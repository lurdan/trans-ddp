<chapt id="after-compromise"><heading>Dopo la compromissione (reazione agli incidenti)</heading>




<sect><heading>Come comportarsi, in generale</heading>

<p>
Se si è fisicamente presenti durante l'attacco, la prima risposta 
dovrebbe essere rimuovere la macchina dalla rete, estraendo la 
scheda di rete (sempre che ciò non danneggi transazioni commerciali
in atto). Disabilitare la rete a basso livello è l'unico vero modo 
di allontanare l'attaccante dalla postazione presa di mira (saggio 
consiglio di Philip Hofmeister).</p>

<p>
Tuttavia, alcuni strumenti di root e porte segrete possono rilevare 
questo fatto e reagire: vedere l'esecuzione di un <tt>rm -rf /</tt> 
mentre si estrae la scheda di rete dal sistema non è molto piacevole. 
Se non si volete correre questo rischio e siete sicuri del 
danneggiamento del sistema, dovreste <em>staccare la spina della 
corrente</em> (tutte le spine, se sono più di una) e incrociare le 
dita; può sembrare un rimedio estremo ma di fatto, evita l'azione 
di qualsiasi bomba-logica programmata dall'intruso. In questo caso,
il sistema <em>non deve essere reinizializzato</em>, ma si 
dovrebbero spostare i dischi fissi su un altro sistema, per 
analizzarli ed usare un altro supporto (un CD-Rom) per inizializzare 
il sistema ed esaminarlo. <em>Evitare</em> l'uso di un disco di 
ripristino Debian per far ripartire il sistema: se si vuole fare
l'analisi del sistema, <em>usare</em> la shell fornita dai dischi 
di installazione (premendo Alt+F2).

<footnote>
<p>Se amate l'avventura, potete salvare informazioni su tutti 
i processi attivi (se ne ricavano molti da /proc/nnn/): potete 
ricavare dalla memoria l'intero codice eseguibile, anche se 
l'attaccante ha cancellato dal disco i file eseguibili, dopodiché... 
staccare la spina della corrente!</p>
</footnote></p>

<p>
L'uso di un file system attivo da CD-Rom, con tutti gli strumenti (e i moduli
del kernel) che possano servire per accedere al sistema danneggiato è il
metodo più consigliabile per tentarne il recupero. Per ottenere tale CD-Rom,
si può usare il pacchetto <package>mkinitrd-cd</package>.

<footnote>
<p>In effetti, questo è lo strumento usato per i CD-Rom del Progetto
<url id="http://www.gibraltar.at/" name="Gibraltar">, un firewall 
su CD-Rom attivo basato sulla distribuzione Debian.</p>
</footnote>. 

Potrebbe essere utile anche il Cd-Rom di 
<url id="http://biatchux.dmzs.com/" name="Biatchux">, visto che è un Cd-Rom
attivo e dotato di strumenti diagnostici utili per questi casi. Non ci sono
ancora né uno strumento come questo basato su Debian, né un modo semplice per
allestire un simile Cd-Rom: per farlo, usando una propria selezione di 
pacchetti Debian e <package>mkinitrd-cd</package>, sarà necessario leggere 
tutta la documentazione fornita con questo.</p>

<p>
Se si vuole aggiustare il danno in tempi brevi, si deve rimuovere dalla
propria rete la postazione danneggiata e reinstallare da zero il sistema
operativo. Naturalmente, questa potrebbe essere una scelta inefficace, dal
momento che non rivela come l'intruso sia riuscito ad assumere lo status di
root; per capirlo, bisogna controllare tutto: il firewall, l'integrità dei
file, la postazione dedicata alla registrazione dei log, gli stessi file di
log e via dicendo. Per maggiori informazioni sul da farsi mentre si segue
un'irruzione, vedete 
<url id="http://www.sans.org/y2k/DDoS.htm" name="Sans' Incident Handling Guide (la Guida di Sans su come
           affrontare un incidente)"> o 
<url id="http://www.cert.org/tech_tips/root_compromise.html" name="CERT's Steps for Recovering from a UNIX or NT System Compromise
           (Regole del CERT per rimediare a un danno a sistemi UNIX o NT)">.</p>

<p>
Alcune questioni comuni, su come trattare un sistema Debian GNU/Linux
danneggiato, sono affrontate in <ref id="vulnerable-system">.</p></sect>


<sect><heading>Fare una copia di ripristino del sistema</heading>

<p>
Si tenga presente che, se si è sicuri che il sistema sia stato danneggiato,
non si può fare affidamento sui programmi installati né sulle informazioni
restituite: le applicazioni potrebbero essere state infettate da virus
trojan, alcuni moduli del kernel poterebbero essere stati installati, ecc.</p>

<p>
La miglior cosa da farsi è una copia completa del file system (mediante 
<prgn>dd</prgn>), dopo la reinizializzazione da un supporto sicuro. 
A tal fine, possono risultare comodi i CD-Rom di Debian GNU/Linux, 
dal momento che, iniziata l'installazione, forniscono, nella console 
2, una shell raggiungibile con Alt+F2 e Invio. Da questa, si salvano 
le informazioni su un altra postazione, se possibile (magari un 
server di file di rete, tramite NFS/FTP), sì da potere svolgere,
a sistema interessato non in linea, l'analisi del danno o la 
reinstallazione.</p>

<p>
Se siete sicuri che la compromissione è avvenuta tramite un 
trojan installato in un modulo del kernel, potete avviare 
tramite l'immagine del kernel denominata <em>rescue</em>.
Assicuratevi di avviare in modalità <em>single user</em>, per 
evitare che altri processi trojanizzati si avviino dopo il kernel.</p></sect>


<sect><heading>Contattate il vostro CERT locale</heading>
<p>Il CERT (Computer and Emergency Response Team) è un'organizzazione
che vi può aiutare a recuperare un sistema compromesso. Ci sono CERT
in tutto il mondo

<footnote>
<p>Questa è una lista di alcuni CERT, per una completa consultare

<url id="http://www.first.org/team-info/" name="FIRST Member Team
information"> (FIRST è il Forum delle reazioni agli incidenti e Security Team):
<url id="http://www.auscert.org.au" name="AusCERT"> (Australia),
<url id="http://www.unam-cert.unam.mx/" name="UNAM-CERT"> (Messico)
<url id="http://www.cert.funet.fi" name="CERT-Funet"> (Finlandia),
<url id="http://ww.dfn-cert.de" name="DFN-CERT"> (Germania),
<url id="http://cert.uni-stuttgart.de/" name="RUS-CERT"> (Germania),
<url id="http://idea.sec.dsi.unim.it" name="CERT-IT"> (Italia),
<url id="http://www.jpcert.or.jp/" name="JPCERT/CC"> (Giappone),
<url id="http://cert.uninett.no" name="UNINETT CERT"> (Norvegia),
<url id="http://www.cert.pl" name="CERT Polskay"> (Polonia),
<url id="http://www.cert.ru" name="RU-CERT"> (Russia),
<url id="http://www.arnes.si/si-cert/" name="Sl-CERT"> (Slovenia)
<url id="http://www.rediris.es/cert/" name="IRIS-CERT"> (Spagna),
<url id="http://www.switch.ch/cert/" name="SWITCH-CERT"> (Svizzera),
<url id="http://www.cert.org.tw" name="TWCERT/CC"> (Taiwan),
e
<url id="http://ww.cert.org" name="CERT/CC"> (USA).</p>
</footnote>

e dovreste contattare il vostro CERT nel caso vi capitasse un
incidente di sicurezza che compromettesse un sistema.
Le persone del vostro CERT vi potranno aiutare a recuperarlo.</p>

<p>Fornendo al vostro CERT (o al CERT coordination center) informazioni
sulla compromissione, anche se non state cercando assistenza, potrete
aiutare gli altri, giacché l'insieme delle informazioni sugli incidenti
riportati al CERT è utilizzata per determinare se una data
vulnerabilità è di uso comune, se c'è un nuovo worm in giro e quali
nuovi strumenti di attacco sono utilizzati.
Queste informazioni sono usate per fornire alla comunità di Internet
le informazioni sulla
<url id="http://www.cert.org/current/" name="attuale attività sugli incidenti di sicurezza">, per
pubblicare <url id="http://www.cert.org/incident_notes/" name="le note sugli incidenti"> e anche gli
<url id="http://www.cert.org/advisories/" name="avvisi">.
Per informazioni più dettagliate leggete come (e perché) fare il
rapporto di un incidente nelle
<url id="http://www.cert.org/tech_tips/incident_reporting.html" name="Linee guida sul rapporto di un incidente">.</p>

<p>Potete anche usare meccanismi meno formali se avete bisogno di
recuperare una compromissione, o se volete discutere sulle informazioni
di un'incidente. Ciò include la
<url id="http://marc.theaimsgroup.com/?l=incidents" name="mailing list degli incidenti"> e la
<url id="http://marc.theaimsgroup.com/?l=intrusions" name="mailing list delle intrusioni">.</p></sect>


<sect><heading>Analisi "patologica"</heading>

<p>
Se si desiderano maggiori informazioni, il pacchetto 
<package>tct</package> ("Gli strumenti del patologo", di Dan Farmer 
e Wientse Venema), oltre a contenere accessori che fanno l'autopsia 
del sistema, permette all'utente di raccogliere dati sui file
cancellati, processi in atto e quant'altro 
(cfr. documentazione acclusa).</p>

<p>
Altri strumenti forniti dalla distribuzione Debian per l'analisi 
"patologica" sono:

<list>

<item><p><package>Fenris</package>.</p></item>
<item><p><package>Strace</package>.</p></item>
<item><p><package>Ltrace</package>.</p></item>

</list></p>

<p>
Questi pacchetti possono analizzare i "binari-canaglia" (come le porte
segrete), per stabilire come funzionino e che cosa facciano al sistema. 
Altri strumenti comuni comprendono 
<prgn>ldd</prgn> (in <package>libc6</package>), <prgn>strings</prgn> e
<prgn>objdump</prgn> (entrambi in <package>binutils</package>).</p>

<p>
Un'analisi patologica su porte segrete o binari sospetti scoperti su sistemi
danneggiati, dovrebbe essere condotta in ambiente sicuro (per esempio,
un'immagine di tipo <package>bochs</package>, <package>flex86</package>
o un sistema sottoposto a <prgn>chroot</prgn> con un utente con 
privilegi minimi), altrimenti il sistema può essere a rischio di
porte segrete o, peggio, usurpazione di root.</p>

<p>
Inoltre, condurre sempre l'analisi patologica sulla copia di ripristino dei
dati, <em>mai</em> direttamente sui dati stessi: in caso di alterazione 
durante l'analisi, ogni tipo di prova verrebbe perso!</p>

<p>
FIXME: Se tutto va bene, in futuro questo paragrafo possa contenere maggiori
informazioni sui metodi di diagnosi in un sistema Debian.</p>

<p>
FIXME: Bisognerebbe parlare di come creare un archivio di tipo debsums su un
sistema stabile, salvando i file MD5sums su CD e ripristinando su una
partizione distinta il sistema recuperato.</p>

<p>
FIXME: aggiungere indicazioni su scritti riguardanti l'analisi "patologica",
come "the Honeynet's reverse challenge" (La controsfida della Honeynet) o i
<url id="http://staff.washington.edu/dittrich/" name="saggi di David Dittirch's">.</p></sect></chapt>






