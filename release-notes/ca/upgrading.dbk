<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % shareddata   SYSTEM "../release-notes.ent" > %shareddata;
]>
<!-- English version: 5957 -->
<!-- Last translator: Miguel Gea Milvaques (xerakko) 2009.01.27 -->

<chapter id="ch-upgrading" lang="ca">
<title>Actualitzacions des de versions anteriors</title>
<section id="backup">
<title>Preparació de l'actualització</title>
<para>
Us suggerim que abans de l'actualització llegiu la informació que hi ha a
<xref linkend="ch-information"/>.  Este capítol cobreix els possibles problemes que
no estan directament relacionats amb el procés d'actualització però que encara poden 
ser importants abans de començar.
</para>
<section id="data-backup">
<title>Copieu qualsevol dada o informació per la configuració</title>
<para>
Abans de l'actualització del vostre sistema, és molt recomanable que feu una
còpia de seguretat, o al menys copieu les dades relatives a la configuració
que no es podeu permetre de perdre. Les eines i el procés de configuració són prou
segurs, però una fallada del maquinari en mig d'una actualització pot deixar-vos
un sistema greument danyat.
</para>
<para>
Les principals coses que heu de fer còpia són els continguts 
d'<filename>/etc</filename>, <filename>/var/lib/dpkg</filename>,
<filename>/var/lib/aptitude/pkgstates</filename> i la eixida de
<literal>dpkg --get-selections "*"</literal> (les cometes són importants.).
</para>
<para>
El procés en si no modifica cap dels directoris
<filename>/home</filename>.  Per altre costat, algunes aplicacions (p.e.  algunes aplicacions
del conjunt de programes de Mozilla i dels entorns d'escriptori de GNOME i KDE) es
sap que escriuen les que ja hi ha amb nous valors per defecte quan s'inicia una
nova versió de l'aplicació la primera vegada per cada usuari. 
Com a precaució, pot ser voleu fer una còpia de seguretat dels fitxers ocults i els 
directoris (<quote>dotfiles</quote>) als directoris home dels usuaris. 
Esta còpia us pot ajudar a recuperar o recrear la antiga configuració.
Hauríeu d'informar els usuaris dels canvis.
</para>
<para>
Qualsevol operació d'instal·lació de paquets s'ha de fer amb privilegis de superusuari,
per tant, o bé entreu com a <literal>root</literal>, o utilitzeu <command>su</command> o <command>sudo</command>
per aconseguir els drets d'accés necessaris.
</para>
<para>
L'actualització te unes quantes condicions prèvies que hauríeu de comprovar abans
d'iniciar l'actualització.
</para>
</section>

<section id="inform-users">
<title>Informeu els usuaris en antelació</title>
<para>
És desitjable que informeu a tots els usuaris per avançat abans de fer les
actualitzacions que esteu plantejant, encara que els usuaris que accedeixen al
vostre sistema amb una connexió <command>ssh</command> hauria de notar-ho un poc
a l'actualització, i haurien de ser capaços de continuar treballant.
</para>
<para>
Si voleu agafar precaucions extra, feu una còpia o desmunteu les particions
des usuaris (<filename>/home</filename>) abans d'actualitzar.
</para>
<para>
Probablement haureu de fer una actualització del nucli quan actualitzeu a &releasename;,
per tant serà necessari tornar a iniciar. Típicament, es farà després de completar
l'actualització.
</para>
</section>

<section id="recovery">
<title>Prepareu-se per la recuperació</title>
<para>
Degut als molts canvis que hi ha entre els nuclis d'&oldreleasename; i de &releasename; respecte a
controladors, cerca de nou maquinari i a l'ordenació i nombrat dels fitxers de dispositiu, 
hi ha un risc real que tingueu problemes al tornar a iniciar el vostre sistema desprès
de l'actualització. S'han documentat molts problemes en potència en aquest capítol
i en els següents de estes notes de llançament.
</para>
<para>
Per este motiu te sentit assegurar-se que sereu capaços de recuperar si el
vostre sistema falla a l'arrencar, o a sistemes gestionats remotament, fallen
en alçar la xarxa.
</para>
<para>
Si esteu actualitzant de forma remota amb una connexió <command>ssh</command>, és
molt recomanable que agafeu les precaucions necessàries per ser capaços d'accedir
al servidor a través d'un terminal sèrie remot. Hi ha la possibilitat que després
d'actualitzar el nucli i de tornar ainiciar, alguns dels dispositius hagen canviat de nom 
(tal i com es descriu a <xref linkend="device-reorder"/> ) i haureu de corregir la
configuració del sistema amb una consola local. També, si els sistema s'ha tornat a iniciar
accidentalment a mitjan actualització, pot ser que necessiteu recuperar-vos utilitzant una
consola local.
</para>
<para>
La primera opció òbvia a intentar és tornar a iniciar amb el nucli antic.
Però, per diferents motius documentats per tot arreu en este document, no està
garantit que funcione.
</para>
<para>
Si això falla, necessitareu un mètode alternatiu per arrancar el vostre sistema per
poder accedir-ne i reparar-lo. Una opció és utilitzar una imatge especial de rescat
o un Linux live CD. Desprès de tornar a iniciar-ho, hauríeu de ser capaços de muntar
el vostres sistema arrel i fer un <literal>chroot</literal>  en ell per investigar
i corregir el problema.
</para>
<para>
Un altra opció que ens agradaria recomanar és utilitzar el <emphasis>mode de
rescat</emphasis> de l'instal·lador de Debian &releasename;.  La principal avantatja 
d'utilitzar l'instal·lador és que podeu triar entre els seus modes d'instal·lació el
que millor s'ajuste a la vostra situació.  Per obtenir més informació, consulteu la 
secció <quote>Recuperació d'un sistema trencat</quote> al capítol 8 de la <ulink
url="&url-install-manual;">guia d'instal·lació</ulink> i les <ulink
url="&url-wiki;DebianInstaller/FAQ">FAQ de l'instal·lador de Debian</ulink>.
</para>
<section id="recovery-initrd">
<title>L'intèrpret d'ordres de depudació a l'arrancada quan s'utilitza initrd</title>
<para>
L'<systemitem role="package">initramfs-tools</systemitem> inclou un intèrpret d'ordres
de depuració<footnote><para> Esta característica es pot inhabilitar afegint el paràmetre
<literal>panic=0</literal> als vostres paràmetres d'arrencada.  </para> </footnote> a
l'initrd que genera. Per exemple, si l'initrd no pot muntar el vostre sistema
de fitxers arrel, sereu enviats a este intèrpret d'ordres de depuració que conté 
les ordres bàsiques disponibles per fer el seguiment del problema i possiblement
corregir-lo.
</para>
<para>
Les coses bàsiques a comprovar són: la presència dels fitxers de dispositiu correctes a
<filename>/dev</filename>; quins mòduls s'han carregat (<literal>cat
/proc/modules</literal>) i l'eixida de <command>dmesg</command> per trobar errors en la
càrrega dels controladors. L'eixida del <command>dmesg</command> us mostrarà quins fitxers
de dispositiu s'han assignat a quins discs; també hauríeu de comprovar l'eixida de 
<literal>echo $ROOT</literal> per assegurar-vos que el sistema de fitxers arrel és
al dispositiu esperat.
</para>
<para>
Si feu gestions per resoldre el problema, escrivint <literal>exit</literal> eixirà 
de l'intèrpret d'ordres i continuarà el procés d'arrancada des del punt on havia fallat.
Per suposat, necessitareu corregir el problema de base i regenerar l'initrd de manera
que no torne a fallar en la pròxima arrancada.
</para>
</section>

</section>

<section id="upgrade-preparations">
<title>Prepareu un entorn segur per l'actualització</title>
<para>
L'actualització de la distribució s'hauria de fer o bé localment amb una consola
virtual en mode text (o directament connectat amb una terminal sèrie), o remotament
amb un enllaç <command>ssh</command>.
</para>
<para>
Per obtenir un marge de seguretat addicional quan s'actualitza remotament, suggerim
que feu el procés d'actualització en la consola virtual que proporciona l'ordre
<command>screen</command>, que facilita una reconnexió segura i assegura que el 
procés d'actualització no s'interromp inclòs si falla el procés de connexió remota.
</para>
<important>
  <para>
    <emphasis>No</emphasis> hauríeu d'actualitzar utilitzant <command>telnet</command>,
    <command>rlogin</command>, <command>rsh</command>, o des d'una sessió X
    controlada per l'<command>xdm</command>, <command>gdm</command>
    o <command>kdm</command> etc. a la màquina que esteu actualitzant.
    Açò és perquè estos serveis s'aturaran a l'actualització, el que pot resultar
    en un sistema
    <emphasis>inaccessible</emphasis> que es troba a mig actualitzar.
  </para>
</important>

<programlisting condition="fixme">
TODO: surely gdm/kdm are sane?
(vorlon) haha, no, gdm is not; I had that thought, and tested a gdm
         restart on my live session ;)
</programlisting>

</section>

<section arch="i386;amd64" id="prepare-initramfs">
  <title>Preparació de l'initramfs per <acronym>LILO</acronym><indexterm><primary>LILO</primary></indexterm></title>
  <para>
    Els usuaris que utilitzen el carregador d'arrancada<acronym>LILO</acronym> 
    haurien de fixar-se que ara els paràmetres per defecte de l'<systemitem
    role="package">initramfs-tools</systemitem> genera un
    initramfs que és massa gran per poder-se carregar amb <acronym>LILO</acronym>. Estos usuaris
    haurien de canviar a <systemitem role="package">grub</systemitem>, o
    editar el fitxer
    <filename>/etc/initramfs-tools/initramfs.conf</filename>, canviant
    la línia <programlisting>MODULES=most</programlisting> per
    <programlisting>MODULES=dep</programlisting></para>

  <para>
    Adoneu-vos, que, açò farà que el vostre <systemitem
    role="package">initramfs-tools</systemitem> tan sols instal·larà
    els mòduls que són necessaris pel maquinari en particular que on s'executa,
    al initramfs; com a tal, si voleu generar un
    mitjà d'arrancada que funcione amb més maquinari que amb el que esteu 
    generant-ho, hauríeu de deixar el paràmetre a
    <programlisting>MODULES=most</programlisting> i assegurar-vos que no
    utilitzeu el <acronym>LILO</acronym>.
  </para>
</section>

</section>

<section id="system-status">
<title>Comprovació de l'estat del sistema</title>
<para>
El procés d'actualització descrit en este capítol s'ha dissenyat per actualitzar
un sistema &oldreleasename; <quote>pur</quote>, sense paquets de tercers.
Per obtenir una major fiabilitat del procés d'actualització, pot ser podríeu 
esborrar els paquets de tercers del vostre sistema abans de iniciar l'actualització.
</para>
<para>
Este procés assegura que el vostre sistema s'ha actualitzat a l'últim punt
del llançament d'&oldreleasename;.  Si no ho heu fet o no esteu segurs, seguiu les
instruccions de <xref linkend="old-upgrade"/>.
</para>
<section id="review-actions">
<title>Revisió de les accions pendens al gestor de paquets</title>
<para>
En altres casos, l'us d'<command>apt-get</command> per instal·lar paquets en
comptes d'<command>aptitude</command> podria fer que l'<command>aptitude</command>
considere un paquet com <quote>unused</quote> i el marque per esborrar-lo. 
En general, hauríeu d'assegurar-vos que el sistema està totalment actualitzat i
<quote>net</quote> abans de continuar amb l'actualització.
</para>
<para>
Per este motiu hauríeu de revisar si hi ha accions pendents al gestor de
paquets <command>aptitude</command>.  Si un paquet està marcat per 
esborrar o actualitzar al gestor de paquets, podria afectar negativament el
procediment d'actualització. Adoneu-vos que corregir açò tan sols es possible si
el vostre <filename>sources.list</filename> encara apunta a <emphasis>&oldreleasename;</emphasis>;
i no a <emphasis>stable</emphasis> o <emphasis>&releasename;</emphasis>; mireu <xref
linkend="old-sources"/>.
</para>
<para>
Per fer-ho, heu d'executar <command>aptitude</command> en <quote>mode visual</quote> i prémer 
<keycap>g</keycap> (<quote>Go</quote>).  Si mostra alguna acció, hauríeu de revisar-la i o bé corregir-la
o implementar les accions suggerides. Si no es suggereix cap acció voreu un missatge que dirà 
<quote>No hi ha cap paquet marcat per instal·lar, esborrar o actualitzar</quote>.
</para>
</section>

<section id="disable-apt-pinning">
<title>Inhabilitar el pinning d'APT</title>
<para>
Si heu configurat l'APT per que instal·le alguns paquets d'altra distribució
que no siga stable (per exemple testing), haureu de canviar la vostra configuració
de pinning d'APT (que es troba a <filename>/etc/apt/preferences</filename>) per permetre
l'actualització dels paquets a les versions del nou llançament estable. Podeu trobar
més informació del pinning d'APT a <citerefentry>
<refentrytitle>apt_preferences</refentrytitle> <manvolnum>5</manvolnum>
</citerefentry>.
</para>
</section>

<section id="package-status">
<title>Comprovació de l'estat dels paquets</title>
<para>
En relació al mètode utilitzat per actualitzar, es recomana que comproveu
primer l'estat de tots els paquets, i que comproveu que tots els paquets estan
en un estat actualitzable. L'ordre següent mostrarà quins paquets tenen un
estat de mig-instal·lat o fallada-de-configuració, i aquells que tenen un estat
d'error.
</para>
<screen>
# dpkg --audit
</screen>
<para>
Podeu inspeccionar l'estat de tos els paquets del vostre sistema utilitzant
<command>dselect</command>, <command>aptitude</command>, o amb ordres de
l'estil
</para>
<screen>
# dpkg -l | pager
</screen>
<para>
o
</para>
<screen>
# dpkg --get-selections "*" &gt; ~/curr-pkgs.txt
</screen>
<para>
Seria desitjable que esborréssiu qualsevol paquet mantingut. Si qualsevol 
paquet essencial per l'actualització es troba mantingut, l'actualització fallarà.
</para>
<para>
Adoneu-vos que l'<command>aptitude</command> utilitza un mètode diferent pel registre dels
paquets que estan mantinguts que l'<command>apt-get</command> i que 
<command>dselect</command>.  Podeu identificar els paquets mantinguts per 
l'<command>aptitude</command> amb
</para>
<screen>
# aptitude search "~ahold" | grep "^.h"
</screen>
<para>
Si voleu comprovar quins paquets estan mantinguts per 
l'<command>apt-get</command>, hauríeu d'utilitzar
</para>
<screen>
# dpkg --get-selections | grep hold
</screen>
<para>
Si heu canviat i tornat a compilat un paquet de forma local, i no l'heu reanomenat o li heu
canviat una era en la versió, haureu de mantenir-lo per prevenir que s'actualitze.
</para>
<para>
Es pot canviar l'estat <quote>mantingut</quote> d'un paquet per l'<command>aptitude</command> utilitzant:
</para>
<screen>
# aptitude hold <replaceable>nom_del_paquet</replaceable>
</screen>
<para>
Reemplaceu el <literal>hold</literal> amb <literal>unhold</literal> per canviar l'estat
<quote>hold</quote>.
</para>
<para>
Si hi ha alguna cosa per corregir, és molt millor assegurar-se que el
<filename>sources.list</filename> encara apunta a &oldreleasename; tal i com s'explica a
<xref linkend="old-sources"/>.
</para>
</section>

<section id="proposed-updates">
  <title>La secció proposed-updates</title>
  <para>
    Si teniu al vostre fitxer <filename>/etc/apt/sources.list</filename> la 
    secció <literal>proposed-updates</literal>, 
    hauríeu d'esborrar-la d'eixe fitxer abans d'intentar l'actualització del vostre
    sistema. Esta es una precacució per reduir la probabilitat de
    conflictes.
  </para>
</section>

<section id="userbackports">
<title>Origens de programari no oficials i backports</title>
<para>
Si teniu algun paquet que no és de Debian al vostre sistema, hauríeu d'anar en compte
ja que podrien esborrar-se a l'actualització degut a alguna dependència conflictiva.
Si estos paquets es van instal·lar afegint un arxiu extra al vostre
<filename>/etc/apt/sources.list</filename>, hauríeu de comprovar si eixe arxiu 
també ofereix paquets compilats per &releasename; i canviar la línia d'origen 
d'acord amb els vostres origens dels paquets de Debian.
</para>
<para>
Alguns usuaris han fet un backport no oficial amb versions <quote>més noves</quote> 
de paquets que els que <emphasis>estan</emphasis> instal·lats en Debian al seu sistema  
&oldreleasename;.  Estos paquets tenen més possibilitats de causar problemes a l'actualització
ja que poden entrar en conflicte<footnote><para> El sistema de gestió de paquets de Debian
normalment no permet que un paquet esborre o reemplace un fitxer que és propietat d'un
altre paquet a menys que s'haja definit que reemplaça eixe paquet. </para> </footnote>.
A <xref linkend="trouble"/> hi ha alguna informació de com tractar amb fitxers amb conflictes
si algun apareguera.
</para>
<section>
  <title>Ús dels paquets de <literal>backports.org</literal></title>
  <para>
    <literal>backports.org</literal> és un repositori quasi-oficial
    proporcionat per desenvolupadors de Debian, que facilita paquets nous
    pel llançament estable, basat en tornar a construir els paquets de 
    l'arxiu <quote>testing</quote>.
  </para>
  <para>
    El repositori <literal>backports.org</literal> conté els paquets 
    de <quote>testing</quote>, però amb números de versió reduits,
    de manera que l'actualizació des dels backports d'&oldreleasename; a
    &releasename; es segura. Per altra banda, hi ha uns pocs que
    s'han fet des d'unstable (actualitzacions de seguretat i les 
    excepcions següents: firefox, nucli, openoffice.org i xorg).
  </para>
  <para>
    Si no utilitzeu estes excepcions, podeu actualitzar de forma segura 
    a &releasename;. Si utilitzeu una de estes excepcions, fixeu el
    pin-priority (vegeu <command>man apt_preferences</command>)
    de forma temporal a <literal>1001</literal> per tots els paquets de &releasename;,
    i hauríeu de ser capaços d'assegurar un dist-upgrade també. Vegeu les
    <ulink
    url="http://backports.org/dokuwiki/doku.php?id=faq">PMF dels 
    backports</ulink>.
  </para>
</section>
</section>

</section>

<section id="handle-conflict">
<title>Desmarcat manual de paquets</title>
<para>
Per prevenir que l'<command>aptitude</command> esborre algun paquet que es van instal·lar 
forçat per alguna dependència, necessitareu eliminar la marca
<emphasis>auto</emphasis> dels paquets.  Açò inclou l'OpenOffice i el Vim per 
instal·lacions d'escriptori:
</para>
<screen>
# aptitude unmarkauto openoffice.org vim
</screen>
<para>
I les imatges de nuclis 2.6 que heu instal·lat utilitzant un metapaquet de nucli:
</para>
<screen>
# aptitude unmarkauto $(dpkg-query -W 'kernel-image-2.6.*' | cut -f1)
</screen>
<note>
  <para>
    Podeu revisar quins paquets s'han marcat com <emphasis>auto</emphasis> amb in
    aptitude executant:
  </para>
  <screen># aptitude search 'i~M <replaceable>nom_del_paquet</replaceable>'</screen>
</note>
</section>

<section id="upgrade-process">
<title>Preparació dels origens del programari per l'APT</title>
<para>
Abans d'iniciar l'actualització heu de configurar la configuració de l'<systemitem
role="package">apt</systemitem> per les llistes de paquets,
<filename>/etc/apt/sources.list</filename>.
</para>
<para>
L'<systemitem role="package">apt</systemitem> considerarà que tots els paquets es poden 
trobar via alguna línia <quote><literal>deb</literal></quote>, i instal·la el paquet
amb una versió superior, donant prioritat a la primera de les línies esmentades
(de esta forma, en cas de tenir múltiples rèpliques, normalment primer nombrareu el 
primer disc dur, després els CD-ROM i després les rèpliques HTTP/FTP).
</para>
<para>
Sovint ens referim a un llançament pel seu nom clau (p.e.
<literal>&oldreleasename;</literal>, <literal>&releasename;</literal>) i pel 
seu nom de l'estat (i.e.  <literal>oldstable</literal>, <literal>stable</literal>,
<literal>testing</literal>, <literal>unstable</literal>).  Referir-se a un
llançament pel seu nom clau te l'avantatge que mai us sorprendrà un nou llançament
i per això serà l'aproximació agafada ací. Això vol dir que haureu de mirar
vosaltres els nous llançaments de la distribució.
Si utilitzeu el nom de l'estat, voreu que hi ha moltes noves actualitzacions dels 
paquets disponibles en el moment que es produeixca el llançament.
</para>
<section id="network">
<title>Nous origens de programari per APT a Internet</title>
<para>
La configuració per defecte està feta per instal·lar des dels principals 
servidors de Debian a Internet, però pot ser hauríeu de modificar
l'<filename>/etc/apt/sources.list</filename> per a què utilitze altres rèpliques,
preferiblement una rèplica que estiga més propera en termes de xarxa a vosaltres.
</para>
<para>
Les adreces de les rèpliques HTTP o FTP les pots trobar a <ulink
url="&url-debian-mirrors;"></ulink> (mireu a la secció <quote>llista de rèpliques de
Debian</quote>).  Les rèpliques HTTP normalment són més ràpides que les FTP.
</para>
<para>
Per exemple, suposeu que la vostra rèplica de Debian és
<literal>&url-debian-mirror-eg;</literal>.  Quan visiteu eixa 
rèplica amb un navegador web o amb un programari d'FTP, voreu que els 
directoris principals estan organitzats així:
</para>
<programlisting>
&url-debian-mirror-eg;/dists/&releasename;/main/binary-&architecture;/...
&url-debian-mirror-eg;/dists/&releasename;/contrib/binary-&architecture;/...
</programlisting>
<para>
Per utilitzar esta rèplica amb <systemitem role="package">apt</systemitem>, afegiu esta línia al vostre
fitxer <filename>sources.list</filename>:
</para>
<programlisting>deb &url-debian-mirror-eg; &releasename; main contrib</programlisting>
<para>
Adoneu-vos que el `<literal>dists</literal>' s'afegeix de forma implícita, i que els
arguments després del nom del llançament s'utilitzen per completar el camí pels
múltiples directoris.
</para>
<para>
A l'afegir els vostres nous origens pel programari, inhabiliteu les línies
<quote><literal>deb</literal></quote> que ja teníeu al <filename>sources.list</filename> posant
un comodí (<literal>#</literal>) al davant d'elles.
</para>
</section>

<section id="localmirror">
<title>Afegint origens de programari d'APT per una rèplica local</title>
<para>
En comptes d'utilitzar una rèplica de paquets HTTP o FTP, hauríeu de voler modificar el
<filename>/etc/apt/sources.list</filename> per utilitzar una rèplica a un disc local
(possiblement muntat per NFS <acronym>NFS</acronym>).
</para>
<para>
Per exemple, la vostra rèplica de paquets podria ser a
<filename>/var/ftp/debian/</filename>, i tenir els directoris principals de l'estil:
</para>
<programlisting>
/var/ftp/debian/dists/&releasename;/main/binary-&architecture;/...
/var/ftp/debian/dists/&releasename;/contrib/binary-&architecture;/...
</programlisting>
<para>
Per fer-ho amb l'<systemitem role="package">apt</systemitem>, afegiu esta línia al vostre
fitxer <filename>sources.list</filename>:
</para>
<programlisting>deb file:/var/ftp/debian &releasename; main contrib</programlisting>
<para>
Adoneu-vos que el `<literal>dists</literal>' s'afegeix de forma implícita, i que els arguments 
desprès del nom s'ha utilitzat per completar la ruta al tots els directoris.
</para>
<para>
Desprès d'afegir el vostres nous origens de programari, inhabiliteu les línies 
<quote><literal>deb</literal></quote> que ja havia al <filename>sources.list</filename> afegint un
comodí (<literal>#</literal>) al davant.
</para>
</section>

<section id="cdroms">
<title>Afegint origens de programari d'APT des d'un CD-ROM o DVD</title>
<para>
Si <emphasis>tan sols</emphasis> voleu utilitzar CD, elimineu els comentaris 
de les línies <quote><literal>deb</literal></quote> a l'<filename>/etc/apt/sources.list</filename> posant
un comodí davant d'elles (<literal>#</literal>).
</para>
<para>
Assegureu-vos que hi ha una línia <filename>/etc/fstab</filename> que activa el
muntatge de les unitats de CD-ROM al punt de muntatge <filename>/cdrom</filename> 
(es necessita el punt de muntatge exacte <filename>/cdrom</filename> per 
l'ordre <command>apt-cdrom</command>).  Per exemple, si la vostra unitat de 
CD-ROM és <filename>/dev/hdc</filename>, el <filename>/etc/fstab</filename> 
hauria de contenir una línia de l'estil:
</para>
<programlisting>
/dev/hdc /cdrom auto defaults,noauto,ro 0 0
</programlisting>
<para>
Adoneu-vos que <emphasis>no</emphasis> hauria d'haver espais entre les paraules
<literal>defaults,noauto,ro</literal> al quart camp.
</para>
<para>
Per comprovar que funciona, inseriu un CD i proveu d'executar
</para>
<screen>
# mount /cdrom    # açò muntarà el CD al punt de muntatge
# ls -alF /cdrom  # açò hauria de mostrar el directori arrel del CD
# umount /cdrom   # açò desmuntarà el cdrom
</screen>
<para>
La pròxima vegada, executeu:
</para>
<screen>
# apt-cdrom add
</screen>
<para>
per cada CD-ROM de Debian amb binaris que tingueu, per afegir les dades de cada
CD a la base de dades d'APT.
</para>
</section>

</section>

<section id="upgradingpackages">
<title>Actualització de paquets</title>
<para>
La manera recomanada d'actualitzar des dels llançament anteriors de &debian; és
utilitzar l'eina de gestió de paquets <command>aptitude</command>.  Este programa
fa més segures les decisions d'instal·lacions de paquets que si s'executa 
<command>apt-get</command> directament.
</para>
<para>
No oblideu de muntar totes les particions necessàries (especialment les
particions arrel i la partició <filename>/usr</filename>) amb lectura i escriptura
amb una ordre de l'estil:
</para>
<screen>
# mount -o remount,rw /<replaceable>punt_muntatge</replaceable>
</screen>
<para>
A continuació hauríeu de comprovar que les entrades d'APT  (a
l'<filename>/etc/apt/sources.list</filename>) apunten o bé a
<quote><literal>&releasename;</literal></quote> o a <quote><literal>stable</literal></quote>.  No hauríeu de trobar
cap origen apuntat a &oldreleasename;.
<note>
  <para>
    Les línies CD-ROM sovint apunten a
    <quote><literal>unstable</literal></quote>; encara que açò pot donar lloc a
confusió, <emphasis>no</emphasis> hauríeu de canviar-les.
  </para>
</note>
</para>
<section id="record-session">
<title>Desar la sessió</title>
<para>
És molt recomanable que utilitzeu l'ordre <command>/usr/bin/script</command>
per desar una transcripció de la sessió d'actualització. Quan aparega un problema,
haureu de tenir un registre del que ha passat, i si fera falta, podríeu donar
informació exacta en un informe d'error. Per iniciar el desat, escriviu:
</para>
<screen>
# script -t 2&gt;~/upgrade-&releasename;.time -a ~/upgrade-&releasename;.script
</screen>
<para>
o alguna cosa semblant.  No poseu el fitxer  typescript a un directori temporal 
com el <filename>/tmp</filename> o <filename>/var/tmp</filename> (els fitxers
d'estos directoris s'esborraran a l'actualització o al tornar a iniciar).
</para>
<para>
El typescript també us permetrà que reviseu la informació que ha quedat fora
de la pantalla pel desplaçament. Canvieu a VT2 (amb
<keycombo action='simul'><keycap>Alt</keycap><keycap>F2</keycap></keycombo>)
i, després d'entrar, utilitzeu
<literal>less -R ~root/upgrade-&releasename;.script</literal> per vore 
el fitxer.
</para>
<para>
Després de completar l'actualització, podeu detenir l'<command>script</command> 
escrivint <literal>exit</literal> a l'indicador.
</para>

<programlisting condition="fixme">
TODO: Could mention the script I provided in 400725 which is useful if you 
have not dumped the timing file
</programlisting>

<para>
Si heu utilitzat l'opció <emphasis>-t</emphasis> pel 
<command>script</command> podreu utilitzar <command>scriptreplay</command>
per reproduir la sessió completa:
</para>
<screen>
# scriptreplay ~/upgrade-&releasename;.time ~/upgrade-&releasename;.script
</screen>
</section>

<section id="updating-lists">
<title>Actualització de la llista de paquets</title>
<para>
Primer la llista de paquets que hi ha a l'abast s'ha de descarregar.
Açò es pot fer executant:
</para>
<screen>
# aptitude update
</screen>
<para>

A la primera execució els nous origens que s'actualitzen imprimiran alguns
avisos relacionats amb la disponibilitat dels origens.  Estos avisos són
inofensius i no apareixeran la pròxima execució de l'ordre.
</para>
</section>

<section id="sufficient-space">
<title>Assegureu-vos que hi ha prou espai per fer l'actualització</title>
<para>
Heu d'assegurar-vos abans d'actualitzar que el vostre sistema té espai suficient
al disc dur quan inicieu l'actualització completa del vostre sistema tal i com
es descriu a <xref linkend="upgrading-other"/>. Primer, es descarreguen des de 
la xarxa tots els paquets necessaris per a la instal·lació emmagatzemant-se a
<filename>/var/cache/apt/archives</filename> (i al subdirectori
<filename>partial/</filename>, quan es descarreguen), per tant hauríeu 
d'assegurar-vos que disposeu de suficient espai en disc al sistema de fitxers
que conté el vostre <filename>/var/</filename> per descarregar temporalment
els paquets que s'instal·laran al vostre sistema.  Després de la descàrrega,
necessitareu probablement més espai a altres particions amb sistemes de fitxers
per instal·lar tant els paquets actualitzats (que podrien contenir binaris més grans
o més dades) com els nous que entraran a l'actualització. Si el vostre sistema
no te prou espai, podríeu acabar amb una actualització incompleta de la que 
podria ser difícil recuperar-se.
</para>
<para>
Tant l'<command>aptitude</command> com l'<systemitem role="package">apt</systemitem> 
us mostrarà informació detallada de l'espai en disc necessari per la instal·lació.
Abans de continuar amb l'actualització, ho podeu estimar executant:</para>
<screen>
# aptitude -y -s -f --with-recommends dist-upgrade
[ ... ]
XXX actualitzats, XXX nous a instal·lar, XXX a suprimir i XXX no actualitzats.
Es necessita obtenir xx.xMB/yyyMB d'arxius. Després d'aquesta operació s'empraran 
AAAMB d'espai en disc addicional.
Voleu descarregar/instal·lar/esborrar els paquets?
</screen>
<para>
<footnote><para> Si executeu esta ordre a l'inici del procés d'actualització
podria donar un error, per les raons que es descriuen a les següents seccions. En este
cas necessitareu esperar a haver acabat una actualització mínima del sistema com contem a
<xref linkend="minimal-upgrade"/> i actualitzar el nucli com es descriu a  <xref
linkend="upgrading-kernel"/> abans d'executar esta ordre per estimar l'espai 
en disc.</para> </footnote>
</para>
<para>
Si no disposeu de suficient espai per l'actualització, assegureu-vos d'alliberar
espai primer. Podeu:
</para>
<itemizedlist>
<listitem>
<para>
Esborreu els paquets que s'han descarregat prèviament per instal·lar-los (a
<filename>/var/cache/apt/archives</filename>).  Podeu buidar la memòria cau dels paquets
executant <command>apt-get clean</command> o <command>aptitude clean</command>
que esborraran tots els paquets que s'havien descarregat prèviament.
</para>
</listitem>
<listitem>
<para>
Esborreu els paquets vells que no utilitzeu. Si teniu el paquet
<systemitem role="package">popularity-contest</systemitem> instal·lat, podeu executar
<command>popcon-largest-unused</command> per obtenir la llista de paquets que no utilitzeu
al sistema que ocupa la major part de l'espai. També podeu utilitzar
<command>deborphan</command> o <command>debfoster</command> per localitzar paquets 
obsolets (vegeu <xref linkend="obsolete"/> ).  De forma alternativa, podeu arrancar
<command>aptitude</command> en <quote>mode visual</quote> i trobar els paquets obsolets a
<quote>Paquets obsolets i creats localment</quote>.
</para>
</listitem>
<listitem>
<para>
Esborreu els paquets que estan utilitzant molt d'espai, que no són útils ara 
(sempre els podeu reinstal·lar després de l'actualització). Podeu obtenir una llista
amb els paquets que ocupen més espai en disc amb <command>dpigs</command> (el trobareu al
paquet <systemitem role="package">debian-goodies</systemitem>) o amb
<command>wajig</command> (executant <literal>wajig size</literal>).
</para>
<programlisting condition="fixme">
TODO: consider this for lenny
Podeu obtenir la llista de paquets que més espai utilitzen amb
l'<systemitem role="package">aptitude</systemitem>.  Executeu 
l'<command>aptitude</command> en <emphasis>mode visual</emphasis>,
selecioneu <guimenu>Vistes</guimenu> i <guimenu>Llista de paquets plana
nova</guimenu> (esta entrada de menú tan sols hi és a les versions posteriors a etch),
premeu <keycap>l</keycap> i introduiu <keycombo
action="seq"><keycap>~</keycap><keycap>i</keycap></keycombo>, premeu
<keycap>S</keycap> i introduïu <literal>~installsize</literal>, aleshores
us donarà una bona llista amb la que treballar. Fent açò desprès de
l'actualització de l'<systemitem role="package">aptitude</systemitem> us hauria donar
accés a esta nova característica.
</programlisting>

</listitem>
<listitem>
<para>
De forma temporal, mogueu a un altre sistema, o esborreu permanentment els registres
del sistema que hi ha a <filename>/var/log/</filename>.
</para>
</listitem>
<listitem>
  <para>
    Utilització temporal de <filename>/var/cache/apt/archives</filename>: 
    podeu utilitzar un directori temporal a un altre sistema de fitxers
    (un dispositiu d'emmagatzemament <acronym>USB</acronym>  un disc temporal,
    un sistema de fitxers ja utilitzat, ...)
  </para>
  <note>
    <para>
      No utilitzeu un muntatge <acronym>NFS</acronym> ja que la connexió a la 
      xarxa es podria interrompre a l'actualització.
    </para>
  </note>
    <para>
  Per exemple, si teniu un disc usb muntat a <filename>/media/usbkey</filename>:
  <orderedlist>
    <listitem>
      <para>
        esborreu els paquets que s'han descarregat per instal·lar-se:

	<screen># apt-get clean</screen>
      </para>
    </listitem>
    <listitem>
      <para>
	copieu el directori
	<filename>/var/cache/apt/archives</filename> al disc 
	<acronym>USB</acronym>:

	<screen># cp -ax /var/cache/apt/archives /media/usbkey/</screen>
      </para>
    </listitem>
    <listitem>
      <para>
	munteu el directori temporal a l'actual:

	<screen># mount --bind /media/usbkey/archives /var/cache/apt/archives</screen>
      </para>
    </listitem>
    <listitem>
      <para>
	després de l'actualització, restaureu el directori original
	<filename>/var/cache/apt/archives</filename>:

	<screen># umount /media/usbkey/archives</screen>
      </para>
    </listitem>
    <listitem>
      <para>
	esborreu els que queden a <filename>/media/usbkey/archives</filename>.
      </para>
    </listitem>
  </orderedlist>
  Podeu crear el directori temporal en qualsevol sistema de fitxers
  que tingueu muntat al vostre sistema.
  </para>
  </listitem>
</itemizedlist>
<para>
Adoneu-vos que per esborrar paquets de forma segura, és aconsellable canviar el vostre 
<filename>sources.list</filename> a &oldreleasename; tal i com es descriu a  <xref
linkend="old-sources"/>.
</para>
</section>

<section id="aptupgrade1st">
  <title>Actualització prèvia d'apt i/o aptitude</title>
  <para>
    Alguns informes d'error han mostrat que les versions d'<systemitem
    role="package">aptitude</systemitem> i <systemitem
    role="package">apt</systemitem> a etch sovint no poden gestionar 
    l'actualització a  &releasename;. A &releasename;, l'<systemitem
    role="package">apt</systemitem> tracta millor cadenes de paquets que
    necessiten una configuració immediata i  <systemitem
    role="package">aptitude</systemitem> és més intel·litgent en la cerca
    de solucions per satisfer les dependències. Com que les dos característiques
    estan molt a dins del dist-upgrade a  &releasename;, s'hauran
    d'actualitzar estos dos paquets abans d'actualitzar
    qualsevol altra cosa. Per <systemitem role="package">apt</systemitem>, executeu:
    <screen># apt-get install apt</screen>
    i per a <systemitem role="package">aptitude</systemitem> (si el teniu 
    instal·lat) executeu: 
   <screen># aptitude install aptitude</screen>
  </para>
  <para>
    Este pas automàticament actualitzarà <systemitem
    role="package">libc6</systemitem> i <systemitem
    role="package">locales</systemitem> i introduirà les biblioteques de suport per SELinux
    (<systemitem role="package">libselinux1</systemitem>).  En este punt, alguns
    serveis que estan en execució, es tornaran a iniciaran, incloent l'<command>xdm</command>,
    <command>gdm</command> i <command>kdm</command>.  Per tant, les sessions d'X11 locals
    es desconnectaran. 
 </para>
</section>
<section id="aptconvert">
  <title>Utilització de la llista de paquets automaticament instal·lats amb apt</title>
  <para>
    <systemitem role="package">aptitude</systemitem> manté la llista
    de paquets que s'han instal·lat automàticament (per exemple, com a
    dependència d'altre paquet). A &releasename;, <systemitem
    role="package">apt</systemitem> també té esta característica. 
  </para>
  <para>
    La primera vegada que s'execute a &releasename; l'<systemitem
    role="package">aptitude</systemitem> llegirà la seua llista de
    paquets automàticament instal·lats i la convertirà per utilitzar-la
    a la versió d'<systemitem role="package">apt</systemitem> de &releasename;.
    Si teniu instal·lat l'<systemitem role="package">aptitude</systemitem> al menys
    hauríeu de executar una vegada 
    l'<command>aptitude</command>
    per fer la conversió.
    Una forma de fer-ho és fer una cerca per un paquet no existent:
    <screen># aptitude search "?false"</screen>
</para>
</section>

<section id="minimal-upgrade">
<title>Actualització mínima del sistema</title>
<para>
Com a conseqüència d'alguns conflictes entre paquets necessaris entre &oldreleasename; i &releasename;, 
l'execució directa de  <literal>aptitude dist-upgrade</literal> sovint esborrarà un gran
nombre de paquets que pot ser voleu mantenir. Per tant recomanem un procés
d'actualització en dos fases, primer una actualització mínima per prevenir estos
conflictes i després un <literal>dist-upgrade</literal> complet.
</para>
<para>
Primer, executeu:
</para>
<screen>
# aptitude upgrade
</screen>
<para>
Açò tindrà l'efecte de que s'actualitzen els paquets que no necessiten 
d'esborrar o instal·lar altres paquets per fer la seva actualització.
</para>
<para>
El pròxim pas dependrà del conjunt de paquets que tingueu instal·lats. Estes
notes de llançament donen conselles generals de quin mètode es podria utilitzar,
però si hi ha dubte, es recomana que examineu la llista de paquets que es
 proposen per esborrar a cadascun dels mètodes.
</para>
<para>
Alguns dels paquets que és normal que s'incloguen per esborrar són <systemitem
role="package">base-config</systemitem>, <systemitem
role="package">hotplug</systemitem>, <systemitem
role="package">xlibs</systemitem>, <systemitem
role="package">netkit-inetd</systemitem>, <systemitem
role="package">python2.3</systemitem>, <systemitem
role="package">xfree86-common</systemitem>, i <systemitem
role="package">xserver-common</systemitem>.  Per vore mes informació dels
paquets obsolets per &releasename;, vegeu 
<xref linkend="obsolete"/>.
</para>
<section id="minimal-upgrade-desktop" condition="fixme">
<title>Actualització d'un sistema d'escriptori</title>
<programlisting condition="fixme">TODO: Està desactualitzat per lenny?</programlisting>
<para>
S'ha comprovat que este procediment d'actualització funciona en sistemes amb 
la tasca d'&oldreleasename; <literal>desktop</literal> instal·lada. És 
possiblement el mètode que donarà els millors resultats a sistemes amb la
tasca <literal>desktop</literal> instal·lada, o amb els paquets 
<literal>gnome</literal> o <literal>kde</literal> instal·lats.
</para>
<para>
Possiblement<emphasis>no</emphasis> serà el mètode correcte si no teniu instal·lats 
els paquets  <systemitem role="package">libfam0c102</systemitem> i
<systemitem role="package">xlibmesa-glu</systemitem>:
</para>
<screen>
# dpkg -l libfam0c102 | grep ^ii
# dpkg -l xlibmesa-glu | grep ^ii
</screen>
<para>
Si tenu un sistema desktop complet instal·lat, executeu:
</para>
<screen>
# aptitude install libfam0 xlibmesa-glu
</screen>
</section>

<section id="minimal-upgrade-x-server">
<title>Actualització d'un sistema amb alguns dels paquets d'X instal·lats</title>
<para>
Els sistemes que tinguen alguns paquets X instal·lats, però que no tinguen la
tasca <literal>desktop</literal> completa, necessitaran un mètode diferent.
Este mètode s'aplica en general als sistemes amb l'<systemitem
role="package">xfree86-common</systemitem> instal·lat, que inclouen alguns
servidors que tenen les tasques de servidor de 
<systemitem role="package">tasksel</systemitem> instal·lades 
ja que algunes inclouen eines de gestió gràfica. Es pareix al mètode correcte a
utilitzar en sistemes que tenen les X, però que no tenen instal·lada completa la
tasca <literal>desktop</literal>.
</para>
<screen>
# dpkg -l xfree86-common | grep ^ii
</screen>
<para>
Primer, comproveu si teniu instal·lats els paquets <systemitem
role="package">libfam0c102</systemitem> i <systemitem
role="package">xlibmesa-glu</systemitem>.
</para>
<screen>
# dpkg -l libfam0c102 | grep ^ii
# dpkg -l xlibmesa-glu | grep ^ii
</screen>
<para>
Si no teniu instal·lat el <systemitem role="package">libfam0c102</systemitem>,
no incloeu <systemitem role="package">libfam0</systemitem> a la línia d'ordres
següent. Si no teniu instal·lat el <systemitem
role="package">xlibmesa-glu</systemitem>, no l'incloeu a la línia d'ordres 
següent. <footnote><para> Esta ordre determinarà si necessiteu tenir instal·lat
el <systemitem role="package">libfam0</systemitem> i el 
<systemitem role="package">xlibmesa-glu</systemitem>, i els seleccionarà automàticament per vosaltres:
</para> <screen> # aptitude install x11-common \ $(dpkg-query --showformat
'${Package} ${Status}\n' -W libfam0c102 xlibmesa-glu \ | grep 'ok installed$' |
sed -e's/ .*//; s/c102//') </screen> </footnote>
</para>
<screen>
# aptitude install x11-common <replaceable>libfam0</replaceable> <replaceable>xlibmesa-glu</replaceable>
</screen>
<para>
Adoneu-vos que instal·lar <systemitem role="package">libfam0</systemitem> també
instal·larà el Monitor de modificacions de fitxers(<systemitem
role="package">fam</systemitem>) i el  RPC portmapper (<systemitem
role="package">portmap</systemitem>) si no hi era al vostre sistema.
Els dos paquets engegaran un nou servei de xarxa al vostre sistema, però es
poden configurar per lligar-lo al dispositiu de xarxa loopback (intern).
</para>
</section>

<section id="minimal-upgrade-server">
<title>Actualització d'un sistema sense suport d'X instal·lat</title>
<para>
A un sistema sense X, no necessitarà cap ordre <literal>aptitude install</literal>,
i podeu seguir al pas següent.
</para>
</section>

</section>

<section id="upgrading-kernel">
<title>Actualització del nucli</title>
<para>
La versió d'<systemitem role="package">udev</systemitem> a &releasename; no té
suport pels nuclis amb versió anterior a la 2.6.15 (que inclouen els nuclis 2.6.8 
d' &oldreleasename; 2.6.8), i la versió d'&oldreleasename; de 
l'<systemitem role="package">udev</systemitem> no anirà bé amb els nuclis anteriors.  
A afegir, instal·lar la versió de &releasename; de
l'<systemitem role="package">udev</systemitem> forçarà que s'esborre el
<systemitem role="package">hotplug</systemitem>, que s'utilitza als nuclis 2.4.
</para>
<para>
Per tant, els nuclis empaquetats de versions anteriors possiblement no funcionaran
correctament després d'esta actualització. De forma semblant, hi haurà un espai
de temps a l'actualització on l'<systemitem role="package">udev</systemitem> 
ja s'ha actualitzat, però no s'ha instal·lat l'últim nucli. Si el sistema s'hagués
de tornar a iniciar en este punt, en mig de l'actualització, podria no iniciar ja que
no es detectarien ni carregarien correctament els controladors. (Vegeu <xref
linkend="upgrade-preparations"/> per vore les recomanacions de com preparar-se per
esta possibilitat si esteu actualitzant de forma remota.)
</para>
<para>
A no ser que al vostre sistema tingueu instal·lada la tasca <literal>desktop</literal>,
o de paquets que provoquen un nombre de paquets esborrats no acceptable,
es recomana que actualitzeu el nucli en este punt.</para>
<para>
Per fer esta actualització del nucli, executeu:
</para>
<screen>
# aptitude install linux-image-2.6-<replaceable>gust</replaceable>
</screen>
<para>
Vegeu <xref linkend="kernel-metapackage"/> per obtenir ajuda de quin gust del 
nucli necessiteu instal·lar.
</para>
<para>
En el cas de l'escriptori, malauradament no és possible assegurar que el nou
paquet del nucli s'instal·le immediatament després de que s'instal·le el nou
<systemitem role="package">udev</systemitem>, per tant hi ha un punt en el temps
on ni hi haurà cap nucli instal·lat amb suport complet de hotplug. Vegeu 
<xref linkend="newkernel"/> per obtenir informació de com configurar el vostre sistema
per que no depenga de hotplug a l'arrancada.
</para>
</section>

<section id="upgrading-other">
<title>Actualització de la resta del sistema</title>
<para>
Podeu ara continuar amb la part principal de l'actualització. Executeu:
</para>
<screen>
# aptitude dist-upgrade
</screen>
<para>
Açò farà una actualització completa del sistema, es a dir instal·larà les 
versions noves de tots els paquets, i resoldrà tots els canvis possibles en les 
dependències entre els paquets dels diferents llançaments. Si és necessari,
instal·larà alguns nous paquets (normalment versions noves de biblioteques,
o paquets que han canviat de nom), i  esborrarà qualsevol paquet obsolet que entre en
conflicte.
</para>
<para>
Quan s'actualitza des d'un conjunt de CD-ROM, es demanarà que inseriu els CDs
específics a diferents punts de l'actualització. Podríeu haver d'inserir més
d'una vegada el mateix CD, açò es deu a que hi ha paquets relacionats que estan
dispersos als diferents CD.
</para>
<para>
Les noves versions dels paquets actualment instal·lats que no es poden 
actualitzar sense canviar l'estat d'instal·lació d'altre paquet es deixaran en
la seua versió actual (que es mostrarà com <quote>held back</quote>).  Açò es
pot resoldre utilitzant <command>aptitude</command> per que trie estos paquets per instal·lar-los o provant <literal>aptitude -f install
<replaceable>package</replaceable></literal>.
</para>
</section>

<section id="get-signatures" condition="fixme">
<title>Descàrrega de les signatures dels paquets</title>
<programlisting condition="fixme">TODO: Es pot esborrar per lenny, no?</programlisting>
<para>
Després de l'actualització, amb la nova versió de 
l'<systemitem role="package">apt</systemitem> ara podeu actualitzar
la informació dels vostres paquets, que inclourà el nou mecanisme de
comprovació de les signatures dels paquets:
</para>
<screen>
# aptitude update
</screen>
<para>
L'actualització ja haurà descarregat i activat les signatures de l'arxiu de 
paquets de Debian. Si afegiu altres fonts de programari (no oficials), 
l'<systemitem role="package">apt</systemitem> mostrarà avisos en relació
a la incapacitat de confirmar que els paquets descarregats són legítims i que no
s'han manipulat.  Per més informació vegeu <xref linkend="pkgmgmt"/>.
</para>
</section>

<section id="trouble">
<title>Possibles problemes a l'actualització</title>
<para>
A una operació on s'utilitza <command>aptitude</command>, <command>apt-get</command>,
o <command>dpkg</command> pot fallar amb l'error
</para>
<screen>
E: Dynamic MMap ran out of room
</screen>
<para>
l'espai de memòria cau per defecte és insuficient. Podeu resoldre-ho esborrant
o comentant les línies que no necessiteu al vostre
<filename>/etc/apt/sources.list</filename> o bé incrementant la mida de la memòria cau.
Podeu incrementar la mida de la memòria cau fixant <literal>APT::Cache-Limit</literal>
a l'<filename>/etc/apt/apt.conf</filename>.  L'ordre següent fixarà a un valor que hauria
de ser suficient per l'actualització:
</para>
<screen>
# echo 'APT::Cache-Limit "12500000";' &gt;&gt; /etc/apt/apt.conf
</screen>
<para>
Açò dona per suposat que no teniu esta variable fixada en eixe fitxer.
</para>
<para>
De vegades no fa falta activar l'opció d'APT <literal>APT::Force-LoopBreak</literal>
per permetre de forma temporal paquets essencials per problemes de 
conflictes/pre-dependències circulars. L'<command>aptitude</command> us avisarà i
avortarà l'actualització. Podeu treballar al voltant d'açò especificant l'opció <literal>-o
APT::Force-LoopBreak=1</literal> a la línia d'ordres d'<command>aptitude</command>.
</para>
<para>
És possible que l'estructura de les dependències del sistema estiga corrupta i que
necessite una intervenció manual. Normalment es tradueix en utilitzar 
<command>aptitude</command> o
</para>
<screen>
# dpkg --remove <replaceable>nom_del_paquet</replaceable>
</screen>
<para>
per eliminar alguns dels paquets que molesten, o 
</para>
<screen>
# aptitude -f install
# dpkg --configure --pending
</screen>
<para>
En alguns casos extrems haureu de forçar la reinstal·lació amb una ordre de l'estil
</para>
<screen>
# dpkg --install <replaceable>/path/to/package_name.deb</replaceable>
</screen>
<para>
Els conflictes de fitxers no haurien d'aparèixer si actualitzeu una &oldreleasename; <quote>pura</quote>,
però poden aparèixer si teniu backports no oficials instal·lats. Un conflicte de fitxers
provocarà un error de l'estil:
</para>
<screen>
Unpacking <replaceable>&lt;package-foo&gt;</replaceable> (from <replaceable>&lt;package-foo-file&gt;</replaceable>) ...
dpkg: error processing <replaceable>&lt;package-foo&gt;</replaceable> (--install):
 trying to overwrite `<replaceable>&lt;some-file-name&gt;</replaceable>',
 which is also in package <replaceable>&lt;package-bar&gt;</replaceable>
dpkg-deb: subprocess paste killed by signal (Broken pipe)
 Errors were encountered while processing:
 <replaceable>&lt;package-foo&gt;</replaceable>
</screen>
<para>
Podeu provar de resoldre un conflicte de fitxers esborrant forçosament el paquet 
al que es refereix a la <emphasis>línia</emphasis> del missatge d'error:
</para>
<screen>
# dpkg -r --force-depends <replaceable>package_name</replaceable>
</screen>
<para>
Després de corregir les coses, hauríeu de ser capaços de continuar amb l'actualització
repetint les ordres descrites anteriorment de l'<command>aptitude</command>.
</para>
<para>
A l'actualització, us faran algunes preguntes relatives a la configuració o a la
reconfiguració d'alguns paquets. Quan us pregunten si algun fitxer als directoris
<filename>/etc/init.d</filename> o <filename>/etc/terminfo</filename>,
o que el fitxer <filename>/etc/manpath.config</filename> s'ha de substituir
per la versió del mantenidor del paquet, normalment s'ha de contestar
`si' per assegurar la consistència del sistema. Sempre podeu tornar a la versió anterior,
ja que es desaran amb l'extensió <literal>.dpkg-old</literal>.
</para>
<para>
Si no esteu segurs de que fer, escriviu el nom del paquet o el fitxer i ordeneu les
coses a un moment posterior. Podeu cercar al fitxer typescript per
revisar la informació que hi havia a la pantalla en el moment de l'actualització.
</para>
</section>

</section>

<section id="newkernel">
<title>Actualització del vostre nucli i dels paquets relacionats</title>
<para>
Esta secció explica com actualitzar el vostre nucli i identificar els problemes
en potència per esta actualització. Podeu o bé instal·lar un dels paquets <systemitem
role="package">linux-image-*</systemitem> distribuïts a Debian, o compilar el
vostre nucli personalitzat des del nucli.
</para>
<para>
Adoneu-vos que hi ha un munt d'informació en esta secció que es basa en la suposició de
que estareu utilitzant un dels nuclis modulars de Debian, junt a l'<systemitem
role="package">initramfs-tools</systemitem> i l'<systemitem
role="package">udev</systemitem>.  Si escolliu utilitzar un nucli personalitzat que
no necessita un initrd o si utilitzeu un generador d'initrd diferent, algunes de
les informacions podrien no ser les més adequades per vosaltres.
</para>
<para>
Adoneu-vos que si l'<systemitem role="package">udev</systemitem> 
<emphasis>no</emphasis> està instal·lat al vostre sistema, encara us serà possible
utilitzar el <systemitem role="package">hotplug</systemitem> per trobar el nou maquinari.
</para>
<para>
Si utilitzeu un nucli 2.4, hauríeu de llegir amb cura <xref
linkend="upgrade-to-2.6"/>.
</para>
<section id="kernel-metapackage">
<title>Instal·lació del metapaquet de nucli</title>
<para>
Quan feu l'actualització completa d'&oldreleasename; a &releasename;, es molt
recomanable que instal·leu un nou metapaquet de nucli linux-image-2.6-*.
Este paquet s'instal·larà automàticament al procés d'actualització completa (dist-upgrade).
 Ho podeu verificar executant:
</para>
<screen>
# dpkg -l "linux-image*" | grep ^ii
</screen>
<para>
Si no vegeu cap eixida, aleshores necessitareu instal·lar un paquet linux-image
nou manualment. Per vore la llista de metapaquets linux-image-2.6 a l'abast, executeu:
</para>
<screen>
# apt-cache search linux-image-2.6- | grep -v transition
</screen>
<para>
Si no esteu segurs de quin paquet triar, executeu <literal>uname
-r</literal> i busqueu un paquet amb un nom semblant. Per exemple, si vegeu 
'<literal>2.4.27-3-686</literal>', el recomanat serà que instal·leu  el <systemitem
role="package">linux-image-2.6-686</systemitem>.  (Adoneu-vos que el gust 386 ja no
existeix; si esteu utilitzant un gust pel nucli 386, hauríeu d'instal·lar el gust 486
en substitució) Podeu utilitzar <command>apt-cache</command>
per vore una descripció més completa de cada paquet per triar la millor que hi 
ha disponible. Per exemple:
</para>
<screen>
# apt-cache show linux-image-2.6-686
</screen>
<para>
Hauríeu d'utilitzar <literal>aptitude install</literal> per instal·lar-lo. Una vegada
tingueu el nou nucli instal·lat hauríeu de tornar a iniciar a la pròxima vegada 
que tingueu oportunitat per obtenir els beneficis que proporciona la nova versió del nucli.
</para>
<para>
Pels més atrevits hi ha una forma fàcil de compilar el vostre nucli personalitzat a
on &debian;.  Instal·leu l'eina <systemitem
role="package">kernel-package</systemitem> i llegiu la documentació que hi ha a
<filename>/usr/share/doc/kernel-package</filename>.
</para>
</section>

<section id="upgrade-from-2.6">
<title>Actualitació des d'un nucli 2.6</title>
<para>
Si esteu utilitzant un nucli de la sèrie 2.6 d'&oldreleasename; esta actualització 
tindrà lloc automàticament després de fer l'actualització completa del sistema de paquets
(tal i com es descriu a <xref linkend="upgradingpackages"/> ).
</para>
<para>
És possible i és el vostre avantatge actualitzar el paquet de nucli de forma separada
del <literal>dist-upgrade</literal> per reduir les ocasiones de tenir un sistema que
temporalment no es puga arrancar. Vegeu <xref linkend="upgrading-kernel"/> per obtenir
una descripció d'este procés. Adoneu-vos que açò tan sols s'hauria de fer després del
procés d'actualització mínima que es descrit a <xref linkend="minimal-upgrade"/>.
</para>
<para>
També podeu fer este pas si esteu utilitzant el vostre nucli personalitzat i voleu
utilitzar el nucli que hi ha a &releasename;. Si la vostra versió del nucli no està
suportat per l'<systemitem role="package">udev</systemitem> aleshores es recomana que
actualitzeu després d'una actualització mínima. Si l'<systemitem
role="package">udev</systemitem> suporta la vostra versió, podeu esperar en seguretat
fins després de l'actualització completa del sistema.
</para>
</section>

<section id="upgrade-from-2.4">
<title>Actualització des d'un nucli 2.4</title>
<para>
Si teniu un nucli 2.4 instal·lat, i el vostre sistema utilitza <systemitem
role="package">hotplug</systemitem> per la detecció del maquinari, hauríeu primer d'actualitzar a
un nucli de la sèrie 2.6 d'&oldreleasename; abans d'intentar l'actualització. Assegureu-vos
que el vostre sistema arranca amb un nucli de la sèrie 2.6 i que tot el maquinari
es detecta correctament abans de fer l'actualització. El paquet <systemitem
role="package">hotplug</systemitem> s'esborra del sistema (en 
favor de l'<systemitem role="package">udev</systemitem>) quan feu una actualització
completa del sistema. Si no feu l'actualització del nucli abans, el vostre sistema
podria no arrancar correctament a partir d'este punt. Una vegada heu completat l'actualització
a un nucli de la sèrie 2.6 a &oldreleasename; ja podeu fer l'actualització tal i com es descriu a
<xref linkend="upgrade-from-2.6"/>.
</para>
<para>
Si el vostre sistema no utilitza <systemitem
role="package">hotplug</systemitem><footnote><para> Podeu tenir els mòduls del nucli
del vostre sistema carregats estàticament amb una configuració correcta de 
l'<filename>/etc/modules</filename>.</para> </footnote> Podeu retrassar l'actualització
del nucli fins que hàgeu acabat l'actualització completa del sistema, tal i com es descriu a
<xref linkend="upgrading-other"/>.  Una vegada el sistema s'ha actalitzat, podeu 
fer açò (canviant el nom del paquet de nucli a el que més s'ajuste al vostre
sistema canviant <varname>gust</varname>):
</para>
<screen>
# aptitude install linux-image-2.6-<replaceable>gust</replaceable>
</screen>
</section>

<section id="device-reorder">
<title>Reordenació de l'enumeració dels dispositius</title>
<para>
&releasename; te com a característica un mecanisme més robust per la detecció del maquinari que
els llançament anterior. Però, açò pot provocar canvis en l'ordre en que es
descobreixen els dispositius al vostres sistema, afectant l'ordre en el qual s'assignen
els noms de dispositius. Per exemple, si teniu dos adaptadors de xarxa que estan associats
a dos controladors diferents, els dispositius els que poden apuntar eth0 i eth1 poden vores
canviats. Per favor, adoneu-vos que el nou mecanisme implica que si per exemple canvieu els
dispositius ethernet a un sistema que executa &releasename;, el nou adapatador agafarà
un nou nom per la seua interfície.
</para>
<para>
Pels dispositius de xarxa, podeu evitar este canvi en l'ordenació utilitzant les regles
d'<systemitem role="package">udev</systemitem>, més específicament, a través de
les definicions que hi ha a
<filename>/etc/udev/rules.d/70-persistent-net.rules</filename><footnote><para>
Les regles es generen automàticament amb l'script
<filename>/etc/udev/rules.d/75-persistent-net-generator.rules</filename> per
obtenir noms consistents per les interfícies de xarxa. Esborreu este enllaç
per inhabilitar el nom persistent en els dispositius pels <acronym>NIC</acronym> per part de 
l'<systemitem role="package">udev</systemitem>.  </para> </footnote>. De forma alternativa, 
podeu utilitzar  la utilitat <command>ifrename</command> per associar els dispositius físics a
noms específics en el moment de l'arrancada. Vegeu <citerefentry>
<refentrytitle>ifrename</refentrytitle> <manvolnum>8</manvolnum>
</citerefentry> i <citerefentry> <refentrytitle>iftab</refentrytitle>
<manvolnum>5</manvolnum> </citerefentry> per obtenir més informació. Les dos
alternatives (<systemitem role="package">udev</systemitem> i
<command>ifrename</command>) no s'hauria d'utilitzar al mateix temps.
</para>
<para>
Pels dispositius d'emmagatzemament, podeu també evitar este reordenament utilitzant
<systemitem role="package">initramfs-tools</systemitem> i configurant-lo per a que 
carregue els mòduls controladors del dispositiu en el mateix ordre que s'estan carregant
en l'actualitat. Per fer-ho, identifiqueu l'ordre en que es van carregar els mòduls
d'emmagatzemament en el vostre sistema mirant l'eixida de l'<command>lsmod</command>.  
L'<command>lsmod</command> mostra la llista de mòduls en l'ordre invers al que es van
carregar, es a dir el primer mòdul a la llista és l'últim carregat. Adoneu-vos que açò
tan sols funcionarà per a dispositius els quals els nuclis enumeren en un ordre
estable (com els dispositius PCI).
</para>
<para>
Per altra banda, esborrar i reordenar els mòduls després de la càrrega inicial 
afectarà a este ordre.  També, el vostre nucli pot tenir alguns dispositius 
enllaçats estàticament, i estos noms no apareixeran en l'eixida de 
l'<command>lsmod</command>. Podeu ser capaços
de desxifrar estos noms de dispositius i l'ordre de càrrega mirant al
<filename>/var/log/kern.log</filename>, o a l'eixida del
<command>dmesg</command>.
</para>
<para>
Afegiu estos noms de mòduls a l'<filename>/etc/initramfs-tools/modules</filename> en
l'ordre que s'hauríen de carregar en el moment de l'arrencada. Alguns noms de
mòduls podrien haver canviat des d'&oldreleasename; a &releasename;.  Per exemple, el 
 sym53c8xx_2 s'ha convertit en sym53c8xx.
</para>
<para>
Necessitareu aleshores regenerar la/les vostra/es image/s de l'initramfs executant
<literal>update-initramfs -u -k all</literal>.
</para>
<para>
Quan ja esteu utilitzant un nucli de &releasename; i <systemitem
role="package">udev</systemitem>, podeu tornar a configurar el vostre sistema per accedir
els discs amb un àlies que no depengui de l'ordre d'arrencada. Estos àlies els trobareu a
la jerarquia <filename>/dev/disk/</filename>.
</para>
</section>

<section id="boot-timing">
<title>Problemes amb el temps d'arrancada</title>
<para>
Si un s'utilitza un initrd creat amb l'<systemitem
role="package">initramfs-tools</systemitem> per arrancar el sistema, en alguns casos la
creació dels fitxers de dispositiu per part de l'<systemitem
role="package">udev</systemitem> pot ser massa tard per que els scripts d'arrancada els
utilitzen.</para>
<para>
Els símptomes són que l'arrancada fallarà ja que el sistema de fitxers arrel
no es pot muntar i us llançarà a una línia d'ordres de depuració. Però quan 
ho comproveu després, tots els dispositius que fan falta ja estan presents a
<filename>/dev</filename>.  Açò s'ha observat en casos on el sistema de fitxers 
arrel està a un disc <acronym>USB</acronym> o a un <acronym>RAID</acronym>, especialment 
si s'utilitza <acronym>LILO</acronym><indexterm><primary>LILO</primary></indexterm>.
</para>
<para>
Una forma d'evitar este problema és utilitzar el paràmetre d'arrancada
<literal>rootdelay=<replaceable>9</replaceable></literal>.  El valor de retard (en segons)
es pot ajustar.
</para>
</section>

</section>

<section id="nownownow">
<title>Coses a fer abans de tornar a iniciar</title>
<para>
Quan ja s'ha acabat el <literal>aptitude dist-upgrade</literal> l'actualització <quote>formal</quote> 
ja ha acabat, però hi ha algunes altres coses que s'haurien de tenir en compte
<emphasis>abans</emphasis> de tornar a reiniciar.
</para>

<section id="rerunlilo">
<title>Execució de lilo</title>
<para>
Si utilitzeu com a carregador d'arrancada <systemitem role="package">lilo</systemitem> 
(és el carregador per defecte a algunes instal·lacions d'&oldreleasename;) és molt
recomanable que torneu a executar el <command>lilo</command> després de l'actualització:
</para>
<screen>
# /sbin/lilo
</screen>
<para>
Açò és necessari inclòs si no heu actualitzat el nucli del vostres sistema, ja que
que la segon etapa de <command>lilo</command> canviarà degut a l'actualització
del paquet.
</para>
<para>
També, reviseu els continguts del vostre <filename>/etc/kernel-img.conf</filename> i 
assegureu-vos que conté <literal>do_bootloader = Yes</literal>.  De esta 
forma el carregador sempre es tornarà a executar després d'una actualització del nucli.
</para>
<para>
Si trobeu algun problema quan executeu <command>lilo</command>, reviseu els
enllaços simbòlics a <filename>/</filename> a <filename>vmlinuz</filename> i a
<filename>initrd</filename> i el contingut del vostres
<filename>/etc/lilo.conf</filename> per trobar discrepàncies.
</para>
<para>
Si oblideu de tornar a executar el <command>lilo</command> abans de tornar a iniciar o si el vostre
sistema s'ha tornat a iniciar accidentalment abans de poder-ho fer manualment, el
vostre sistema podria fallar. En comptes de l'indicador de lilo, tan sols voreu
<literal>LI</literal> quan s'arranca el sistema<footnote><para> Per obtenir més
informació del codis d'error a l'arrancar <command>lilo</command> vegeu <ulink
url="http://tldp.org/HOWTO/Bootdisk-HOWTO/a1483.html">The Linux Bootdisk
HOWTO</ulink>.  </para> </footnote>.  Mireu <xref linkend="recovery"/> per obtenir
informació de com recuperar-se d'este problema.
</para>
</section>

<section id="mdadm">
<title>Actualització d'mdadm</title>
<para>
mdadm necessita un fitxers de configuració per assemblar els arrays MD (<acronym>RAID</acronym>) 
des del ramdisk inicial i a la seqüència d'inicialització del sistema. Assegureu-vos
de llegir i seguir les instruccions que trobareu a
<filename>/usr/share/doc/mdadm/README.upgrading-2.5.3.gz</filename> després 
d'actualitzar el paquet
<emphasis role="strong">i abans de tornar a iniciar</emphasis>.  
L'última versió d'este fitxer la podeu trobar a <ulink
url="http://svn.debian.org/wsvn/pkg-mdadm/mdadm/trunk/debian/README.upgrading-2.5.3?op=file"></ulink>;
consulteu-ho en cas de patir algun problema.
</para>
</section>

</section>

<section id="boot-hangs">
  <title>El sistema es queda penjat a l'arrancar en <literal>Waiting for root file
  system</literal></title>
  <subtitle>Procediment per recuperar-se quan l'<filename>/dev/hda</filename>
  s'ha convertit en  <filename>/dev/sda</filename></subtitle>

  <para>
    Alguns usuaris han informat que l'actualització pot provocar que
    el nucli no trobe la partició arrel del sistema després de tornar
    a iniciar el sistema. 
  </para>

  <para>
    En este cas, l'arrancada del sistema es quedarà parada mostrant el missatge
    següent:
    <screen>Waiting for root file system ...</screen>
    i després d'alguns segons us llançarà un busybox pelat.
  </para>

  <para>
    Este problema passa quan l'actualització del nucli introdueix
    l'us de la nova generació de controladors <acronym>IDE</acronym>
    La convenció de noms de disc per l'<acronym>IDE</acronym> als controladors
    vells era <literal>hda</literal>, <literal>hdb</literal>,
    <literal>hdc</literal>, <literal>hdd</literal>. Els nous controladors
    anomenen els mateixos discs <literal>sda</literal>,
    <literal>sdb</literal>, <literal>sdc</literal>,
    <literal>sdd</literal>. El problema apareix quan l'actualització no
    genera un nou fitxer <filename>/boot/grub/menu.lst</filename> 
    per agafar la nova convenció de noms. A l'arrancada, el Grub
    passarà una partició amb l'arrel del sistema al nucli el qual no
    pot trobar. 
  </para>

  <para>
    Si s'heu trobat este problema després d'actualitzar, aneu a 
    <xref linkend="how-to-recover"/>. Per evitar el problema 
    abans d'actualitzar, llegiu-ho abans.
   </para>

  <section id="avoid-problems-before-upgrading">
    <title>Com evitar el problema abans d'actualitzar</title>

    <para>
      Podem evitar este problema completament utilitzant un identificador 
      pel sistema de fitxers arrel que no canvie entre una arrancada i la següent.
      Hi ha dos possibles mètodes per fer-ho - etiquetant el sistema de
      fitxers, o utilitzant l'identificador únic universal de sistema de
      fitxers (<acronym>UUID</acronym>). Estos mètodes estan suportats
      a Debian des del llançament d' 'etch'.
    </para>

    <para>
      Les dos aproximacions tenen avantatges i inconvenients. L'aproximació
      de l'etiquetat és més llegible, però podríeu tenir més problemes
      si un altre sistema de fitxers al vostre sistema té la mateixa etiqueta.
      L'aproximació de l'uuid és més lletja, però tenir un conflicte d'uuids
      és altament improbable. 
    </para>

    <para>
      Als exemples següents assumim que el sistema de fitxers arrel és a
      <filename>/dev/hda6</filename>. També assumim que el vostre sistema té 
      una instal·lació d'udev funcionant i un sistema de fitxers ext2 o ext3.
    </para>

    <para>
      Per implementar l'aproximació per etiquetat:
      <orderedlist>
	<listitem>
	  <para>
	    Etiqueteu el sistema de fitxers (el nom ha de tenir &lt; 16 caràcters)
	    executant l'ordre:
	    <command>e2label /dev/hda6 rootfilesys</command>
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Editeu el <filename>/boot/grub/menu.lst</filename> i canvieu la línia:
	    <programlisting># kopt=root=/dev/hda6 ro</programlisting>
	    per
	    <programlisting># kopt=root=ETIQUETA=rootfilesys ro</programlisting>
	    <note>
	      <para>
	        No esborreu el <literal>#</literal> a l'inici de la línia, 
		fa falta que estiga allí.	
              </para>
	    </note>
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Actualitzeu les línies <literal>kernel</literal> del
	    <filename>menu.lst</filename> executant l'ordre 
	    <command>update-grub</command>.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Editeu l'<filename>/etc/fstab</filename> i canvieu la línia que 
	    munta la partició <filename>/</filename>, per exemple:

	    <programlisting>/dev/hda6     /     ext3  defaults,errors=remount-ro 0 1</programlisting>

	    per

	    <programlisting>LABEL=rootfilesys     /     ext3  defaults,errors=remount-ro 0 1</programlisting>

	    El canvi que es fa és a la primera columna; no
	    necessitareu modificar les altres columnes d'esta línia.	
 	  </para>
	</listitem>
      </orderedlist>
    </para>

    <para>
      Per implementar l'aproximació uuid:
      <orderedlist>
	<listitem>
	  <para>
 	    Trobeu l'identificador únic universal del vostre sistema executant:
	    <command>ls -l /dev/disk/by-uuid | grep hda6</command>
	  </para>
	  <para>
	    Hauríeu d'aconseguir una línia semblant a aquesta:
	    <screen>lrwxrwxrwx 1 root root 24 2008-09-25 08:16 d0dfcc8a-417a-41e3-ad2e-9736317f2d8a -> ../../hda6</screen>

	    L'<acronym>UUID</acronym> és el nom de l'enllaç 
 	    simbòlic que apunta a <filename>/dev/hda6</filename> es a dir:
	    <literal>d0dfcc8a-417a-41e3-ad2e-9736317f2d8a</literal>.
	    <note>
	      <para>
		El vostre sistema <acronym>UUID</acronym>
		tindrà una cadena diferent.
	      </para>
	    </note>
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Editeu el <filename>/boot/grub/menu.lst</filename> i canvieu la línia

	    <programlisting># kopt=root=/dev/hda6 ro</programlisting>

	    per 

	    <programlisting># kopt=root=UUID=d0dfcc8a-417a-41e3-ad2e-9736317f2d8 ro</programlisting>

	    <note>
	      <para>
		No esborreu el <literal>#</literal> del principi de la 
		línia, és necessari que estiga allí.	
	      </para>
	    </note>
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Actualitzeu les línies <literal>kernel</literal> al
	    <filename>menu.lst</filename> executant l'ordre
	    <command>update-grub</command>.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Editeu l'<filename>/etc/fstab</filename> i canvieu la línia que munta la partició <filename>/</filename> per exemple:

	    <programlisting>/dev/hda6     /     ext3  defaults,errors=remount-ro 0 1</programlisting>

	    per

	    <programlisting>UUID=d0dfcc8a-417a-41e3-ad2e-9736317f2d8  /  ext3  defaults,errors=remount-ro 0 1</programlisting>
		
	    El canvi que passa allí és a la primera columna, no
	    fa falta que canvieu les altres columnes d'esta línia.
	  </para>
	</listitem>
      </orderedlist>
    </para>
  </section>

  <section id="how-to-recover">
    <title>Com recuperar-se del problem després de l'actualització</title>

    <section id="solution1">
      <title>Solució 1</title>
      <para>
 	Açò es pot aplicar quan Grub us mostra l'interfície del menú 
	per seleccionar l'entrada que voleu per arrancar. Si el menú
	no apareix, proveu de pressionar <keycap>Esc</keycap> abans
	de que carregue el nucli per fer que aparega. Si no conseguiu
 	accedir a este menú, proveu amb la <xref linkend="solution2"/> o <xref
	linkend="solution3"/>.
      </para>

      <orderedlist>
	<listitem>
	  <para>
	    El el menú de Grub, assenyaleu l'entrada des de la que voleu
	    arrancar. Pressioneu <keycap>e</keycap> per editar les
	    opcions relacionades amb esta entrada. Voreu coses de l'estil:

	    <screen>root (hd0,0)
kernel /vmlinuz-2.6.26-1-686 root=/dev/hda6 ro
initrd /initrd.img-2.6.26-1-686</screen>
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Assenyaleu la línia

	    <screen>kernel /vmlinuz-2.6.26-1-686 root=/dev/hda6 ro</screen>

	    premeu la tecla <keycap>e</keycap> i reemplaceu
	    <literal>hd<replaceable>X</replaceable></literal> per
	    <literal>sd<replaceable>X</replaceable></literal>
	    (<varname>X</varname> pot ser la lletra
	    <literal>a</literal>, <literal>b</literal>,
	    <literal>c</literal> o <literal>d</literal> depenent del
	    vostre sistema). En el meu exemple, les línies es queden:
	    <screen>kernel /vmlinuz-2.6.26-1-686 root=/dev/sda6 ro</screen>

	    Després premeu <keycap>Enter</keycap> per guardar les modificacions.
	    A altres línies mostrarà 
	    <literal>hd<replaceable>X</replaceable></literal>, canvieu-les
	    també. No modifiqueu les entrades de l'estil
	    <literal>root (hd0,0)</literal>.  Quan s'han fet totes les
	    modificacions, premeu <keycap>b</keycap>. I el vostre
	    sistema arrancarà ara com de costum.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Ara que el vostre sistema ha arrancat, necessitareu corregir
	    este problema de forma permanent. Aneu a <xref
	    linkend="avoid-problems-before-upgrading"/> i apliqueu un dels
	    dos procediments proposat.
	  </para>
	</listitem>
      </orderedlist>
    </section>

    <section id="solution2">
      <title>Solució 2</title>

      <para>
	Arranqueu des d'un mitjà d'instal·lació
	(<acronym>CD</acronym>/<acronym>DVD</acronym>) i quan pregunte
	escriviu <literal>rescue</literal>  per llançar el mode de
    	rescat. Seleccioneu el vostre idioma, lloc, mapa de teclat, deixeu
	que es configure la xarxa, no importa si funciona o no. Després
	d'això, us demanarà que seleccioneu la partició que voleu 
	utilitzar com a arrel del sistema de fitxers. Les opcions
	proposades seran de l'estil:

	<screen>/dev/ide/host0/bus0/target0/lun0/part1
/dev/ide/host0/bus0/target0/lun0/part2
/dev/ide/host0/bus0/target0/lun0/part5
/dev/ide/host0/bus0/target0/lun0/part6</screen>
      </para>

      <para>
	Si sabeu en quina partició es troba el vostres sistema de fitxers
	arrel, escolliu la correcta. Si no, proveu amb la primera. Si
	es queixa de que la partició té el sistema de fitxers arrel invàlid,
	proveu amb la següent, i aneu seguint. Provar una després de l'altra
	no deuria de fer res a les vostres particions i si teniu tan sols
	un sistema instal·lat als vostres discs, hauria de ser fàcil trobar
	la partició amb el sistema de fitxers arrel correcte. Si teniu 
	més sistemes operatius instal·lats al vostre disc, seria millor
	conèixer exactament quina és la vostra partició arrel.
      </para>

      <para>
	Una vegada heu triat una partició, us proposarà algunes opcions 
	diferents. Trieu d'executar un intèrpret d'ordres a la partició
	seleccionada. Si es queixa que no pot, proveu amb un altra 
	partició.
      </para>

      <para>
	Ara hauríeu de tenir un intèrpret d'ordres amb usuari <literal>root</literal> amb el
	vostre sistema de fitxers arrel muntat a <filename>/</filename>. 
	Necessiteu accedir al contingut de <filename>/boot</filename>, <filename>/sbin</filename>
	i al contingut dels directoris <filename>/usr</filename>. Si és
	necessari muntar estes particions, feu-ho
	(mireu l'<filename>/etc/fstab</filename> si no teniu ni idea de quina
	partició muntar).
      </para>

      <para>
	Aneu a <xref linkend="avoid-problems-before-upgrading"/> i
	apliqueu un dels dos procediments proposats per resoldre el problema
	de forma permanent. Aleshores, escriviu <literal>exit</literal> per
	abandonar l'intèrpret d'ordres de rescat i seleccioneu <literal>reboot</literal> 
	per tornar a iniciar el sistema com de costum (no oblideu d'extreure
	el mitjà d'arrancada)
      </para>
    </section>

    <section id="solution3">
      <title>Solució 3</title>

      <orderedlist>
	<listitem>
	  <para>
	    Arranqueu des de la vostra distribució LiveCD favorita, com
	    Debian Live, Knoppix, Ubuntu Live.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Munteu la partició on estiga el vostre directori
	    <filename>/boot</filename>. Si no sabeu quin és, utilitzeu
	    l'eixida de l'ordre <command>dmesg</command> per trobar
	    si el vostre disc s'anomena <literal>hda</literal>,
	    <literal>hdb</literal>, <literal>hdc</literal>,
	    <literal>hdd</literal> o <literal>sda</literal>,
	    <literal>sdb</literal>, <literal>sdc</literal>,
	    <literal>sdd</literal>. Quan ja sapigueu amb quin disc
	    treballar, per exemple el <literal>sdb</literal>, proveu l'ordre
	    següent per vore la taula de particions del disk i per trobar la
            partició correcta: 
            <command>fdisk -l /dev/sdb</command>
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Assumint que teniu muntada la partició correcta a 
	    <filename>/mnt</filename> i que esta partició conté el directori
	    <filename>/boot</filename> i els seus continguts,  editeu el
	    fitxer <filename>/mnt/boot/grub/menu.lst</filename>.
	  </para>
	  <para>
	    Trobeu la secció de l'estil:
	    <programlisting>## ## End Default Options ##

title           Debian GNU/Linux, kernel 2.6.26-1-686
root            (hd0,0)
kernel          /vmlinuz-2.6.26-1-686 root=/dev/hda6 ro
initrd          /initrd.img-2.6.26-1-686

title           Debian GNU/Linux, kernel 2.6.26-1-686 (single-user mode)
root            (hd0,0)
kernel          /vmlinuz-2.6.26-1-686 root=/dev/hda6 ro single
initrd          /initrd.img-2.6.26-1-686

### END DEBIAN AUTOMAGIC KERNELS LIST</programlisting>

	    i canvieu cada <literal>hda</literal>,
	    <literal>hdb</literal>, <literal>hdc</literal>,
	    <literal>hdd</literal> respectivament per
	    <literal>sda</literal>, <literal>sdb</literal>,
	    <literal>sdc</literal>, <literal>sdd</literal>.  No
	    modifiqueu la línia que és de l'estil:

	    <programlisting>root            (hd0,0)</programlisting>
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Torneu a iniciar el sistema, esborreu el LiveCD i el
	    vostre sistema hauria d'arrancar correctament.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Quan haja arrancat, apliqueu un dels dos procediments
	    proposats a <xref
	    linkend="avoid-problems-before-upgrading"/> per corregir
	    el problema de forma permanent.
	  </para>
	</listitem>
      </orderedlist>
    </section>
  </section>
</section>

<section id="for-next">
<title>Preparació pel pròxim llançament</title>
<para>
Després de l'actualització hi ha algunes coses per preparar-vos pel pròxim
llançament.
</para>
<itemizedlist>
<listitem>
<para>
Si la nova imatge del metapaquet de nucli va entrar com a dependència del vell,
es marcarà com a instal·lat automàticament, que es podria corregir:
</para>
<screen>
# aptitude unmarkauto $(dpkg-query -W 'linux-image-2.6-*' | cut -f1)
</screen>
</listitem>
<listitem>
<para>
Esborreu els paquets obsolets i sense ús tal i com es descriu a <xref linkend="obsolete"/>.
Hauríeu de revisar quins són els fitxers de configuració i considerar de purgar
els paquets per esborrar els seus fitxers de configuració.
</para>
</listitem>
</itemizedlist>
</section>

<section id="deprecated">
<title>Paquets obsolets (deprecated)</title>
<para>
Amb el llançament de Debian (nom clau <literal>&nextreleasename;</literal>)
es quedaran obsolets un nombre molt 
gran de paquets de servidor, així que actualitzar a les versions més noves de estos
us protegirà de problemes quan actualitzeu a <literal>&nextreleasename;</literal>.
</para>
<para>
Açò inclou els paquets següents:
</para>
<itemizedlist>
<listitem>
<para>
<systemitem role="package">uw-imapd</systemitem>, sense successor definit encara
</para>
</listitem>
</itemizedlist>
</section>

<section id="obsolete">
<title>Paquets obsolets</title>
<para>
Amb la introducció de centenars de nous paquets, &releasename; també retira i omet més
de dos-cents paquets que hi havia a &oldreleasename;.  No hi ha una ruta d'actualització
per estos paquets obsolets. Com que res no evita que continueu utilitzant un
paquet obsolet si es vol, heu de saber que el projecte Debian normalment deixarà
de donar suport de seguretat d'ells un anys després dels llançament de &releasename;<footnote><para> O per
tant de temps en que no hi haja un altre llançament en este espai de temps. Típicament
tan sols es donen dos llançaments estables en qualsevol moment donat.  </para> </footnote>, i 
normalment no donarà altre suport mentrestant. Reemplaceu-los per altres
alternatives disponibles, si hi ha, és el recomanat.
</para>
<para>
Hi ha alguns motius pels quals haurien de ser esborrats de la 
distribució: no estan mantinguts pel seu desenvolupador, no hi ha
cap desenvolupador de Debian interessat en mantenir el paquet, la funcionalitat
que proporcionen ha estat substituïda per un programari diferent (o una nova versió),
no es considera adequat per a &releasename; degut a errors. En l'últim cas,
els paquets podrien encara estar presents en la distribució <quote>unstable</quote>.
</para>
<para>
La detecció de quins paquets en un sistema actualitzat són <quote>obsolets</quote> és fàcil
ja que els entorns de gestió de paquets els marcarà com a tals. Si esteu utilitzant
<command>aptitude</command>, voreu un llistat d'aquells paquets a l'entrada
<quote>Paquets obsolets i creats localment</quote>.  <command>dselect</command>
proporciona una secció semblant però el llistat que presenta podria canviar. També, si
heu utilitzat <command>aptitude</command> per instal·lar paquets manualment a &oldreleasename;
mantindrà el seguiment dels paquets instal·lats manualment i podrà marcar
com a obsolets aquells paquets que han entrat per dependències tan sols que 
ja no fan falta si el paquet s'ha esborrat. A més més,
<command>aptitude</command>, a diferència de <command>deborphan</command> no
marcarà com obsolets el que heu instal·lat manualment, a diferència d'aquells
que es van instal·lar automàticament per dependències.
</para>
<para>
Hi ha eines addicionals que podeu utilitzar per trobar els paquets obsolets com
<command>deborphan</command>, <command>debfoster</command> o
<command>cruft</command>.  El <command>deborphan</command> és molt recomanable,
encara que (en el seu mode per defecte) tan sols informarà de les biblioteques obsoletes:
paquets en les seccions <quote><literal>libs</literal></quote> o <quote><literal>oldlibs</literal></quote> 
que no són utilitzades per altres paquets. 
No esborreu a cegues el que us presenten estes eines, especialment si esteu 
utilitzant opcions agressives que no són les què són per defecte que són propenses a produir 
falsos positius. És molt recomanable que reviseu manualment els paquets suggerits per
esborrar (es a dir els seus continguts, mida i descripció) abans d'esborrar-los.
</para>
<para>
El <ulink url="&url-bts;">sistema de seguiment d'errors</ulink>
sovint proporciona informació addicional de perquè es va esborrar el paquet. Hauríeu
de revisar tant els informes d'error arxivats pel paquet com els informes 
d'error arxivats del <ulink
url="&url-bts;cgi-bin/pkgreport.cgi?pkg=ftp.debian.org&amp;archive=yes">pseudo-paquet 
ftp.debian.org</ulink>.
</para>
<section id="dummy">
<title>Dummy packages</title>
<para>
Alguns paquets d'&oldreleasename; s'han dividit en més d'un paquet a &releasename;, sovint
per millorar el manteniment del sistema. Per facilitar l'actualització en estos casos,
&releasename; sovint proporciona paquets <quote>dummy</quote>: són paquets buits que tenen 
el mateix nom que els paquets vells d'&oldreleasename; amb dependències que fan que s'instal·len
els nous paquets. Estos paquets <quote>dummy</quote> es consideren obsolets després de l'actualització
i es poden esborrar amb seguretat.
</para>
<para>
La major part (per no tots) de les descripcions dels paquets dummy indiquen el seu objectiu.
Les descripcions dels paquets dummy no són uniformes, així que podríeu també
trobar l'opció <literal>--guess</literal> del <command>deborphan</command> 
d'utilitat per detectar-los al vostre sistema. Adoneu-vos que alguns paquets
dummy no s'intenten esborrar després d'una actualització, és més s'utilitzen
per fer un seguiment de la versió actual que hi ha a l'abast d'un programa al
llarg del temps.
</para>
</section>

</section>

<section id="plans-for-nigel">
  <title>Plans pel nou llançament de Debian</title>

  <section arch="arm;armel">
    <title>S'abandona el port ARM ABI, en fvor del port ARM EABI</title>

    <para>
      Debian lenny té dos ports diferents i incompatibles d'ARM: l'antic
      port ABI (arb) i el nou port EABI (armel). Debian lenny és
      l'últim llançament amb suport pel port ARM ABI i en els pròxims
      llançaments tan sols es suportarà el port ARM EABI o armel. Per
      tant es recomana que utilitzeu armel per les noves instal·lacions
      de lenny.
    </para>

    <para>
      Amb l'excepció de Netwinder, les imatges de l'instal·lador per les
      màquines ARM suportades estan a la vostra disposició tant per arm com per armel a lenny.
      El suport per Netwinder tan sols es té per arm i s'abandonarà
      després de lenny juntament amb el port d'arm.
    </para>

    <para>
      Visiteu <ulink
      url="http://wiki.debian.org/ArmEabiPort">esta pàgina</ulink> per
      aprendre més del port ARM EABI (armel). 
   </para>
  </section>
</section>
</chapter>
