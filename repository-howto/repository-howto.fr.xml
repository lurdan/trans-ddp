<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- Translation based on English revision 1.?? -->
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
     "http://docbook.org/xml/4.2/docbookx.dtd">
<article lang="fr_FR">
  <articleinfo>
    <title>Guide pratique des référentiels Debian</title>
	<subtitle>
         Version française du <foreignphrase>Debian Repository HOWTO</foreignphrase>
    </subtitle>

    <author>
      <firstname>Aaron</firstname>
      <surname>Isotton</surname>
      <affiliation>
        <address><email>aaron@isotton.com</email></address>
      </affiliation>
    </author>

   <othercredit role="traduction" class="translator">
     <firstname>Éric</firstname>
     <surname>Madesclair</surname>
     <contrib>Adaptation française</contrib>
     <address><email>eric-m@wanadoo.fr</email></address>
   </othercredit>

	
    <abstract>
      <para>Ce document décrit le fonctionnement et l'installation 
            des référentiels Debian.</para>
    </abstract>
  </articleinfo>
  
<section id="intro">
<title>Introduction</title>

  <para>
  
  Un référentiel Debian est un ensemble de paquets Debian et de fichiers
  additionnels organisés sous une arborescence particulière. Les fichiers 
  additionnels sont les fichiers catalogues et les fichiers contenant les 
  sommes de contrôles des paquets. Si un utilisateur ajoute une nouvelle 
  entrée dans le fichier <filename>/etc/apt/source.list</filename>, il 
  pourra facilement avoir accès et installer tous les paquets disponibles dans 
  ce référentiel.
  
  </para><para>
  
  Un référentiel peut être soit en ligne « online » ou hors-ligne « offline »
  (par exemple sur un cédérom), les référentiels en ligne sont les plus courants.
  
  </para><para>
  
  Ce document présente le fonctionnement des référentiels Debian, les méthodes 
  pour les créer et comment y accéder en les ajoutant correctement dans le fichier 
  <filename>sources.list</filename>.

  </para><para>
  
  Le document original peut être récupéré à l'adresse : <ulink
  url="http://www.isotton.com/debian/docs/repository-howto/"/>.
  </para>

 <section id="copyright">
 <title>Copyright et licence</title>

  <para>
  
  <emphasis>Référentiels Debian HOWTO</emphasis>, Copyright (c) 2002-2003  
  <emphasis>Aaron Isotton</emphasis>. 
  Permission est donnée de copier, distribuer ou modifier ce document selon 
  les termes de la <emphasis>GNU Free Documentation License</emphasis>, version 
  1.1 ou suivante, publié par la Free Software Foundation ; sans Sections Invariables, 
  sans Texte de Première de Couverture, et sans Texte de Quatrième de Couverture.
  
  </para>	 
 </section> <!-- copyright  -->

 <section id="feedback">
 <title>Réactions</title>

  <para>
  
  Les réactions sur ce document sont les bienvenues. Envoyez en anglais vos ajouts, 
  vos commentaires et critiques à l'adresse suivante : 
  <email>aaron@isotton.com</email>.

  </para><para>
  
  Toutes les remarques concernant cette traduction peuvent être envoyées à l'adresse
  suivante <email>eric-m@wanadoo.fr</email> ou à la liste de diffusion 
  <email>debian-l10n-french@lists.debian.org</email>

  </para>
      
 </section> <!-- feedback -->
</section> <!-- intro -->

<section id="terms">
<title>Termes utilisés dans ce document</title>

 <variablelist>
 <varlistentry>
 <term>Distributions</term>
 <listitem>
   
   <para>
   
   Fait référence aux trois distributions Debian : <emphasis>stable</emphasis>, 
   <emphasis>testing</emphasis> et <emphasis>unstable</emphasis>.
   
   </para>
 </listitem>
 </varlistentry>

 <varlistentry>
 <term>Les catalogues</term>
 <listitem>
   <para>
   
   Fait référence aux fichiers <filename>Packages.gz</filename> et <filename>Sources.gz</filename>.
   
   </para>
 </listitem>
 </varlistentry>
 </variablelist>
</section>

<section id="how-it-works">
<title>Comment fonctionne un référentiel</title>

  <para>
  
  Un référentiel est constitué d'au moins un répertoire contenant des paquets 
  DEB, et de deux fichiers particuliers : <filename>Packages.gz</filename> 
  pour les paquets binaires, et <filename>Sources.gz</filename> pour les 
  paquets source.
  
  </para><para> 
  
  Si le référentiel est correctement ajouté dans le fichier <filename>sources.list</filename>, 
  la commande <command>apt-get</command> récupérera les catalogues.
  Le fichier <filename>Packages.gz</filename> pour la liste des paquets binaires 
  (mot clef <literal>deb</literal>) et le fichier <filename>Sources.gz</filename> 
  pour la liste des paquets source (mot clef <literal>deb-src</literal>).
  
  </para><para>
  
  Le fichier <filename>Packages.gz</filename> contient le nom, la version, 
  la taille, une description courte et une longue, les dépendances de chaque 
  paquet (et des informations complémentaires). Toute ces informations sont 
  affichées (et utilisées) par des logiciels d'administration des paquets 
  comme <command>dselect</command> ou <command>aptitude</command>.
  
  </para><para>
  
  Le fichier <filename>Sources.gz</filename> contient le nom, la version et 
  les dépendances pour la compilation (les paquets nécessaires pour construire
  le paquet) de chaque paquet (et des informations complémentaires) ; ces 
  informations sont utilisées par <command>apt-get source</command> ou par des 
  outils similaires.
  
  </para><para>
  
  Le fichier optionnel <filename>Release</filename> contient des informations sur 
  le référentiel. Ces informations sont utilisées pour l'étiquetage « <literal>Pinning</literal> ». 
  Pour plus d'information sur l'étiquetage, vous pouvez consulter le 
  <ulink url="http://www.debian.org/doc/manuals/apt-howto/">APT	HOWTO</ulink>.
  
  </para><para> 
  
  Ainsi, une fois que le référentiel a été correctement configuré, vous pouvez 
  installer tous vos paquets avec ceux propres à Debian. Si un paquet est mis à 
  jour dans le référentiel, l'utilisateur pourra mettre à niveau son paquet en 
  exécutant la commande <command>apt-get upgrade</command>. De plus chaque utilisateur 
  aura accès facilement à la description courte et aux autres informations importantes 
  sur vos paquets.
  
  </para><para>
  
  De plus, si le référentiel a été correctement créé, vous pouvez obtenir les
  paquets pour chaque distribution et pour chaque architecture (actuellement onze) 
  supportées ; <literal>apt</literal> récupérera automatiquement le bon paquet pour la 
  machine de l'utilisateur, sans rien connaître des autres architectures. Il est aussi 
  possible de grouper les paquets selon différents composants. Les paquets officiels Debian 
  sont répartis en trois composants, <literal>main</literal>, <literal>non-free</literal> et
  <literal>contrib</literal>. Donc si votre paquet a été porté sur plusieurs architectures, 
  vous apprécierez la souplesse des référentiels. 
  
  </para>
	
  </section> <!-- how-it-works -->
<section id="setting-up">
<title>Comment installer un référentiel</title>

  <para> 
  
  Il existe deux sortes de référentiels ; le premier, complexe où l'utilisateur 
  a seulement besoin de spécifier l'adresse du référentiel, la distribution et 
  les composants  désirés (apt  cherchera automatiquement les paquets pour la 
  bonne architecture, s'ils sont disponibles) et le second, plus simple où l'utilisateur 
  doit indiquer le chemin exact (apt déterminera quel paquet est le bon). 
  Le premier est plus difficile à configurer mais son utilisation est simplifié, 
  il doit toujours être utilisé pour des référentiels complexe ou multiplateforme. 
  Le second est plus simple à mettre en oeuvre, mais doit être réservé pour des petits 
  référentiels ou des référentiels gérant une seule architecture.
  
  </para><para>

  Pour simplifier, on parlera dans la suite du document de <emphasis>référentiels 
  automatiques</emphasis> pour le premier et de <emphasis>référentiels triviaux
  </emphasis>  pour le second.
  
  </para>
   <section>
      <title>Référentiel automatique</title>

      <para>
	  
	  La structure des répertoires d'un référentiel automatique pour les architectures 
	  et les composants standards de Debian doit ressemblé à ça :
	  
	  </para>
      <example id="debian-repository-example">
        <title>Un référentiel Debian standard</title>
      <screen>(racine du référentiel) 
| 
+-dists
  | 
  |-stable
  | |-main
  | | |-binary-alpha 
  | | |-binary-arm
  | | |-binary-...
  | | +-source 
  | |-contrib
  | | |-binary-alpha 
  | | |-binary-arm
  | | |-binary-...
  | | +-source 
  | +-non-free
  |   |-binary-alpha
  |   |-binary-arm
  |   |-binary-...
  |   +-source
  |
  |-testing 
  | |-main
  | | |-binary-alpha 
  | | |-binary-arm
  | | |-binary-...
  | | +-source 
  | |-contrib
  | | |-binary-alpha 
  | | |-binary-arm
  | | |-binary-...
  | | +-source 
  | +-non-free
  |   |-binary-alpha
  |   |-binary-arm
  |   |-binary-...
  |   +-source
  |
  +-unstable 
    |-main
    | |-binary-alpha 
    | |-binary-arm
    | |-binary-...
    | +-source 
    |-contrib
    | |-binary-alpha 
    | |-binary-arm
    | |-binary-...
    | +-source 
    +-non-free
      |-binary-alpha
      |-binary-arm
      |-binary-...
      +-source
	 </screen>

      </example>


    <para>
	
	Les paquets libres sont placés dans la section <literal>main</literal> ; 
	les paquets non libres dans	la section <literal>non-free</literal> et les 
	paquets libres dépendant de paquets non-free sont placés dans la section 
	<literal>contrib</literal>. Debian s'installe actuellement sur onze 
	architectures différentes ; la plupart d'entre elles ont été omises dans l'exemple
	pour rester concis.
	
	</para><para>

    Chaque répertoire <filename>binary-*</filename> contient un fichier 
	<filename>Packages.gz</filename> et un fichier <filename>Release</filename> 
	optionnel. Chaque répertoire <filename>source</filename> contient un fichier 
	<filename>Sources.gz</filename> et un fichier <filename>Release</filename> 
	optionnel. Notez que les paquets n'ont pas besoin d'être dans le même répertoire
	que les catalogues ; car le chemin de chaque paquet est contenu dans 
	les	catalogues. De ce fait, les paquets peuvent être mis n'importe ou
	dans le référentiel. Ce qui rend possible la création de « <link linkend="pools">
	pools</link> ».
	
	</para><para> 
	
	Vous êtes libre de créer autant de distributions et de composants et de les 
	nommer comme vous le souhaitez. Ceux pris dans les exemple sont ceux utilisés 
	par Debian. Il est possible par exemple de créer les distributions <literal>
	courante</literal> et <literal>bêta</literal> (au lieu de <literal>stable</literal>,
	<literal>testing</literal> et <literal>unstable</literal>), et les composants 
	<literal>foo</literal>, <literal>bar</literal>, <literal>baz</literal> et <literal>
	qux</literal> (à la place de <literal>main</literal>, <literal>contrib</literal> 
	et <literal>non-free</literal>).
	
	</para><para>
	
	Bien que vous soyez libre de nommer les composants comme vous le souhaitez, Il est 
	préférable d'utiliser les noms standards, car c'est ce qu'attendent les utilisateurs 
	de Debian.
    
	</para>
    </section>

    <section>
    <title>Référentiel trivial</title>

    <para>
	
	Un référentiel trivial est composé d'un répertoire racine et de plusieurs sous-répertoires.
	Comme l'utilisateur doit spécifier le chemin de la racine du référentiel ainsi que le chemin
	relatif entre la racine et le répertoire contenant les catalogues, vous êtes libre de 
	faire ce que vous désirez (même mettre tout à la racine du référentiel. Dans ce cas, le chemin 
	relatif sera très simple : <quote><filename>/</filename></quote>).
	
	</para>

    <example id="trivial-example">
    <title> Un référentiel trivial avec deux sous-répertoires</title>
        
    <screen>(racine du référentiel)
|
|-binary
+-source
    
	</screen>
    </example>
    </section>

    <section>
    <title>Créer les catalogues</title>

    <para>
	
	La commande <command>dpkg-scanpackages</command> permet de générer le fichier
	<filename>Packages</filename> et la commande <command>dpkg-scansources</command>
	le fichier <filename>Sources</filename>.
	
	</para><para>
	
	Le résultat des deux commandes est affiché sur la sortie standard ; ainsi pour 
	générer un fichier compressé, vous pouvez utiliser une commande comme : <command>
	dpkg-scanpackages <replaceable>arguments</replaceable> | gzip -9c &gt; Packages.gz</command>.
	
	</para><para>
	
	Les deux commandes fonctionnent de la même manière ; elles prennent deux arguments 
	(en réalité il y en a plus, reportez-vous aux pages de manuel pour en savoir plus).
	Le premier est le répertoire où sont les paquets, et le second est un fichier 
	<emphasis>override</emphasis>. Pour un simple référentiel le fichier <emphasis>override
	</emphasis>	n'est pas nécessaire, mais l'argument est obligatoire, utilisez simplement 
	<literal>/dev/null</literal>.
	
	</para><para>
	
	La commande <command>dpkg-scanpackages</command> recherche les paquets avec l'extension
	<filename>.deb</filename> et <command>dpkg-scansources</command> les fichiers avec l'
	extension <filename>.dsc</filename>. Il est nécessaire de mettre les fichiers  <filename>
	.orig.gz</filename>, <filename>.diff.gz</filename> et <filename>.dsc</filename> ensemble. 
	Le fichier <filename>.changes</filename> n'est pas utilisé.
	
	</para><para>
	
	Ainsi, si vous avez un référentiel trivial comme celui de <xref linkend="trivial-example"/>, 
	vous pouvez créer les catalogues de la façon suivante :
	
	</para>
    <screen>
	$ cd my-repository
	$ dpkg-scanpackages binary /dev/null | gzip -9c &gt; binary/Packages.gz
	$ dpkg-scansources source /dev/null | gzip -9c &gt; source/Sources.gz
	</screen>
    <para>
	
	Si votre référentiel est plus complexe comme celui de <xref linkend="debian-repository-example"/>, 
	vous devriez écrire des scripts pour automatiser le processus.
	
	</para><para>
	
	Vous pouvez aussi utiliser l'argument <replaceable>pathprefix</replaceable> avec les deux 
	commandes pour simplifier la syntaxe ; ceci est laissé comme exercice pour le lecteur 
	(reportez-vous aux pages de manuel).
	
	</para>
    </section>
    <section id="release">
      <!-- todo: Release should be between <filename> tags, but then
      xmltex won't compile it --> 
    <title>Créer le fichier Release</title>

	<para>
	
	Si vous souhaitez que les utilisateurs puissent utiliser l'étiquetage « <emphasis>Pinning</emphasis> »
	avec votre référentiel, vous devez inclure un fichier <filename>Release</filename> dans chaque répertoire 
	contenant les catalogues. (Vous pouvez consulter le <ulink url="http://www.debian.org/doc/manuals/apt-howto/">
	APT HOWTO</ulink> pour plus d'information sur l'étiquetage).
	
	</para><para>
	
	Le fichier <filename>Release</filename> est un simple  fichier texte de la forme suivante :
	
	</para>
    <screen>
    Archive: <replaceable>archive</replaceable>
    Component: <replaceable>composant</replaceable>
    Origin: <replaceable>votre Compagnie</replaceable>
    Label: <replaceable>YourCompany Debian repository</replaceable>
    Architecture: <replaceable>architecture</replaceable>
	</screen>

      <variablelist>
        <varlistentry>
          <term><literal>Archive</literal></term>

          <listitem>
            <para>
			
			Le nom de la distribution Debian auquel appartiennent les paquets du répertoire, 
			c'est-à-dire <literal>stable</literal>, <literal>testing</literal> ou <literal>unstable</literal>.
			
			</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><literal>Component</literal></term>

          <listitem>
            <para>
			
			Les composants auquel appartiennent les paquets du répertoire, par exemple
            <literal>main</literal>, <literal>non-free</literal>, ou <literal>contrib</literal>.
			
			</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><literal>Origin</literal></term>

          <listitem>
            <para>
			Le nom du responsable du paquet.
			</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><literal>Label</literal></term>

          <listitem>
            <para>
			un commentaire satisfaisant pour les paquets ou pour votre référentiel.
			Utilisez votre imagination.
			  
			 </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><literal>Architecture</literal></term>

          <listitem>
            <para>
			
			L'architecture cible des paquets du répertoire, comme <literal>i386</literal>,
            <literal>sparc</literal> ou <literal>source</literal>.
			
			</para>
          </listitem>
        </varlistentry>
      </variablelist>

    <para>
	
	Il est important d'avoir des valeurs correctes pour les champs <literal>Archive</literal>
	et <literal>Architecture</literal>, car ce sont les plus utilisés pour l'étiquetage. Les autres 
	champs sont moins importants.
	
	</para>
    </section>

    <section id="pools">
    <title>Créer un « Pool »</title>

	  <para>
	  
	  Avec les référentiels automatiques, distribuer les paquets
	  dans des répertoires différents peut devenir rapidement difficile 
	  à administrer. Il y a aussi de l'espace disque ainsi que de la bande 
	  passante gâché, car il y a beaucoup de paquets (par exemple les paquets
	  de documentation) identiques dans toutes les architectures.
	  
	  </para><para>
	  
	  Dans ce cas, une solution possible est un  <emphasis>pool</emphasis>. Un pool est 
	  un répertoire supplémentaire à la racine du référentiel qui regroupe <emphasis>tous
	  </emphasis> les paquets (les binaires pour toutes les architectures, toutes les 
	  distributions et tous les composants ainsi que toutes les sources). Au travers d'une
	  combinaison adéquate des fichiers override. 
	  
	  Un bon exemple de référentiel incluant un pool est le référentiel Debian.
	  
	  </para><para>
	  
	  Les <emphasis>pools</emphasis> sont seulement utiles pour des référentiels importants.
	  Je n'ai jamais fait de référentiel semblable et je ne pense pas en avoir besoin 
	  prochainement, c'est pourquoi je n'expliquerai pas comment faire. Si vous pensez
	  qu'une section doit être ajoutée, vous êtes libre de l'écrire. Contactez-moi alors
	  pour que je la rajoute.	
	  
	  </para>
    </section>
    <section>
      <title>Outils</title>

      <para>
	  
	  Il existe différents outils pour automatiser et faciliter la création des archives Debian ; 
	  j'ai listé les plus importants.
	  
	  </para>

      <para>
	  <command>apt-ftparchive</command> est utilisé pour déplacer un ensemble de paquets Debian 
	  dans une arborescence du type de celle utilisée dans les archives officielles de Debian.
	  Cette commande fait partie du paquet <literal>apt-utils</literal>.
      
	  </para><para>
	  
	  <command>apt-move</command> est utilisé pour déplacer un ensemble de paquets Debian 
	  dans une arborescence du type de celle utilisée dans les archives officielles de Debian.

	  </para>	
    </section>
  </section> <!-- setting-up -->
  <section id="using-a-repository">
  <title>Utiliser un référentiel</title>

   <para>
   
   L'utilisation d'un référentiel est très simple, mais dépend du genre de référentiel 
   que vous avez fait : binaire ou source, et automatique ou trivial.
	
   </para><para>
   
   Chaque référentiel prend une ligne dans le fichier <filename>sources.list</filename> ;
   pour un référentiel de binaire vous utilisez la commande <literal>deb</literal>, et 
   pour les sources la commande<literal>deb-src</literal>.

   </para><para>
   Chaque ligne a la syntaxe suivante :

      <screen>deb|deb-src <replaceable>uri</replaceable> <replaceable>distribution</replaceable> [<replaceable>component1</replaceable>] [<replaceable>component2</replaceable>] [...]</screen>

    L'<replaceable>uri</replaceable> est l'URI de la racine du référentiel comme par exemple :
    <literal>ftp://ftp.votresite.com/debian</literal>, <literal>http://votresite.com/debian</literal>, 
	ou, pour un référentiel trivial : <literal>file::///home/joe/mon-referentiel-debian</literal>.  
	La dernière barre oblique est facultative.
	  
	 </para><para>
	 
	 Pour un référentiel automatique, vous devez spécifier une distribution et 
	 un ou plusieurs composants ; le nom de la distribution ne doit pas se terminer 
	 par une barre oblique.
	  
	 </para>

    <example>
      <!-- todo: sources.list should be tagged as <filename>, but xmltex
      doesn't support that -->
      <title>Deux référentiels automatiques dans mon sources.list</title>
	  
      <screen>
	  deb ftp://sunsite.cnlab-switch.ch/mirror/debian/ unstable main contrib non-free
	  deb-src ftp://sunsite.cnlab-switch.ch/mirror/debian/ unstable main contrib non-free
	  </screen>
     
	 <para>
	  
	  Ces deux lignes définissent un référentiel automatique pour paquets binaires et paquets source ayant pour
	  racine <literal>ftp://sunsite.cnlab-switch.ch/mirror/debian/</literal>, comme distribution 
	  <literal>unstable</literal> et pour composants <literal>main</literal>, <literal>contrib</literal>
	  et <literal>non-free</literal>.
	  
	  </para>
    </example>

	<para>
	
	Si le référentiel n'est pas automatique, alors la <emphasis>distribution</emphasis> définit
	le chemin relatif vers les catalogues et doit se terminer par une barre oblique, et aucun 
	composant ne doit être spécifié.
	
	</para>
	<example>
      <title>Deux référentiels triviaux dans mon sources.list</title>

      <screen>
	  deb file:///home/aisotton/rep-exact binary/
	  deb-src file:///home/aisotton/rep-exact source/
	  </screen>

      <para>
	  
	  La première de ces deux lignes définit un référentiel de paquet binaire dans le 
	  répertoire <filename>/home/aisotton/rep-exact/binary</filename> sur ma machine locale ;
	  et la seconde définit un référentiel pour paquets source dans le répertoire 
	  <filename>/home/aisotton/rep-exact/source</filename>.
	 
	 </para>
    </example>
  </section> <!-- using-a-repository -->

  <section>
    <title>Voir aussi</title>

    <itemizedlist>
      <listitem>
        <para>
		La documentation sur <command>apt-ftparchive</command>.
        </para>
      </listitem>

      <listitem>
        <para>
		La documentation sur <command>apt-get</command> et pour <literal>apt</literal>.
		</para>
      </listitem>

      <listitem>
        <para>
		La documentation sur <command>apt-move</command>
		</para>
      </listitem>

      <listitem>
        <para>
		<ulink url="http://www.apt-get.org/"/> pour des exemples de référentiels.
		</para>
      </listitem>
        
      <listitem>
        <para>
		Le <ulink url="http://www.debian.org/doc/manuals/apt-howto/">APT HOWTO</ulink>.
		</para>
      </listitem>

      <listitem>
        <para>
		La documentation sur <command>dpkg-scanpackages</command>.
		</para>
      </listitem>

      <listitem>
        <para>La documentation sur <command>dpkg-scansources</command>.</para>
      </listitem>

      <listitem>
        <para>
		Les pages de manuels sur <literal>sources.list(5)</literal>.
		</para>
      </listitem>
    </itemizedlist>

  </section>
</article>
