<!DOCTYPE debiandoc PUBLIC "-//DebianDoc//DTD DebianDoc//EN" [

<!-- textual data entities -->
<!-- first definition wins in SGML -->
<!ENTITY % default  SYSTEM "default.ent">  %default;
<!ENTITY % version  SYSTEM "version.ent">  %version;

]>
<!-- CVS revision of this document "$Revision: 1.116 $"  -->
<!-- CVS revision of original english document "*.**"  -->

<!-- In order to make translation easy, please do not continue text beyond
     normal boundary of SGML tag.  This file will be converted to po4a system.
     Copy maint-guide.pot as your initial maint-guide.??.po file and translate it.
     If you see too much us of "the following" and "as follows", 
     this is intentional. -->

<debiandoc>

 <book>

  <titlepag>

   <title>Debian New Maintainers' Guide</title>

   <author>Josip Rodin <email>joy-mg@debian.org</email> </author>
<!--
   <author>Translated by: [put your name here] <email>[put your e-mail here]</email> </author>
  -->

   <version>version &docversion;, &docisodate;</version>

   <copyright>
   <copyrightsummary>Copyright &copy; 1998-2002 Josip Rodin.</copyrightsummary>
   <copyrightsummary>Copyright &copy; 2005-2010 Osamu Aoki.</copyrightsummary>
   <copyrightsummary>Copyright &copy; 2010 Craig Small.</copyrightsummary>
   <copyrightsummary>Copyright &copy; 2010 Raphael Hertzog.</copyrightsummary>

<!-- For now we stick with ASCII for best compatibility.  No UTF-8 please.  
     If we have to, this should be in latin-1
     Translators, please let Osamu know you are translating.  
     We should be able to set up better po4a based work flow, now.
-->

   <p>This document may be used under the terms the GNU General Public License
   version 2 or higher.

   <p>This document was made using with these two documents as examples:

   <p>Making a Debian Package (AKA the Debmake Manual), copyright &copy;
   1997 Jaldhar Vyas.

   <p>The New-Maintainer's Debian Packaging Howto, copyright &copy; 1997
   Will Lowe.
   </copyright>

  </titlepag>

  <toc sect1>

  <chapt id="start">Getting started The Right Way

  <p>This document tries to describe building of a Debian package to the
  common Debian user, and the prospectus developer. It uses pretty common language,
  and it's well covered with working examples.
  There is an old Roman saying, <em>Longum
  iter est per preaecepta, breve et efficax per exempla!</em> (It's a long way
  by the rules, but short and efficient with examples!).

  <p>This document has been updated for the Debian <tt>squeeze</tt> release.
  <footnote>The document assumes you are using the <tt>squeeze</tt> system.  If
  you need to follow this text in the <tt>lenny</tt> system, you must install
  backported <package>dpkg</package> and <package>debhelper</package>
  packages, at least.</footnote>

  <p>One of the things that makes Debian such a top-notch Linux distribution
  is its package system. While there is a vast quantity of software already
  in the Debian format, sometimes you need to install software that isn't.
  You may be wondering how you can make your own packages and perhaps you
  think it is a very difficult task. Well, if you are a real novice on Linux,
  it is hard, but if you were rookie, you wouldn't be reading this doc now. :-)
  You do need to know a little about Unix programming but you certainly
  don't need to be a wizard.

  <p>One thing is certain, though: to properly create and maintain Debian
  packages you need many hours. Make no mistake, for our system to work the
  maintainers need to be both technically competent and diligent.

  <p>This document will explain every little (at first maybe irrelevant)
  step, and help you create that first package, and to gain some experience
  in building next releases of that and maybe other packages later on.

  <p>If you need some help on packaging, please read <ref id="helpme">.

  <p>Newer versions of this document should always be available online at
  <url name="http://www.debian.org/doc/maint-guide/" id="http://www.debian.org/doc/maint-guide/">
  and in the <package/maint-guide/ package.
  <!-- Translation in <this language> is also available in the
       <package/maint-guide-xy/ package. -->

  <sect id="needprogs">Programs you need for development

  <p>Before you start anything, you should make sure that you have properly
  installed some additional packages needed for development. Note that the
  list doesn't contain any packages marked <tt>essential</tt> or <tt>required</tt> - we
  expect that you have those installed already.

  <p>The following packages come with the standard Debian installation,
  so you probably have them already (along with any additional packages
  they depend on).
  Still, you should check it with "<tt>aptitude show <var>package</var></tt>".

  <p>
  The most important package to install on your development system is the
  <package/build-essential/ package. Once you try to install it, it will
  <em>pull in</em> other packages required to have a basic build environment.

  <p>
  For some types of packages, that is all you will require, however there
  is another set of packages that while not essential for all package builds 
  are useful to have install or may be required by your package:

  <list>
  <item><package/file/ - this handy program can determine what type a file is.
  (see <manref name="file" section="1">)

  <item><package/patch/ - this very useful utility will take a file containing
  a difference listing (produced by the <prgn>diff</prgn> program) and apply it to the
  original file, producing a patched version. (see <manref name="patch" section="1">)

  <item><package/perl/ - Perl is one of the most used interpreted scripting
  languages on today's Unix-like systems, often referred to as "Unix's Swiss Army
  Chainsaw". (see <manref name="perl" section="1">)

  <item><package/python/ - Python is another of the most used interpreted
  scripting languages on the Debian system that combines remarkable power
  with very clear syntax.  (see <manref name="python" section="1">)

  <item><package/autoconf/, <package/automake/ and <package/autotools-dev/ - 
  many newer programs use configure scripts and <file>Makefile</file> files preprocessed with 
  help of programs like these. (see "<tt>info autoconf</tt>", "<tt>info automake</tt>").
  The <package/autotools-dev/ keeps up-to-date versions of certain auto
  files and has documentation about the best way to use those files.

  <item><package/dh-make/ and <package/debhelper/ - <package/dh-make/ is necessary to
  create the skeleton of our example package, and it will use some of the
  <package>debhelper</package> tools for creating packages. They are not essential for creation
  of packages, but are <em>highly</em> recommended for new
  maintainers. It makes the whole process very much easier to start, and
  control afterwards. (see <manref name="dh_make" section="1">,
  <manref name="debhelper" section="1">, <file>/usr/share/doc/debhelper/README</file>)
  <footnote>
  There are few similar but specialized packages such as
  <package>dh-make-perl</package>, <package>dh-make-php</package>, etc.
  </footnote>

  <item><package/devscripts/ - this package contains some nice and useful
  scripts that can be helpful to the maintainers, but they are also not
  necessary for building packages. Packages recommended and suggested by 
  this package are worth looking into.  (see <file>/usr/share/doc/devscripts/README.gz</file>)

  <item><package/fakeroot/ - this utility lets you emulate being root which
  is necessary for some parts of the build process. (see
  <manref name="fakeroot" section="1">)

  <item><package/gnupg/ - a tool that enables you to digitally <em>sign</em>
  packages. This is especially important if you want to distribute it to
  other people, and you will certainly be doing that when your work gets
  included in the Debian distribution. (see <manref name="gpg" section="1">)

  <item><package/gfortran/ - the GNU Fortran 95 compiler, necessary if your
  program is written in Fortran. (see <manref name="gfortran" section="1">)

  <item><package/gpc/ - the GNU Pascal compiler, necessary if your
  program is written in Pascal. Worthy of note here is <package/fp-compiler/,
  the Free Pascal Compiler, which is also good at this task.
  (see <manref name="gpc" section="1">, <manref name="ppc386" section="1">)

  <item><package/xutils-dev/ - some programs, usually those
  made for X11, also use these programs to generate <file>Makefile</file> files from sets of
  macro functions. (see <manref name="imake" section="1">,
  <manref name="xmkmf" section="1">)

  <item><package/lintian/ - this is the Debian package checker that can let
  you know of any common mistakes after you build the package, and explains
  the errors found. (see <manref name="lintian" section="1">,
  <file>/usr/share/doc/lintian/lintian.html/index.html</file>)

  <item><package/pbuilder/ - this package contains programs which are used 
  for creating and maintaining <prgn>chroot</prgn> environment.  Building Debian 
  package in this <prgn>chroot</prgn> environment verifies the proper build dependency
  and avoid FTBFS (Fails To Build From Source) bugs.  (see <manref
  name="pbuilder" section="8"> and <manref name="pdebuild" section="1">)

  <item><package/patchutils/ - this package contains some utilities to work
  with patches such as the <prgn>lsdiff</prgn> , <prgn>interdiff</prgn> and
  <prgn>filterdiff</prgn> commands.

  <item><package/quilt/ - this package helps you to manage a series
  of patches by keeping track of the changes each of them makes. They are
  logically organized as a stack, and you can apply (=push), un-apply (=pop),
  refresh them easily by traveling into the stack. (see <manref name="quilt"
  section="1">, <file>/usr/share/doc/quilt/README.Debian</file>)

  <item><package/git-core/ - this package provides popular version control 
  system designed to handle very large projects with speed and efficiency; 
  it is used for many high profile open source projects, most notably the
  Linux kernel. (see <manref name="git" section="1">,
  <file>/usr/share/doc/git-doc/index.html</file>)

  </list>

  <p>The following is the <em>very important</em> documentation which you
  should read along with this document:

  <list>
  <item><package/debian-policy/ - the <url name="Debian Policy Manual" id="http://www.debian.org/doc/devel-manuals#policy"> 
  includes explanations of the
  structure and contents of the Debian archive, several OS design issues,
  the Filesystem Hierarchy Standard (which says where each file and
  directory should be) etc.
  For you, the most important thing is that it describes requirements that
  each package must satisfy to be included in the distribution
  (see <file>&debian-policy;</file>).

  <item><package/developers-reference/ - the 
  <url name="Debian Developer's Reference" id="http://www.debian.org/doc/devel-manuals#devref"> 
  describes all matters not specifically
  about the technical details of packaging, like the structure of the
  archive, how to rename, orphan, pick up packages, how to do NMUs, how to
  manage bugs, best packaging practices, when and where to upload etc.
  (see <file>&developers-reference;</file>).

  <item> 
  <url name="Autotools Tutorial" id="http://www.lrde.epita.fr/~adl/autotools.html"> 
  provides very good tutorial for 
  <url name="the GNU Build System known as the GNU Autotools" id="http://en.wikipedia.org/wiki/GNU_build_system">
  whose most important components are Autoconf, Automake, Libtool,
  and Gettext.

  <item><package/gnu-standards/ - this package contains two pieces of
  documentation from the GNU project: 
  <url name="GNU Coding Standards" id="http://www.gnu.org/prep/standards/html_node/index.html">, and 
  <url name="Information for Maintainers of GNU Software" id="http://www.gnu.org/prep/maintain/html_node/index.html">.
  Although Debian does not require these to be followed, these are still
  helpful as guidelines and common sense.
  (see <file>/usr/share/doc/gnu-standards/standards.html</file> and
  <file>/usr/share/doc/gnu-standards/maintain.html</file>).

  </list>

  <p>If this document contradicts with what the Debian Policy Manual and Debian
  Developer's Reference describes, they are correct.  Please file a bug report
  on the <package>maint-guide</package> package.

  <p>The short descriptions that are given above only serve to introduce
  you to what each package does. Before continuing please thoroughly read
  the documentation of each program, at least, for the standard usage.
  It may seem like heavy going now, but later on you'll be <em>very</em>
  glad you read it.

  <sect id="terminology">Basic terminology

  <p>There are two types of packages.

  <list>

  <item><strong>source package</strong>: A source package is a set of files
  which contain code and data which you can compile and process into execution
  programs and formatted documents.  It usually comes as a combination of
  <file>*.orig.tar.gz</file>, <file>*.debian.tar.gz</file> (or
  <file>*.diff.gz</file>), and <file>*.dsc</file>.  Some other archive and
  compression methods may be used, too.

  <item><strong>binary package</strong>: A binary package contains execution
  programs and formatted documents.  It usually comes as <file>*.deb</file> for
  the normal Debian system and as <file>*.udeb</file> for the Debian Installer.

  </list>

  <p> Don't mix terms like source of the program and the source package of the
  program!

  <p>There are several role names used around Debian.

  <list>

  <item><strong>upstream author</strong>: The person who made the original
  program.

  <item><strong>upstream maintainer</strong>: The person who currently
  maintains the program.

  <item><strong>maintainer</strong>: The person who makes Debian package of the
  program.

  <item><strong>sponsor</strong>: The person who helps maintainers to upload
  packages to the official Debian Package Archive after checking their
  contents.

  <item><strong>mentor</strong>: The person who helps novice maintainers on
  packaging etc.

  <item><strong>Debian Developer</strong> (DD): The person who is a member of
  Debian.  He has full upload right to the official Debian Package Archive.

  <item><strong>Debian Maintainer</strong> (DM): The person who has limited upload
  right to the official Debian Package Archive.

  </list>

  <p>There are several version names used around Debian.

  <list>
  <item><strong>upstream source version</strong>: The upstream source version is referred as <tt><var>version</var></tt>.

  <item><strong>Debian revision</strong>: The revision by Debian on package is referred as <tt><var>revision</var></tt>.

  <item><strong>Debian package version</strong>: The Debian package version is referred as the following.
  <list>
  <item><tt><var>version</var></tt> for the native Debian binary package and for the Debian source package.
  <item><tt><var>version</var>-<var>revision</var></tt> for the non-native Debian binary package.
  </list>

  </list>

  <p>Please read the other manuals if you need more details on terminology.

  <sect id="debiandeveloper">Official Debian Developer

  <p>You can not become an official <strong>Debian Developer</strong> (DD) over
  night because it takes more than technical skill.  Please do not be
  discouraged by this.  If it is useful to others, you can still upload your
  package either as a <strong>maintainer</strong> through a
  <strong>sponsor</strong> or as a <strong>Debian Maintainer</strong>.
  See <url name="Debian New Maintainers" id="&newmaint;"> for more.

  <p>Please note that you do not need to create any new package to
  become an official Debian Developer.  Contributing to the existing
  packages can provide a path to become an official Debian Developer
  too.  There are many packages waiting for good maintainers (see <ref id="choose">).

  <sect id="helpme">Where to ask for help

  <p>Before you decide to ask your question in some public place, please
  just RTFM.
  <!-- /usr/share/doc/debian is used be doc-debian and debian-faq --> 
  That includes documentation in <file>/usr/share/doc/dpkg</file>,
  <file>/usr/share/doc/debian</file>, <file>&autotools-dev;</file>, 
  <file>/usr/share/doc/<var>package</var>/*</file>
  files and the <prgn>man</prgn>/<prgn>info</prgn> pages for all the programs mentioned in this document.
  See all the information at <url id="&nm-home;">.

  <p>Making a small test package is good way to learn details of packaging.
  Inspecting existing well maintained packages is the best way to learn how other
  people make packages.

  <p>If you still have questions about packaging that you couldn't find answers to
  in the available documentation and web resources, you can ask them on the Debian Mentors' mailing list
  at <url id="http://lists.debian.org/debian-mentors/" name="debian-mentors@lists.debian.org">. The more experienced Debian
  developers will gladly help you, but do read at least some of the
  documentation before asking a question!

  <p>See <url id="http://lists.debian.org/debian-mentors/"> for more
  information about this mailing list.

  <p>When you receive
  a bug report (yes, actual bug reports!), you will know that it is time for you
  to dig into the <url name="Debian Bug Tracking System" id="http://www.debian.org/Bugs/">
  and read the documentation there, to be able to deal with the reports
  efficiently. I highly recommend reading the <url name="Developer's Reference, 5.8. 'Handling bugs'"
  id="http://www.debian.org/doc/manuals/developers-reference/pkgs.html#bug-handling">.

  <p>If you still have questions, ask on the Debian Developers' mailing list
  at <url id="http://lists.debian.org/debian-devel/" name="debian-devel@lists.debian.org">. See
  <url id="http://lists.debian.org/debian-devel/"> for more information
  about this mailing list.

  <p>Even if it all worked well, it's time to start praying. Why? Because
  in just a few hours (or days) users from all around the world will start
  to use your package, and if you made some critical error you'll get
  mailbombed by numerous angry Debian users... Just kidding. :-)

  <p>Relax and be ready for bug reports, because there is a lot more work
  to be done before your package will be fully in line with Debian policies
  and its best practice guidelines
  (once again, read the <em>real documentation</em> for details). Good luck!

  <chapt id="first">First steps

  <p>Let's try to make your own package.

  <sect id="choose">Choose your program

  <p>You have probably chosen the package you want to create. The first
  thing you need to do is check if the package is in the distribution archive
  already by using <prgn>aptitude</prgn>.

  <p>You can also check package information through
  <url name="package search page" id="http://www.debian.org/distrib/packages"> and
  <url name="Debian Package Tracking System" id="http://packages.qa.debian.org/common/index.html">.

  <p>If the package already exists, well, install it! :-) If it happens to
  be orphaned -- if its maintainer is set to "Debian QA Group", you may
  be able to pick it up. 

<p>Then you should consult the Debian web site at
  <url name="Work-Needing and Prospective Packages" id="http://www.debian.org/devel/wnpp/">
  and
  <url name="the latest adoption/orphan status of the package" id="http://wnpp.debian.net/">.

  <p>If you are able to adopt the package, get the sources (with something
  like "<tt>apt-get source <var>packagename</var></tt>") and examine them. This document
  unfortunately doesn't include comprehensive information about adopting
  packages. Thankfully you shouldn't have a hard time figuring out how the
  package works since someone has already done the initial set up for you.
  Keep reading, though, a lot of the advice below will still be applicable
  for your case.

  <p>If the package is new, and you decide you'd like to see it in Debian,
  proceed as follows:

  <list>
  <item>First, you must know that program works, and
  have tried it for some time to confirm its usefulness.</item>

  <item>You must check if no one else is working on the package already at
  <url name="the list of packages being worked on" id="http://www.de.debian.org/devel/wnpp/being_packaged">.
  If no one else is working on it, file an ITP (Intent To Package) bug report
  to the <package>wnpp</package> pseudo-package using <prgn>reportbug</prgn>.
  If someone's already on it, contact them if you feel you need to.
  If not - find another interesting program that nobody maintains.
  </item>

  <item>That program <strong>must have a license</strong>.

  <list>
  <item>For the <tt>main</tt> section, it <strong>must be compliant to all the Debian Free Software Guidelines(DFSG)</strong>
  (see <url id="http://www.debian.org/social_contract#guidelines">)
  and <strong>That program must not require a package outside of
  <tt>main</tt></strong> for compilation or execution as required by the Debian Policy.  
  This is desired case.</item>
  <item>For the <tt>contrib</tt> section, it must be compliant
  to all the DSFG but it may require a package outside of main for compilation
  or execution.</item>
  <item>For the <tt>non-free</tt> section, it may not be
  compliant to some of the DSFG but it <strong>must be
  distributable</strong>.</item>
  </list>

  If you are unsure about where it should go, post the license text on
  <url id="http://lists.debian.org/debian-legal/" name="debian-legal@lists.debian.org"> and ask for advice.
  </item>

  <item>That program certainly should <strong>not</strong> run setuid root, or
  even better - it shouldn't need to be setuid or setgid to anything.</item>

  <item>That program should not be a daemon, or something that goes in <file>*/sbin</file>
  directories, or open a port as root.</item>

  <item>That program should result in binary executable form, libraries are
  harder to handle.</item>

  <item>That program should be well documented and its code needs to be
  understandable (i.e. not obfuscated).</item>

  <item>You should contact program's author(s) to check if they agree
  with packaging it and amicable to Debian. It is important to be able to consult with author(s)
  about the program in case of any program specific problems, so don't
  try to package unmaintained pieces of software.</item>

  </list>

  <p>Of course, these things are just safety measures, and intended to save
  you from raging users if you do something wrong in some setuid daemon...
  When you gain some more experience in packaging, you'll be able to do such
  packages, but even the experienced developers consult the <url id="http://lists.debian.org/debian-mentors/" name="debian-mentors@lists.debian.org">
  mailing list when they are in doubt. And people there will gladly help.

  <p>For more help about these, check in <url name="Debian Developer's Reference" id="http://www.debian.org/doc/devel-manuals#devref">.

  <sect id="getit">Get the program, and try it out

  <p>So the first thing to do is to find and download the original source code.
  I presume that you already have the source file that you picked up at the
  author's homepage. Sources for free Unix programs usually come in
  <prgn>tar</prgn>+<prgn>gzip</prgn> format with extension
  <file>.tar.gz</file>, or <prgn>tar</prgn>+<prgn>bzip2</prgn> format with
  extension <file>.tar.bz2</file>.  These usually contain the subdirectory
  called <file><var>programname</var>-<var>version</var></file> in them and all the
  sources under it.

  <p>If the latest version of such sources are available through VCS such as
  Git, Subversion, or CVS repository, you need to get it with "<tt>git
  clone</tt>", "<tt>cvs co</tt>", or "<tt>svn co</tt>" and repack it into
  <prgn>tar</prgn>+<prgn>gzip</prgn> format by yourself using the
  "<tt>--exclude-vcs</tt>" option.

  <p>If your program's source comes as some other sort of archive (for
  instance, the filename ends in <file>.Z</file> or
  <file>.zip</file><footnote>You can identify the archive format using the
  <prgn>file</prgn> command when the file extension is not enough.</footnote>),
  unpack it with appropriate tools and repack it, too.

  <p>As an example, I'll use a program called <prgn>gentoo</prgn>, an X GTK+ file
  manager.<footnote>This program is already packaged.  Current version 0.15.3 has changed
  substantially from the version 0.9.12 in the following examples.</footnote>

  <p>Create a subdirectory under your home directory named <file>debian</file> or <file>deb</file>
  or anything you find appropriate (e.g. just <file>~/gentoo</file> would do fine in
  this case). Place the downloaded archive in it, and uncompress it (with
  "<tt>tar xzf gentoo-0.9.12.tar.gz</tt>"). Make sure there are no errors, even some
  <em>irrelevant</em> ones, because there will most probably be problems unpacking
  on other people's systems, whose unpacking tools may or may not ignore
  those anomalies.  On your console screen, you should see the following.

<example>
$ mkdir ~/gentoo ; cd ~/gentoo
$ wget http://<var>www.example.org</var>/gentoo-0.9.12.tar.gz
$ tar xvzf gentoo-0.9.12.tar.gz
$ ls -F
gentoo-0.9.12/
gentoo-0.9.12.tar.gz
</example>

  <p>Now you have another subdirectory, called <file>gentoo-0.9.12</file>.
  Change to that directory and <em>thoroughly</em> read the provided
  documentation. Usually there are files named <file>README*</file>,
  <file>INSTALL*</file>, <file>*.lsm</file> or <file>*.html</file>. You must
  find instructions on how to correctly compile and install the program (most
  probably they'll assume you want to install to <file>/usr/local/bin</file>
  directory; you won't be doing that, but more on that later in <ref
  id="destdir">).

  <p>Simple programs come with a <file>Makefile</file> file in them and can be
  compiled simply with "<tt>make</tt>".  Some of them support 
  "<tt>make check</tt>", which runs included self-checks. Installation to the
  destination directories is usually done with "<tt>make install</tt>".

  <p>Now try to compile and run your program, to make sure it works properly
  and doesn't break something else while it's installing or running.

  <p>Also, you can usually run "<tt>make clean</tt>" (or better "<tt>make distclean</tt>") to
  clean up the build directory. Sometimes there's even a "<tt>make uninstall</tt>"
  which can be used to remove all the installed files.

  <sect id="autotools">Compile portable programs using Autotools

  <p>A lot of Free programs use 
  <url name="the GNU Build System known as the GNU Autotools" id="http://en.wikipedia.org/wiki/GNU_build_system">,
  whose most important components are Autoconf, Automake, Libtool, and Gettext
  to make them portable across different platforms.  You can notice such sources by the
  <file>configure.ac</file>, <file>Makefile.am</file>, and <file>Makefile.in</file> files.
  <footnote>
  See <url name="Autotools Tutorial" id="http://www.lrde.epita.fr/~adl/autotools.html"> 
  and <file>&autotools-dev;</file>.
  </footnote>

  <p>The first step of Autotools work flow is usually that the upstream runs
  "<tt>autoreconf -i -f</tt>" in the source and distributes this source with
  generated files.
<example>
configure.ac-----+-> autoreconf -+-> configure
Makefile.am -----+        |      +-> Makefile.in
src/Makefile.am -+        |      +-> src/Makefile.in
                          |      +-> config.h.in
                      automake
                      aclocal
                      aclocal.m4
                      autoheader
</example>

  <p>Editing <file>configure.ac</file> and <file>Makefile.am</file> files
  requires some knowledge of <prgn>autoconf</prgn> and <prgn>automake</prgn>.
  See "<tt>info autoconf</tt>" and "<tt>info automake</tt>".

  <p>The second step of Autotools work flow is usually that the user obtains
  this distributed source and runs "<tt>./configure  &amp;&amp; make</tt>" 
  in the source to compile program into a <prgn><var>binary</var></prgn>.

<example>
Makefile.in -----+                +-> Makefile -----+-> make -> <var>binary</var>
src/Makefile.in -+-> ./configure -+-> src/Makefile -+
config.h.in -----+                +-> config.h -----+
                          |
           config.status -+
           config.guess --+
</example>

  <p>You can change many things in the <file>Makefile</file> file such as the
  default file install location using the command option, e.g. 
  "<prgn>./configure --prefix=/usr</prgn>".

  <p>Although it is not required, updating the <file>configure</file> and other
  files with "<tt>autoreconf -i -f</tt>" as the user may improve the
  compatibility of the source.

  <sect id="namever">Package name and version

  <p>You should start packaging with a completely clean (pristine) source
  directory, or simply with freshly unpacked sources.
  
  <p>For the package to be built correctly, you must make the program's
  original name lowercase (if it isn't already), and you should move the
  source directory to <file><var>packagename</var>-<var>version</var></file>.
  
  <p>If the program name consists of more than one word, contract them to one
  word, or make an abbreviation. For example, program "John's little editor
  for X" package would be named <package>johnledx</package>, or <package>jle4x</package>, or whatever you decide,
  as long as it's under some reasonable limit, e.g. 20 characters.

  <p>Also check for the exact version of the program (to be included in the
  package version). If that piece of software is not numbered with versions
  like <tt>X.Y.Z</tt>, but with some kind of date, feel free to use that date as the
  version number, as long as newer version numbers will look larger.
  While it is best to use the same version number as what upstream uses,
  if it is in the format of <tt>09Oct23</tt> you may need to convert it to
  <tt>YYYYMMDD</tt> format, which would be <tt>20091023</tt>, to ensure 
  proper order for upgrade with the <prgn>dpkg</prgn> program.<footnote>Version string can be compared by
  "<tt>dpkg --compare-versions <var>ver1</var> <var>op</var> <var>ver2</var></tt>". 
  See <manref name="dpkg" section="1"> manpage.</footnote>

  <p>Some programs won't be numbered at all, in which case you
  should contact the upstream maintainer to see if they've got some other
  revision-tracking method.

  <sect id="dh_make">Initial <em>debianization</em>

  <p>Let's set up the Bash shell environment variable <tt>$DEBEMAIL</tt> and
  <tt>$DEBFULLNAME</tt> so many Debian maintenance tools recognize your name and
  email address to use for packages as follows.

<example>
$ cat &gt;&gt;~/.bashrc &lt;&lt;EOF
DEBEMAIL=your.email.address@example.org
DEBFULLNAME="Firstname Lastname"
export DEBEMAIL DEBFULLNAME
EOF
</example>

  <p>Let's make initial <em>debianization</em> by issuing the <prgn>dh_make</prgn> command as follows.

<example>
$ . ~/.bashrc
$ cd ~/gentoo/gentoo-0.9.12
$ dh_make -f ../gentoo-0.9.12.tar.gz
</example>

  <p>Of course, replace the filename with the name of your original source
  archive. 
  <footnote>If the upstream source provides the <file>debian</file> directory
  and its contents, run the <prgn>dh_make</prgn> command with the
  <tt>--addmissing</tt> option, instead.  The new source
  <tt>3.0 (quilt)</tt> format is quite robust not to break even for these packages.
  You may need to update contents provided by the upstream for your Debian
  package.</footnote>
  See <manref name="dh_make" section="1"> for details.
 
  <p>Some information will come up. It will ask you what sort of package you
  want to create. Gentoo is a single binary package - it creates only one
  binary, and thus one <file>.deb</file> file - so we will select the first option, with
  the "<tt>s</tt>" key, check the information on the screen and confirm by pressing
  "<tt><var>ENTER</var></tt>".
  <footnote>There are few choices here: "<tt>s</tt>" for "Single binary",
  "<tt>i</tt>" for "Arch-Independent", "<tt>m</tt>" for "Multiple binary",
  "<tt>l</tt>" for "Library", "<tt>k</tt>" for "Kernel module", "<tt>b</tt>"
  for "<package>cdbs</package>", "<tt>--kpatch</tt>" for "Kernel patch".  This
  document focuses on the use of the <package>debhelper</package> package with
  the <prgn>dh</prgn> command.  This document focuses on the use of the new
  <prgn>dh</prgn> command for "Single binary" and touches on it for
  "Arch-Independent" and "Multiple binary".  The <package>cdbs</package>
  package offers alternative package script infrastructure to the
  <prgn>dh</prgn> command and outside of the scope of this document.</footnote>

  <p>After this execution of <prgn>dh_make</prgn>, a copy of the
  upstream tarball is created as <file>gentoo_0.9.12.orig.tar.gz</file>
  in the parent directory to accommodate the creation of the non-native
  Debian source package with the <file>debian.tar.gz</file> later. 

<example>
$ cd ~/gentoo ; ls -F
gentoo-0.9.12/
gentoo-0.9.12.tar.gz
gentoo_0.9.12.orig.tar.gz
</example>
 
  <p>Please note 2 key features in this <file>gentoo_0.9.12.orig.tar.gz</file> file name:
  <list>
  <item>Package name and version are separated by the "<tt>_</tt>" (underscore).
  <item>There is the <file>.orig</file> before the <file>.tar.gz</file> .
  </list>

  <p>You should also notice that many template files are created in the source
  under the <file>debian</file> directory.  These will be explained in <ref
  id="dreq"> and <ref id="dother">.  You should also understand that the
  packaging is not automatic process.  You need to modify the upstream source
  for Debian as <ref id="modify">.  After all these, you need to build Debian
  packages under the proper method as <ref id="build">, check them as <ref
  id="checkit">, and upload them as <ref id="upload">.  I will explain all
  these steps.

  <p>Once again, as a new maintainer you are discouraged from creating
  complicated packages, e.g.,
  <list>
  <item>multiple binary packages,
  <item>library packages,
  <item>kernel module packages,
  <item>kernel patch packages,
  <item>the source file format being neither in <file>tar.gz</file> nor
       <file>tar.bz2</file>, or
  <item>the source tarball containing undistributable contents.
  </list>
  It's not too hard, but it does require a bit more knowledge, so we
  won't describe all of it here. 

  <p>If you accidentally erased some template files while working on them, you
  can recover them by running <prgn>dh_make</prgn> with the
  <tt>--addmissing</tt> option again in an already <em>debianized</em>
  directory.

  <p>Updating an existing package may get complicated since it may be using
  older techniques.  Please stick with fresh packaging cases for now to learn
  basics.  I will come back to explain it later in <ref id="update">.

  <chapt id="modify">Modifying the source

  <p>Please note that there isn't space here to go into <em>all</em> the
  details of fixing upstream sources, but here are some basic steps and
  problems people often run across.

  <sect id="quiltrc">Set up <prgn>quilt</prgn>

  <p>The <prgn>quilt</prgn> program offers the basic method to record
  modification to the source for the Debian packaging.  Since slightly
  different default is desirable for Debian packaging, let's set up
  <file>~/.quilrc</file> as follows.
  <footnote>You can disable this configuration by starting the
  <prgn>quilt</prgn> command as "<tt>quilt --quiltrc /dev/null ...</tt>".
  </footnote>

<example>
$ cat &gt;&gt;~/.quiltrc &lt;&lt;EOF
d=. ; while [ ! -d "$d/debian" -a `readlink -e $d` != / ]; do d="$d/.."; done
if [ -d "$d/debian" ] && [ -z "$QUILT_PATCHES" ]; then
    # Debian packaging case and unset $QUILT_PATCHES
    QUILT_PATCHES=debian/patches
    QUILT_PATCH_OPTS="--unified-reject-files"
    QUILT_DIFF_ARGS="-p ab --no-timestamps --no-index --color=auto"
    QUILT_REFRESH_ARGS="-p ab --no-timestamps --no-index"
    QUILT_COLORS="diff_hdr=1;32:diff_add=1;34:diff_rem=1;31:\
diff_hunk=1;33:diff_ctx=35:diff_cctx=33"
    if ! [ -d $d/debian/patches ]; then mkdir $d/debian/patches; fi
fi
EOF
</example>

  <p>See <manref name="quilt" section="1"> and
  <file>/usr/share/doc/quilt/quilt.html</file> for how to use <prgn>quilt</prgn>.

  <sect id="fixupstream">Fixing upstream bug
 
  <p>Let's assume you find an error in the upstream <file>Makefile</file> file as follows where
  "<tt>install: gentoo</tt>" should have been 
  "<tt>install: gentoo-target</tt>".

<example>
install: gentoo
        install ./gentoo $(BIN)
        install icons/* $(ICONS)
        install gentoorc-example $(HOME)/.gentoorc
</example>

  <p>Let's fix this and record this with the <prgn>quilt</prgn> command as
  <file>fix-gentoo-target.patch</file>.
<footnote> The <file>debian/patches</file> directory should exist now if you
run <prgn>dh_make</prgn> as described before.  This example operation creates
it just in case you are updating the existing package.</footnote>

<example>
$ mkdir debian/patches
$ quilt new fix-gentoo-target.patch
$ quilt add Makefile
</example>

You change the <file>Makefile</file> file as follows.

<example>
install: gentoo-target
        install ./gentoo $(BIN)
        install icons/* $(ICONS)
        install gentoorc-example $(HOME)/.gentoorc
</example>

<p>Ask quilt to refresh the patch to create <file>debian/patches/fix-gentoo-target.patch</file> and add its description.

<example>
$ quilt refresh
$ quilt header -e
... describe patch
</example>

  <sect id="destdir">Installation of files to the destination

  <p>Normally, programs install themselves in the <file>/usr/local</file>
  subdirectory.  Since it is reserved for system administrator's (or user's)
  private use, Debian packages must not use that directory but should use
  system directories such as the <file>/usr/bin</file> subdirectory following
  the Filesystem Hierarchy Standard 
  (<url name="FHS" id="http://www.debian.org/doc/packaging-manuals/fhs/fhs-2.3.html">, 
  <file>/usr/share/doc/debian-policy/fhs/fhs-2.3.html</file>). 

  <p>Normally, <manref name="make" section="1"> is used to automate building
  the program and the execution of "<tt>make install</tt>" installs programs
  directly to the desired destination by the <tt>install</tt> target of the
  <file>Makefile</file> file.  In order for Debian to provide binary packages,
  the build system installs programs to the file tree image created under a
  temporary directory instead to the actual destination.

  <p>
  These 2 differences between (1) the normal program installation and (2) the
  Debian packaging can be transparently addressed by the
  <package>debhelper</package> package through the
  <prgn>dh_auto_configure</prgn> and <prgn>dh_auto_install</prgn> commands if
  the following conditions are met.
  <list>
  <item>The <file>Makefile</file> file follows the GNU conventions to
  support <tt>$(DESTDIR)</tt> variable
  (<file>/usr/share/doc/gnu-standards/standards.html#Makefile-Conventions</file>).
  <item>The source follows the Filesystem Hierarchy Standard (FHS).
  </list>
  <p>Programs that use GNU <prgn>autoconf</prgn> <em>automatically</em> follow
  the GNU conventions and their packaging is almost <em>automatic</em>.  With
  this and other heuristics, the <package>debhelper</package> package estimates
  that it works for about 90% of packages without making any intrusive changes
  to their build system.  So the packaging is not as complicated as it may
  seem.
  
  <p>If you need to make changes in the <file>Makefile</file> file, you should
  make sure to support these <tt>$(DESTDIR)</tt> 
  variable.  The <tt>$(DESTDIR)</tt> variable is unset in it and is prepended
  to each file path used for the program installation.  The packaging
  script will set <tt>$(DESTDIR)</tt> to the temporary directory.

  <p>The temporary directory used by the <prgn>dh_auto_install</prgn> command
  is chosen as <file>debian/<var>package</var></file> for single binary
  packages.
  <footnote>For multiple binary packages, the <prgn>dh_auto_install</prgn>
  command uses <file>debian/tmp</file> as the temporary directory while the
  <prgn>dh_install</prgn> command with the help of
  <file>debian/<var>package-1</var>.install</file> and
  <file>debian/<var>package-2</var>.install</file> files will split contents of
  <file>debian/tmp</file> into <file>debian/<var>package-1</var></file> and
  <file>debian/<var>package-2</var></file> temporary directories to create
  multiple binary <file>*.deb</file> packages.</footnote>
  Everything that is contained in the temporary directory will be installed on
  a user's system when they install your package, the only difference is that
  <prgn>dpkg</prgn> will be installing the files in the root directory.

  <p>Bear in mind that even though your program installs in
  <file>debian/<var>package</var></file>, it still needs to behave
  correctly when placed in the root directory, i.e. when installed from the
  <file>.deb</file> package. So you must not allow the build system to hardcode
  strings like
  <tt>/home/me/deb/<var>package</var>-<var>version</var>/usr/share/<var>package</var></tt>
  into the package file.

  <p>Here's the relevant part of <package>gentoo</package>'s
  <file>Makefile</file> file 
  <footnote>This is just an example to show how the <file>Makefile</file> file
  should look like.  If the <file>Makefile</file> file is created by the
  <prgn>./configure</prgn> command, the correct way to fix this kind of
  <file>Makefile</file> is to executed the <prgn>./configure</prgn> command from
  the <prgn>dh_auto_configure</prgn> command with default options including
  <tt>--prefix=/usr</tt>.</footnote>:

<example>
# Where to put binary on 'make install'?
BIN     = /usr/local/bin

# Where to put icons on 'make install'?
ICONS   = /usr/local/share/gentoo
</example>

  <p>We see that the files are set to install under <file>/usr/local</file>.
  Change those paths to:

<example>
# Where to put binary on 'make install'?
BIN     = $(DESTDIR)/usr/bin

# Where to put icons on 'make install'?
ICONS   = $(DESTDIR)/usr/share/gentoo
</example>

  <p>But why in that directory, and not some other? Because Debian packages
  never install files beneath <file>/usr/local</file> -- that tree is
  reserved for the system administrator's use. Such files on Debian
  systems go under <file>/usr</file> instead.

  <p>The more exact locations for binaries, icons, documentation etc. are
  specified in the Filesystem Hierarchy Standard
  (see <file>/usr/share/doc/debian-policy/fhs/</file>). I recommend you browse it and read
  the sections that might concern your package.

  <p>So, we should install the binary in <file>/usr/bin</file> instead of <file>/usr/local/bin</file>,
  the manual page in <file>/usr/share/man/man1</file> instead of <file>/usr/local/man/man1</file> etc.
  Notice how there's no manual page mentioned in <package>gentoo</package>'s <file>Makefile</file>, but
  since the Debian Policy requires that every program has one, we'll make one
  later and install it in <file>/usr/share/man/man1</file>.

  <p>Some programs don't use <file>Makefile</file> variables to define paths such as
  these. This means you might have to edit some real C sources in order to
  fix them to use the right locations.
  But where to search, and exactly what for? You can find this out by issuing:

<example>
$ grep -nr -e 'usr/local/lib' --include='*.[c|h]' .
</example>

  <p><prgn>grep</prgn> will run recursively through the source tree and tell
  you the filename and the line number for all matches.

  <p>Edit those files and in those lines replace <tt>/usr/local/lib</tt> with <tt>usr/lib</tt>.
<example>
$ vim '+argdo %s/usr\/local\/lib\//usr\/lib\//gce|update' +q \
      $(find . -type f -name '*.[c|h]')
</example>

  <p>Be careful that you don't mess up the rest of the code! :-)

  <p>After that you should find the install target (search for line that
  starts with <tt>install:</tt>, that will usually work) and rename all references
  to directories other than ones defined at the top of the <file>Makefile</file>.

  <p>After your upstream bug fix, <package>gentoo</package>'s install target said:

<example>
install: gentoo-target
        install ./gentoo $(BIN)
        install icons/* $(ICONS)
        install gentoorc-example $(HOME)/.gentoorc
</example>

  <p>Let's fix this and record this with the <prgn>quilt</prgn> command as <file>debian/patches/install.patch</file>.

<example>
$ quilt new install.patch
$ quilt add Makefile
</example>

  <p>Let's change this for Debian package as following using the editor:
<example>
install: gentoo-target
        install -d $(BIN) $(ICONS) $(DESTDIR)/etc
        install ./gentoo $(BIN)
        install -m644 icons/* $(ICONS)
        install -m644 gentoorc-example $(DESTDIR)/etc/gentoorc
</example>

  <p>You've surely noticed that there's now a "<tt>install -d</tt>" command
  before the other commands in the rule. The original <file>Makefile</file> didn't have
  it because usually the <tt>/usr/local/bin</tt> and other directories already exist
  on the system where one runs "<tt>make install</tt>". However, since we will
  install into our own empty (or even nonexistent) directory, we will have
  to create each and every one of those directories.

  <p>We can also add in other things at the end of the rule, like the
  installation of additional documentation that the upstream authors
  sometimes omit:

<example>
        install -d $(DESTDIR)/usr/share/doc/gentoo/html
        cp -a docs/* $(DESTDIR)/usr/share/doc/gentoo/html
</example>

  <p>After careful check, if everything is fine, ask quilt to refresh the patch to create <file>debian/patches/install.patch</file> and add its description.

<example>
$ quilt refresh
$ quilt header -e
... describe patch
</example>

  <p>Now you have a series of patches.
  <enumlist>
    <item>Upstream bug fix: <file>debian/patches/fix-gentoo-target.patch</file> 
    <item>Debian specific packaging modification: <file>debian/patches/install.patch</file>
  </enumlist>

  <p>Whenever you make changes that are not specifically related to Debian
  package such as <file>debian/patches/fix-gentoo-target.patch</file>, 
  be sure to send them to the upstream maintainer so they can be
  included in the next program revision and be useful to everyone else.
  Also remember to make your fixes not specific to Debian or Linux (or even
  Unix!) prior to sending them -- make them portable. This will make your
  fixes much easier to apply.

  <p>Note that you don't have to send the <file>debian/*</file> files upstream.

  <sect id="difflibs">Differing libraries

  <p>There is one other common problem: libraries are often different from
  platform to platform. For example, a <file>Makefile</file> can contain a reference to a
  library which doesn't exist on Debian systems. In that case, we
  need to change it to a library which does exist in Debian, and serves the
  same purpose.

  <p>So, if there is a line in your program's <file>Makefile</file> (or <file>Makefile.in</file>) that
  says something like this (and your program doesn't compile)
  <footnote><p>The author realizes that this is not the best example considering our
  <package>libncurses</package> package now ships with a <file>libcurses.so</file> symlink, but he couldn't
  think of a better one. Suggestions very welcome :-)</footnote>:

<example>
LIBS = -lcurses -lsomething -lsomethingelse
</example>

  <p>Let's fix this as <file>debian/patches/ncurse.patch</file> by changing <tt>curses</tt> into <tt>ncurses</tt>.

<example>
$ quilt new ncurse.patch
$ quilt add Makefile
$ sed -i -e "s/-lcurses/-lncurses/g" Makefile
$ quilt refresh
$ quilt header -e
... describe patch
</example>

  <chapt id="dreq">Required files under the <file>debian</file> directory

  <p>There is a new subdirectory under the program's source directory,
  it's called <file>debian</file>. There are a number of files in this directory that
  we should edit in order to customize
  the behavior of the package. The most important of them are <file>control</file>,
  <file>changelog</file>, <file>copyright</file> and <file>rules</file>, which are required for all packages.

  <sect id="control"><file>control</file> file

  <p>This file contains various values which <prgn/dpkg/, <prgn/dselect/, 
  <prgn/apt-get/, <prgn/apt-cache/, <prgn/aptitude/, and
  other package management tools will use to manage the package.  It is defined by the 
  <url name="Debian Policy Manual, 5 'Control files and their fields'" id="http://www.debian.org/doc/debian-policy/ch-controlfields.html">.

  <p>Here is the control file <prgn>dh_make</prgn> created for us:

<example>
 1 Source: gentoo
 2 Section: unknown
 3 Priority: extra
 4 Maintainer: Josip Rodin &lt;joy-mg@debian.org&gt;
 5 Build-Depends: debhelper (>= 7.0.50~)
 6 Standards-Version: 3.8.4
 7 Homepage: &lt;insert the upstream URL, if relevant&gt;
 8
 9 Package: gentoo
10 Architecture: any
11 Depends: ${shlibs:Depends}, ${misc:Depends}
12 Description: &lt;insert up to 60 chars description&gt;
13  &lt;insert long description, indented with spaces&gt;
</example>
  (I've added the line numbers.)

  <p>Lines 1-6 are the control information for the source package.

  <p>Line 1 is the name of the source package.

  <p>Line 2 is the section of the distribution the source package goes into. 

  <p>As you may have noticed, Debian is divided in sections: <tt>main</tt> (the free
  software), <tt>non-free</tt> (the not really free software) and <tt>contrib</tt> (free
  software that depends on non-free software). Under those, there are
  logical subsections that describe in short what packages are in.
  So we have <tt>admin</tt> for administrator-only programs, <tt>base</tt> for the
  basic tools, <tt>devel</tt> for programmer tools, <tt>doc</tt> for documentation,
  <tt>libs</tt> for libraries, <tt>mail</tt> for e-mail readers and daemons, <tt>net</tt> for
  network apps and daemons, <tt>x11</tt> for X11 programs that don't fit anywhere
  else, and many more.  
  See the 
  <url name="Debian Policy Manual, 2.4 'Sections'" id="http://www.debian.org/doc/debian-policy/ch-archive.html#s-subsections"> and 
  <url name="List of sections in 'sid'" id="http://packages.debian.org/unstable/">
  for the guidance.

  <p>Let's change it then to x11. (A <tt>main/</tt> prefix is implied so we can
  omit it.)

  <p>Line 3 describes how important it is that the user installs this package.
  See the <url name="Debian Policy Manual, 2.5 'Priorities'" id="http://www.debian.org/doc/debian-policy/ch-archive.html#s-priorities"> 
  for the guidance.
  <list>
  <item> The <tt>optional</tt> priority will usually work for new packages that do not conflict with others with <tt>required</tt>, <tt>important</tt> or <tt>standard</tt> or priorities. 
  <item> The <tt>extra</tt> priority will usually work for new packages that conflict with others with non-<tt>extra</tt> priorities. 
  </list>

  <p>Section and priority are used by the frontends like <prgn/aptitude/ when
  they sort packages and select defaults. Once you upload the package to
  Debian, the value of these two fields can be overridden by the archive
  maintainers, in which case you will be notified by email.
  
  <p>As this is a normal priority package and doesn't conflict with anything
  else, we will change the priority to "<tt>optional</tt>".

  <p>Line 4 is the name and email address of the maintainer. Make sure that
  this field includes a valid "<tt>To: </tt>" header for an email, because after you
  upload it, the bug tracking system will use it to deliver bug emails to
  you. Avoid using commas, ampersands and parenthesis.

  <p>The 5th line includes the list of packages required to build your package
  as the <tt>Build-Depends:</tt> field.  You can also have the
  <tt>Build-Depends-Indep:</tt> field as an additional line, here. (see the
  <url name="Debian Policy Manual, 7.7 'Relationships between source and binary packages - Build-Depends, Build-Depends-Indep, Build-Conflicts, Build-Conflicts-Indep'" id="http://www.debian.org/doc/debian-policy/ch-relationships.html#s-sourcebinarydeps">).
  Some packages like <package>gcc</package> and <package>make</package> which
  are required by the <package>build-essential</package> package are implied.
  If you need to have other tools to build your package, you should add them to
  these fields.  Multiple entries are separated with commas; read on for the
  explanation of binary dependencies to find out more about the syntax of these
  lines. 

  <list>
  <item>For all packages packaged with the <prgn>dh</prgn> command in the
  <file>debian/rules</file> file, you must have 
  "<tt>debhelper (>=7.0.50~)</tt>" in the <tt>Build-Depends:</tt> field to
  satisfy the Debian Policy requirement for the <tt>clean</tt> target.

  <item>For source packages which have some binary packages with
  "<tt>Architecture: any</tt>", they are rebuild by the autobuilder.  Since
  this autobuilder procedure runs "<tt>debian/rules build</tt>" in it while
  installing only packages listed in the <tt>Build-Depends</tt> field (see 
  <ref id="autobuilder">), the <tt>Build-Depends</tt> field needs to list
  practically all the required packages and the <tt>Build-Depends-indep</tt> is
  rarely used.

  <item>For source packages which have binary packages only with 
  "<tt>Architecture: all</tt>", the <tt>Build-Depends-Indep</tt> field may list
  all the required packages unless they are already listed in the
  <tt>Build-Depends</tt> field to satisfy the Debian Policy requirement for the
  <tt>clean</tt> target.
  </list>

  <p>If you are not sure which one should be used, use the
  <tt>Build-Depends</tt> field to be on the safe side.
  <footnote>This somewhat strange situation is a feature well documented in the 
  <url name="Debian Policy Manual, Footnotes 43" id="http://www.debian.org/doc/debian-policy/footnotes.html#f43">.
  This is not due to the use of the <prgn>dh</prgn> command in the
  <file>debian/rules</file> file but due to how the
  <prgn>dpkg-buildpackage</prgn> works.  The same situation applies to the 
  <url name="auto build system for Ubuntu" id="https://bugs.launchpad.net/launchpad-buildd/+bug/238141">.
  </footnote>

  <p>To find out what packages your package needs to be built run the command:
<example>
$ dpkg-depcheck -d ./configure
</example>

  <p>To manually find exact build dependency for
  <prgn><var>/usr/bin/foo</var></prgn>, you execute

<example>
$ objdump -p <var>/usr/bin/foo</var> | grep NEEDED
</example>
  and for each library listed, e.g., <prgn>libfoo.so.6</prgn>, execute
<example>
$ dpkg -S libfoo.so.6 
</example>
  Then you just take <tt>-dev</tt> version of every package as
  <tt>Build-Depends</tt> entry.  If you use <prgn>ldd</prgn> for this
  purpose, it will report indirect lib dependencies as well, resulting
  in the problem of excessive build dependencies.

  <p><package>gentoo</package> also happens to require <package/xlibs-dev/,
  <package/libgtk1.2-dev/ and <package/libglib1.2-dev/ to build, so we'll
  add them here next to <package/debhelper/.

  <p>Line 6 is the version of the Debian Policy standards this package follows,
  the versions of the <url name="Debian Policy Manual"
  id="http://www.debian.org/doc/devel-manuals#policy"> you read while making
  your package.

  <p>On line 7 you can put the URL of the homepage for the upstream package.

  <p>Line 9 is the name of the binary package. This is usually the same as
  the name of the source package, but it doesn't necessarily have to be that
  way.

  <p>Line 10 describes the CPU architecture the binary package can be compiled
  for. We'll leave this as "<tt>any</tt>" because <manref name="dpkg-gencontrol"
  section="1"> will fill in the appropriate value for any machine this
  package gets compiled on.

  <p>If your package is architecture independent
  (for example, a shell or Perl script, or a document), change this to
  "<tt>all</tt>", and read later in <ref id="rules"> about using the <tt>binary-indep</tt>
  rule instead of <tt>binary-arch</tt> for building the package.

  <p>Line 11 shows one of the most powerful features of the Debian packaging
  system. Packages can relate to each other in various ways. Apart from
  <tt>Depends:</tt>, other relationship fields are <tt>Recommends:</tt>, <tt>Suggests:</tt>,
  <tt>Pre-Depends:</tt>, <tt>Conflicts:</tt>, <tt>Provides:</tt>, and <tt>Replaces:</tt>.

  <p>The package management tools usually behave the same way when dealing
  with these relations; if not, it will be explained.
  (see <manref name="dpkg" section="8">, <manref name="dselect" section="8">,
  <manref name="apt" section="8">, <manref name="aptitude" section="1"> etc.)

  <p>This is what the dependencies mean:

  <p><list>
  <item><tt>Depends:</tt>
  <p>The package will not be installed unless the packages it depends on
  are installed. Use this if your program absolutely will not run (or will
  cause severe breakage) unless a particular package is present.</item>

  <item><tt>Recommends:</tt>
  <p>Use this for packages that are not strictly necessary but are typically
  used with your program.  When a user installs your program, all frontends
  will likely prompt them to install the recommended packages.
  <prgn>aptitude</prgn> and <prgn>apt-get</prgn> install recommended packages
  along with your package (but the user can disable this default
  behaviour). <prgn>dpkg</prgn> will ignore this field.
  </item>

  <item><tt>Suggests:</tt>
  <p>Use this for packages which will work nicely with your program but are not
  at all necessary.
  When a user installs your program, all frontends will likely prompt them to
  install the suggested packages.  
  <prgn>aptitude</prgn> can be configured to install suggested packages along
  with your package but this is not its default.
  <prgn>dpkg</prgn> and <prgn>apt-get</prgn> will ignore this field.
  </item>

  <item><tt>Pre-Depends:</tt>
  <p>This is stronger than <tt>Depends:</tt>. The package will not be installed
  unless the packages it pre-depends on are installed and <em>correctly
  configured</em>. Use this <em>very</em> sparingly and only after
  discussing it on the <url id="http://lists.debian.org/debian-devel/" name="debian-devel@lists.debian.org"> mailing list. Read: don't use it at
  all. :-)</item>

  <item><tt>Conflicts:</tt>
  <p>The package will not be installed until all the packages it conflicts
  with have been removed. Use this if your program absolutely will not run
  or will cause severe problems if a particular package is present.</item>

  <item><tt>Provides:</tt>
  <p>For some types of packages where there are multiple alternatives
  virtual names have been defined. You can get the full list in the
  <file>/usr/share/doc/debian-policy/virtual-package-names-list.txt.gz</file> file.
  Use this if your program provides a function of an existing virtual
  package.</item>

  <item><tt>Replaces:</tt>
  <p>Use this when your program replaces files from another package, or
  completely replaces another package (used in conjunction with <tt>Conflicts:</tt>).
  Files from the named packages will be overwritten with the files from your
  package.
  </item>
  </list>

  <p>All these fields have uniform syntax. They are a list of package names
  separated by commas. These package names may also be lists of alternative
  package names, separated by vertical bar symbols "<tt>|</tt>" (pipe symbols).

  <p>The fields may restrict their applicability to particular versions of
  each named package. These versions are listed in parentheses after each
  individual package name, and they should contain a relation from the list
  below followed by the version number. The relations allowed are:
  <tt>&lt;&lt;</tt>, <tt>&lt;=</tt>, <tt>=</tt>, <tt>&gt;=</tt> and
  <tt>&gt;&gt;</tt> for strictly lower, lower or equal, exactly equal,
  greater or equal and strictly greater, respectively. For example,

<example>
Depends: foo (&gt;= 1.2), libbar1 (= 1.3.4)
Conflicts: baz
Recommends: libbaz4 (&gt;&gt; 4.0.7)
Suggests: quux
Replaces: quux (&lt;&lt; 5), quux-foo (&lt;= 7.6)
</example>
  
  <p>The last feature you need to know about is <tt>${shlibs:Depends}</tt>,
  <tt>${perl:Depends}</tt>, <tt>${misc:Depends}</tt>, etc.  These entries are
  substituted by the list generated by other <package>debhelper</package>
  components when the <manref name="dh_gencontrol" section="1"> command is
  executed.

  <p><manref name="dh_shlibdeps" section="1"> will scan it for binaries and
  libraries determine their shared library dependencies and detect which
  packages they are in, such as <package>libc6</package> or
  <package>xlib6g</package>, after your package has been built and installed
  into the temporary directory.  This list of shared library dependencies is
  used for <tt>${shlibs:Depends}</tt>.

  <p>The package list generated by the <manref name="dh_perl" section="1"> is
  used for <tt>${perl:Depends}</tt>.

  <p>Some <package>debhelper</package> commands may make the generated package
  need to depend on some other packages.  This list of required packages is
  used for <tt>${misc:Depends}</tt>.

  <p>Having said all that, we can leave the <tt>Depends:</tt> field exactly as
  it is now, and insert another line after it saying "<tt>Suggests: file</tt>",
  because <package>gentoo</package> can use some features provided by that
  <package>file</package> package.

  <p>Line 12 is the short description. Most people screens are 80 columns
  wide so this shouldn't be longer than about 60 characters. I'll change
  it to "<tt>fully GUI configurable X file manager using GTK+</tt>".

  <p>Line 13 is where the long description goes. This should be a paragraph
  which gives more details about the package. Column 1 of each line should
  be empty. There must be no blank lines, but you can put a single "<tt>.</tt>" (dot)
  in a column to simulate that. Also, there must be no more than one blank
  line after the long description.

  <p>Let's insert <tt>Vcs-*</tt> fields documented in 
  <url name="Developer's Reference, 6.2.5. 'Version Control System location'" id="http://www.debian.org/doc/manuals/developers-reference/best-pkging-practices.html#bpp-vcs"> between line 6 and 7.  Let's assume
  that the <package>gentoo</package> package is located in Debian Alioth Git
  Service at <tt>git://git.debian.org/git/collab-maint/gentoo.git</tt>.

  <p>Finally, here is the updated <file>control</file> file:

<example>
 1 Source: gentoo
 2 Section: x11
 3 Priority: optional
 4 Maintainer: Josip Rodin &lt;joy-mg@debian.org&gt;
 5 Build-Depends: debhelper (>= 7.0.5), xlibs-dev, libgtk1.2-dev, libglib1.2-dev
 6 Standards-Version: 3.8.4
 7 Vcs-Git: git://git.debian.org/git/collab-maint/gentoo.git
 8 Vcs-browser: http://git.debian.org/?p=collab-maint/gentoo.git
 9 Homepage: http://www.obsession.se/gentoo/
10
11 Package: gentoo
12 Architecture: any
13 Depends: ${shlibs:Depends}, ${misc:Depends}
14 Suggests: file
15 Description: fully GUI configurable X file manager using GTK+
16  gentoo is a file manager for Linux written from scratch in pure C. It
17  uses the GTK+ toolkit for all of its interface needs. gentoo provides
18  100% GUI configurability; no need to edit config files by hand and re-
19  start the program. gentoo supports identifying the type of various
20  files (using extension, regular expressions, or the 'file' command),
21  and can display files of different types with different colors and icons.
22  .
23  gentoo borrows some of its look and feel from the classic Amiga file
24  manager "Directory OPUS" (written by Jonathan Potter).
</example>
  (I've added the line numbers.)

  <sect id="copyright"><file>copyright</file> file

  <p>This file contains the information about package upstream resources,
  copyright and license information. Its format is not dictated by the
  Debian Policy Manual, but the content is 
  (<url name="Debian Policy Manual, 12.5 'Copyright information'" id="http://www.debian.org/doc/debian-policy/ch-docs.html#s-copyrightfile">).  You may also consult <url name="DEP-5: Machine-parseable debian/copyright" id="http://dep.debian.net/deps/dep5/">.

  <p><prgn>dh_make</prgn> can give you a template copyright file.  Let's use
  the "<tt>--copyright gpl2</tt>" option here to get a template file for the
  <package>gentoo</package> package released under GPL-2.

  <p>You must fill in missing information such as the place you got the package
  from, the actual copyright notice and their license to complete this file.
  For the common free software licenses such as GNU GPL-2, GNU GPL-3, LGPL-2,
  LGPL-3, BSD, Apache or the Artistic license, you can just refer to the
  appropriate file in <file>/usr/share/common-licenses/</file> directory that
  exists on every Debian system.  Otherwise, you must include the complete
  license.

  <p>In short, here's how <package>gentoo</package>'s <file>copyright</file> file should look like:

<example>
 1 This work was packaged for Debian by:
 2
 3     Josip Rodin &lt;joy-mg@debian.org&gt; on 2  Wed, 11 Nov 1998 21:02:14 +0100.
 4
 5 It was downloaded from:
 6     ftp://ftp.obsession.se/gentoo/
 7
 8 Upstream author:
 9
10     Emil Brink &lt;emil@obsession.se&gt;
11
12 Copyright:
13     Copyright (C) 1998-99 by Emil Brink, Obsession Development.
14
15 License:
16     You are free to distribute this software under the terms of
17     the GNU General Public License  either version 2 of the License,
18     or (at your option) any later version.
19
20     This package is distributed in the hope that it will be useful,
21     but WITHOUT ANY WARRANTY; without even the implied warranty of
22     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
23     GNU General Public License for more details.
24
25     You should have received a copy of the GNU General Public License
26     along with this package; if not, write to the Free Software
27     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA
28
29 On Debian systems, the complete text of the GNU General
30 Public License version 2 can be found in `/usr/share/common-licenses/GPL-2'.
31
32 The Debian packaging is:
33
34     Copyright (C) 1998 Josip Rodin &lt;joy-mg@debian.org&gt;
35
36 You can redistribute it and/or modify
37 it under the terms of the GNU General Public License as published by
38  Free Software Foundation; either version 2 of the License, or
39 (at your option) any later version.
</example>
  (I've added the line numbers.)

  <p>Please follow the HOWTO provided by ftpmasters and sent to debian-devel-announce: 
  <url id="&copyright-howto;"> .


  <sect id="changelog"><file>changelog</file> file

  <p>This is a required file, which has a special format described in
  the <url name="Debian Policy Manual, 4.4 'debian/changelog'" id="http://www.debian.org/doc/debian-policy/ch-source.html#s-dpkgchangelog">. 
  This format is used by <prgn>dpkg</prgn> and other programs to obtain the
  version number, revision, distribution and urgency of your package.

  <p>For you, it is also important, since it is good to have documented
  all changes you have done. It will help people downloading your package
  to see whether there are issues with the package that they should know
  about. It will be saved as
  <file>/usr/share/doc/gentoo/changelog.Debian.gz</file> in the binary package.

  <p><prgn>dh_make</prgn> created a default one, and this is how it looks like:

<example>
1  gentoo (0.9.12-1) unstable; urgency=low
2
3   * Initial release (Closes: #<var>nnnn</var>)  &lt;<var>nnnn</var> is the bug number of your ITP&gt;
4
5  -- Josip Rodin &lt;joy-mg@debian.org&gt;  Mon, 22 Mar 2010 00:37:31 +0100
6
</example>
  (I've added the line numbers.)

  <p>Line 1 is the package name, version, distribution, and urgency.
  The name must match the source package name, distribution should be either
  <tt>unstable</tt> (or even <tt>experimental</tt>) <footnote>Some people use
  invalid distribution values such as <tt>UNRELEASED</tt> to prevent a package
  to be accidentally uploaded when updating a package in a shared
  VCS.</footnote>, and urgency shouldn't be changed to anything higher than
  <tt>low</tt>. :-)
  
  <p>Lines 3-5 are a log entry, where you document changes made in this
  package revision (not the upstream changes - there is special file for that
  purpose, created by the upstream authors, which you will later install as
  <file>/usr/share/doc/gentoo/changelog.gz</file>). Let's assume your ITP
  (Intent To Package) bug report number was "<tt>12345</tt>".  New lines must
  be inserted just before the uppermost line that begins with "<tt>*</tt>"
  (asterisk). You can do it with <manref name="dch" section="1">, or manually
  with a text editor.

  <p>You will end up with something like this:

<example>
1  gentoo (0.9.12-1) unstable; urgency=low
2
3   * Initial Release. Closes: #12345
4   * This is my first Debian package.
5   * Adjusted the Makefile to fix $(DESTDIR) problems.
6
7  -- Josip Rodin &lt;joy-mg@debian.org&gt; Mon, 22 Mar 2010 00:37:31 +0100
8
</example>
  (I've added the line numbers.)

  <p>You can read more about updating the changelog file later in
  <ref id="update">.

  <sect id="rules"><file>rules</file> file

  <p>Now we need to take a look at the exact rules which 
  <manref name="dpkg-buildpackage" section="1"> will use to actually create the
  package. This file is actually another <file>Makefile</file>, but different
  from the one(s) in the upstream source. Unlike other files in
  <file>debian</file>, this one is marked as executable.

  <sect1 id="targets">Targets of <file>rules</file> file

  <p>Every <file>rules</file> file, as any other <file>Makefile</file>,
  consists of several targets and their rules specifying how to handle the
  source.  
  <url name="Debian Policy Manual, 4.9 'Main building script: debian/rules'"
  id="http://www.debian.org/doc/debian-policy/ch-source.html#s-debianrules">
  explains its details.

  <p>The simplified explanation of targets are the following.

<list>
<item><tt>clean</tt> target: to clean all compiled, generated, and useless files in the build-tree. (required)
<item><tt>build</tt> target: to build the source into compiled programs and formatted documents in the build-tree. (required)
<item><tt>install</tt> target: to install files into a file tree for each binary package under the <file>debian</file> directory.  If defined, <tt>binary*</tt> targets effectively depend on this target. (optional)
<item><tt>binary</tt> target: to create all binary packages (effectively combination of <tt>binary-arch</tt> and <tt>binary-indep</tt> targets). (required)<footnote>This target is used by "<tt>dpkg-buildpackage</tt>" as in <ref id="completebuild">.</footnote>
<item><tt>binary-arch</tt> target: to create arch-dependent (<tt>Architecture: any</tt>) binary packages in the parent directory. (required)<footnote>This target is used by "<tt>dpkg-buildpackage -B</tt>" as in <ref id="autobuilder">.</footnote>
<item><tt>binary-indep</tt> target: to create arch-independent (<tt>Architecture: all</tt>) binary packages in the parent directory. (required)<footnote>This target is used by "<tt>dpkg-buildpackage -A</tt>".</footnote>
<item><tt>get-orig-source</tt> target: to obtain the most recent version of the original source package from upstream archive site. (optional)
</list>

  <p>Rules that you want to execute are invoked as command
  line arguments (for example, "<tt>./debian/rules build</tt>" or 
  "<tt>fakeroot make -f debian/rules binary</tt>"). After the target name, you
  can name the dependency, program or file that the rule depends on. After
  that, there can be any number of commands, indented with
  <tt><var>TAB</var></tt>. A new rule begins with the target declaration in the
  first column. Empty lines and lines beginning with "<tt>#</tt>" (hash) are
  treated as comments and ignored.

  <p>You are probably confused now, but it will all be clear upon examination
  of the <file>rules</file> file that <prgn>dh_make</prgn> gives us as a default. You should also
  read "<tt>info make</tt>" for more information.

  <sect1 id="defaultrules">Default <file>rules</file> file

  <p>Newer <prgn>dh_make</prgn> generates a very
  simple but powerful default <file>rules</file> file using the <prgn>dh</prgn>
  command:

<example>
 1 #!/usr/bin/make -f
 2 # -*- makefile -*-
 3 # Sample debian/rules that uses debhelper.
 4 # This file was originally written by Joey Hess and Craig Small.
 5 # As a special exception, when this file is copied by dh-make into a
 6 # dh-make output file, you may use that output file without restriction.
 7 # This special exception was added by Craig Small in version 0.37 of dh-make.
 8
 9 # Uncomment this to turn on verbose mode.
10 #export DH_VERBOSE=1
11
12 %:
13        dh $@
</example>
  (I've added the line numbers.  In the actual <file>rules</file> file, the
  leading white spaces are TAB codes.)

  <p>You are probably familiar with lines like line 1 from shell and Perl
  scripts. It tells the operating system that this file is to be processed
  with <file>/usr/bin/make</file>.

  <p>Line 10 can be uncommented to set <tt>DH_VERBOSE</tt> variable to 1. Then,
  the <prgn>dh</prgn> command will output which <prgn>dh_*</prgn> commands are
  executed by the <prgn>dh</prgn> command.  You can also add "<tt>export
  DH_OPTIONS=-v</tt>" line here.  Then each <prgn>dh_*</prgn> command will
  output which commands are executed by each <prgn>dh_*</prgn> command.  This
  helps you to understand what exactly is going on behind this simple
  <file>rules</file> file and to debug its problems.  This new <prgn>dh</prgn>
  is a core part of the <package>debhelper</package> tools and does not hide
  anything from you.

  <p>Lines 12 and 13 are where all the work is done. The percent sign means any
  targets which then call a single program, <prgn>dh</prgn> with the target
  name. 
  <footnote>This uses the new <package>debhelper</package> V7 features.  Its
  design concepts are explained in 
  <url id="http://joey.kitenet.net/talks/debhelper/debhelper-slides.pdf" name="Not Your Grandpa's Debhelper"> 
  presented at Debconf9 by the <package>debhelper</package> upstream.
  Under <tt>lenny</tt>,
  <prgn>dh_make</prgn> created a much more complicated <file>rules</file> file
  with many <prgn>dh_*</prgn> scripts listed for each required explicit targets
  and frozen them to the state when it was initially packaged.  This new
  <prgn>dh</prgn> command is simpler and frees us from this constrain.  You
  still have full power to customize this with <tt>override_dh_*</tt> targets.
  See <ref id="customrules">.  It is based only on the
  <package>debhelper</package> package and does not obfuscate the package
  building process like the <package>cdbs</package> package.</footnote>
  The <prgn>dh</prgn> command is a wrapper script which runs appropriate sequences of
  <prgn>dh_*</prgn> programs depending on its argument.
  <footnote>You can verify actual sequences of <prgn>dh_*</prgn> programs
  invoked for a given <tt><var>target</var></tt> as 
  "<tt>dh --no-act <var>target</var></tt>" or 
  "<tt>debian/rules -- '--no-act <var>target</var>'</tt>" 
  without really running them.</footnote>
  <list>
  <item>"<tt>debian/rules clean</tt>" runs "<tt>dh clean</tt>"; which in turn
  runs the following:
<example>
dh_testdir
dh_auto_clean
dh_clean
</example>
  <item>"<tt>debian/rules build</tt>" runs "<tt>dh build</tt>"; which in turn
  runs the following:
<example>
dh_testdir
dh_auto_configure
dh_auto_build
dh_auto_test
</example>
  <item>"<tt>fakeroot debian/rules binary</tt>" runs 
  "<tt>fakeroot dh binary</tt>"; which in turn runs the following<footnote>This
  assumes that the <package>python-support</package> package is installed on the
  system.</footnote>:
<example>
dh_testroot
dh_prep
dh_installdirs
dh_auto_install
dh_install
dh_installdocs
dh_installchangelogs
dh_installexamples
dh_installman
dh_installcatalogs
dh_installcron
dh_installdebconf
dh_installemacsen
dh_installifupdown
dh_installinfo
dh_pysupport
dh_installinit
dh_installmenu
dh_installmime
dh_installmodules
dh_installlogcheck
dh_installlogrotate
dh_installpam
dh_installppp
dh_installudev
dh_installwm
dh_installxfonts
dh_bugfiles
dh_lintian
dh_gconf
dh_icons
dh_perl
dh_usrlocal
dh_link
dh_compress
dh_fixperms
dh_strip
dh_makeshlibs
dh_shlibdeps
dh_installdeb
dh_gencontrol
dh_md5sums
dh_builddeb
</example>
  <item>"<tt>fakeroot debian/rules binary-arch</tt>" runs "<tt>fakeroot dh binary-arch</tt>";
  which in turn runs the same sequence as "<tt>fakeroot dh binary</tt>" but
  with the "<tt>-a</tt>" option appended for each command.
  <item>"<tt>fakeroot debian/rules binary-indep</tt>" runs "<tt>fakeroot dh
  binary-indep</tt>"; which in turn runs almost the same sequence as
  "<tt>fakeroot dh binary</tt>" but excluding <prgn>dh_strip</prgn>,
  <prgn>dh_makeshlibs</prgn>, and <prgn>dh_shlibdeps</prgn> with the
  "<tt>-i</tt>" option appended for each remaining command.
  </list>

  <p>The function of <prgn>dh_*</prgn> commands are almost self-evident from
  their names.  
  <footnote>For complete information on what do all these <prgn>dh_*</prgn>
  scripts exactly do, and what their other options are, please read their
  respective manual pages and the <package>debhelper</package>
  documentation.</footnote>
  There are few notable ones worth making (over)simplified explanation here
  assuming typical build environment based on <file>Makefile</file>.
  <footnote>These commands support other build environments such as
  <file>setup.py</file> which can be listed by executiong 
  "<tt>dh_auto_build --list</tt>" in a package source directory.</footnote>
  <list>
  <item><p><prgn>dh_auto_clean</prgn> usually executes the following if
  <file>Makefile</file> exists with the <tt>distclean</tt> target.
  <footnote>It actually looks for the first available target of
  <tt>distclean</tt>, <tt>realclean</tt> or <tt>clean</tt> in
  <file>Makefile</file> and execute it.</footnote>
<example>
make distclean
</example>
  <item><p><prgn>dh_auto_configure</prgn> usually executes the following if
  <file>./configure</file> exists (arguments abbreviated for readability).
<example>
./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var ...
</example>
  <item><p><prgn>dh_auto_build</prgn> usually executes the following to execute the first target of <file>Makefile</file> if it exists.
<example>
make
</example>
  <item><p><prgn>dh_auto_test</prgn> usually executes the following if
  <file>Makefile</file> exists with the <tt>test</tt> target.
  <footnote>It actually looks for the first available target of
  <tt>test</tt> or <tt>check</tt> in
  <file>Makefile</file> and execute it.</footnote>
<example>
make test
</example>
  <item><p><prgn>dh_auto_install</prgn> usually executes the following if
  <file>Makefile</file> exists with the <tt>install</tt> target (line folded for readability).
<example>
make install \
  DESTDIR=<var>/path/to</var>/<var>package</var>_<var>version</var>-<var>revision</var>/debian/<var>package</var>
</example>
  </list>

  <p>Targets which require the <prgn>fakeroot</prgn> command contain
  <prgn>dh_testroot</prgn>.  If you are not pretending to be root using this
  command, it exits with an error.

  <p>The important part to know about the <file>rules</file> file created by
  <prgn>dh_make</prgn>, is that it is just a suggestion. It will work for most
  packages but for more complicated ones, don't be afraid to customize it to
  fit your needs. Only things that you must not change are the names of the
  rules, because all the tools use these names, as mandated by the Debian Policy.

  <p>Although "<tt>install</tt>" is not required target, it is supported.  
  "<tt>fakeroot dh install</tt>" behaves like 
  "<tt>fakeroot dh binary</tt>" but stops after <prgn>dh_fixperms</prgn>. 

  <sect1 id="customrules">Customization of <file>rules</file> file

  <p>There are many ways to customize the <file>rules</file> file created with
  the new <prgn>dh</prgn> command.

  <p>The "<tt>dh $@</tt>" command can be customized as follows.
  <footnote>
  If a package installs the 
  <file>/usr/share/perl5/Debian/Debhelper/Sequence/<var>custom_name</var>.pm</file>
  file, you should activate its customization function by 
  "<tt>dh --with <var>custom-name</var> $@</tt>".
  </footnote>

<list>
<item>Add support of the <prgn>dh_pysupport</prgn> command. (The best choice for Python.)
<footnote>Use of the <prgn>dh_pysupport</prgn> command is preferred over use
of the <prgn>dh_pycentral</prgn> command.  Do not use the
<prgn>dh_python</prgn> command.</footnote>
<list>
<item>Install the <package>python-support</package> package in "<tt>Build-Depends:</tt>".
<item>Use "<tt>dh $@</tt>" as usual. (This is enabled by default)
<item>This handles Python modules using the <package>python-support</package> framework.
</list>
<item>Add support of the <prgn>dh_pycentral</prgn> command.
<list>
<item>Install the <package>python-central</package> package in "<tt>Build-Depends:</tt>".
<item>Use "<tt>dh --with python-central $@</tt>" instead.
<item>This also deactivates the <prgn>dh_pysupport</prgn> command.
<item>This handles Python modules using the <package>python-central</package> framework.
</list>
<item>Add support of the <prgn>dh_installtex</prgn> command.
<list>
<item>Install the <package>tex-common</package> package in "<tt>Build-Depends:</tt>".
<item>Use "<tt>dh --with tex $@</tt>" instead.
<item>This registers Type 1 fonts, hyphenation patterns, or formats with TeX.
</list>
<item>Add support of the <prgn>dh_quilt_patch</prgn> and <prgn>dh_quilt_unpatch</prgn> commands.
<list>
<item>Install the <package>quilt</package> package in "<tt>Build-Depends:</tt>".
<item>Use "<tt>dh --with quilt $@</tt>" instead.
<item>This applies and un-applies patches to the upstream source from files in the <file>debian/patches</file> directory for the <tt>1.0</tt> source package.
<item>This is not needed if you use the new <tt>3.0 (quilt)</tt> source package.
</list>
<item>Add support of the <prgn>dh_dkms</prgn> command.
<list>
<item>Install the <package>dkms</package> package in "<tt>Build-Depends:</tt>".
<item>Use "<tt>dh --with dkms $@</tt>" instead.
<item>This correctly handles DKMS usage by the kernel module package.
</list>
<item>Add support of the <prgn>dh_autotools-dev_updateconfig</prgn> and <prgn>dh_autotools-dev_restoreconfig</prgn> commands.
<list>
<item>Install the <package>autotools-dev</package> package in "<tt>Build-Depends:</tt>".
<item>Use "<tt>dh --with autotools-dev $@</tt>" instead.
<item>This updates and restores <file>config.sub</file> and <file>config.guess</file>.
</list>
<item>Add support of the <prgn>dh_autoreconf</prgn> and <prgn>dh_autoreconf_clean</prgn> commands.
<list>
<item>Install the <package>dh-autoreconf</package> package in "<tt>Build-Depends:</tt>".
<item>Use "<tt>dh --with autoreconf $@</tt>" instead.
<item>This updates the GNU Build System files and restores them after the build.
</list>
<item>Add support to the <prgn>bash</prgn> completion feature.
<list>
<item>Install the <package>bash-completion</package> package in "<tt>Build-Depends:</tt>".
<item>Use "<tt>dh --with bash-completion $@</tt>" instead.
<item>This installs <prgn>bash</prgn> completions using configuration file at <file>debian/<var>package</var>.bash-completion</file>.
</list>
</list>

  <p>For sources using Autotools, use combination of above as 
  "<tt>dh --with autotools-dev --with autoreconf $@</tt>" to be most current
  with the GNU Build System.

  <p>Many <prgn>dh_*</prgn> commands invoked by the new <prgn>dh</prgn> command
  can be customized by the corresponding configuration files in the
  <file>debian</file> directory.  See <ref id="dother"> and the manpage of each
  command for the customization of such features.

  <p>Some <prgn>dh_*</prgn> commands invoked by the new <prgn>dh</prgn> command
  may require you to run it with some arguments or to run additional commands
  with them or to skip them.  For such cases, you create an
  <tt>override_dh_<var>foo</var></tt> target with its rule in the
  <file>rules</file> file only for the <prgn>dh_<var>foo</var></prgn> command
  you want to change.  It basically say "<em>run me instead</em>".
  <footnote>Under <tt>lenny</tt>, if you wanted to change the behavior of a
  <prgn>dh_*</prgn> script you found the relevant line in the
  <file>rules</file> file and adjusted it.</footnote>

  <p>Please note that the <prgn>dh_auto_*</prgn> commands tend to do
  more than what has been discussed as (over)simplified explanation to take care
  all the corner cases.  Use of simplified equivalent command instead of these
  in <tt>override_dh_*</tt> targets except the <tt>override_dh_auto_clean</tt>
  target is a bad idea since it may kill such <package>debhelper</package>'s
  smart features.

  <p>If you want to store the system configuration data for the
  <package>gentoo</package> package in the <file>/etc/gentoo</file> directory
  instead of the usual <file>/etc</file> directory, you can override the
  default <tt>--sysconfig=/etc</tt> argument given by the
  <prgn>dh_auto_configure</prgn> command to the <prgn>./configure</prgn> command by
  the following.
  <footnote>The <package>gentoo</package> package uses the GNU build system,
  also known as the Autotools.  
  See <url id="http://en.wikipedia.org/wiki/GNU_build_system">.</footnote>

<example>
override_dh_auto_configure:
        dh_auto_configure -- --sysconfig=/etc/gentoo
</example>

  <p>The arguments given after <tt>--</tt> are appended to the default
  arguments of the auto-executed program to override them.  Using the
  <prgn>dh_auto_configure</prgn> command is better than the
  <prgn>./configure</prgn> command here since it will only override the
  <tt>--sysconfig</tt> argument and keeps well intended other arguments to the
  <prgn>./configure</prgn> command.

  <p>If <file>Makefile</file> of a source for <package>gentoo</package>
  requires you to specify <tt>build</tt> as its target to build it
  <footnote><prgn>dh_auto_build</prgn> without any arguments will execute the
  first target in the <file>Makefile</file> file.</footnote>, you create an
  <tt>override_dh_auto_build</tt> target to enable it.

<example>
override_dh_auto_build:
        dh_auto_build -- build
</example>

  <p>This ensures to run $(MAKE) with all the default arguments given by the
  <prgn>dh_auto_build</prgn> command and <tt>build</tt> argument.

  <p>If <file>Makefile</file> of a source for <package>gentoo</package>
  requires you to specify the <tt>packageclean</tt> target to clean it for
  Debian package instead of the <tt>distclean</tt> or <tt>clean</tt> targets in
  the <file>Makefile</file> file, you create an <tt>override_dh_auto_clean</tt>
  target to enable it.

<example>
override_dh_auto_clean:
        $(MAKE) packageclean
</example>

  <p>If <file>Makefile</file> of a source for <package>gentoo</package>
  contains <tt>test</tt> target which you do not want to run for the Debian
  package building process, you can use empty <tt>override_dh_auto_test</tt>
  target to skip it.

<example>
override_dh_auto_test:
</example>

  <p>If <package>gentoo</package> has an unusual upstream changelog file called
  <file>FIXES</file>, <prgn>dh_installchangelogs</prgn> will not install that
  file by default.  The <prgn>dh_installchangelogs</prgn> command requires
  <file>FIXES</file> as its argument to install it.
  <footnote>The <file>debian/changelog</file> and <file>debian/NEWS</file>
  files are always automatically installed.  The upstream chengelog is searched
  by converting filenames to the lower case and matching them with the
  <file>changelog</file>, <file>changes</file>, <file>changelog.txt</file>, and
  <file>changes.txt</file>.</footnote>

<example>
override_dh_installchangelogs:
        dh_installchangelogs FIXES
</example>

  <p>When you use the new <prgn>dh</prgn> command, use of explicit targets such
  as the ones listed in <ref id="targets"> except <tt>get-orig-source</tt>
  target may make it difficult to understand their exact effects.  Please limit
  explicit targets to <tt>override_dh_*</tt> targets and completely independent
  ones, if possible.

  <chapt id="dother">Other files under the <file>debian</file> directory

  <p>To control most of what <package>debhelper</package> does while building
  the package, you put optional configuration files under the
  <file>debian</file> directory. This chapter will make an overview of what each of these
  does and its format.  Please read 
  <url name="Debian Policy Manual" id="http://www.debian.org/doc/devel-manuals#policy"> and
  <url name="Debian Developer's Reference" id="http://www.debian.org/doc/devel-manuals#devref">
  for guidelines for the packaging.

  <p>The <prgn>dh_make</prgn> command will create some template configuration
  files under the <file>debian</file> directory.  Most of them come with
  filenames suffixed by "<tt>.ex</tt>".  Some of them come with filenames
  prefixed by the binary package name such as  <tt><var>package</var></tt>.
  Take a look at all of them. 

  <p>If you wish or need to activate any of those, please do the following.
  <list>
    <item>rename template files by removing the <tt>.ex</tt> or <tt>.EX</tt> suffix if the template files have one.
    <item>modify template file contents to suit your needs.
    <item>remove template files which you do not need.
    <item>modify the <file>control</file> file (see <ref id="control">), if necessary. 
    <item>modify the <file>rules</file> file (see <ref id="rules">), if necessary. 
  </list>

  <p>Those <package>debhelper</package> configuration files without
  <file><var>package</var></file> prefix such as <file>install</file> apply to
  the first binary package.  When there are many binary packages, their
  configurations can be specified by prefixing their name to their
  configuration filenames such as <file><var>package-1</var>.install</file>,
  <file><var>package-2</var>.install</file>, etc.

  <sect id="readme"><file>README.Debian</file> file

  <p>Any extra details or discrepancies between the original package and
  your <em>debianized</em> version should be documented here.

  <p><prgn>dh_make</prgn> created a default one, this is what it looks like:

<example>
gentoo for Debian
-----------------

&lt;possible notes regarding this package - if none, delete this file&gt;

 -- Josip Rodin &lt;joy-mg@debian.org&gt;, Wed, 11 Nov 1998 21:02:14 +0100
</example>

  <p>If you have nothing to be documented, remove this file. 
  See <manref name="dh_installdocs" section="1">.

  <sect id="compat"><file>compat</file> file

  <p>The <file>compat</file> file defines the <package>debhelper</package>
  compatibility level.  Currently, you should set it to
  the <package>debhelper</package> V7 by the following.
<example>
$ echo 7 > debian/compat
</example>

  <sect id="conffiles"><file>conffiles</file> file

  <p>One of the most annoying things about software is when you spend a
  great deal of time and effort customizing a program, only to have an
  upgrade stomp all over your changes. Debian solves this problem by
  marking configuration files so that when you upgrade a package, you'll
  be prompted whether you want to keep your old configuration or not.

  <p>Since <package>debhelper</package> V3, <manref name="dh_installdeb" section="1"> will
  <em>automatically</em> flag any files under the <file>/etc</file> directory
  as conffiles, so if your program only has conffiles there you do not need to
  specify them in this file. For most package types, the only place there is
  (and should be conffiles) is under <file>/etc</file> and so this file doesn't
  need to exist.

  <p>If your program uses configuration files but also rewrites them on its
  own, it's best not to make them as conffiles because <prgn>dpkg</prgn> will
  then prompt users to verify the changes all the time.

  <p>If the program you're packaging requires every user to modify the
  configuration files in the <file>/etc</file> directory, there are 2 popular
  ways to make them not as conffiles to keep <prgn>dpkg</prgn> quiet.
  <list>
  <item>You make a symlink under the <file>/etc</file> directory pointing to a
  file under the <file>/var</file> directory generated by the <em>maintainer
  scripts</em>.
  <item>You make a file generated by the <em>maintainer scripts</em> under the
  <file>/etc</file> directory.
  </list>

  <p>For more information on the <em>maintainer scripts</em>, see <ref id="maintscripts">.

  <sect id="crond"><file><var>package</var>.cron.*</file> files

  <p>If your package requires regularly scheduled tasks to operate properly, 
  you can use this file to set it up. You can either setup regular tasks 
  that happen hourly, daily, weekly or monthly or alternatively happen any
  other time that you wish.  The filenames are:

  <list>
    <item><file>cron.hourly</file> - Installed as <file>/etc/cron.hourly/<var>package</var></file>:
    run once an hour every hour.
    <item><file>cron.daily</file> - Installed as <file>/etc/cron.daily/<var>package</var></file>:
    run once a day, usually early morning.
    <item><file>cron.weekly</file> - Installed as <file>/etc/cron.weekly/<var>package</var></file>:
    run once a week, usually early Sunday morning.
    <item><file>cron.monthly</file> - Installed as <file>/etc/cron.monthly/<var>package</var></file>:
    run once a month, usually early morning on the first of the month.
    <item><file>cron.d</file> - Installed as <file>/etc/cron.d/<var>package</var></file>: for any other time
  </list>

  <p>For the named files, the format of them is the shell script.  The different
  one is <file><var>package</var>.cron.d</file> which follows the format of
  <manref name="crontab" section="5">.

  <p>Note that this doesn't include log rotation; for that, see
  <manref name="dh_installlogrotate" section="1"> and
  <manref name="logrotate" section="8">.

  <sect id="dirs"><file>dirs</file> file

  <p>This file specifies the directories which we need but the normal
  installation procedure ("<tt>make install DESTDIR=...</tt>" invoked by
  "<tt>dh_auto_install</tt>") somehow doesn't create. This generally
  means there is a problem with the <file>Makefile</file>.

  <p>Files listed in the <file>install</file> file doesn't need
  the directories created first. See <ref id="install">

  <p>It is best to first try to run the installation first and only use
  this if you run into trouble.  There is no preceding slash on the 
  directory names.  

  <sect id="doc-base"><file><var>package</var>.doc-base</file> file

  <p>If your package has documentation other than manual pages and info
  docs, you should use the <package/doc-base/ file to register it,
  so the user can find it with e.g. <manref name="dhelp" section="1">,
  <manref name="dwww" section="1"> or <manref name="doccentral" section="1">.

  <p>This usually includes HTML, PS and PDF files, shipped in
  <file>/usr/share/doc/<var>packagename</var>/</file>.

  <p>This is how <package>gentoo</package>'s doc-base file <file>gentoo.doc-base</file> looks like:

<example>
Document: gentoo
Title: Gentoo Manual
Author: Emil Brink
Abstract: This manual describes what Gentoo is, and how it can be used.
Section: File Management

Format: HTML
Index: /usr/share/doc/gentoo/html/index.html
Files: /usr/share/doc/gentoo/html/*.html
</example>

  <p>For information on the file format, see
  <manref name="install-docs" section="8"> and the <package/doc-base/ manual,
  in <file>/usr/share/doc/doc-base/doc-base.html/</file>.

  <p>For more details on installing additional documentation, look in <ref id="destdir">.

  <sect id="docs"><file>docs</file> file

  <p>This file specifies the file names of documentation files we can have
  <manref name="dh_installdocs" section="1"> install into the temporary directory for us.

  <p>By default, it will include all existing files in the top-level source
  directory that are called "<file>BUGS</file>", "<file>README*</file>", "<file>TODO</file>" etc.

  <p>For <package>gentoo</package>, I also included some other files:

<example>
BUGS
CONFIG-CHANGES
CREDITS
ONEWS
README
README.gtkrc
TODO
</example>
  
  <sect id="emacsen"><file>emacsen-*</file> file

  <p>If your package supplies Emacs files that can be bytecompiled at
  package installation time, you can use these files to set it up.

  <p>They are installed into the temporary directory by
  <manref name="dh_installemacsen" section="1">.

  <p>If you don't need these, remove them.

  <sect id="examples"><file><var>package</var>.examples</file> file 
  <p>The <manref name="dh_installexamples" section="1"> command installs files
  and directories listed in this file as example files .

  <sect id="initd"><file><var>package</var>.init</file> and <file><var>package</var>.default</file> files

  <p>If your package is a daemon that needs to be run at the system start-up,
  you've obviously disregarded my initial recommendation, haven't you? :-)

  <p>The <file><var>package</var>.init</file> file is installed as the
  <file>/etc/init.d/<var>package</var></file> script.  Its fairly generic 
  skeleton template is provided by the <prgn>dh_make</prgn> command as
  <file>init.d.ex</file>. You'll likely have to rename and edit it, a lot,
  while making sure to provide Filesystem Hierarchy Standard
  (see <file>/usr/share/doc/debian-policy/fhs/</file>) compliant headers. It gets installed into
  the temporary directory by <manref name="dh_installinit" section="1">.

  <p>The <file><var>package</var>.default</file> file will be installed into
  <file>etc/default/<var>package</var></file>. This file
  sets defaults that are sourced by the init script.  Most times this
  default file is used to disable running a daemon, set some default flags
  or timeouts.  If your init script has certain <em>settable</em> features you want
  to install these into the default file, not the init script.
  
  <p>If your upstream package has an init file you can either use it or not. 
  If you don't use their init.d script then create a new one in <file>debian/init</file>.
  However if the upstream init script looks fine and installs in the right
  place you still need to setup the <file>rc*</file> symlinks. To do this you will need
  to override <prgn>dh_installinit</prgn> in the <file>rules</file> file with the following lines:

<example>
override_dh_installinit:
        dh_installinit --onlyscripts
</example>

  <p>If you don't need this, remove the files.

  <sect id="install"><file>install</file> file

  <p>If there are files that need to be installed into your package but
  your standard "<tt>make install</tt>" won't do it, you put the filenames and
  destinations into this <file>install</file> file. They are installed by
  <manref name="dh_install" section="1">.<footnote>This replaces the deprecated 
  <manref name="dh_movefiles" section="1"> command which is configured by the
  <file>files</file> file.</footnote>  You should first check there is not a
  more specific tool to use.  For example, documents should be in the
  <file>docs</file> file and not in this one.

  <p>This <file>install</file> file has one line per file installed, with the name of the file
  (relative to the top build directory) then a space then the installation
  directory (relative to the install directory). One example of where this
  is used is where a binary is forgotten to be installed, the <file>install</file> file
  would look like:

<example>
src/foo/mybin usr/bin
</example>

  <p>This will mean when this package is installed, there will be a binary
  file <file>/usr/bin/mybin</file>.

  <p>Alternatively, this <file>install</file> can have the name of the file only without
  the installation directory when the relative directory path does not change.
  This format is usually used for a large package that splits build result into
  multiple binary packages using <file><var>package-1</var>.install</file>,
  <file><var>package-2</var>.install</file>, etc.

  <p>The <prgn>dh_install</prgn> command will fall back to look in
  <file>debian/tmp</file> for files, if it doesn't find them in the current
  directory (or wherever you've told it to look using <tt>--sourcedir</tt>).

  <sect id="info"><file><var>package</var>.info</file> files

  <p>If your package has info pages, you should install them using 
  <manref name="dh_installinfo" section="1"> by listing them in the
  <file><var>package</var>.info</file> files.

  <sect id="lintian"><file>{<var>package</var>.|source/}lintian-overrides</file> files

  <p>If <package>lintian</package> reports an erroneous diagnostics for
  a case when the policy allows exceptions to some rule, you can use
  <file><var>package</var>.lintian-overrides</file> or
  <file>source/lintian-overrides</file> to quiet it.  Please read
  <file>/usr/share/doc/lintian/lintian.html/index.html</file> and refrain from
  abusing this.

  <p><file><var>package</var>.lintian-overrides</file> is for the binary
  package named as <package><var>package</var></package> and is installed into
  <file>usr/share/lintian/overrides/<var>package</var></file> by the
  <prgn>dh_lintian</prgn> command.

  <p><file>source/lintian-overrides</file> is for the source package. This is
  not installed.

  <sect id="manpage"><file>manpage.*</file> files

  <p>Your program(s) should have a manual page. If they don't, you must create
  them.  The <prgn>dh_make</prgn> command creates few template files for a
  manual page.  These need to be copied and edited for each command without its 
  manual page.  Please make sure to remove unused templates.

  <sect1 id="manpage1"><file/manpage.1.ex/ file

  <p>Manual pages are normally written in <manref name="nroff" section="1">.
  The <file/manpage.1.ex/ template is written in <prgn>nroff</prgn>, too.
  See the <manref name="man" section="7"> manual page
  for a brief description of how to edit such a file.

  <p>The final manual page file name should include the name of the program
  it is documenting, so we will rename it from "<tt>manpage</tt>" to "<tt>gentoo</tt>". 
  The file name also includes "<tt>.1</tt>" as the first suffix, which means it's a
  manual page for a user command. Be sure to verify that this section is
  indeed the correct one. Here's a short list of manual page sections:

<example>
Section |     Description     |     Notes
   1     User commands          Executable commands or scripts.
   2     System calls           Functions provided by the kernel.
   3     Library calls          Functions within system libraries.
   4     Special files          Usually found in /dev
   5     File formats           E.g. /etc/passwd's format
   6     Games                  Or other frivolous programs
   7     Macro packages         Such as man macros.
   8     System administration  Programs typically only run by root.
   9     Kernel routines        Non-standard calls and internals.
</example>
  
  <p>So <package>gentoo</package>'s man page should be called
  <file>gentoo.1</file>.  If there was no <file>gentoo.1</file> man page in the
  original source, you should create it by renaming the <file/manpage.1.ex/
  template to <file>gentoo.1</file> and edit it by using information from the
  example and from upstream docs.

  <p>You can use the <prgn>help2man</prgn> command to generate a man page out of
  "<tt>--help</tt>" and "<tt>--version</tt>" output of each program, too.
  <footnote>If the command is missing <prgn>info</prgn> page but have documentation files in
  the <file>/usr/share/<var>package</var></file> directory, you should manually
  edit generated the man page created by the <prgn>help2man</prgn> command.
  </footnote>

  <sect1 id="manpagesgml"><file/manpage.sgml.ex/ file

  <p>If on the other hand you prefer writing SGML instead of <prgn>nroff</prgn>, you can
  use the <file/manpage.sgml.ex/ template. If you do this, you have to:
  
  <list>
    <item>rename the file to something like <file/gentoo.sgml/.
    <item>install the <package/docbook-to-man/ package
    <item>add <tt/docbook-to-man/ to the <tt/Build-Depends/ line in the
          <file/control/ file
    <item>add a <tt>override_dh_auto_build</tt> target to your <file>rules</file> file:
<example>
override_dh_auto_build:
        docbook-to-man debian/gentoo.sgml > debian/gentoo.1
        dh_auto_build
</example>
  </list>

  <sect1 id="manpagexml"><file>manpage.xml.ex</file> file

  <p>If you prefer XML over SGML, you can use the <tt/manpage.xml.ex/ template.
  If you do this, you have two choices:
  
  <list>
    <item>rename the source file to something like <tt/gentoo.1.xml/
    <item>install the <package/docbook-xsl/ package and an XSLT processor like
          <package/xsltproc/ (recommended)
    <item>add the <tt/docbook-xsl/, <tt/docbook-xml/ and <tt/xsltproc/ packages to the
          <tt/Build-Depends/ line in the <tt/control/ file
    <item>add a <tt>override_dh_auto_build</tt> target to your <file>rules</file> file:
<example>
override_dh_auto_build:
        xsltproc --nonet \
         --param make.year.ranges 1 \
         --param make.single.year.ranges 1 \
         --param man.charmap.use.subset 0 \
         -o debian/ \
 http://docbook.sourceforge.net/release/xsl/current/manpages/docbook.xsl\
        debian/gentoo.1.xml
        dh_auto_build
</example>
  </list>
 
  <sect id="manpages"><file><var>package</var>.manpages</file> files

  <p>If your package has manual pages, you should install them using 
  <manref name="dh_installman" section="1"> by listing them in the
  <file><var>package</var>.manpages</file> files.

  <sect id="menu"><file>menu</file> file

  <p>X Window System users usually have a window manager with a menu that
  can be customized to launch programs. If they have installed the Debian
  <package/menu/ package, a set of menus for every program on the system will be
  created for them.

  <p>Here's the default <file/menu.ex/ file that <prgn>dh_make</prgn> created:
  
<example>
?package(gentoo):needs="X11|text|vc|wm" \
        section="Applications/see-menu-manual"\
        title="gentoo" command="/usr/bin/gentoo"
</example>

  <p>The first field after the colon character is <tt>needs</tt>, and it specifies
  what kind of interface the program needs. Change this to one of the listed
  alternatives, e.g. <tt>text</tt> or <tt>X11</tt>.

  <p>The next is <tt>section</tt>, where the menu and submenu the entry should
  appear in. The current list of sections <footnote>There were a major
  reorganization of menu structure for <tt>squeeze</tt>.</footnote> is at:
  <file>/usr/share/doc/debian-policy/menu-policy.html/ch2.html#s2.1</file>

  <p>The <tt>title</tt> field is the name of the program. You can start this one
  in uppercase if you like. Just keep it short.

  <p>Finally, the <tt>command</tt> field is the command that runs the program.

  <p>Let's change the file name to <file>menu</file> and change the menu entry to this:

<example>
?package(gentoo): needs="X11" \
        section="Applications/Tools" \
        title="Gentoo" command="gentoo"
</example>

  <p>You can also add other fields like <tt>longtitle</tt>, <tt>icon</tt>, <tt>hints</tt> etc.
  See <manref name="dh_installmenu" section="1">, <manref name="menufile" section="5">,
  <manref name="update-menus" section="1">
  and <file>/usr/share/doc/debian-policy/menu-policy.html/</file> for more
  information.

  <sect id="news"><file>NEWS</file> file

  <p>The <manref name="dh_installchangelogs" section="1"> command installs this.

  <sect id="maintscripts"><file>{post|pre}{inst|rm}</file> files

  <p>These <file>postinst</file>, <file>preinst</file>,
  <file>postrm</file>, and <file>prerm</file> files
  <footnote>Although I used Bash short hand expression to indicate these files
  as "<file>{post|pre}{inst|rm}</file>" here, I recommend you to use pure
  POSIX (non-Bash) shell for these <em>maintainer scripts</em> as much as possible for
  the better compatibility.</footnote>
  are called <em>maintainer scripts</em>. They are scripts which are
  put in the control area of the package and run by <prgn/dpkg/ when your
  package is installed, upgraded or removed.

  <p>As a novice maintainer, you should avoid any manual editing of
  <em>maintainer scripts</em> because they are problematic. For more
  information look in the 
  <url name="Debian Policy Manual, 6 'Package maintainer scripts and installation procedure'" id="http://www.debian.org/doc/debian-policy/ch-maintainerscripts.html">, 
  and take a look at these example files provided by <prgn>dh_make</prgn>.

  <p>If you did not listen to me and made your custom <em>maintainer
  scripts</em> for a package, you should make sure to test them not only for
  <strong>install</strong> and <strong>upgrade</strong> but also for
  <strong>remove</strong> and <strong>purge</strong>.

  <p>Upgrades to the new version should be silent and non-intrusive (existing
  users should not notice the upgrade except by discovering that old bugs have
  been fixed and there perhaps are new features).  

  <p>When the upgrade is necessarily intrusive (eg., config files scattered
  through various home directories with totally different structure), you may
  consider to set package to the safe default (e.g., disabled service) and
  provide proper documentations required by the policy
  (<file>README.Debian</file> and <file>NEWS.Debian</file>) as the last resort.
  Don't bother user with the <prgn>debconf</prgn> note invoked from these
  <em>maintainer scripts</em> for upgrades.

  <p>The <package>ucf</package> package provides <em>conffile-like</em>
  handling infrastructure to preserve user changes for files that may not be
  labeled <em>conffiles</em> such as ones managed by the <em>maintainer
  scripts</em>.  This should minimize issues associated with them.

  <p>These <em>maintainer scripts</em> are the Debian enhancements that explain
  <strong>why people choose Debian</strong>.  You must be very careful not to
  annoy them with these.  

  <sect id="todo"><file>TODO</file> file
  <p>The <manref name="dh_installdocs" section="1"> command installs this.

  <sect id="watch"><file>watch</file> file

  <p>The <file>watch</file> file format is documented in the 
  <manref name="uscan" section="1"> manpage. The <file>watch</file> file
  configures the <prgn>uscan</prgn> program (in the
  <package>devscripts</package> package) to watch the site where you originally
  got the source from.  This is also used by 
  <url id="http://wiki.debian.org/DEHS" name="Debian External Health Status (DEHS)">.

  <p>Here's what I put in it:

<example>
# watch control file for uscan
version=3
http://sf.net/gentoo/gentoo-(.*)\.tar\.gz debian uupdate
</example>

  <p>Normally with this <file>watch</file> file, the URL at
  "<tt>http://sf.net/gentoo</tt>" is downloaded and searched for links of the
  form "<tt>&lt;a href=...&gt;</tt>".  The base name (just the part after the
  final "<tt>/</tt>") of these linked URLs are matched against Perl regexp (see
  <manref name="perlre" section="1">) pattern "<tt>gentoo-(.*)\.tar\.gz</tt>".
  Out of matched files, the file with the greatest version number is
  downloaded and the <prgn>uupdate</prgn> program is run to create the updated
  source tree from them.

  <p>Although this is true for other sites, the SourceForge download service at
  <url id="http://sf.net"> is an exception.  When the <file>watch</file> file
  has an URL matching with the Perl regexp "<tt>^http://sf\.net/</tt>",  the
  <prgn>uscan</prgn> program substitutes it with
  "<tt>http://qa.debian.org/watch/sf.php/</tt>" and then applies this rule.
  The URL redirector service at this <url id="http://qa.debian.org/"> is
  designed to offer a stable redirect service to the desired file for the
  <file>watch</file> file having
  "<tt>http://sf.net/<var>project</var>/<var>tar-name</var>-(.+)\.tar\.gz</tt>".
  This solves issues related to the periodically changing URL there.

  <sect id="sourcef"><file>source/format</file> file

  <p>In the <file>debian/source/format</file> file, there should be a single
  line indicating the desired format for the source package
  (check <manref name="dpkg-source" section="1"> for an exhaustive list).  After
  <tt>squeeze</tt>, it should say either:
  <list>
  <item><tt>3.0 (native)</tt> for Debian native packages or 
  <item><tt>3.0 (quilt)</tt> for everything else.  
  </list>

  <p>The newer <tt>3.0 (quilt)</tt> source format records
  modifications in a <prgn>quilt</prgn> patch series within
  <file>debian/patches</file>. Those changes are then automatically
  applied during extraction of the source package. 
  <footnote>See <url name="DebSrc3.0"
  id="http://wiki.debian.org/Projects/DebSrc3.0"> for the summary information
  concerning the switch to the new <tt>3.0 (quilt)</tt> and <tt>3.0
  (native)</tt> source formats.</footnote> The Debian modifications are simply
  stored in a <file>debian.tar.gz</file> archive containing all files under the
  <file>debian</file> directory.  This new format supports
  inclusion of binary files such as PNG icons by the package maintainer without
  requiring tricks.  <footnote>Actually, this new format also supports
  multiple upstream tarballs and more compression methods.
  These are beyond the scope of this document.</footnote>

  <p>When <prgn>dpkg-source</prgn> extracts a source package in 
  <tt>3.0 (quilt)</tt> source format, it automatically applies all
  patches listed in <file>debian/patches/series</file>.  You can avoid
  applying patches at the end of the extraction with the <tt>--skip-patches</tt>
  option.

  <sect id="patches"><file>patches/*</file> files

  <p>The old <tt>1.0</tt> source format created a single large
  <file>diff.gz</file> file which contains package maintenance files in
  <file>debian</file> and patch files to the source.  Such a package is a bit
  cumbersome to inspect and understand for each source tree modification later.
  This is not so nice.

  <p>The newer <tt>3.0 (quilt)</tt> source format stores patches in
  <file>debian/patches/*</file> files using the <prgn>quilt</prgn> command.
  These patches and other package data which are all constrained under the
  <file>debian</file> directory are packaged as the <file>debian.tar.gz</file>
  file.  Since the <prgn>dpkg-source</prgn> command can handle
  <prgn>quilt</prgn> formatted patch data in the <tt>3.0 (quilt)</tt> source
  without the <package>quilt</package> package, it does not need to
  <tt>Build-Depends:</tt> on the <package>quilt</package> package.
  <footnote>Several methods for the patch set maintenance have been proposed
  and are in use with Debian packages.  The <prgn>quilt</prgn> system is the
  preferred maintenance system in use.  Other ones are <prgn>dpatch</prgn>,
  <prgn>dbs</prgn>, <prgn>cdbs</prgn>, etc.  Many of these keep such patches as
  <file>debian/patches/*</file> files.</footnote>


  <p>The <prgn>quilt</prgn> command is explained in <manref section="1"
  name="quilt">. It records modifications to the source as a stack of
  <tt>-p1</tt> patch files in the <file>debian/patches</file> directory and
  the source tree is untouched outside of the <file>debian</file> directory.
  The order of these patches are recorded in the
  <file>debian/patches/series</file> file.  You can apply (=push),
  un-apply (=pop), and refresh patches easily.
  <footnote>If you are asking a sponsor to upload your package, this kind of
  clear separation and documentation of your changes are very important to
  expedite the package review by your sponsor.</footnote>

  <p>For <ref id="first">, we created 3 patches in <file>debian/patches</file>.

  <p>Since Debian patches are located in <file>debian/patches</file>, please
  make sure to setup the <prgn>quilt</prgn> command properly as described
  in <ref id="quiltrc">.

  <p>When someone (including yourself) provides you with a patch <file><var>foo</var>.patch</file> to the source
  later, then the modification of a <tt>3.0 (quilt)</tt> source package is quite simple:

<example>
$ dpkg-source -x gentoo_0.9.12.dsc
$ cd gentoo-0.9.12
$ quilt import ../<var>foo</var>.patch
$ quilt push
$ quilt refresh
$ quilt header -e
... describe patch
</example>

  <p>The patches stored in the newer <tt>3.0 (quilt)</tt> source format must be
  <em>fuzz</em> free.  You should ensure it as 
  "<tt>quilt pop -a; while quilt push; do quilt refresh; done</tt>".

  <chapt id="build">Building the package

  <p>We should now be ready to build the package.

  <sect id="completebuild">Complete (re)build

  <p>In order to properly make complete (re)build of a package, you have to
  ensure to install
  <list>
  <item>the <package>build-essential</package> package,
  <item>packages listed in the <tt>Build-Depends:</tt> field (see <ref id="control">), and
  <item>packages listed in the <tt>Build-Depends-indep:</tt> field (see <ref id="control">).
  </list>

  <p>Then you issue the following command in the source directory:

<example>
$ dpkg-buildpackage
</example>

  <p>This will do everything to make full binary and source packages for you. It will:
  <list>
    <item>clean the source tree ("<tt>debian/rules clean</tt>")
    <item>build the source package ("<tt>dpkg-source -b</tt>")
    <item>build the program ("<tt>debian/rules build</tt>")
    <item>build binary packages ("<tt>fakeroot debian/rules binary</tt>")
    <item>sign the source <file/.dsc/ file, using <prgn/gpg/
    <item>create and sign the upload <file/.changes/ file, using
          <prgn/dpkg-genchanges/ and <prgn/gpg/
  </list>

  <p>The only input that will be required of you is your GPG secret pass
  phrase, twice.

  <p>After all this is done, you will see the following files in the
  directory above (<file>~/gentoo</file>):

  <p><list>
  <item><file>gentoo_0.9.12.orig.tar.gz</file>

  <p>This is the original source code tarball, merely renamed to the above
  so that it adheres to the Debian standard. Note that this was created
  initially by the "<tt>dh_make -f ../gentoo-0.9.12.tar.gz</tt>".

  <item><file>gentoo_0.9.12-1.dsc</file>

  <p>This is a summary of the contents of the source code. The file is
  generated from your <file>control</file> file, and is used when
  unpacking the source with <manref name="dpkg-source" section="1">. This
  file is GPG signed, so that people can be sure that it's really yours.

  <item><file>gentoo_0.9.12-1.debian.tar.gz</file>

  <p>This compressed tarball contains your <file>debian</file> directory
  contents. Each and every addition you made to the original source code are
  stored as quilt patches in <file>debian/patches</file>.

  <p>If someone else wants to re-create your package from scratch, they can
  easily do so using the above three files. The extraction procedure is
  trivial: just copy the three files somewhere else and run
  "<tt>dpkg-source -x gentoo_0.9.12-1.dsc</tt>".
  <footnote>You can avoid applying <prgn>quilt</prgn> patches in the
  <tt>3.0 (quilt)</tt> source format at the end of the
  extraction with the <tt>--skip-patches</tt> option.  Alternatively, you can
  run "<tt>quilt pop -a</tt>" after normal operation.</footnote>

  <item><file>gentoo_0.9.12-1_i386.deb</file>

  <p>This is your completed binary package. You can use <prgn/dpkg/ to
  install and remove this just like any other package.

  <item><file>gentoo_0.9.12-1_i386.changes</file>

  <p>This file describes all the changes made in the current package
  revision, and it is used by the Debian FTP archive maintenance programs
  to install the binary and source packages in it. It is partly generated
  from the <file>changelog</file> file and the <file>.dsc</file> file. This file is GPG signed, so
  that people can be sure that it's really yours.

  <p>As you keep working on the package, behavior will change and new
  features will be added. People downloading your package can look at this
  file and quickly see what has changed. Debian archive maintenance programs
  will also post the contents of this file to the <url
  id="http://lists.debian.org/debian-devel-announce/"
  name="debian-devel-announce@lists.debian.org"> mailing list.
  </list>

  <p>The long strings of numbers in the <file>.dsc</file> and
  <file>.changes</file> files are MD5/SHA1/SHA256 checksums for the files
  mentioned.  A person downloading your files can test them with <manref
  name="md5sum" section="1">, <manref name="sha1sum" section="1">, or <manref
  name="sha256sum" section="1"> and if the numbers don't match, they'll know
  the file is corrupt or has been tampered with.

  <sect id="autobuilder">Autobuilder

  <p>Debian supports many <url name="ports" id="http://www.debian.org/ports/">
  with the <url name="autobuilder network" id="http://www.debian.org/devel/buildd/">
  running <prgn>buildd</prgn> daemons on many different architecture computers.
  Although you do not need to do this by yourself, you should be aware of what
  will happen on your packages.  Let's look into roughly how your packages are
  rebuild for many different architectures by them. 
  <footnote>The actual autobuilder system involves much more complicated
  schemes than the one documented here.  Such details are beyond the scope of
  this document.</footnote>

  <p>For "<tt>Architecture: any</tt>" packages, the autobuilder system rebuild
  them.  It ensures to install
  <list>
  <item>the <package>build-essential</package> package, and
  <item>packages listed in the <tt>Build-Depends:</tt> field (see <ref id="control">).
  </list>

  <p>Then it issues the following command in the source directory:

<example>
$ dpkg-buildpackage -B
</example>

  <p>This will do everything to make architecture dependent binary packages on
  another architecture. It will:
  <list>
    <item>clean the source tree ("<tt>debian/rules clean</tt>")
    <item>build the program ("<tt>debian/rules build</tt>")
    <item>build architecture dependent binary packages ("<tt>fakeroot debian/rules binary-arch</tt>")
    <item>sign the source <file/.dsc/ file, using <prgn/gpg/
    <item>create and sign the upload <file/.changes/ file, using
          <prgn/dpkg-genchanges/ and <prgn/gpg/
  </list>

  <p>This is why you see your package for other architectures.  

  <p>Although packages listed in the <tt>Build-Depends-indep:</tt> field are
  required to be installed for the normal packaging by us (see 
  <ref id="completebuild">), they are not required to be installed for the
  autobuilder system since it build only architecture dependent binary
  packages.
  <footnote>Unlike under the <package>pbuilder</package> package, the
  <prgn>chroot</prgn> environment under the <package>sbuild</package> package
  used by the autobuilder system does not force the minimal system and may leave
  many packages installed.</footnote>
  This difference between normal packaging and autobuilder situation dictates
  whether you record such required packages in the <tt>Build-Depends:</tt> or
  <tt>Build-Depends-indep:</tt> fields of the <file>debian/control</file> file
  (see <ref id="control">).

  <sect id="option-sa">Including <file>orig.tar.gz</file> for upload

  <p>
When you first upload the package to the archive, you need to include
the original <file>orig.tar.gz</file> source.  If the last changelog entry is
not the first one for the given upstream version, you must provide
<prgn>dpkg-buildpackage</prgn> command with the "<tt>-sa</tt>" option.
On the other hand, the "<tt>-sd</tt>" option will force to exclude the
original <file>orig.tar.gz</file> source.

  <sect id="debuild"><prgn>debuild</prgn> command

  <p>You can automate package build process of the
  <prgn>dpkg-buildpackage</prgn> command further with the <prgn>debuild</prgn>
  command.  
  See <manref name="debuild" section="1">.
  
  <p>Customization of the <prgn>debuild</prgn> command can be done through 
  <file>/etc/devscripts.conf</file> or <file>~/.devscripts</file>. 
  I would suggest at least following items:

<example>
DEBSIGN_KEYID="Your_GPG_keyID"
DEBUILD_LINTIAN=yes
DEBUILD_LINTIAN_OPTS="-i -I --show-overrides"
</example>
  With these, packages are signed by your specified GPG key ID (good for
  sponsoring packages) and checked by the <prgn>lintian</prgn> command in
  details.

  <p>Cleaning source and rebuilding package from a user account 
  is as simple as:
<example>
$ debuild
</example>

  <p>Please note that the <prgn>dpkg-buildpackage</prgn> option "<tt>-sa</tt>"
  to include the original <file>orig.tar.gz</file> source can be specified as:
<example>
$ debuild -sa
</example>

  <p>You can clean source tree as simple as:
<example>
$ debuild clean
</example>

  <sect id="pbuilder"><package>pbuilder</package> package
  <p>
For a clean room (<prgn>chroot</prgn>) build environment to verify the build
dependencies, the <package>pbuilder</package> package is very useful.  
<footnote>Since the <package>pbuilder</package> package is still evolving, you
have to check the actual configuration situation by consulting the latest
official documentation.</footnote>
This ensures a clean build from the source under the <tt>sid</tt> auto-builder
for different architectures and avoids the severity serious FTBFS (Fails To
Build From Source) bug which is always in the RC (release critical) category.
See <url id="&buildd-home;"> for more on the Debian package auto-builder.

<p>Let's customize the <package>pbuilder</package> package by the following.
<list>
<item>setting <file>/var/cache/pbuilder/result</file> directory writable by the
user.
<item>creating a directory, e.g. <file><var>/var/cache/pbuilder/hooks</var></file>,
writable by the user to place hook scripts.
<item>setting <file>~/.pbuilderrc</file> or <file>/etc/pbuilderrc</file> to
include as follows.
<example>
AUTO_DEBSIGN=yes
HOOKDIR="<var>/var/cache/pbuilder/hooks</var>"
</example>
</list>

<p>This will allow you to sign generated packages with your secret GPG key in
the <file>~/.gnupg/</file> directory.

<p>Let's then initialize the local <package>pbuilder</package>
<prgn>chroot</prgn> system first as follows.
<example>
$ sudo pbuilder create
</example>

<p>If you already have the completed source packages, issue the following
commands in the directory where the <file><var>foo</var>.orig.tar.gz</file>,
<file><var>foo</var>.debian.tar.gz</file>, and <file><var>foo</var>.dsc</file>
files exist to update the local <package>pbuilder</package> <prgn>chroot</prgn>
system and to build binary packages in it.
<example>
$ sudo pbuilder --update
$ sudo pbuilder --build <var>foo</var>.dsc
</example>

  <p>Please note that the <prgn>dpkg-buildpackage</prgn> option "<tt>-sa</tt>"
  to include the original <file>orig.tar.gz</file> source can be specified as:
<example>
$ sudo pbuilder --build --debbuildopts "-sa" <var>foo</var>.dsc
</example>

<p>
The newly built packages will be located in
<file>/var/cache/pbuilder/result/</file> with non-root ownership.

<p>If you already have the updated source tree without generating the matching
source packages, issue the following commands in the source directory where the
<file>debian</file> directory exists, instead.
<example>
$ sudo pbuilder --update
$ pdebuild
</example>

  <p>Please note that the <prgn>dpkg-buildpackage</prgn> option "<tt>-sa</tt>"
  to include the original <file>orig.tar.gz</file> source can be specified as:
<example>
$ pdebuild --debbuildopts "-sa"
</example>

<p>You can log into its <prgn>chroot</prgn> environment with the 
"<tt>pbuilder --login --save-after-login</tt>" command and configure it as you
wish.  This environment can be saved by leaving its shell prompt with
<tt>^D</tt> (Control-D).

<p>The latest version of the <prgn>lintian</prgn> command can be executed in
the <tt>chroot</tt> environment using the hook script configured as follows.
<footnote>This assumes <tt>HOOKDIR="/var/cache/pbuilder/hooks"</tt>.
You can find many examples of the hook script in the
<file>/usr/share/doc/pbuilder/examples</file> directory.</footnote>
<example>
$ cat &gt; <var>/var/cache/pbuilder/hooks</var>/B90lintian &lt;&lt;EOF
#!/bin/sh
set -e
install_packages() {
    apt-get -y --force-yes install "$@"
    }
install_packages lintian
echo "+++ lintian output +++"
su -c "lintian -i -I --show-overrides /tmp/buildd/*.changes" - pbuilder
# use this version if you don't want lintian to fail the build
#su -c "lintian -i -I --show-overrides /tmp/buildd/*.changes; :" - pbuilder
echo "+++ end of lintian output +++"
EOF
</example>

  <p>You need to have access to the latest <tt>sid</tt> environment to build
  packages properly for <tt>sid</tt>.  In reality, <tt>sid</tt> may be
  experiencing issues which makes it not desirable for you to migrate your
  whole system.  The <package>pbuilder</package> package can help you to cope
  with this kind of situation.

  <p>You may need to update your <tt>stable</tt> packages after their release for
  <tt>stable-proposed-updates</tt>, <tt>stable/updates</tt>, etc.
  <footnote>There are some restrictions for such updates of your <tt>stable</tt>
  package.</footnote>
  For such occasions, "I am running <tt>sid</tt> system" is not good enough
  excuse not to update them promptly.  The <package>pbuilder</package> package
  can help you to access environments of almost any Debian derivative
  distributions of the same CPU architecture.

<p>
See <url id="&pbuilder-home;">,
<manref section="1" name="pdebuild">,
<manref section="5" name="pbuilderrc">, and
<manref section="8" name="pbuilder">.

  <sect id="git-buildpackage"><prgn>git-buildpackage</prgn> command and similars
<p>
If your upstream uses the source code management system 
(<url id="http://www.debian.org/doc/manuals/debian-reference/ch10.en.html#_version_control_systems" name="VCS">) 
to maintain their code, you should consider to use them.  That makes merging
and cherry-picking upstream patches much easier.  There are several specialized
wrapper script packages for the Debian package building for each VCS.
<list>
<item><package>git-buildpackage</package>: Suite to help with Debian packages in Git repositories.
<item><package>topgit</package>: a Git patch queue manager
<item><package>svn-buildpackage</package>: helper programs to maintain Debian packages with Subversion.
<item><package>cvs-buildpackage</package>: A set of Debian package scripts for CVS source trees.
</list>

<p>These packages offer more elegant working environment than manual use of the
<prgn>quilt</prgn> commands for advanced audiences to <em>automate</em>
building of packages.  I will not explain them in this tutorial.
<footnote>
Here are few web resources available for advanced audiences.
<list>
<item>"Building Debian Packages with git-buildpackage" at <file>/usr/share/doc/git-buildpackage/manual-html/gbp.html</file>/
<item>"<url name="debian packages in git" id="https://honk.sigxcpu.org/piki/development/debian_packages_in_git/">"
<item>"<url name="Using Git for Debian Packaging" id="http://www.eyrie.org/~eagle/notes/debian/git.html">"
<item>"<url name="Using TopGit to generate quilt series for Debian packaging" id="http://git.debian.org/?p=collab-maint/topgit.git;a=blob_plain;f=debian/HOWTO-tg2quilt;hb=HEAD">"
<item>"<url name="git-dpm: debian packages in git manager" id="http://git-dpm.alioth.debian.org/">"
</list>
</footnote>

  <sect id="quickrebuild">Quick rebuild

  <p>With a large package, you may not want to rebuild from scratch every time
  while you tune details in <file>debian/rules</file>. For testing purposes,
  you can make a <file>.deb</file> file without rebuilding the upstream sources
  like this
<footnote> Environment variables which are normally configured to proper
values are not set by this method.  Never create real packages to be uploaded 
using this <strong>quick</strong> method.</footnote>:

<example>
$ fakeroot debian/rules binary
</example>

Or, simply as following to see if it build or not.

<example>
$ fakeroot debian/rules build
</example>

  <p>Once you are finished with your tuning, remember to rebuild following
  the proper procedure. You may not be able to upload correctly if
  you try to upload <file>.deb</file> files built this way.


  <chapt id="checkit">Checking the package for errors
  
  <p>There are few chores you should know to check the package for errors by
  yourself before uploading packages to public archives.

  <p>Testing on machine other than your own is also good idea.  You must watch
  closely for any warnings or errors for all the test described here.

  <sect id="pinstall">Verifying package for install

  <p>You must test your package if it installs without problem.  
  The <manref name="debi" section="1"> command helps you to test to install all
  the generated binary packages.

<example>
$ sudo debi gentoo_0.9.12-1_i386.changes
</example>

  <p>You have to make sure that there are no overlapped files with other
  existing packages using the <file>Contents-<var>i386</var></file> file
  downloaded from the Debian archive to prevent installation problem on
  different systems.  The <prgn>apt-file</prgn> command may be handy for this
  task. If there are overlapped files, please take actions to avoid the real
  problem using the alternatives mechanism (see 
  <manref name="update-alternatives" section="1">) by coordinating with other
  affected packages or by setting the "<tt>Conflicts:</tt>" entry in the
  <file>debian/control</file> file.

  <sect id="pmaintscripts">Verifying package for <em>maintainer scripts</em>

  <p>All <em>maintainer scripts</em>, i.e., <file>preinst</file>,
  <file>prerm</file>, <file>postinst</file>, and <file>postrm</file> files, are
  non-trivial unless they are auto-generated by the
  <package>debhelper</package> programs.  So do not use them if you are a
  novice maintainer (see <ref id="maintscripts">).

  <p>If the package makes use of these non-trivial <em>maintainer scripts</em>,
  be sure to test not only for install but also for remove, purge, and upgrade.
  Many <em>maintainer script</em> bugs show up when packages are removed or
  purged. Use the <prgn>dpkg</prgn> command as follows to test them.

<example>
$ sudo dpkg -r gentoo
$ sudo dpkg -P gentoo
$ sudo dpkg -i gentoo_<var>version</var>-<var>revision</var>_<var>i386</var>.deb
</example>

  <p>This should be done with sequences such as the following.

  <list>
    <item>install the previous version (if needed).
    <item>upgrade it from the previous version.
    <item>downgrade it back to the previous version (optional).
    <item>purge it.
    <item>install the new package.
    <item>remove it.
    <item>install it again.
    <item>purge it.
  </list>

  <p>If this is your first package, you should create dummy packages with
  different versions to test your package in advance to prevent future
  problems.

  <p>Bear in mind that if your package has previously been released in
  Debian, people will often be upgrading to your package from the version
  that was in the last Debian release. Remember to test upgrades from that
  version too.

  <p>Although downgrade is not officially supported, it should be nice to
  support it.

  <sect id="lintians"><package>lintian</package> package

  <p>Run <manref name="lintian" section="1"> on your <file>.changes</file>
  file.  The <prgn>lintian</prgn> command runs many test scripts to check for
  many common packaging errors.
  <footnote>You do not need to provide the <prgn>lintian</prgn> option 
  "<tt>-i -I --show-overrides</tt>" if you customized <file>/etc/devscripts.conf</file> or
  <file>~/.devscripts</file> as described in <ref id="debuild">.
  </footnote> 
  
<example>
$ lintian -i -I --show-overrides gentoo_0.9.12-1_i386.changes
</example>

  <p>Of course, replace the filename with the name of the <file>.changes</file>
  file generated for your package.  The output of the <prgn>lintian</prgn>
  command are marked as follows.
  <list>
  <item><tt>E:</tt> for error; a sure policy violation or a packaging error.
  <item><tt>W:</tt> for warning; a possible policy violation or a packaging error.
  <item><tt>I:</tt> for info; a information on certain packaging aspects.
  <item><tt>N:</tt> for note; a detailed message to help your debugging.
  <item><tt>O:</tt> for overridden; a message overridden by the <file>lintian-overrides</file> files but displayed by the <tt>--show-overrides</tt> option.

  </list>

  <p>For warnings, tune the package to avoid them or verify that the warnings
  are spurious.  If spurious, set the <file>lintian-overrides</file> files as
  described in <ref id="lintian">.

  <p>Note that you can build the package with <prgn/dpkg-buildpackage/ and run
  <prgn/lintian/ on it in one command with <manref name="debuild" section="1"> or 
  with <manref name="pdebuild" section="1">.
  
  <sect id="debc"><prgn>debc</prgn> command

  <p>You can list files in the binary Debian package by
  <manref name="debc" section="1"> command. 

<example>
$ debc <var>package</var>.changes
</example>

  <sect id="debdiff"><prgn>debdiff</prgn> command

  <p>You can compare file contents in two source Debian packages with
  the <manref name="debdiff" section="1"> command.  

<example>
$ debdiff <var>old-package</var>.dsc <var>new-package</var>.dsc
</example>

  <p>You can also compare file lists in two sets of binary Debian packages with
  the <manref name="debdiff" section="1"> command.  

<example>
$ debdiff <var>old-package</var>.changes <var>new-package</var>.changes
</example>

  <p>These are useful to identify what has been changed in the source packages,
  if no files have been unintentionally misplaced or removed in the binary packages,
  and if no other inadvertent changes were made when updating binary packages.

  <sect id="interdiff"><prgn>interdiff</prgn> command

  <p>You can compare two <file>diff.gz</file> files with the 
  <manref name="interdiff" section="1"> command.  This is useful for verifying
  that no inadvertent changes were made to the source by the maintainer when
  updating packages in the old <tt>1.0</tt> source format.

<example>
$ interdiff -z <var>old-package</var>.diff.gz <var>new-package</var>.diff.gz
</example>

  <sect id="mc"><prgn>mc</prgn> command

  <p>Many of these file inspection operations can be made into an intuitive process by
  using a file manager like <manref name="mc" section="1"> which will
  let you browse not only the contents of <file>*.deb</file> package files but
  also <file>*.udeb</file>, <file>*.debian.tar.gz</file>,
  <file>*.diff.gz</file>, and <file>*.orig.tar.gz</file> files.
  <p> 
  Be on the lookout for extra unneeded files or zero length files, both
  in the binary and source package. Often cruft doesn't get cleaned up
  properly; adjust your <file>rules</file> file to compensate for that.
 
  <chapt id="upload">Uploading the package

  <p>Now that you have tested your new package thoroughly, you will be technically ready
  to start the Debian new maintainer application process, as described at
  <url id="http://www.debian.org/devel/join/newmaint">

  <sect id="upload-debian">Uploading to the Debian archive
  
  <p>Once you become an official developer, you'll need to upload the
  package to the Debian archive. You can do this manually, but it's easier
  to use the provided automated tools, like
  <manref name="dupload" section="1"> or <manref name="dput" section="1">.
  We'll describe how it's done with <prgn/dupload/.
  <footnote>
  The <package>dput</package> package seems to come with more features and
  becoming more popular than the <package>dupload</package> package.  It uses
  the <file>/etc/dput</file> file for the global configuration and the
  <file>~/.dput.cf</file> file for the per-user one.  It supports Ubuntu
  related services out-of-box, too.
  </footnote>

  <p>First you have to set up <prgn>dupload</prgn>'s config file. You can either edit the
  system-wide <file>/etc/dupload.conf</file> file, or have your own
  <file>~/.dupload.conf</file> file override the few things you want to
  change.

  <p>You can read the <manref name="dupload.conf" section="5"> manual
  page to understand what each of these options means.

  <p>The <tt>$default_host</tt> option determines which of
  the upload queues will be used by default. <tt>anonymous-ftp-master</tt> is the primary
  one, but it's possible that you will want to use another one.

  <p>While connected to the Internet, you can upload your package by the following:
  
<example>
$ dupload gentoo_0.9.12-1_i386.changes
</example>

  <p><prgn/dupload/ checks that the MD5/SHA1/SHA256 checksums of the files match those from the
  <file>.changes</file> file, so it will warn you to rebuild it as described in
  <ref id="completebuild"> so it can properly upload.

  <!-- (No more use of ftp-master nor faster queue.  It is not so useful these days.
  <p>If you upload to "ftp-master", <prgn/dupload/ will ask for your
  password on Debian machines, and then upload the packages.
  -->

  <p>If you encounter an upload problem at <url id="&ftp-uploadqueue;">,
  you can fix this by manually uploading GPG signed
  <file>*.commands</file> file to there with <prgn>ftp</prgn>.
  <footnote>
  See <url id="&ftp-command;">.  Alternatively, you may use
  <prgn>dcut</prgn> command from the <package>dput</package> package.
  </footnote>
  For example, use <file>hello.commands</file>:
<example>
-----BEGIN PGP SIGNED MESSAGE-----

Uploader: Foo Bar &lt;Foo.Bar@example.org&gt;
Commands: 
 rm hello_1.0-1_i386.deb
 mv hello_1.0-1.dsx hello_1.0-1.dsc

-----BEGIN PGP SIGNATURE-----
Version: 2.6.3ia

iQCVAwUBNFiQSXVhJ0HiWnvJAQG58AP+IDJVeSWmDvzMUphScg1EK0mvChgnuD7h
BRiVQubXkB2DphLJW5UUSRnjw1iuFcYwH/lFpNpl7XP95LkLX3iFza9qItw4k2/q
tvylZkmIA9jxCyv/YB6zZCbHmbvUnL473eLRoxlnYZd3JFaCZMJ86B0Ph4GFNPAf
Z4jxNrgh7Bc=
=pH94
-----END PGP SIGNATURE-----
</example>

  <p>See <url name="mentors.debian.net"
  id="http://mentors.debian.net/cgi-bin/welcome"> for publically accessible
  upload area for non-DD.

  <p>See <url name="Debian Reference, 2.7.12. 'Small public package archive'"
  id="http://www.debian.org/doc/manuals/debian-reference/ch02.en.html#_small_public_package_archive">
  for an example for creating a small public package archive compatible with
  the modern secure APT system.

  <chapt id="update">Updating the package

  <p>Once you release a package, you need to update it soon.

  <sect id="newrevision">New Debian revision

  <p>Let's say that a bug report was filed against your package as <tt>#54321</tt>,
  and it describes a problem that you can solve. To create a new Debian
  revision of the package, you need to:

  <list>
  <item>If this is to be recorded as a new patch, do the following.
  <list>
  <item>"<tt>quilt new <var>bugname.patch</var></tt>" to set patch name.
  <item>"<tt>quilt add <var>buggy-file</var></tt>" to declare file to be modified.
  <item>Correct the problem in the package source for the upstream bug.
  <item>"<tt>quilt refresh</tt>" to record to <file><var>bugname.patch</var></file>.
  <item>"<tt>quilt header -e</tt>" to add its description.
  </list>
  <item>If this is to update an existing patch, do the following.
  <list>
  <item>"<tt>quilt pop <var>foo.patch</var></tt>" to recall existing <file><var>foo.patch</var></file>.
  <item>Correct the problem in the old <file><var>foo.patch</var></file>.
  <item>"<tt>quilt refresh</tt>" to update <file><var>foo.patch</var></file>.
  <item>"<tt>quilt header -e</tt>" to update its description.
  <item>"<tt>while quilt push; do quilt refresh; done</tt>" to apply all patches while removing <em>fuzz</em>.
  </list>
  <item>Add a new revision at the top of the Debian <file>changelog</file> file, for
  example with "<tt>dch -i</tt>", or explicitly with
  "<tt>dch -v <var>version</var>-<var>revision</var></tt>"
  and then insert the comments using your preferred editor.
  <footnote>To get the date in the required format, use "<tt>LANG=C date -R</tt>".</footnote>

  <item>Include a short description of the bug and the solution in the
  changelog entry,
  followed by "<tt>Closes: #54321</tt>". That way, the bug report will be
  <em>automagically</em> closed by the archive maintenance software the moment your
  package gets accepted in the Debian archive.

  <item>Repeat what you did in the above to fix more bugs while updating the
  Debian <file>changelog</file> file with "<tt>dch</tt>" as needed.

  <item>Repeat what you did in <ref id="completebuild">, <ref id="checkit">,
  and <ref id="upload">. The difference is that this time, the original source
  archive won't be included, as it hasn't been changed and it already
  exists in the Debian archive.
  </list>

  <sect id="inspectnewupstream">Inspection of the new upstream release

  <p>When preparing packages of the new upstream release for the Debian
  archive, you must check the new upstream release, first.

  <p>You start this by reading the upstream <file>changelog</file>,
  <file>NEWS</file>, and whatever other documentations they may have released
  with the new version.

  <p>You then inspect changes between the old and new upstream sources as
  follow to watch out for anything suspicious.
<example>
$ diff -urN <var>foo</var>-<var>oldversion</var> <var>foo</var>-<var>newversion</var>
</example>

  <p>Changes to some auto-generated files by Autotools such as
  <file>missing</file>, <file>aclocal.m4</file>, <file>config.guess</file>,
  <file>config.h.in</file>, <file>config.sub</file>, <file>configure</file>,
  <file>depcomp</file>, <file>install-sh</file>, <file>ltmain.sh</file>, and
  <file>Makefile.in</file> may be ignored.  You may erase them before running
  <prgn>diff</prgn> to the source for inspection.

  <sect id="newupstream">New upstream release

  <p>If a package <package><var>foo</var></package> is properly packaged in the newer
  <tt>3.0 (native)</tt> or <tt>3.0 (quilt)</tt> formats,
  packaging a new upstream version is essentially moving the old
  <file>debian</file> directory to the new source.  This can be done by running
  "<tt>tar xvzf /<var>path</var>/<var>to</var>/<var>foo</var>_<var>oldversion</var>.debian.tar.gz</tt>" 
  in the new untared source.
  <footnote>
  <p>If a package <package><var>foo</var></package> is packaged in the old
  <tt>1.0</tt> format, this can be done by running
  "<tt>zcat /<var>path</var>/<var>to</var>/<var>foo</var>_<var>oldversion</var>.diff.gz|patch -p1</tt>" 
  in the new un-tared source, instead.
  </footnote>
  Of course, you need to do few obvious chores.
  <list>
  <item>Create a copy of upstream source as the <file>foo_<var>newversion</var>.tar.gz</file> file.
  <item>Update the Debian <file>changelog</file> file with 
  "<tt>dch -v <var>newversion</var>-<var>1</var></tt>".
  <list>
  <item>Add an entry with "New upstream release".
  <item>Describe concisely the changes <em>in the new upstream release</em>
  that fix reported bugs and close those bugs.
  <item>Describe concisely the changes <em>to the new upstream release</em> by
  the maintainer that fix reported bugs and close those bugs.
  </list>
  <item>"<tt>while quilt push; do quilt refresh; done</tt>" to apply all patches while removing <em>fuzz</em>.
  </list>


  <p>If the patch/merge did not apply cleanly, inspect the situation (clues are left in <file>.rej</file> files).
  <list>
  <item>If a patch you applied to the source was integrated to the upstream source,
  <list>
  <item>"<tt>quilt delete</tt>" to remove it.
  </list>
  <item>If a patch you applied to the source conflicted with new changes in the upstream source,
  <list>
  <item>"<tt>quilt push -f</tt>" to apply old patches while forcing rejects as
  <file><var>baz</var>.rej</file>.
  <item>Edit the <file><var>baz</var></file> file manually to realize intended
  effect of <file><var>baz</var>.rej</file>.
  <item>"<tt>quilt refresh</tt>" to update the patch.
  </list>
  <item>Continue back to "<tt>while quilt push; do quilt refresh; done</tt>".
  </list>

  <p> This process can be automated using the <manref name="uupdate" section="1"> command as follows:
<example>
$ apt-get source <var>foo</var>
...
dpkg-source: info: extracting <var>foo</var> in <var>foo</var>-<var>oldversion</var>
dpkg-source: info: unpacking <var>foo</var>_<var>oldversion</var>.orig.tar.gz
dpkg-source: info: applying <var>foo</var>_<var>oldversion</var>-1.debian.tar.gz
$ ls -F
<var>foo</var>-<var>oldversion</var>/
<var>foo</var>_<var>oldversion</var>-1.debian.tar.gz
<var>foo</var>_<var>oldversion</var>-1.dsc
<var>foo</var>_<var>oldversion</var>.orig.tar.gz
$ wget http://example.org/<var>foo</var>/<var>foo</var>-<var>newversion</var>.tar.gz
$ cd <var>foo</var>-<var>oldversion</var>
$ uupdate -v <var>newversion</var> ../<var>foo</var>-<var>newversion</var>.tar.gz
$ cd ../<var>foo</var>-<var>newversion</var>
$ while quilt push; do quilt refresh; done
$ dch
... document changes made
</example>

  <p>If you set up a <file>debian/watch</file> file as described in <ref
  id="watch">, you can skip the <prgn>wget</prgn> command.  You simply run
  <manref name="uscan" section="1"> in the
  <file><var>foo</var>-<var>oldversion</var></file> directory instead of the
  <prgn>uupdate</prgn> command.  This will <em>automagically</em> look for
  the updated source, download it, and run the <prgn>uupdate</prgn> command.
  <footnote>If the <prgn>uscan</prgn> command downloads the updated source but it does
  not run the <prgn>uupdate</prgn> command, you should correct the <file>debian/watch</file>
  file to have "<tt>debian uupdate</tt>" at the end of the URL.
  </footnote>

  <p>You can release this updated source by repeating what you did in <ref
  id="completebuild">, <ref id="checkit">, and <ref id="upload">.

  <sect id="packagestyle">Updating the packaging style

  <p>Updating the package style is not a required activity for the update of a
  package.  But, you can use the full capability of the modern
  <package>debhelper</package> system and the <tt>3.0</tt> source format by
  doing this.
  <footnote>If your sponsor or other maintainers object to updating the
  existing packaging style, it is not worth bothering nor arguing.  There are
  more important things to do.</footnote>

<list>

  <item>If you need to add erased template files for any reason, you may run
  <prgn>dh_make</prgn> again in the same, already <em>debianized</em>,
  directory with <tt>--addmissing</tt> option.  Then edit it properly.

  <item>If the package has not updated to use the <package>debhelper</package>
  V7 <prgn>dh</prgn> syntax for the <file>debian/rules</file> file, update it to
  use <prgn>dh</prgn>.  Update the <file>debian/control</file> file accordingly.

  <item>If you want to update the <file>rules</file> file created with the
  makefile inclusion mechanism of the Common Debian Build System
  (<package>cdbs</package>) to the <prgn>dh</prgn> syntax, see
  <file>/usr/share/doc/cdbs/cdbs-doc.html</file> and understand its
  <tt>DEB_*</tt> configuration variables. 
  <footnote>In the <package>cdbs</package> (0.4.74) package, there are some
  negative descriptions of the <file>rules</file> file created by the
  <prgn>dh_make</prgn> command for the non-<package>cdbs</package> choices.  Do
  not worry about it.  It applies only for <tt>lenny</tt> which created
  explicit targets with long list of <prgn>dh_*</prgn> commands.</footnote>

  <item>If you have a <tt>1.0</tt> source package without the
  <file><var>foo</var>.diff.gz</file> file, you can update it to the newer
  <tt>3.0 (native)</tt> source format by creating
  <file>debian/source/format</file> with "<tt>3.0 (native)</tt>".  The rest of
  <file>debian/*</file> files can be just copied.

  <item>If you have a <tt>1.0</tt> source package with the
  <file><var>foo</var>.diff.gz</file> file, you can update it to the newer
  <tt>3.0 (native)</tt> source format by creating
  <file>debian/source/format</file> with "<tt>3.0 (quilt)</tt>".  The rest of
  <file>debian/*</file> files can be just copied.  Import the
  <file>big.diff</file> file generated by the 
  "<tt>filterdiff -z -x '*/debian/*' <var>foo</var>.diff.gz &gt; big.diff</tt>" 
  command to your <prgn>quilt</prgn> system, if needed.
  <footnote>You may split <file>big.diff</file> into many small incremental
  patches using the <prgn>splitdiff</prgn> command.</footnote>

  <item>If it was packaged with another patch system such as
  <package>dpatch</package>, <package>dbs</package>, or <package>cdbs</package>
  with <tt>-p0</tt>, <tt>-p1</tt>, or <tt>-p2</tt>, convert it to the
  <package>quilt</package> command using <file>deb3</file> at 
  <url id="http://bugs.debian.org/581186">.

  <item>If it was packaged with the <prgn>dh</prgn> command with the
  "<tt>--with quilt</tt>" option or with the <prgn>dh_quilt_patch</prgn> and
  <prgn>dh_quilt_unpatch</prgn> commands, remove such things and make it use
  the newer <tt>3.0 (native)</tt> source format.

</list>

  <p>You need to do other tasks described in <ref id="newupstream">, too.

  <sect id="reminders">Reminders for updating packages

  <p>Here are few reminders for updating packages.

  <list>

<item>Preserve old changelog entries (sounds obvious, but there have been
incidents to type "<tt>dch</tt>" when you should have typed "<tt>dch -i</tt>".)

<item>Existing Debian changes need to be reevaluated; throw away stuff that
upstream has incorporated (in one form or another) and remember to
keep stuff that hasn't been incorporated by upstream, unless there is
a compelling reason not to.

<item>If any changes were made to the build system (hopefully you'd know
from inspecting upstream changes) then update the <file>debian/rules</file> and
<file>debian/control</file> build dependencies if necessary.

<item>Check to see <url name="Debian Bug Tracking System (BTS)"
id="http://www.debian.org/Bugs/"> if someone have provided patches to bugs that
are currently open in it.

<item>Check the contents of the <file>.changes</file> file to make sure you are
uploading to the correct distribution, the proper bugs closures are
listed in the <tt>Closes:</tt> field, the <tt>Maintainer:</tt> and <tt>Changed-By:</tt> fields
match, the file is GPG-signed, etc.

</list>

 </book>
</debiandoc>
