#!/bin/sh

# This should solve issues with debiandoc for Polish quotation if fixed.

#  Called as "fixlatex -l <lang> <infile> <outfile>"

locale=en

while getopts ":l:" opt
do
        case ${opt}
        in 
           l) locale=${OPTARG};;
           \? ) echo "unknown option \`${OPTARG}'"; exit -1;;
        esac
done
shift $((${OPTIND} - 1))

# $1 <infile>
# $2 <outfile>
# (both are different, real files, no stdin/stdout/...)

cp "$1" "$2"
file="$2"

dir=$(echo $locale | tr [A-Z]_ [a-z]-) # change pt_BR to pt-br

# include $dir/LaTeXmacros.sty file with language specific macros and
# LaTeXmacros.sty for general use in all translations
# (these files do not need to exist)
#sed '/^\\documentclass/ a\
#\\InputIfFileExists{LaTeXmacros.sty}{}{}\
#\\InputIfFileExists{'$dir'/LaTeXmacros.sty}{}{}' $file > $file.tmp
#mv $file.tmp $file

case $locale in
("zh_TW")
        perl -p \
-e 's/([\x80-\xff])\\textbackslash\{\}/$1\\/g;' \
-e 's/([\x80-\xff])\\textasciitilde\{\}/$1\~/g;' \
-e 's/([\x80-\xff])\\textasciicircum\{\}/$1\^/g;' \
-e 's/([\x80-\xff])\\\}/$1\}/g;' \
-e 's/([\x80-\xff])\\\{/$1\{/g;' \
-e 's/([\x80-\xff])\\\_/$1_/g;' <$1 |
        bg5conv >$2
        ;;
("pl")
	cat $file | \
	# use double quotes ,,text'': LaTeX: "`text"'
	# debiandoc2latex changes "text" to ``text'', so lets change ,, `` ''
	# Use &apos;&apos; for '', if '' really means '' in source
	sed -e "s/\`\`/\"\`/g" -e "s/,,/\"\`/g" -e "s/''/\"'/g" > $file.tmp
	mv $file.tmp $file
	;;

(*)
	: # do nothing
;;
esac

