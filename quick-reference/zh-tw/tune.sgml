<!-- CVS revision of this document "$Revision: 1.9 $"  -->
<!-- CVS revision of original english document "1.116" -->
<chapt id="tune"> &debian; 系統調整
<p>
這一章節主要是說明如何在文字介面下設定系統組態。
<ref id="install">.  
<p>
強烈建議閱讀 <url id="&securing-debian-howto;" name="Securing Debian Manual"> 來建構系統的安全性，該文件也可以安裝 <package>&p-securing-debian-howto;</package> 套件取得。

<sect id="init-hints"> 初始化系統的技巧
<p>
先閱讀 <ref id="init"> 了解 &debian; 的 init 系統與流程。

<sect1 id="init-defaults">自定 init 命令稿
<p>
&debian; 使用的是 System V 啟動命令稿系統。 雖然系統管理者可以任意修改編輯放在 <file>/etc/init.d/*</file> 之下的所有系統命令稿，但比較好的辦法是額外將命令稿的設定檔放置在 <file>/etc/default/*</file> 並由命令稿讀入。
<p>
舉例來說， 可以自行編輯 motd，sulogin 等服務命令稿並放置在 <file>/etc/init.d/rcS</file> 讓系統開機時即可啟動。

<sect1 id="syslogd">設定系統登入日誌( system logging )
<p>
系統日誌是由 syslogd 這支程式控制，編輯 <file>/etc/syslog.conf</file> 設定日誌輸出型態。
透過 <package>colorize</package> 這個套件可以讓日誌檔更容易辨識。
查看 <manref name="syslogd" section="8"> 和 <manref name="syslog.conf" section="5"> 可以得到更多的訊息。
</sect1>

<sect1 id="hdtune">硬體存取最佳化Hardware access optimization
<p>
&debian; 保留了部份硬體最佳化的設定，系統管理者可以在安裝之後進行設定。

<list>
<item><package>hdparm</package>
 <list compact>
<item>硬碟讀寫最佳化軟體，效果十分顯著。
<item>請小心使用該軟體，最好先閱讀過 <manref name="hdparm" section="8"> 再嚐試。
<item><tt>hdparm -tT <var>/dev/hda</var></tt> ：測試 /dev/hda 的讀寫速度。
<item><tt>hdparm -q -c3 -d1 -u1 -m16 <var>/dev/hda</var></tt>： 加速新型的硬碟機。( 有可能照成錯誤 )
 </list>

<item><package>setcd</package>
 <list compact>
<item>光碟機讀寫最佳化軟體。.
<item><tt>setcd -x <var>2</var></tt>： 設定讀取速度為 <var>2</var>.倍速。
<item>閱讀 <manref name="setcd" section="1"> 可以得到更多資訊。
 </list>

<item><package>setserial</package>
 <list compact>
<item>串列埠管理工具集。
 </list>

<item><package>scsitools</package>
 <list compact>
<item>SCSI 裝置管理工具集。
 </list>

<item><package>memtest86</package>
 <list compact>
<item>記憶體檢測軟體。
 </list>

<item><package>hwtools</package>
 <list compact>
<item>低階硬體管理程式的集合。
  <list compact>
   <item><prgn>irqtune</prgn>: 改變硬體的 IRQ 優先權，使快速的裝置或服務可以擁有較高的優先權，比如加速串列埠數據機的產量達 3 倍等。

   <item><prgn>scanport</prgn>: 掃描 ISA 裝置從 0x100 到 0x3ff 的輸入輸出位置。
   <item><prgn>inb</prgn>: 從輸出輸入埠傾印資料並轉換成二進制和十六進制。
  </list>

 </list>

<item><package>schedutils</package>
 <list compact>
<item>Linux 程序排程工具
<item>包括了 <prgn>taskset</prgn>, <prgn>irqset</prgn>, <prgn>lsrt</prgn> 以及 <prgn>rt</prgn> 。
<item>另外還有 <prgn>nice</prgn> and <prgn>renice</prgn>(不包括)，可以全盤控制程序的排程參數。
 </list>
</list>
<p>
掛載檔案系統時加上 <tt>noatime</tt> 這個參數能提昇檔案讀寫的效率。
閱讀 <manref name="fstab" section="5"> 以及 <manref name="mount" section="8">。
<p>
部份的硬體裝置可以藉由 Linux Kernel 設定 proc 檔案系統來直接設定及最佳化。
閱讀 <ref id="proc-sys">。
<p>
Debian 納入了許多設定硬體特性的軟體。大部分的軟體都是針對筆記型電腦設計。底下是 Debian 中比較有趣的軟體：
<list compact>
<item><package>tpconfig</package> - 觸碰版設定軟體
<item><package>apmd</package> - 進階電源管理程式
<item><package>acpi</package> - 檢視 ACPI 裝置資訊的工具
<item><package>acpid</package> - 使用 ACPI 的工具集
<item><package>lphdisk</package> - 提供 Phoenix NoteBIOS 的硬體磁區休眠功能
<item><package>sleepd</package> - 設定筆記型電腦休眠狀態的軟體
<item><package>noflushd</package> - 讓閒置的硬碟可以停止運轉以節省電源
<item><package>big-cursor</package> - 提供 X 更大的滑鼠指標
<item><package>acme</package> - 啟動筆記型電腦上的多媒體功能鍵
<item><package>tpctl</package> - IBM ThinkPad 硬體裝置設定工具
<item><package>mwavem</package> - Mwave/ACP 數據機支援
<item><package>toshset</package> - Toshiba 筆記型電腦的硬體設定程式
<item><package>toshutils</package> - Toshiba 筆記型電腦相關工具
<item><package>sjog</package> - 支援 Sony Vaio 筆記型電腦上的 "Jog Dial" 的軟體
<item><package>spicctrl</package> - 調整 Sony Vaio 液晶螢幕亮度的軟體
</list>
ACPI 是一個全新的架構是且比 APM 要來的新且完整。
<p>
部份的套件需要特定的 Kernel 模組且已經納入最新的 Kernel Source 之中。如果硬體依然不支援，只好自行抓取修正檔並重新編譯 Kernel。

<sect>存取控制 ( Access control )

<sect1 id="loginctrl">利用 PAM 來控制登入程序
<p>
PAM (Pluggable Authentication Modules) 提供了登入控制限制。  
<example>
/etc/pam.d/*             # PAM 控制檔案的位置
/etc/pam.d/login         # PAM 控制登入的設定檔
/etc/security/*          # PAM 模組參數的設定檔
/etc/securetty           # 限制 root 從 console 模式下登入的設定檔
/etc/login.defs          # 登入系統之後的環境變數設定檔
</example>
<p>
如果想允許空白密碼的使用者登入系統，可以編輯 <file>/etc/pam.d/login</file> 並加入以下的訊息，此動作的風險很大，請管理者斟酌。
<example>
#auth       required   pam_unix.so nullok
auth       required   pam_permit.so
</example>
<prgn>xdm</prgn>, <prgn>gdm</prgn>...等軟體透過這樣的步驟也能允許空白密碼的使用者登入。

<p>
另一方面，使用 <package>cracklib2</package> 可以加強密碼安全機制，設定 <file>/etc/pam.d/passwd</file> 並加入以下的敘述。
<example>
password required       pam_cracklib.so retry=3 minlen=6 difok=3
</example>
使用 <prgn>passwd</prgn> 並加入 <tt>-e</tt> 這個參數會強迫使用者在下一次登入時必須修改密碼。
閱讀 <manref name="passwd" section="1"> 以取得更多的資訊。
<p>
在 Bash shell 的環境中，可以執行 <tt>ulimit -u 1000</tt> 來設定執行程序的最大值，或者直接編輯 <file>/etc/security/limits.conf</file>。
在該檔案中可以找到類似 <tt>core</tt> 的參數，試著編輯它即可。
<prgn>PATH</prgn> 的設定可以藉由 <file>/etc/login.defs</file> 的內容來初始化。

<p>
PAM 的文件被包裝在 <package>libpam-doc</package> 之中。在這個套件包裝的文件有：<em>Linux-PAM System Administrator's Guide</em>，涵蓋了如何設定 PAM 以及相關模組的說明。<em>The Linux-PAM Application Developers' Guide</em> 以及 <em>The Linux-PAM Module Writers' Guide</em>。
</sect1>

<sect1 id="wheel">"為何 GNU <prgn>su</prgn> 不支援 <tt>wheel</tt> 群組"
<p>
這是 Richard M. Stallman 的慣用語，可以在舊式的 <tt>info su</tt> 頁面底下找到。請不要擔心，目前 Debian 中的 <prgn>su</prgn> 程式是使用 PAM的，所以編輯 <file>/etc/pam.d/su</file> 並加入 <prgn>pam_wheel.so</prgn> 的敘述就可以限定那些使用者可以執行 <prgn>su</prgn>。底下以  Debian 中的 <tt>adm</tt> 群組當作範例；如何實現 BSD 中的 <tt>wheel</tt> 群組直接執行 <prgn>su</prgn> 且不需輸入密碼就能切換成 root。
<example>
# anti-RMS configuration in /etc/pam.d/su
auth       required   pam_wheel.so group=adm

# Wheel members to be able to su without a password
auth       sufficient pam_wheel.so trust group=adm
</example>

<sect1>Meaning of various groups
<p>
比較特殊的群組：
<list compact>
<item>如果 <prgn>pam_wheel.so</prgn> 不加上 <tt>group=</tt> 參數指定群組名稱，則 <tt>root</tt> 群組便是 <prgn>su</prgn> 所定義的預設 wheel 群組。 
<item><tt>adm</tt> 群組可以讀取系統紀錄檔。 
<item><tt>cdrom</tt> 群組可以對光碟機進行存取的動作。
<item><tt>floppy</tt> 群組可以讀寫控制軟碟槽。
<item><tt>audio</tt> 群組可以讀寫音效裝置。
<item><tt>src</tt> 群組擁有管理軟體源碼的權限，比如 <file>/usr/src</file> 下的檔案存取。
<item><tt>staff</tt> 針對新上手的系統管理者或是系統諮詢帳號所規劃的群組，該群組的使用者擁有 <file>/usr/local</file> 以及 <file>/home</file> 的讀寫權。
</list>
<p>
想要了解更多的資料，請閱讀 <url id="&securing-debian-howto;" name="Securing Debian Manual"> 的 "FAQ"。Debian Woody 可以安裝 <package>&p-securing-debian-howto;</package> 套件取得該文件。<package>&p-base-passwd;</package> (>3.4.6) 更納入了權限的列表。

<sect1 id="sudo"><prgn>sudo</prgn> &ndash; 更安全的工作環境
<p>
對我而言，<prgn>sudo</prgn> 絕大部分是防止我做出愚笨的行為，使用 <prgn>sudo</prgn> 會是比直接切換成 root 更好的辦法。
<p>
安裝 <prgn>sudo</prgn> 之後，編輯好 <file><url id="&examples;" name="/etc/sudoers"></file> 就能啟動。順便檢查 <file>&dochome;sudo/OPTIONS</file> 中的 <tt>sudo</tt> 群組參數。

<p>
這個例子是說明 "staff" 群組透過 <prgn>sudo</prgn> 的設定之後便能以 root 身份執行任何程式；同樣地，"src" 群組透過 <prgn>sudo</prgn> 設定之後便能以 root 身份執行部份程式。

<p>
使用 <prgn>sudo</prgn> 的好處在於一般 user 只要輸入自己的密碼就能登入並被系統監視。
且能提供部份權限給予新上手的管理者練習。舉例來說：
<example>
$ sudo chown -R <var>myself</var>:<var>mygrp</var> .
</example>
<p>
如果你擁有 root 密碼，那麼你能以 root 權限來執行任何命令：
<example>
$ su -c "shutdown -h now"
Password:
</example>
(我知道我應該要加強管理者帳號的 <prgn>sudo</prgn> 權限。但這是我自家使用的伺服器，所以不用去煩惱這個問題。)
<p>
安裝 <package>super</package> 這個套件能夠讓一般使用者以 root 權限執行特定指令。
</sect1>
    
<sect1 id="tcpd">daemon 存取控制程式
<p>
<em>super-server</em>, <prgn>inetd</prgn>, 在開機時被 <file>/etc/rc2.d/S20inetd</file> (for RUNLEVEL=2)呼叫並啟動，而這個檔案是 <file>/etc/init.d/inetd</file> 的一個 soft link。基本上，<prgn>inetd</prgn> 能啟動和控制其他的服務，減低系統負載度。
<p>
當一個服務對 <prgn>inetd</prgn> 送出需求時，它的通訊協定與服務可以從 <file>/etc/protocols</file> 以及 <file>/etc/services</file> 中找到，然後 <prgn>inetd</prgn> 便會搜尋 <file>/etc/inetd.conf</file> 找到適合的網際網路服務來對應，如果是 Sun-RPC 類型的服務，便會搜尋 <file>/etc/rpc.conf</file> 這一個設定檔。 
<p>
由於系統安全上的考量，請取消 <file>/etc/inetd.conf</file> 中不必要或是不使用的服務。Sun-RPC 服務需要啟動 NFS 以及其他 RPC 為主的程式。
<p>
有些時候，<prgn>inetd</prgn> 並不會直接啟動，而是透過 <prgn>tcpd</prgn> 這個 TCP/IP 服務控制程式並以 <file>/etc/inetd.conf</file> 中已定義的伺服器服務名稱來啟動。這個情況下，<prgn>tcpd</prgn> 在登入以及請求時必須使用 <file>/etc/hosts.deny</file> 以及 <file>/etc/hosts.allow</file> 進行附加的檢查，然後在執行相對應的服務程序。
<p>
如果您在新版的 &debian 上無法進行遠端登入，請將 <file>/etc/hosts.deny</file> 中的 "ALL: PARANOID" 給註解掉。
<p>
想要得知更多的資訊，請閱讀
<manref name="inetd" section="8">,  
<manref name="inetd.conf" section="5">, 
<manref name="protocols" section="5">,  
<manref name="services" section="5">,  
<manref name="tcpd" section="8">,  
<manref name="hosts_access" section="5">, 以及
<manref name="hosts_options" section="5">. 
<p>
有關 Sun-RPC 更多的訊息，請參閱
<manref name="rpcinfo" section="8">, 
<manref name="portmap" section="8">, 以及
<file>&f-portmap;</file>.

<sect1 id="ldap">輕量級的目錄服務
<p>
請參考：
<list compact>
<item><url id="&openldaphome;" name="OpenLDAP">
<item>OpenLDAP Admin Guide in the <package>openldap-guide</package> 套件
<item>LDP: <url id="&ldap-linux-howto;" name="LDAP Linux HOWTO">
<item>LDP: <url id="&ldap-implementation-howto;" name="LDAP Implementation HOWTO">
<item><url id="&ldap-use1;" name="OpenLDAP, extensive use reports">
<item><url id="&ldap-use2;" name="Open LDAP with Courier IMAP and Postfix">
</list>
</sect>


<sect id="cdrw">燒錄器
<p>
ATAPI/IDE 介面的燒錄器是越來越流行了。對於系統備份或是文件容量 &lt 640MB 的家用戶來說可是不錯的選擇。閱讀 LDP <url id="&cd-writing-howto;" name="CD-Writing-HOWTO"> 能夠得到更進階的資訊喔。

<sect1>簡介
<p>
首先，對於光碟片來說，燒錄器將資料寫入光碟片之後，已經無法回覆光碟上的資料。如果預算不是問題，建議直接購買 SCSI 介面的燒錄器來取代 ATAPI/IDE 介面的。如果要連接 IDE 裝置，請使用 PCI 匯流排(例如，在主機板上)而不要使用 ISA 匯流排( SB16 音效卡就是使用它)
<p>
如果您的燒錄器是 IDE 介面且 Kernel 為 2.2 或是 2.4 時，則必須使用 IDE-SCSI 來驅動燒錄功能。所以就必須使用 SCSI 泛型驅動程式。底下有兩種方法可以達成上述功能，假設使用的是較新版本的 Kernel(如 2001 年三月的版本)。
</sect1>

<sect1>方法一：modules + <prgn>lilo</prgn>
<p>
如果您使用的是 Debian 所包裝的 kernel-image，請在 <file>/etc/lilo.conf</file> 中加入以下的字串。如果有多個選項請用空白分開：
<example>
append="hd<var>x</var>=ide-scsi ignore=hd<var>x</var>"
</example>
燒錄器的裝置代號標示法為 <tt>hd<var>x</var></tt>，其中的 <var>x</var> 代表以下的任一種硬體裝置：
<example>
hda          for a master on the first IDE port
hdb          for a slave on the first IDE port
hdc          for a master on the second IDE port
hdd          for a slave on the second IDE port
hde ... hdh  for a drive on an external IDE port or ATA66/100 IDE port
</example>
完成上述設定之後，以 root 權限執行以下的命令：
<example>
# lilo
# shutdown -h now
</example>
</sect1>


<sect1>方法二：recompile the kernel
<p>
Debian 使用 <prgn>make-kpkg</prgn> 來產生 kernel image。執行 <prgn>make-kpkg</prgn> 並加入 <tt>--append_to_version</tt> 的參數能夠建立多種 kernel images。請參閱 <ref id="kernel">。
<p>
執行 <tt>make menuconfig</tt> 加入底下的 kernel 參數與設定：
<list>
<item>bzImage
<item>Exclude the IDE CD driver (not a must, but simpler to do this)
<item>Compile in ide-scsi and sg, or make them modules
</list>
</sect1>

<sect1>設定步驟
<p>
以下的步驟可讓系統在開機時啟動燒錄器：
<example>
# echo ide-scsi &gt;&gt;/etc/modules
# echo sg       &gt;&gt;/etc/modules
# cd /dev; ln -sf scd0 cdrom
</example>
手動啟動可以這樣做：
<example>
# modprobe ide-scsi
# modprobe sg
</example>
重新開機之後，您可以用下列方式檢查：
<example>
$ dmesg|less
# apt-get install cdrecord
# cdrecord -scanbus
</example>
<p>
[Per Warren Dodge] 如果系統同時存在 CD-ROM 以及 CD-R/RW 的話，有時會造成 <tt>ide-scsi</tt> 和 <tt>ide-cd</tt> 的衝突。試著增加底下的設定到 <file>/etc/modutils/aliases</file> 並執行 <prgn>update-modules</prgn> 和重新開機：
<example>
pre-install      ide-scsi      modprobe ide-cd
</example>
這會使得 IDE 驅動程式比 <tt>ide-scsi</tt>  更早載入到核心。<tt>ide-cd</tt> 管理所有的 ATAPI CD-ROM&mdash;被指明忽略的裝置除外。剩下的裝置才由 <tt>ide-scsi</tt> 來控制。
</sect1>

<sect1>光碟映像檔 (可開機)
<p>
如何產生一個 <file>target-directory/</file> 下所有資料的光碟映像檔：<file>cd-image.raw</file>
(可開機, Joliet TRANS.TBL-enabled format; 如果不需要光碟開機，拿掉 <tt>-b</tt> 和 <tt>-c</tt> 參數)？先將一片開機磁片放入軟碟機中並執行
<example>
# dd if=<var>/dev/fd0</var> <var>target-directory/boot.img</var> 
# mkisofs -r -V <var>volume_id</var> -b <var>boot.img</var> -c <var>bootcatalog</var> -J -T \
        -o <var>cd-image.raw</var> <var>target_directory/</var>
</example>
<p>
另一個方法是產生一個開機 DOS 映像檔。假設一個開機片映像檔放在 <file><var>boot.img</var></file> 之下，則當軟碟開機時，CD-ROM 也會被驅動。您可以藉由 freeDOS 來達成這些動作。
<p>
光碟映像檔可以當成 loop 裝置來掛載。
<example>
# mount -t iso9660 -o ro,loop <var>cd-image.raw</var> /cdrom
# cd /cdrom
# mc
# umount /cdrom
</example>
</sect1>

<sect1>寫錄到燒錄機上(R, RW)：
<p>
先測試看看 (假設燒錄速度為兩倍)
<example>
# nice --10 cdrecord -dummy speed=2 dev=0,0 <var>disk.img</var>
</example>
如果無誤，則燒錄到 CD-R 只需執行以下指令
<example>
# nice --10 cdrecord -v -eject speed=2 dev=0,0 <var>disk.img</var>
</example>
或是燒錄到 CD-RW 的片子上
<example>
# nice --10 cdrecord -v -eject blank=fast speed=2 dev=0,0 <var>disk.img</var>
</example>
對於某些 CD-RW 來說，陸續的指令會好
<example>
# nice --10 cdrecord -v blank=all speed=2 dev=0,0 <var>disk.img</var>
</example>
接續如下
<example>
# nice --10 cdrecord -v -eject speed=2 dev=0,0 <var>disk.img</var>
</example>
為了預防清除 CD-RW 光碟片時出現 SCSI timeouts，則以上兩個步驟是必須的。而 <prgn>nice</prgn> 的值需要特別注意。
</sect1>

<sect1>產生一個光碟映像檔
<p>
有些版權光碟具有防拷的保護使得在使用 <prgn>dd</prgn> 時無法正確拷貝 ( Windows 98 便是其中之一 )。
您可以試用 <prgn>readcd</prgn> 這個指令來拷貝，<prgn>readcd</prgn> 包含在 <package>cdrecord</package> 套件之中。利用該軟體來複製光碟大綱以產生映像檔。如果是資料光碟，請先掛載它，並執行 <prgn>df</prgn> 來查詢光碟大小。將得到的 blocks (1 block = 1024 bytes) 數目除以 2 來取得 sector 數目 (1 sector = 2048)。
執行 <prgn>readcd</prgn> 並加入以下參數來建立映像檔並燒錄到 CD-R/RW。
<example>
# readcd dev=<var>target</var>,<var>lun</var>,<var>scsibusno</var> # select function 11
</example> 
大部分來說，只要將以上三個參數皆設為 0 就可以了。通常 <prgn>readcd</prgn> 所檢查出來的 sectors 數目都會過多！所以改用掛載時所產生的 block，sector 數目會比較好。
<p>
<prgn>dd</prgn> 對於光碟複製上可能會有些小問題。第一次執行 <prgn>dd</prgn> 時可能會產生錯誤訊息且映像檔會失去最末端的資料。第二次執行 <prgn>dd</prgn> 時如果沒指定大小，可能會產生過大的映像檔，當然，這些過多的資料都是無用的。目前解決的辦法是在執行第二次 <prgn>dd</prgn> 時指定正確的大小，第一次有錯誤時也不要退出光碟。假設由 <prgn>df</prgn> 查出來的大小為 <tt>46301184</tt> blocks，則執行以下指令兩次來取得正確的映像檔大小。(以我的經驗來說) 
<example>
# dd if=/dev/cdrom of=cd.img bs=2048 count=$((46301184/2))
</example>
</sect1>

<sect1>Debian 光碟映像檔
<p>
您可以在 <url id="&debian-cd;" name="Debian CD site"> 取得最新的 &debian; 光碟訊息。
<p>
如果您有高速網路，則可以考慮網路安裝：
<list compact>
<item>部份 <url id="&debian-floppyinst;" name="floppy images">.
<item>一個 <url id="&debian-netinst;" name="minimal bootable CD image">.
</list>
<p>
如果您的網路不夠快，則可以考慮從 <url id="&debian-venders;" name="CD vendor"> 來購買 &debian; 光碟。
<p>
除非您是映像檔測試者，否者請不要浪費頻寬來下載光碟映像檔(即使是使用 jigdo)。
<p>
另一個值得注意的光碟映像檔為 <url id="&knoppix;" 
name="KNOPPIX - Live Linux Filesystem On CD">。
您可以在光碟開機之後馬上擁有 &debian; 系統而不需安裝到硬碟內。

<!-- old document section
$ export CVSROOT=anonymous@cvs.debian.org:/cvs/debian-boot
$ cvs co debian-cd
</example>
Following is a summary of CD image creation. 
<example>
# apt-get install debian-cd
# cd /etc/debian-cd
# vim CONF.sh
$ . CONF.sh
$ make distclean
$ make status
$ make list COMPLETE=1 SIZELIMIT1=555000000 SRCSIZELIMIT=665000000
$ make official_images
 or if you want only binary images :
$ make bin-official_images
-->
</sect1>

<sect1>備份您的資料到 CD-R
<p>
如何備份重要的資料到 CD-R 呢？您可以採用備份 script <url id="&examples;" name='"backup"'>。也請留意 <ref id="archiving"> 以及 <ref id="diff-backup">。
</sect1>

<sect1>拷貝音樂光碟
<p>
我沒有測試過喔：
<example>
# apt-get install cdrecord cdparanoia
# cdparanoia -s -B
# cdrecord dev=0,0,0 speed=2 -v -dao -eject defpregap=1 -audio *.wav
</example>
或是
<example>
# apt-get install cdrdao #disk at once
# cdrdao read-cd --device /dev/cdrom --paranoia-mode 3 my_cd # read cd
# cdrdao write --device /dev/cdrom --speed 8 my_cd    # write a new CD
</example>
<prgn>cdrdao</prgn> 能夠完整複製光碟(沒有音軌空隙，等...)。
</sect1>
</sect>

<sect id="x">X 應用軟體
<p>
X 環境是由 <url id="&xfree86home;" name="Xfree86"> 所提供的。
在 &debian; 上有兩個主要版本的 X 伺服器：
Xfree86 版本 3.3(XF3) 以及 XFree86 版本 4.x(XF4)；兩者皆是以 X11R6 為基礎並由 <url id="&xorghome;" name="X.Org"> 所建構。
<p>
了解 X 的基本概念，您可以閱讀 <manref name="X" section="7">, LDP <url id="&xwindowuser-howto;" name="XWindow-User-HOWTO">, 以及 <url id="&remote-xapps-howto;" name="Remote X Apps mini-HOWTO">。
您可以閱讀 <package>xfree86-common</package> 套件中的 <file>&f-x-deb-faq;</file>，這是專對於 &debian; 的設計的使用者指南。其中 Branden Robinson 有一些有趣並且有權威的對 key binding 的討論。
<p>
<taglist>
<tag><ref id="xsrvr">
<item>此軟體將本地端主機的 X window 視窗或桌面顯示到使用者的螢幕(CRT, LCD) 並接受鍵盤與滑鼠的輸入。
<tag><ref id="xclnt">
<item>與 X 相容的應用軟體，可以在本地端或是遠地端的主機執行。
</taglist>
這些正好與一般的 "server" 和 "client" 的觀念相反。
<p>
有幾種方法可以讓 "X server" (顯示端) 接受遠端連線的 "X client" (程式端)：

<list>
<item><prgn>xhost</prgn> 方式
<list compact>
<item>主機列表機制 (很不安全)。
<item>未加密的協定 (易受到網路監聽攻擊)。
<item>如果可以，盡量不要使用。
<item>請參閱 <ref id="xhost"> 以及 <manref name="xhost" section="1x">。
</list>
<item><strong><prgn>xauth</prgn></strong> 方式
<list compact>
<item>MIT magic cookie 機制 (不算安全，但比 <prgn>xhost</prgn> 安全多)。
<item>未加密的協定 (易受到網路監聽攻擊)。
<item>如果是本地端連線，建議採用，比 <prgn>ssh -X</prgn> 更省資源。
<item>請參閱 <ref id="ss-xsu"> 以及 <manref name="xauth" section="1x">。
</list>
<item><prgn>xdm</prgn>, <prgn>wdm</prgn>, <prgn>gdm</prgn>, 
 <prgn>kdm</prgn>, ... 方式
<list compact>
<item>MIT magic cookie 機制 (不算安全，但比 <prgn>xauth</prgn> 安全多)。
<item>請參閱 <manref name="xdm" section="1x"> 以及 <manref name="Xsecurity" section="7"> 來建立簡單的存取權限控制。
<item>請參閱 <manref name="wdm" section="1x">, <manref name="gdm" section="8">, 
 和 <manref name="kdm.options" section="5"> 了解更多資訊。
<item>請閱讀 <ref id="sys-v"> 來了解如何在不刪除 <prgn>xdm</prgn> 套件時取消 <prgn>xdm</prgn> 並回到系統啟動的終端機畫面。
</list>
<item><strong><prgn>ssh -X</prgn></strong> 方式
<list compact>
<item>透過安全 shell 埠號轉送機制 (<strong>很安全</strong>)。
<item>加密的傳輸協定 (對於本地端使用簡直是浪費)。
<item>當遠端連線時，建議採用。
<item>請閱讀 <ref id="xssh">。
</list>
</list>
以上所有遠地端連接 X 的方式，除了 <prgn>ssh</prgn> 之外，都需要設定 X server 啟動 TCP/IP 連線，請閱讀 <ref id="xtcp">。

<sect1 id="x-system">X 系統套件
<p>
目前在 woody 上已經有許多 meta 套件能降低您安裝 X 系統的難度。
<taglist>
<tag><package>x-window-system-core</package>
<item>
此 metapackage 提供最基本工作站使用的 X Window 系統。它提供了 X 函式，X 伺服器 (<package>xserver-xfree86</package>)，以及一些字型和基本的 X clients 與工具。

<tag><package>x-window-system</package> 
<item>
此 metapackage 提供大部分的 XFree86 計畫的 X Window System 元件，以及一套許多有名的附屬應用程式。(包含了<package>x-window-system-core</package>、<package>twm</package>和<package>xdm</package>等組件，故安裝了它就不用再安裝<package>x-window-system-core</package>了)

<tag><package>xserver-common-v3</package> 
<item>
XFree86 3.x X 伺服器（X3）相關的軟體和工具。

<tag><package>xserver-*</package> 
<item>
X3伺服器器軟體的額外套件，包含了支援對那些新的 X4 伺服器不支援的硬體。如X4不支援某些老舊的ATI mach64卡，某些顯示卡在Woody版的X4中無法工作等等。（要獲得可用的套件，可執行 <tt>apt-cache search xserver-|less</tt>。所有這些X3伺服器均是基於<package>xserver-common-v3</package>的。）
</taglist>
<p>
大多數情況下，應該安裝<package>x-window-system</package>（如果要使用終端模式登入，需停用<package>xdm</package>，詳細方法參閱 <ref id="no-x-start">。）

<sect1 id="hdetect-x">X 伺服器的硬體偵測軟體
<p>
在安裝系統之前只要先安裝以下軟體就能在配置 X 時偵測週邊硬體：
<list>
<item><package>discover</package> &ndash; 硬體偵測系統。
<item><package>mdetect</package> &ndash; 滑鼠自動偵測工具。
<item><package>read-edid</package> &ndash; hardware information-gathering 
 tool for VESA PnP monitors.
</list>

<sect1 id="xsrvr">X server
<p>
See <manref name="XFree86" section="1x"> for X server information.
<p>
Invoke X server from a local console:
<example>
$ startx -- :&lt;display&gt; <var>vtXX</var>
e.g.:
$ startx -- :1 vt8 -bpp 16
... start on vt8 connected to localhost:1 with 16 bpp mode
</example>
Arguments given after <tt>--</tt> are for the X server.
<p>
Note, when using a <file>~/.xserverrc</file> script to customize the X
server startup process, be sure to  <tt>exec</tt> the real X server.
Failing to do this can make the X server slow to start and exit. For
example:
<example>
#!/bin/sh
exec /usr/bin/X11/X -dpi 100 -nolisten tcp
</example>

<sect2 id="config-x4">Configure an XF4 server
<p>
To (re-)configure an XF4 server,
<example>
# dpkg-reconfigure --priority=low xserver-common
# dpkg-reconfigure --priority=low xserver-xfree86
</example>
will generate <file>/etc/X11/XF86Config-4</file> file 
and configure X using the script <prgn>dexconf</prgn>.

<sect2 id="config-x3">Configure an XF3 server
<p>
To (re-)configure an XF3 server,
<example>
# dpkg-reconfigure --priority=low xserver-common-v3
# dpkg-reconfigure --priority=low xserver-mach64
</example>
will generate <file>/etc/X11/XF86Config</file> file 
and configure X using the script <prgn>xf86config-v3</prgn>.

<sect2 id="manual-config-x">Manually configure an X server
<p>
To add user customizations, <strong>do not edit the configuration file 
between the text</strong> (this is XF4):
<!-- FIXME for XF3 -->
<example>
### BEGIN DEBCONF SECTION
[snip]
### END DEBCONF SECTION
</example>
<p>
Instead, <strong>add the customizations before the text</strong>.  For example, to use a custom
video device, add something resembling the following text to the <em>top</em>
of the file:
<example>
Section "Device"
  Identifier        "Custom Device"
  Driver            "ati"
  Option            "NoAccel"
EndSection

Section "Screen"
  Identifier  "Custom Screen"
  Device      "Custom Device"
  Monitor     "Generic Monitor"
  DefaultDepth 24
  Subsection "Display"
    Depth       8
    Modes       "1280x960" "1152x864" "1024x768" "800x600" "640x480"
  EndSubsection
  Subsection "Display"
    Depth       16
    Modes       "1280x960" "1152x864" "1024x768" "800x600" "640x480"
  EndSubsection
  Subsection "Display"
    Depth       24
    Modes       "1280x960" "1152x864" "1024x768" "800x600" "640x480"
  EndSubsection
EndSection

Section "ServerLayout"
    Identifier        "Custom"
    Screen            "Custom Screen"
    InputDevice       "Generic Keyboard" "CoreKeyboard"
    InputDevice       "Configured Mouse" "CorePointer"
EndSection
</example>

<sect1 id="xclnt">X client
<p>
Most X client programs can be started with a command like this:
<example>
client $ xterm -geometry 80x24+30+200 -fn 6x10 -display <var>hostname</var>:0 &amp;
</example>
Here, the optional command-line arguments mean:
<list>
<item><tt>-geometry <var>WIDTH</var>x<var>HEIGHT</var>+<var>XOFF</var>+<var>YOFF</var></tt>: 
the initial size and location of the window.

<item><tt>-fn <var>FONTNAME</var></tt>: the font to use for displaying text.
 <tt><var>FONTNAME</var></tt> can be:
<list compact>
<item>a14: Normal size font
<item>a24: Large size font
<item>... (check available fonts with <tt>xlsfont</tt>.)
</list>
<item><tt>-display <var>displayname</var></tt>: the name of the X server to use. 
 <tt><var>displayname</var></tt> can be:
<list compact>
<item><tt><var>hostname</var>:<var>D.S</var></tt> means screen <tt><var>S</var></tt> on display
 <tt><var>D</var></tt> of host <tt><var>hostname</var></tt>; the X server for this display is
listening to TCP port 6000+D.

<item><tt><var>host</var>/unix:<var>D.S</var></tt> means screen <tt><var>S</var></tt> on display 
<var>D</var> of host <tt><var>host</var></tt>; the X server for this display is 
listening to UNIX domain socket
<file>/tmp/.X11-unix/XD</file> (so it's only reachable from <tt><var>host</var></tt>).

<item><tt><var>:D.S</var></tt> is equivalent to 
<tt><var>host</var>/unix:<var>D.S</var></tt>, where <tt><var>host</var></tt> is the local hostname.
</list>
</list>
<p>
The default <tt><var>displayname</var></tt> for the X client program (application side) 
can be set by the DISPLAY environment variable.  For example, prior to 
running an X client program, executing one of the following commands 
achieves this:
<example>
$ export DISPLAY=:0 
        # The default, local machine using the first X screen
$ export DISPLAY=<var>hostname.fulldomain.name</var>:0.2
$ export DISPLAY=localhost:0
</example>
Its startup can be customized by <file>~/.xinitrc</file>.  For example:
<example>
xrdb -load $HOME/.Xresources
xsetroot -solid gray &amp;
xclock -g 50x50-0+0 -bw 0 &amp;
xload -g 50x50-50+0 -bw 0 &amp;
xterm -g 80x24+0+0 &amp;
xterm -g 80x24+0-0 &amp;
twm
</example>
As described in <ref id="custom-x">, this overrides everything normal 
execution of <prgn>Xsession</prgn> does when started from <prgn>startx</prgn>.
Use <file>~/.xsession</file> instead and use this approach only as the 
last resort.
</sect1>

<sect1 id="x-session">X session
<p>
An X session (X server + X client) can be started by:
<list compact>
<item><prgn>startx</prgn>: wrapper script command for <prgn>initx</prgn> to
      start an X server and client from a Linux character console.   If
      <file>~/.xinitrc</file> does not exist, <file>/etc/X11/Xsession</file> is
      executed through <file>/etc/X11/xinit/xinitrc</file>.
<item><prgn>xdm</prgn>, <prgn>gdm</prgn>, <prgn>kdm</prgn>, or
      <prgn>wdm</prgn>: X display manager daemons to start the X server and
      client, and to control login via a GUI screen.  
      <file>/etc/X11/Xsession</file> is directly executed.
</list>
The console can be made available as in <ref id="no-x-start">.

<sect2 id="custom-x">Custom X session
<p>
The default startup script <file>/etc/X11/Xsession</file> is 
effectively a combination of
<file>/etc/X11/Xsession.d/50xfree86-common_determine-startup</file> and
<file>/etc/X11/Xsession.d/99xfree86-common_start</file>.
<p>
Execution of <file>/etc/X11/Xsession</file> is somewhat affected by 
<file>/etc/X11/Xsession.options</file> and is essentially an execution
of a program which was first found in the following order with the 
<prgn>exec</prgn> command:
<enumlist compact>
<item><file>~/.xsession</file> or <file>~/.Xsession</file>, if it is defined.
<item><file>/usr/bin/x-session-manager</file>, if it is defined.
<item><file>/usr/bin/x-window-manager</file>, if it is defined.
<item><file>/usr/bin/x-terminal-emulator</file>, if it is defined.
</enumlist>
<p>
The exact meaning of these commands is determined by the &debian; 
alternative system described in <ref id="alternatives">.
For example:
<example>
# update-alternatives --config x-session-manager
... or
# update-alternatives --config x-window-manager
</example>
In order to make any X window manager a default while keeping GNOME
and KDE session managers installed, replace
<file>/etc/X11/Xsession.d/50xfree86-common_determine-startup</file>
with the one attached in the second bug report at 
<url id="&bug-xfree;"> (I hope this will be included soon)
and edit <file>/etc/X11/Xsession.options</file> as follows to disallow 
the X session manager:
<example>
# /etc/X11/Xsession.options
#
# configuration options for /etc/X11/Xsession
# See Xsession.options(5) for an explanation of the available options.
# Default enabled
allow-failsafe
allow-user-resources
allow-user-xsession
use-ssh-agent
# Default disabled (enable them by uncommenting)
do-not-use-x-session-manager
#do-not-use-x-window-manager
</example>
<p>
Without the abovementioned modification to the system,
<package>gnome-session</package> and <package>kdebase</package> are 
the packages containing these X session managers.  Removing them allows
X window manager to be a default. (Yack, any better idea?)
<p>
On a system where <file>/etc/X11/Xsession.options</file> contains
a line <tt>allow-user-xsession</tt> without preceding characters,
any user who defines <file>~/.xsession</file> or <file>~/.Xsession</file>
will be able to customize the action of <file>/etc/X11/Xsession</file>.
<p>
The last command in the <file>~/.xsession</file> file should use form of 
<tt>exec <var>some-window/session-manager</var></tt> to start
your favorite X window/session manager.
<p>
A good example of an <file>~/.xsession</file> script is given at
<file>&f-xsession;</file>.
<p>
I use this to set the window manager, screen access, and language support for
each user account. See <ref id="s-w-manager">, <ref id="ss-xsu">, and
<ref id="x-cjk">.
<p>
User-specific additional X resources can be stored in
<file>~/.Xresources</file>, while system-wide X resources are stored in
<file>/etc/X11/Xresources/*</file>.  See <manref name="xrdb"
section="1x">.
<p>
User-customized keymaps and pointer button mappings in X can be specified 
in <file>~/.xmodmaprc</file>.  See <manref name="xmodmap" section="1x">.

<sect2 id="s-w-manager">Start a particular X session/window manager
<p>
Following the principle described at <ref id="custom-x">,
a user-specific X session/window manager can be activated by installing
the package indicated and setting the contents at the end of 
<file>~/.xsession</file> file as follows.
(I like <package>blackbox</package>/<package>fluxbox</package> for its 
simple style and fast speed.):

<list>
<item>default X session manager 
<list compact>
<item>See <ref id="alternatives">
<item><tt>exec /usr/bin/x-session-manager</tt>
</list>
<item>default X window manager 
<list compact>
<item>See <ref id="alternatives">
<item><tt>exec /usr/bin/x-window-manager</tt>
</list>

<item>GNOME session manager (loaded)
<list compact>
<item>Install package: <package>gnome-session</package>
<item><tt>exec /usr/bin/gnome-session</tt>
</list>

<item>KDE session manager (loaded)
<list compact>
<item>Install package: <package>kdebase</package> (or 
<package>kdebase3</package> for KDE3)
<item><tt>exec /usr/bin/kde2</tt>
</list>

<item>Blackbox window manager (lightweight, slick)
<list compact>
<item>Install package: <package>blackbox</package>
<item><tt>exec /usr/bin/blackbox</tt>
</list>

<item>Fluxbox window manager (lightweight, new blackbox)
<list compact>
<item>Install package: <package>fluxbox</package>
<item><tt>exec /usr/bin/fluxbox</tt>
</list>

<item>Xfce window manager (Mac OS-X, SUN CDE&ndash;like)
<list compact>
<item>Install package: <package>xfce</package>
<item><tt>exec /usr/bin/xfwm</tt>
</list>

<item>IceWM window manager (lightweight, GNOME alternative)
<list compact>
<item>Install package: <package>icewm</package>
<item><tt>exec /usr/bin/X11/icewm</tt>
</list>

<item>FVWM2 virtual window manager (lightweight, Win95-like)
<list compact>
<item>Install package: <package>fvwm</package>
<item><tt>exec /usr/bin/fvwm2</tt>
</list>

<item>Windowmaker window manager (somewhat NexT-like)
<list compact>
<item>Install package: <package>wmaker</package>
<item><tt>exec /usr/bin/wmaker</tt>
</list>

<item>Enlightenment window manager (loaded)
<list compact>
<item>Install package: <package>enlightenment</package>
<item><tt>exec /usr/bin/enlightenment</tt>
</list>

</list>
See <url id="&windomanagerhome;" name="Window Managers for X">.


<sect2 id="kde-gnome">Set up a KDE/GNOME environment
<p>
In order to setup full KDE or GNOME environment, the following 
metapackages are  useful:
<list>
<item>KDE: install the <package>kde</package> package
<item>GNOME: install the <package>gnome</package> package
</list>
Installing these packages with tools which handle <tt>recommends</tt>,
such as <prgn>dselect</prgn> and <prgn>aptitude</prgn>, provides you 
with richer choices of software than just installing these with 
<prgn>apt-get</prgn>.
<p>
If you want console login, be sure to disable X display managers,
such as <package>kdm</package>, <package>gdm</package>, and 
<package>wdm</package>, which may be pulled in by the dependencies, 
as described in <ref id="no-x-start">.
<p>
If you want to have GNOME as the system default over KDE, make sure to
configure <prgn>x-session-manager</prgn> as in <ref id="alternatives">.

<sect1 id="xtcp">TCP/IP connection to X
<p>
Because a remote TCP/IP socket connection without encryption is prone 
to an eavesdropping attack, the default setting for X in recent 
&debian; versions disables the TCP/IP socket.  Consider using <prgn>ssh</prgn> 
for a remote X connection (see <ref id="xssh">). 
<p>
The method described here is not encouraged unless one is in a very secure 
environment behind a good firewall system with only trusted users present.
Use the following command to verify your current X server setting for the
TCP/IP socket:
<example>
# find /etc/X11 -type f -print0 | xargs -0 grep nolisten
/etc/X11/xinit/xserverrc:exec /usr/bin/X11/X -dpi 100 -nolisten tcp
</example>
Remove <tt>-nolisten</tt> to restore TCP/IP listening on the X server.
</sect1>
 
<sect1 id="xhost">Remote X connection: <prgn>xhost</prgn>
<p>
<prgn>xhost</prgn> allows access based on hostnames. This is very insecure.
The following will disable host checking and allow connections from anywhere 
if a TCP/IP socket connection is allowed (see <ref id="xtcp">):
<example>
$ xhost +
</example>
You can re-enable host checking with:
<example>
$ xhost -
</example>
<p>
<prgn>xhost</prgn> does not distinguish between different users on the 
remote host. Also, hostnames (addresses actually) can be spoofed. 
<p>
This method must be avoided even with more restrictive host criteria
if you're on an untrusted network (for instance with dialup PPP
access to the Internet).  See <manref name="xhost" section="1x">.
</sect1>

<sect1 id="xssh">Remote X connection: <prgn>ssh</prgn>
<p>
The use of <prgn>ssh</prgn> enables a secure connection from a local X server 
to a remote application server.  
<list>
<item>Set <tt>X11Forwarding</tt> and <tt>AllowTcpForwarding</tt> entries 
to <tt>yes</tt> in <file>/etc/ssh/sshd_config</file> of the remote host,
if you want to avoid corresponding command-line options.
<item>Start the X server on the local host.
<item>Open an <prgn>xterm</prgn> in the local host.
<item>Run <prgn>ssh</prgn> to establish a connection with the remote site.  
<example>
localname @ localhost $ ssh -q -X -l loginname remotehost.domain
Password:
.....
</example>
<item>Run X application commands on the remote site.
<example>
loginname @ remotehost $ gimp &
</example>
</list>
This method allows the display of the remote X client output as if it 
were locally connected through a local UNIX domain socket.
</sect1>

<sect1 id="xtermfaq"><prgn>xterm</prgn>
<p>
Learn everything about <prgn>xterm</prgn> at <url id="&xtermfaq;">.
</sect1>

<sect1 id="xresources">X resource database
<p>
Many older X programs, such as <prgn>xterm</prgn>, use the X resource database
to configure their appearance.  The file <file>~/.Xresources</file> is used
to store user resource specifications.  This file is automatically
merged into the default X resources upon login.
<p>
Here are some helpful settings to add to your
<file>~/.Xresources</file> file:
<example>
! Set the font to a more readable 9x15
XTerm*font: 9x15

! Display a scrollbar
XTerm*scrollBar: true

! Set the size of the buffer to 1000 lines
XTerm*saveLines: 1000
</example>
To make these settings take effect immediately, merge them into the
database using the command:
<example>
xrdb -merge ~/.Xresources
</example>

<sect1 id="ss-xsu">Gain root in X
<p>
If a GUI program needs to be run with root privilege, use the following
procedures to display program output on a user's X server.
<strong>Never attempt to start an X server directly from the root
account</strong> in order to avoid possible security risks.
<p>
Start the X server as a normal user and open an <prgn>xterm</prgn> console.
Then:
<example>
$ XAUTHORITY=$HOME/.Xauthority
$ export XAUTHORITY
$ su root
Password:*****
# printtool &
</example>
When using this trick to <prgn>su</prgn> to a non-root user, make
sure <file>~/.Xauthority</file> is group readable by this non-root user.
<p>

<!-- this section moved up -->

To automate this command sequence, create a file
<file>~/.xsession</file> from the user's account, containing the following
lines:
<example>
# This makes X work when I su to the root account.
if [ -z "$XAUTHORITY" ]; then
        XAUTHORITY=$HOME/.Xauthority
        export XAUTHORITY
fi
unset XSTARTUP
# If a particular window/session manager is desired, uncomment
# the following and edit it to fit your needs.
#XSTARTUP=/usr/bin/blackbox
# This starts x-window/session-manager program
if [ -z "$XSTARTUP" ]; then
  if [ -x /usr/bin/x-session-manager ]; then
    XSTARTUP=x-session-manager
  elif [ -x /usr/bin/x-window-manager ]; then
    XSTARTUP=x-window-manager
  elif [ -x /usr/bin/x-terminal-emulator ]; then
    XSTARTUP=x-terminal-emulator
  fi
fi
# execute autoselected X window/session manager
exec $XSTARTUP
</example>
Then run <prgn>su</prgn> (not <tt>su -</tt>) in an
<prgn>xterm</prgn> window of the user.  Now GUI programs started from this
<prgn>xterm</prgn> can display output on this user's X window while running
with root privilege.  This trick works as long as the default 
<file>/etc/X11/Xsession</file> is
executed.  If a user set up his customization using <file>~/.xinit</file>
or <file>~/.xsession</file>, the abovementioned environment
variable <tt>XAUTHORITY</tt> needs to be set similarly in those scripts.

<p>Alternatively, <package>sudo</package> can be used to automate the command sequence:
<example>
$ sudo xterm
... or
$ sudo -H -s
</example>
Here <file>/root/.bashrc</file> should contain:
<example>
if [ $SUDO_USER ]; then
    sudo -H -u $SUDO_USER xauth extract - $DISPLAY | xauth merge -
fi
</example>
This works fine even with the home directory of the user on an NFS
mount, because root does not read the <file>.Xauthority</file> file.
<p>
There are also several specialized packages for this purpose:
<package>kdesu</package>, <package>gksu</package>, <package>gksudo</package>,
<package>gnome-sudo</package>, and <package>xsu</package>.  Some
other methods can be used to achieve similar results: creating a symlink from
<file>/root/.Xauthority</file> to the user's corresponding one; use of the
script <url id="&suxhome;" name="sux">; or putting "<tt>xauth merge
~<var>USER_RUNNING_X</var>/.Xauthority</tt>" in the root initialization script.
<p>
See more on the <url id="&deb-dev-su;" name="debian-devel mailing list">.
</sect1>

<sect1 id="xfs-tt">TrueType fonts in X
<p>
The standard <prgn>xfs</prgn> in XFree86-4 works fine with TrueType
fonts.  You have to install a third-party font server such as
<prgn>xfs-xtt</prgn>, if you are using XFree86-3.
<p>
You just need to make sure that whatever apps you want to use the
TrueType fonts are linked against libXft or libfreetype (you probably
don't even have to worry about this if you're using precompiled
.debs).
<p>
Remember to install required font files and generate the 
<file>fonts.{scale,dir}</file> files so that the fonts can be indexed
and used.
<p>
Since <strong>Free</strong> fonts are sometimes limited, installing
or sharing some commercial TrueType fonts is an option for a &debian;
users. In order to make this process easy for the user, 
some convenience packages have been created:
<list compact>
<item><package>ttf-commercial</package>
<item><package>msttcorefonts (>1.1.0)</package> (The package in Woody does 
 not work as of 8/2002 due to a change in Microsoft's website.)
</list>
You'll have a really good selection of TT fonts at the expense of
contaminating your <strong>Free</strong> system with non-Free fonts.

<sect1 id="ss-browser">Web Browser (graphical)
<p>
There are a few web browser packages with graphical display capabilities
as of the Woody release:
<list compact>
<item><package>mozilla</package> The Mozilla browser (new)
<item><package>galeon</package> Mozilla-based browser with a Gnome UI (new)
<item><package>konqueror</package> KDE browser
<item><package>dillo</package> GTK browser
<item><package>amaya-gtk</package> W3C reference browser
<item><package>amaya-lesstif</package> W3C reference browser
<item><package>netscape-...</package> (many, old)
<item><package>communicator-...</package> (many, old)
<item>...
</list>
The version of <package>mozilla</package> must match 
the version that <package>galeon</package> requires.  Although they differ in
UI, these two programs share the Gecko HTML rendering engine.
<p>
Plug-ins for browsers such as <package>mozilla</package> and
<package>galeon</package> can be enabled by installing "<tt>*.so</tt>" 
manually in the plug-in directory and restarting the browsers.
<p>
Plug-in resources:
<list compact>
<item>Java plug-in: install binary "J2SE" from <url id="&javasunhome;">.
<item>Flash plug-in: install binary "Macromedia Flash Player 5" from
 <url id="&flashhome;">.
<item><package>freewrl</package>: VRML browser and Netscape plug-in
<item>...
</list>
</sect1>

<!-- CJK and X moved to bottom with different name to locale section -->

</sect>

<sect id="ssh">SSH
<p>
SSH (Secure SHell) is the secure way to connect over the Internet.  A free
version of SSH called OpenSSH is available as the <package>ssh</package>
package in &debian;.

<sect1 id="ssh-basics">Basics
<p>
First install the OpenSSH server and client.
<example>
# apt-get update && apt-get install ssh
</example>
The non-US entry in the <file>/etc/apt/source.list</file> is required.
<file>/etc/ssh/sshd_not_to_be_run</file> must not be present if one wishes to 
run the OpenSSH server.
<p>
SSH has two authentication protocols:
<list>
<item>SSH protocol version 1: 
 <list compact>
<item>Potato version only supports this protocol.
<item>available authentication methods:
  <list compact>
<item>RSAAuthentication: RSA identity key based user authentication
<item>RhostsAuthentication: .rhosts based host authentication 
 (insecure, disabled)
<item>RhostsRSAAuthentication: .rhosts authentication combined with 
 RSA host key (disabled)
<item>ChallengeResponseAuthentication: RSA challenge-response authentication
<item>PasswordAuthentication: password based authentication
  </list>
 </list>
<item>SSH protocol version 2: 
 <list compact>
<item>post-Woody versions use this as the primary protocol.
<item>available authentication methods:
  <list compact>
<item>PubkeyAuthentication: public key based user authentication
<item>HostbasedAuthentication: <file>.rhosts</file> or
 <file>/etc/hosts.equiv</file> authentication 
 combined with public key client host authentication  (disabled)
<item>ChallengeResponseAuthentication: challenge-response authentication
<item>PasswordAuthentication: password based authentication
  </list>
 </list>
</list>

<p>
Be careful about these differences if you are migrating to Woody or using 
a non-&debian; system.  
<p>
See <file>/usr/share/doc/ssh/README.Debian.gz</file>,
<manref name="ssh" section="1">, 
<manref name="sshd" section="8">,
<manref name="ssh-agent" section="1">, and
<manref name="ssh-keygen" section="1"> for details.

<p>
Following are the key configuration files:

<list>

<item><file>/etc/ssh/ssh_config</file>: SSH client defaults.
 See <manref name="ssh" section="1">.  Notable entries are:

 <list compact>
<item><tt>Host</tt>: Restricts the following declarations 
  (up to the next Host keyword) to be only for those hosts 
   that match one of the patterns given after the keyword.
<item><tt>Protocol</tt>: Specifies the SSH protocol versions.  
 The default is "2,1".
<item><tt>PreferredAuthentications</tt>: Specifies the SSH2 client 
 authentication method.  The default is 
"hostbased,publickey,keyboard-interactive,password".
<item><tt>PasswordAuthentication</tt>: If you want to log in with 
 a password, you have to make sure this is not set <tt>no</tt>.
<item><tt>ForwardX11</tt>: The default is disabled.  This can be
 overridden by the command-line option "<tt>-X</tt>".
 </list>

<item><file>/etc/ssh/sshd_config</file>: SSH server defaults.
 See <manref name="sshd" section="8">.  Notable entries are:

 <list compact>
<item><tt>ListenAddress</tt>: Specifies the local addresses 
 <prgn>sshd</prgn> should listen on. Multiple options are permitted.
<item><tt>AllowTcpForwarding</tt>: The default is disabled.  
<item><tt>X11Forwarding</tt>: The default is disabled.  
 </list>

<item><file>$HOME/.ssh/authorized_keys</file>: the lists of the default 
public keys that clients use to connect to this account on this host.
See <manref name="ssh-keygen" section="1">.

<item><file>$HOME/.ssh/identity</file>: 
See <manref name="ssh-add" section="1">
and <manref name="ssh-agent" section="1">.
</list>

<p>
The following will start an <prgn>ssh</prgn> connection from a client.
<example>
$ ssh username@hostname.domain.ext
$ ssh -1 username@hostname.domain.ext # Force SSH version 1
$ ssh -1 -o RSAAuthentication=no -l username foo.host
    # force password on SSH1
$ ssh -o PreferredAuthentications=password -l username foo.host
    # force password on SSH2
</example>
For the user, <prgn>ssh</prgn> functions as a smarter and more secure 
<prgn>telnet</prgn> (will not bomb with ^]).

</sect1>

<sect1 id="ssh-forward">Port forwarding &ndash; for SMTP/POP3 tunneling
<p>
To establish a pipe to connect to port 25 of <var>remote-server</var> from port 4025 of
localhost, and to port 110 of <var>remote-server</var> from port 4110 of localhost
through <prgn>ssh</prgn>, execute on the local machine:
<example>
# ssh -q -L 4025:remote-server:25 4110:remote-server:110 \
           username@remote-server
</example>
This is a secure way to make connections to SMTP/POP3 servers over the Internet.
Set the <tt>AllowTcpForwarding</tt> entry to <tt>yes</tt> in 
<file>/etc/ssh/sshd_config</file> of the remote host.
</sect1>

<sect1 id="ssh-rsa">Connect with fewer passwords
<p>
One can avoid having to remember a password for each remote system by using
RSAAuthentication (SSH1 protocol) or PubkeyAuthentication (SSH2 protocol).  
<p>
On the remote system, set the respective entries,
"RSAAuthentication yes" or "PubkeyAuthentication yes", in 
<file>/etc/ssh/sshd_config</file>.
<p>
Then generate authentication keys locally and install the public key
on the remote system:
<example>
$ ssh-keygen          # RSAAuthentication: RSA1 key for SSH1
$ cat .ssh/identity.pub | ssh user1@remote \
        "cat - &gt;&gt;.ssh/authorized_keys"
...
$ ssh-keygen -t rsa   # PubkeyAuthentication: RSA key for SSH2
$ cat .ssh/id_rsa.pub | ssh user1@remote \
        "cat - &gt;&gt;.ssh/authorized_keys"
...
$ ssh-keygen -t dsa   # PubkeyAuthentication: DSA key for SSH2
$ cat .ssh/id_dsa.pub | ssh user1@remote \
        "cat - &gt;&gt;.ssh/authorized_keys"
</example>
One can change the passphrase later with "<tt>ssh-keygen -p</tt>".
Make sure to verify settings by testing the connection.  In case of any
problem, use "<tt>ssh -v</tt>".
<p>
You can add options to the entries in <prgn>authorized_keys</prgn> to limit
hosts and to run specific commands. See <manref name="sshd" section="8"> for details.
<p>
Note that SSH2 has <tt>HostbasedAuthentication</tt>. For this to work, 
you must adjust the settings of <tt>HostbasedAuthentication</tt> to <tt>yes</tt> in 
both <file>/etc/ssh/sshd_config</file> on the server machine and 
<file>/etc/ssh/ssh_config</file> or <file>$HOME/.ssh/config</file> on 
the client machine.
</sect1>

<sect1 id="ssh-client">Foreign SSH clients
<p>
There are a few free SSH clients available for non-Unix-like platforms.
<taglist>
<tag>Windows
<item><url id="&puttyhome;" name="puTTY"> (GPL)
<tag>Windows (cygwin)
<item>SSH in <url id="&cygwinhome;" name="cygwin"> (GPL)
<tag>Macintosh Classic
<item><url id="&macsshhome;" name="macSSH"> (GPL) [Note that Mac OS X
  includes OpenSSH; use <tt>ssh</tt> in the Terminal application]
</taglist>
See also <url id="&sfdochome;" name="SourceForge.net, site documentation">, 
"6. CVS Instructions".

<sect1 id="ssh-agent">SSH agent
<p>
It is safer to protect your SSH authentication key with a passphrase.
If it was not set, use <tt>ssh-keygen -p</tt> to set it.
<p>
Place your public key (e.g. <file>~/.ssh/id_rsa.pub</file>) 
into <file>~/.ssh/authorized_keys</file> on a remote host using
a password-based connection to the remote host as described in
<ref id="ssh-rsa">.
<example>
$ ssh-agent bash # or run zsh/tcsh/pdksh program instead.
$ ssh-add ~/.ssh/id_rsa
Enter passphrase for /home/osamu/.ssh/id_rsa:
Identity added: /home/osamu/.ssh/id_rsa (/home/osamu/.ssh/id_rsa)
$ scp <var>foo</var> <var>user@remote.host:foo</var>
 ... no passphrase needed from here on :-)
$^D
 ... terminating ssh-agent session
</example>
For the X server, normal &debian; startup scripts execute 
<prgn>ssh-agent</prgn> as parent process.  So you only need to execute 
<prgn>ssh-add</prgn> once.
<p>
For more, read <manref name="ssh-agent" section="1">and
<manref name="ssh-add" section="1">.
</sect1>

<sect1 id="ssh-trouble">Troubleshooting
<p>
If you have problems, check the permissions of configuration files and run
<prgn>ssh</prgn> with the "<tt>-v</tt>" option.
<p>
Use the "<tt>-P</tt>" option if you are root and have trouble with a firewall;
this avoids the use of server ports 1&ndash;1023.
<p>
If <prgn>ssh</prgn> connections to a remote site suddenly stop working, it may be the
result of tinkering by the sysadmin, most likely a change in
<prgn>host_key</prgn> during system maintenance.  After making sure this is
the case and nobody is trying to fake the remote host by some clever hack, one
can regain a connection by removing the <prgn>host_key</prgn> entry from
<file>$HOME/.ssh/known_hosts</file> on the local machine.
</sect1>

</sect>

<sect id="mail">Mail programs
<p>
Mail configuration divides into three categories:
<list>
<item>mail transfer agent (MTA): <prgn>exim</prgn>, <prgn>postfix</prgn>, 
 <prgn>sendmail</prgn>, <prgn>qmail</prgn>, <prgn>ssmtp</prgn>,
 <prgn>nullmailer</prgn>, ...
<item>mail utilities: <prgn>procmail</prgn>, <prgn>fetchmail</prgn>,
<prgn>mailx</prgn>, ...
<item>mail user agent (MUA): <prgn>mutt</prgn>,
<prgn>emacs</prgn>+<prgn>gnus</prgn>, ...
</list>

<sect1>Mail transport agent (MTA)
<p>
For a full-featured MTA, use <package>exim</package>. References:
<list compact>
<item><package>exim-doc</package> and <package>exim-doc-html</package> packages
<item><url id="&eximhome;">
</list>
The only reasonable alternative MTA is <package>postfix</package> if you
care about security. <package>sendmail</package> and
<package>qmail</package> are available as &debian; packages but are not
recommended. 
<p>
If you do not need the relay capability of an MTA as in the case of a
satellite system such as a laptop PC, you may consider using one of these 
lightweight packages:
<list compact>
<item><prgn>ssmtp</prgn>: needs an SMTP connection and is alias-capable, or
<item><prgn>nullmailer</prgn>: can spool but is not alias-capable.
</list>
At this moment, I find <prgn>exim</prgn> to be more suitable even for
my personal workstation machine, which is a laptop PC.
<p>
You may need to remove <prgn>exim</prgn> for the installation of 
these conflicting packages:
<example>
# dpkg -P --force-depends exim
# apt-get install nullmailer         # or ssmtp
</example> 

<sect2>Basic configuration of Exim
<p>
In order to use <prgn>exim</prgn> as your MTA, configure the following:
<example>
/etc/exim/exim.conf     "eximconfig" to create and edit
/etc/inetd.conf         comment out smtp to run exim as daemon
/etc/email-addresses    Add spoofed source address lists
check filters using exim -brw, -bf, -bF, -bV, ... etc.
</example>

<sect2>A catchall for nonexistent email addresses (Exim)
<p>
In <file>/etc/exim/exim.conf</file> (Woody or later),
in the DIRECTORS part, at the end (after the localuser: director)
add a catch-all director that matches all addresses that the
previous directors couldn't resolve (per Miquel van Smoorenburg):
<example>
catchall:
  driver = smartuser
    new_address = <var>webmaster@mydomain.com</var>
</example>
<p>
If one wants to have more a detailed recipe for each virtual domain, etc., 
add the following at the end of <file>/etc/exim/exim.conf</file> 
(per me, not well tested):
<example>
*@yourdomain.com ${lookup{$1}lsearch*{/etc/email-addresses} \
        {$value}fail} T
</example>
Then have an "*" entry in <file>/etc/email-addresses</file>.
</sect2>

<sect2>Selective address rewrite for outgoing mail (Exim)
<p>
<!-- Derrick 'dman' Hudson dman@dman.ddts.net -->
Selective address rewrite for outgoing mail to produce
proper "From:" headers can be done using <prgn>exim</prgn>
by configuring near the end of <file>/etc/exim/exim.conf</file>:
<example>
*@host1.something.dyndns.org \
  "${if eq {${lookup{$1}lsearch{/etc/passwd}{1}{0}}} {1}  \
   {$0}{$1@somethig.dyndns.org}}"  frFs
</example>
This rewrites all addresses matching <tt>*@host1.something.dyndns.org</tt>.
<enumlist>
<item>It searches through <file>/etc/password</file> to see if the local part ($1)
   is a local user or not.
<item>If it is a local user, it rewrites the address to the same thing it was in
   the first place ($0).
<item>If it is not a local user, it rewrites the domain part.
</enumlist>

<sect2>SMTP auth with Exim
<p>
Some SMTP services such as yahoo.com require SMTP auth.
Configure <file>/etc/exim/exim.conf</file> as follows:
<example>
remote_smtp:
  driver = smtp
  authenticate_hosts = smtp.mail.yahoo.com
...

smarthost:
  driver = domainlist
  transport = remote_smtp
  route_list = "* smtp.mail.yahoo.com bydns_a"
...

plain:
  driver = plaintext
  public_name = PLAIN
  client_send = "^cmatheson3^this_is_my_password"
</example>
Do not forget double quotes in the last line.

<sect1>Mail utility (Fetchmail)
<p>
<prgn>fetchmail</prgn> is run in daemon mode to fetch mail from a POP3 account
with an ISP into the local mail system.  Configure:
<example>
/etc/init.d/fetchmail   
/etc/rc?.d/???fetchmail run update-rc.d fetchmail default priority 30
/etc/fetchmailrc        configuration file (chown 600, owned by fetchmail)
</example>
<p>
Information on how to start <prgn>fetchmail</prgn> as a daemon from the
<prgn>init.d</prgn> script for Potato is confusing (Woody fixed this). See the
sample <file>/etc/init.d/fetchmail</file> and <file>/etc/fetchmailrc</file>
files in the <url id="&examples;" name="example scripts">.
<p>
If your email headers are contaminated by ^M due to your ISP's mailer, add
"stripcr" to your options in <file>$HOME/.fetchmailrc</file>:
<example>
options fetchall no keep stripcr
</example>
</sect1>

<sect1>Mail utility (Procmail)
<p>
<prgn>procmail</prgn> is a local mail delivery and filter program. One needs to create 
<file>$HOME/.procmailrc</file> for each account that uses it. Example:
<url id="&examples;" name="_procmailrc">
</sect1>

<sect1>Mail user agent (Mutt)
<p>
Use <prgn>mutt</prgn> as the mail user agent (MUA) in combination with
<prgn>vim</prgn>.
Customize with <file>~/.muttrc</file>; for example:

<example>
# use visual mode and "gq" to reformat quotes
set editor="vim -c 'set tw=72 et ft=mail'"
#
# header weeding taken from the manual (Sven's Draconian header weeding)
#
ignore *
unignore from: date subject to cc
unignore user-agent x-mailer
hdr_order from subject to cc date user-agent x-mailer
auto_view application/msword
....
</example>
<p>
Add the following to <file>/etc/mailcap</file> or
<file>$HOME/.mailcap</file> to display HTML mail and MS Word attachments
inline:
<example>
text/html; lynx -force_html &percnt;s; needsterminal;
application/msword; /usr/bin/antiword '&percnt;s'; copiousoutput;
description="Microsoft Word Text"; nametemplate=&percnt;s.doc
</example>

</sect1>

</sect>

<sect id="l10n">Localization and national language support
<p>
&debian; is internationalized, offering support for a growing number of
languages and local usage conventions. The next subsection lists some of the
forms of diversity that &debian; currently supports, and the following
subsections discuss <strong>localization</strong>, the process of customizing
your working environment to allow current input and output of your chosen
language(s) and conventions for dates, numeric and monetary formats, and other
aspects of a system that differ according to your region.

<sect1 id="languages">Customizing basics
<p>
There are several aspects to customizing for localization and national 
language support.

<sect2 id="keyboard">Keyboard
<p>
&debian; is distributed with keymaps for nearly two dozen
keyboards.  In Woody, reconfigure the keyboard by:

<list compact>
<item><tt>dpkg-reconfigure --priority=low console-data # console</tt>
<item><tt>dpkg-reconfigure --priority=low xserver-xfree86   # XF4</tt>
<item><tt>dpkg-reconfigure --priority=low xserver-common-v3 # XF3</tt>
</list>
</sect2>

<sect2 id="data-stream">Data
<p>
The vast majority of Debian software packages support data 
    handling of non-US-ASCII characters through the LC_CTYPE environment 
    variable offered by the <strong>locale</strong> technology in glibc.
   
    <list compact>
    <item>8-bit clean: practically all programs
    <item>other Latin character sets (e.g. ISO-8859-1 or ISO-8859-2): the
                  majority of programs
    <item>multibyte languages such as Chinese, Japanese, or Korean:
                  many new applications
    </list>
</sect2>

<sect2 id="display">Display
<p>
X can display any coding, including UTF-8, and supports all fonts.
The list includes not only all the 8-bit fonts but also 16-bit fonts 
such as Chinese, Japanese, or Korean.  Multibyte character input
method is supported by the XIM mechanism.   See <ref id="x-cjk">.
<p>
Japanese EUC code display is also available in a (S)VGA graphics console
through the <package>kon2</package> package.  There is an alternative new
Japanese display, <package>jfbterm</package>, which uses a frame-buffer
console, too.  In these console environments, the Japanese input method must
be supplied by the application.  Use <package>egg</package> package for Emacs
and use japanized <package>jvim</package> package for a Vim environment.
</sect2>

<sect2 id="translation">Translation
<p>
Translations exist for many of the text messages and documents that
    are displayed in the &debian; system, such as error messages, standard
    program output, menus, and manual pages.
    Currently, support for manual pages in German, Spanish, Finnish, French,
    Hungarian, Italian, Japanese, Korean, Polish, Portuguese, Chinese,
    and Russian is provided through the <tt>manpages-<var>LANG</var></tt>
    packages (where <var>LANG</var> is a comma-separated list of two-letter
    ISO country codes.  Use <tt>apt-cache search manpages-|less</tt> to get a 
    list of available Unix manual pages.)
    <p>
    To access an NLS manual page, the user must set the environment variable
    LC_MESSAGES to the appropriate string. For example, in the case of the 
    Italian-language manual pages,
    LC_MESSAGES needs to be set to <tt>it</tt>.  The <prgn/man/ program will
    then search for Italian manual pages under <file>/usr/share/man/it/</file>.
</sect2>
</sect1>

<sect1 id="locales">Locales
<p>
Debian supports <strong>locale</strong> technology.  Locale is a mechanism
that allows programs to provide suitable output and functionality according to
local conventions such as character set, format for date and time, currency
symbol, and so on. It uses environment variables to determine the appropriate
behavior. For example, assuming you have both the American English and German
locales installed on your system, the error messages of many programs can be
multilingual:
<example>
$ LANG="en_US" cat foo
cat: foo: No such file or directory
$ LANG="de_DE" cat foo
cat: foo: Datei oder Verzeichnis nicht gefunden
</example>
Glibc offers support for this functionality to programs as a library.  See
<manref name="locale" section="7">.

<sect1 id="activate-locales">Activate locale support capability
<p>
&debian; does <strong>not</strong> come with all available
locales precompiled. Check <file>/usr/lib/locale</file> to see which
locales (besides the default "C") are compiled for your system. If the one
you need is not present, you have two options:
<list compact>
 <item>Edit <file>/etc/locale.gen</file> to add the desired locale, then
   run <prgn>locale-gen</prgn> as root to compile it. See <manref
   name="locale-gen" section="8"> and the manpages listed in its "SEE ALSO"
   section.
 <item>Run <tt>dpkg-reconfigure locales</tt> to reconfigure the
   <package>locales</package> package. Or if it is not already installed,
   installing <package>locales</package> will invoke the debconf interface to
   let you choose needed locales and compile the database.
</list>

<sect1 id="env-locale">Activate a particular locale
<p>
The following environment variables are evaluated in this order to provide
particular locale values to programs:
<enumlist>
<item>LANGUAGE: This environment variable consists of a colon-separated 
      list of locale names in order of priority. Used only if the POSIX
      locale is set to a value other than "C" [in Woody; the Potato version
      always has priority over the POSIX locale]. (GNU extension)
<item>LC_ALL: If this is non-null, the value is used for all locale
      categories. (POSIX.1) Usually "" (null).
<item>LC_*: If this is non-null, the value is used
      for the corresponding category (POSIX.1).  Usually "C".
<p>
      LC_* variables are:
 <list compact>
<item>LC_CTYPE: Character classification and case conversion.
<item>LC_COLLATE: Collation order.
<item>LC_TIME: Date and time formats.
<item>LC_NUMERIC: Non-monetary numeric formats.
<item>LC_MONETARY: Monetary formats.
<item>LC_MESSAGES: Formats of informative and diagnostic messages and
            interactive responses.
<item>LC_PAPER: Paper size.
<item>LC_NAME: Name formats.
<item>LC_ADDRESS: Address formats and location information.
<item>LC_TELEPHONE: Telephone number formats.
<item>LC_MEASUREMENT: Measurement units (Metric or Other).
<item>LC_IDENTIFICATION: Metadata about the locale information.
 </list>
<item>LANG:   If this is non-null and LC_ALL is undefined, the value is used
      for all LC_* locale categories with undefined values. (POSIX.1) Usually
      "C".
</enumlist>
Note that some applications (e.g., Netscape 4) ignore LC_* settings.
<p>
The <prgn>locale</prgn> program can display active locale settings and
available locales; see <manref name="locale" section="1">. (NOTE: <tt>locale
-a</tt> lists all the locales that your system knows about; this does
<em>not</em> mean that all of them are compiled! See
<ref id="activate-locales">.)

<sect1 id="ISO-locale">ISO 8601 date format locale
<p>
The locale support for the international date standard of <tt>yyyy-mm-dd</tt>
(ISO 8601 date format) is provided by the locale called <tt>en_DK</tt>, 
"English in Denmark", which is a bit of joke :-)
This seems to work only in a console screen for <prgn>ls</prgn>.

<!-- beyond locale moved to below -->

<sect1 id="iso-8859-1">Example for the US (ISO-8859-1)
<p>
Add the following lines to <file>~/.bash_profile</file>:
<example>
LC_CTYPE=en_US.ISO-8859-1
export LC_CTYPE
</example>

<sect1 id="france">Example for France with Euro sign (ISO-8859-15)
<p>
Add the following lines to <file>~/.bash_profile</file>:
<example>
LANG=fr_FR@euro
export LANG
LC_CTYPE=fr_FR@euro
export LC_CTYPE
</example>
<p>
Configure the keyboard for French "AZERTY" as described in <ref id="keyboard">;
add French manual pages by installing <package>manpages-fr</package>.  The
Right-Alt key in the US is called Alt-Gr in Europe.  Pressing this together
with other keys creates numerous accented and special characters.  For example,
Alt-Gr+E creates a Euro sign.
<p>
Most western European languages can be configured similarly.
<p>
See <url id="&debian-euro-support;" name="Debian Euro HOWTO"> for 
adding support for the new Euro currency and 
<url id="&debian-fr-howto;" name="Utiliser et configurer Debian pour le francais"> 
for more details in French.

<sect1 id="x-cjk">Example for a bilingual system (Japanese EUC and ISO-8859-1)
<p>
Let us set up a bilingual system: ja_JP.eucJP (Japanese EUC, traditional 
Unix Japanese environment) in X with English messages and ISO type dates, 
and  en_US.ISO-8859-1 (almost ASCII with accented character support) 
in the Linux console.
<list>

 <item>add locale support for the Japanese ja_JP.eucJP locale 
  using the method described at <ref id="l10n">.

 <item>install Kana-to-Kanji conversion system and dictionary:
  <list compact>
  <item><package>canna</package>&mdash;Local server ("free-beer" license), or
  <item><package>freewnn-jserver</package>&mdash;Network-extensible server 
   (Public Domain)
  </list>

 <item>install Japanese input method system:
  <list compact>
  <item><package>kinput2-canna</package>&mdash;for X, or
  <item><package>kinput2-canna-wnn</package>&mdash;for X, and
  <item><package>egg</package>&mdash;directly works with Emacsen even 
    in console (optional)
  </list>

 <item>Japanese-compatible terminal:
  <list compact>
  <item><package>kterm</package>&mdash;X (classic),
  <item><package>mlterm</package>&mdash;X (very neat, variable font size), and 
  </list>

 <item>add all the Japanese font packages.
 
 <item>Set up as described in <ref id="custom-x">. This allows a user-specific
 X environment independent of how X is started. 
  (<prgn>startx</prgn>, <prgn>xdm</prgn>, ...)
  
 <item>create the <file>~/.xsession</file> that sets the user-specific X 
  environment:

<example>
#!/bin/sh
# This makes X work when I su to root.
if [ -z "$XAUTHORITY" ]; then
        XAUTHORITY=$HOME/.Xauthority
        export XAUTHORITY
fi

# Japanese locale as default, C locale as backup
# export LANG=ja_JP.eucJP     
# make sure to overwrite en_US.ISO-8859-1 used in console
#export LC_CTYPE=ja_JP.eucJP
# I want menu messages to be English in ASCII :-)
export LC_MESSAGES=C
# activate input method
kinput2 &        
XMODIFIERS=@im=kinput2
export XMODIFIERS
# How about blackbox window manager (lightweight)
exec /usr/bin/blackbox
</example>

 <item>add the following lines to <file>~/.bashrc</file>:
<example>
# Change language environment depending on the console program
# X-shells only execute .bashrc (they are not login shells)
# General environment for X is set by .xsession
if [ $TERM = kterm ] || [ $TERM = mlterm ]; then
        unset LC_ALL
        export LANG=C
        #export LANG=ja_JP.eucJP
# For ISO yyyy-mm-dd date display, more natural for Japanese :-)
        export LC_TIME=en_DK.ISO-8859-1
        export LC_MESSAGES=C
        export LANGUAGE=ja_JP.eucJP:en_US.ISO-8859-1:C
        export LC_CTYPE=ja_JP.eucJP
else
        unset LC_ALL
        export LANG=C
        export LC_TIME=en_DK.ISO-8859-1
        export LANGUAGE=en_US.ISO-8859-1:C
        export LC_CTYPE=en_US.ISO-8859-1
fi
</example>

 <item>add the following lines to <file>~/.muttrc</file>:
<example>
# UTF-8 support is not popular in popular Japanese EMACS environment
# 7-bit encoding of iso-2022-jp is easier for everyone
# default encoding order = us-ascii --&gt; iso-8859-1 --&gt; utf-8
#set send_charset="us-ascii:iso-8859-1:utf-8"
#set allow_8bit=yes
set send_charset="us-ascii:iso-8859-1:iso-2022-jp"
set allow_8bit=no
</example>
 <item>activate XIM <prgn>kinput2</prgn> for X applications
  <list compact>
  <item>add <tt>*inputMethod: kinput2</tt> to your X resources file,
  <file>~/.Xresources</file>  (it looks like Debian takes care of this
  automatically somehow).
  <item>Some applications (such as <prgn>mlterm</prgn>) also allow 
  you to set up <tt>*inputMethod:</tt> and other information dynamically 
  at runtime (press <strong>Ctrl-MouseButton-3</strong> in <prgn>mlterm</prgn>).
  </list>
 <item>start X by typing <tt>startx</tt> or from one of the display
  managers (<prgn>xdm</prgn>, <prgn>gdm</prgn>, <prgn>kdm</prgn>,
  <prgn>wdm</prgn>, ...)
 <item>start a Japanese-compatible application such as
  Vim 6, (x)emacs21, mc-4.5, mutt-1.4, ...
  (Emacs seems to be the most popular platform, though I do not use it.)
 <item>press <strong>Shift+Space</strong> to toggle Japanese 
  character input mode on and off.
</list>
See also the <url id="&suse-cjk;" name="SuSE pages for CJK">.

<sect1 id="x-utf-8">Example for UTF-8 in X
<p>
Everyone will need this in the future.
See <url id="&unicode-howto;" name="The Unicode HOWTO">.

<sect1 id="fb-utf-8">Example for UTF-8 in a framebuffer console
<p>
UTF-8 support on a FB console is provided by <package>bterm</package>
used in the <prgn>debian-installer</prgn>.

<sect1 id="beyond-locale">Beyond locale
<p>
When you are first setting the system up for a <strong>national
language environment</strong>, please consider using
<prgn>tasksel</prgn> or <prgn>aptitude</prgn> to find out what packages
are selected by choosing the corresponding language environment task.
The package choice made is useful even for a multilingual setup.  If
you encounter any package dependency conflicts during the install to
your carefully configured system, avoid installing any software that
conflicts with the existing system.  You may have to use
<prgn>update-alternative</prgn> to regain the original state for some
commands since a newly installed one may have higher priority than
existing ones.
<p>
Newer major programs are using glibc 2.2 and are mostly internationalized.  So
a specially localized version such as <prgn>jvim</prgn> for Vim may not be
needed as its functionality is offered by <prgn>vim</prgn> version 6.0 in X.
In reality, it is still somewhat rough-edged.  Since <prgn>jvim</prgn> has a
version compiled with direct Japanese input method (<prgn>canna</prgn>)
support even in the console and addresses many other Japanese-specific issues
maturely, you may still want it :-)
<p>
Programs may need to be configured beyond <tt>locale</tt> configuration
to enable a comfortable working environment.  The
<package>language-env</package> package and its command
<prgn>set-language-env</prgn> greatly eases this process.
<p>
Also see the internationalization document, <url id="&intro-i18n;" 
name="Introduction to i18n">. It is aimed at developers but is also 
useful for system administrators.
</sect1>

</sect>
</chapt>

