<!-- CVS revision of this document "$Revision: 1.5 $"  -->
<!-- CVS revision of original english document "1.37"  -->
<!--Line width ruler (ruler uses 78 characters)     34567890123456789012345-->

<chapt id="vcs">Systemy kontroli wersji

<sect id="cvs">CVS

<p>Przeczytaj (np. przegl±dark± <prgn>lynx</prgn>) pliki:
<file>/usr/share/doc/cvs/html-cvsclient</file>,
<file>/usr/share/doc/cvs/html-info</file>,
<file>/usr/share/doc/cvsbook</file> lub wykonaj polecenia:
<tt>info cvs</tt> oraz <tt>man cvs</tt> w celu uzyskania
dok³adnych informacji.

<sect1 id="cvs-inst">Instalacja serwera CVS
<p>
Poni¿sze ustawienia pozwalaj± na wprowadzanie zmian w repozytorium wy³±cznie
u¿ytkownikom nale¿±cym do grupy &ldquor;src&rdquor;, a na administracjê CVS wy³±cznie
cz³onkowi grupy &ldquor;staff&rdquor;, redukuj±c w ten sposób szanse zastrzelenia samego
siebie.
<example>
# cd <var>/var/lib</var>; umask 002 ; mkdir <var>cvs</var> # [Woody] FSH
# apt-get install cvs cvs-doc cvsbook
# export CVSROOT=<var>/var/lib/cvs</var>
# cd $CVSROOT
# chown root:src .	# &ldquor;staff&rdquor; dla wiêkszych ograniczeñ rozpoczynania projektów
# chmod 3775 .		# Je¶li w powy¿szym wystêpuje &ldquor;staff&rdquor;, u¿yj 2775
# cvs -d <var>/var/lib/cvs</var> init 	# bezpieczniej jest okre¶liæ -d tutaj!
# cd CVSROOT
# chown -R root:staff .
# chmod 2775 .
# touch val-tags
# chmod 664 history val-tags
# chown root:src history val-tags
</example>
<p>
</sect1>

<sect1 id="cvs-examples">Przyk³adowe sesje CVS
<p>
Poni¿ej znajduj± siê przyk³ady konfiguracji ¶rodowiska pow³oki dla dostêpu do
repozytoriów CVS.

<sect2>Anonimowy CVS (tylko pobieranie)
<p>
Zdalny dostêp tylko do odczytu:
<example>
$ export CVSROOT=:pserver:<var>anonymous@cvs.qref.sf.net:/cvsroot/qref</var>
$ cvs login
$ cvs -z3 co <var>qref</var>
</example>
</sect2>

<sect2>U¿ycie lokalnego serwera CVS
<p>
Dostêp lokalny z pow³oki na tej samej maszynie:
<example>
$ export CVSROOT=<var>/var/lib/cvs</var>
</example>
</sect2>

<sect2>U¿ycie odleg³ego pservera CVS
<p>
Zdalny dostêp bez SSH (u¿ywaj±c obs³ugi RSH w <prgn>cvs</prgn>):
<example>
$ export CVSROOT=:pserver:<var>account@cvs.foobar.com:/var/lib/cvs</var>
$ cvs login
</example>
Jest to metoda podatna na pods³uch.
</sect2>

<sect2>U¿ycie zdalnego CVS przez <prgn>ssh</prgn>
<p>
Zdalny dostêp z SSH:
<example>
$ export CVSROOT=:ext:<var>account@cvs.foobar.com:/var/lib/cvs</var>
</example>
lub dla SourceForge:
<example>
$ export CVSROOT=:ext:<var>account@cvs.qref.sf.net:/cvsroot/qref</var>
</example>
Mo¿esz równie¿ u¿yæ uwierzytelnienia RSA (<ref id="ssh-rsa">), które eliminuje
pytanie o has³o.
</sect2>

<sect2>Tworzenie nowego archiwum CVS
<p>
Dla,
<example>
OBIEKT              WARTO¦Æ                          ZNACZENIE
Drzewo ¼róde³:      ~/<var>project-x</var>           Wszystkie kody ¼ród³owe
Nazwa projektu:     <var>project-x</var>             Nazwa projektu
¬ród³o modu³u:      <var>Main-branch</var>           Nazwa ca³ego modu³u (vendortag)
Etykieta wydania:   <var>Release-original</var>      Nazwa wydania (releasetag)
</example>
Wykonaj,
<example>
$ cd ~/<var>project-x</var>                 # przejd¼ do katalogu ze ¼ród³ami
 ... stwórz drzewo ¼róde³ ...
$ cvs import -m <var>"Start project-x" project-x Main-branch Release-original</var>
$ cd ..; rm -R ~/<var>project-x</var>
</example>
</sect2>

<sect2>Praca z CVS
<p>
Praca nad projektem <var>project-x</var> przy u¿yciu lokalnego repozytorium:
<example>
$ cd                            # przej¶cie do przestrzeni roboczej
$ cvs co <var>project-x</var>              # pobranie ¼róde³ z CVS-u
$ cd <var>project-x</var>
 ... wprowadzanie zmian w zawarto¶ci ...
$ cvs diff -u                   # podobne do diff -u repozytorium/ lokalne/
$ cvs up -C <var>modyfikowany_plik</var>   # cofniêcie zmian w pliku
$ cvs ci -m "<var>Opisz zmiany</var>"      # wys³anie modyfikacji do CVS
$ vi <var>nowy_plik</var>
$ cvs add <var>nowy_plik</var>
$ cvs ci -m "<var>Dodano nowy_plik</var>"
$ cvs up                        # pobranie najnowszych wersji z CVS
 ... by utworzyæ wszystkie nowoutworzone katalogi w CVS u¿yj
 ... "cvs up -d -P" w zastêpstwie.
 ... uwa¿aj na linie zaczynaj±ce siê od &ldquor;C <var>nazwa_pliku</var>&rdquor;
 ... kod niezmodyfikowany przeniesiony jest do `.#<var>nazwa_pliku</var>.wersja'.
 ... szukaj "&lt;&lt;&lt;&lt;&lt;&lt;&lt;" i "&gt;&gt;&gt;&gt;&gt;&gt;&gt;" w <var>nazwa_pliku</var>.
$ cvs tag <var>Release-1</var>             # dodaj symboliczn± nazwê wydania
 ... edytuj dalej ...
$ cvs tag -d <var>Release-1</var>          # usuñ nazwê wydania
$ cvs ci -m "<var>nastêpne komentarze</var>"
$ cvs tag <var>Release-1</var>             # ponownie dodaj nazwê wydania
$ cd                            # wróæ do przestrzeni roboczej
$ cvs co -r <var>Release-initial</var> -d <var>old</var> <var>project-x</var>
 ... pobierz wersjê oryginaln± do katalogu <var>old</var>
$ cd old
$ cvs tag -b <var>Release-initial-bugfixes</var> # stwórz nazwê odga³êzienia (-b)
 ... mo¿esz teraz pracowaæ na starej wersji (Tag=sticky)
$ cvs update -d -P         # nie twórz pustych katalogów
 ... drzewo ¼róde³ ma teraz trwa³± (sticky) nazwê &ldquor;Release-initial-bugfixes&rdquor;
 ... pracuj na tym odga³êzieniu
$ cvs up -d -P # zsynchronizuj z plikami modyfikowanymi przez innych w tej ga³êzi
$ cvs ci -m "<var>check into this branch</var>"
$ cvs update -kk -A -d -P
 ... usuñ trwa³± nazwê i zapomnij zawarto¶æ
 ... aktualizuj z g³ównego pnia bez rozwijania s³ów kluczowych
$ cvs update -kk -d -P -j <var>Release-initial-bugfixes</var>
 ... w³±czenie z odga³êzienia <var>Release-initial-bugfixes</var> do drzewa
 ... g³ównego.  Napraw konflikty edytorem.
$ cvs ci -m "<var>w³±czono Release-initial-bugfixes</var>"
$ cd
$ tar -cvzf <var>old-project-x.tar.gz</var> <var>old</var>     # stwórz archiwum, -j dla bz2
$ cvs release -d <var>old</var>               # usuñ lokalne ¼ród³a (opcjonalne)
</example>
Mi³e opcje do zapamiêtania (u¿ywaj jako pierwszych opcji dla <prgn>cvs</prgn>):
<example>
-n      pusty przebieg, ¿adnych efektów
-t      wy¶wietl komunikaty pokazuj±ce etapy pracy cvs
</example>
</sect2>

<sect2>Eksport plików z CVS
<p>
Aby pobraæ najnowsz± wersjê z CVS u¿yj &ldquor;tomorrow&rdquor;:
<example>
$ cvs ex -D tomorrow <var>nazwa_modu³u</var>
</example>
</sect2>

<sect2>Zarz±dzanie CVS
<p>
Dodaj alias dla projektu (serwer lokalny):
<example>
$ su - admin           # cz³onek grupy staff
$ export CVSROOT=<var>/var/lib/cvs</var>
$ cvs co CVSROOT/modules
$ cd CVSROOT
$ echo "<var>px</var> -a <var>project-x</var>" &gt;&gt;modules
$ cvs ci -m "<var>px jest teraz aliasem project-x</var>"
$ cvs release -d .
$ exit                 # Ctrl-D aby wyj¶æ z su
$ cvs co -d <var>project</var> <var>px</var>
 ... pobierz <var>project-x</var> (alias:<var>px</var>) z CVS to katalogu project
$ cd project
 ... wprowad¼ zmiany w zawarto¶ci ...
</example>0
</sect2>

<sect1 id="cvs-trouble">Rozwi±zywanie problemów z CVS

<sect2>Uprawnienia plików w repozytorium
<p>
CVS nie nadpisuje aktualnych plików w repozytorium, tylko zastêpuje je innymi.
Z tego powodu, <em>pozwolenie na pisanie do katalogu z repozytorium</em> ma
kluczowe znaczenie. Dla ka¿dego nowego repozytorium, wykonaj nastêpuj±ce czynno¶ci
aby zapewniæ ten warunek.
<example>
# cd <var>/var/lib/cvs</var>
# chown -R root:src <var>repozytorium</var>
# chmod -R ug+rwX   <var>repozytorium</var>
# chmod    2775     <var>repozytorium</var>  # je¶li potrzebne, w podkatalogu
</example>
</sect2>

<sect2>Bit wykonywalno¶ci
<p>
Bit wykonywalno¶ci pliku jest zachowany przy pobieraniu z CVS.  Kiedy tylko
zobaczysz problem z prawem do wykonywania w pobranych plikach, zmieñ uprawnienia
pliku w repozytorium nastêpuj±cym poleceniem.
<example>
# chmod ugo-x <var>nazwa_pliku</var>
</example>
</sect2>

</sect1>

<sect1 id="cvs-short">Polecenia CVS
<p>
Oto polecenia CVS wraz ze skrótami.
<example>
{add|ad|new} [-k kflag] [-m 'komunikat'] pliki...
{admin|adm|rcs} [opcje-rcs] pliki...
{annotate|ann} [opcje] [pliki...]
{checkout|co|get} [opcje] modu³y...
{commit|ci|com}   [-lnR]  [-m  'podsumowanie_zmian'  |  -f  file] \
        [-r rewizja] [pliki...]
{diff|di|dif} [-kl] [opcje_rcsdiff] [[-r rev1 | -D data1] \
        [-r rev2 |  -D data2]] [pliki...]
{export|ex|exp} [-flNn] -r rev|-D data [-d katalog] [-k kflag] modu³...
{history|hi|his} [-report] [-flags] [-options args] [pliki...]
{import|im|imp} [-opcje] repozytorium vendortag releasetag...
{login|logon|lgn}
{log|lo|rlog} [-l] opcje-rlog [pliki...]
{rdiff|patch|pa} [-flags] [-V vn] [-r t|-D d [-r t2|-D d2]] modu³y...
{release|re|rel} [-d] katalogi...
{remove|rm|delete} [-lR] [pliki...]
{rtag|rt|rfreeze} [-falnR]  [-b]  [-d]  [-r  tag  |  -D  data] \
         nazwa_symboliczna modu³y...
{status|st|stat} [-lR] [-v] [pliki...]
{tag|ta|freeze} [-lR] [-F] [-b] [-d] [-r tag | -D data]  [-f] \
         nazwa_symboliczna [pliki...]
{update|up|upd} [-AdflPpR] [-d] [-r tag|-D data] pliki...
</example>
</sect1>

<sect id="svn">Subversion
<p>
Subversion jest systemem kontroli wersji nowej generacji, który tworzony by³ z
my¶l± o zast±pieniu CVS.  Wed³ug twórców jest on obecnie w stanie &ldquor;alpha&rdquor;,
jednak prawdopodobnie jest wystarczaj±co stabilny dla wiêkszo¶ci
u¿ytkowników.  W momencie powstawania tego tekstu,
Subversion dostêpny jest wy³±cznie w <tt>niestabilnej</tt>
ga³êzi Debiana.

<sect1 id="svn-inst">Instalacja serwera Subversion
<p>
Meta-pakiet <package>subversion-server</package> jest zale¿ny
od wymaganych do u¿ycia systemu Subversion pakietów
(<package>libapache2-dav-svn</package> oraz
<package>subversion-tools</package>).

<sect2>Tworzenie repozytorium
<p>
Aktualnie, pakiet <package>subversion</package> nie tworzy repozytorium, wiêc
musi byæ ono utworzone rêcznie.  Jednym z mo¿liwych miejsc dla repozytorium jest
<file>/var/local/repos</file>.
<p>
Utwórz katalog:
<example>
# mkdir -p /var/local/repos
</example>
Utwórz bazê danych repozytorium:
<example>
# svnadmin create /var/local/repos
</example>
Daj prawo do zapisu w repozytorium serwerowi WWW:
<example>
# chown -R www-data:www-data /var/local/repos
</example>
</sect2>
<sect2>Konfiguracja Apache2
<p>
Aby umo¿liwiæ dostêp do repozytorium przez uwierzytelnienie u¿ytkownika, dodaj
(lub usuñ komentarz) nastêpuj±ce wpisy do
<file>/etc/apache2/mods-available/dav_svn.conf</file>:
<example>
&lt;Location /repos&gt;
  DAV svn
  SVNPath /var/local/repos
  AuthType Basic
  AuthName "Repozytorium Subversion"
  AuthUserFile /etc/subversion/passwd
  &lt;LimitExcept GET PROPFIND OPTIONS REPORT&gt;
    Require valid-user
  &lt;LimitExcept&gt;
&lt/Location&gt
</example>
Nastêpnie stwórz plik z has³ami u¿ytkowników u¿ywaj±c polecenia:
<example>
htpasswd2 -c /etc/subversion/passwd jaki¶-u¿ytkownik
</example>
Prze³aduj Apache2, a Twoje nowe repozytorium Subversion bêdzie dostêpne pod
adresem http://<var>nazwa_hosta</var>/repos.
</sect2>
</sect1>

<sect1 id="svn-cvs">Przenoszenie repozytorium CVS do Subversion
</sect1>
<sect1 id="svn-usage">Przyk³ady u¿ycia Subversion
<p>
Poni¿sze czê¶ci pokazuj± jak u¿ywaæ ró¿nych poleceñ w Subversion.

<sect2>Tworzenie nowego archiwum
<p>
Aby stworzyæ nowe archiwum Subversion, napisz poni¿sze polecenia:
<example>
$ cd ~/<var>twój-projekt</var>         # przejd¼ do katalogu ¼róde³
$ svn import http://localhost/repos <var>twój-projekt</var> \
  <var>nazwa-projektu</var> -m "pocz±tkowy import projektu"
</example>
<p>
Tworzy to katalog o nazwie <var>nazwa-projektu</var> w Twoim repozytorium.
Katalog ten zawiera pliki Twojego projektu.  Sprawd¼ pod adresem
http://localhost/repos/ czy siê tam znalaz³.
</sect2>

<sect2>Praca z Subversion
<p>
Praca z <var>project-y</var> przy u¿yciu Subversion:
<example>
$ cd                            # przejd¼ do przestrzeni roboczej
$ svn co http://localhost/repos/<var>project-y</var>  # pobierz ¼ród³a
$ cd <var>project-y</var>
 ... wykonaj pracê ...
$ svn diff                      # podobne do diff -u repozytorium/ lokalne/
$ svn revert <var>modyfikowany_plik</var>  # cofnij zmiany w pliku
$ svn ci -m "<var>Opisz zmiany</var>"      # wy¶lij pliki do repozytorium
$ vi <var>dodany_plik</var>
$ svn add <var>dodany_plik</var>
$ svn add <var>nowy_katalog</var>          # rekursywnie dodaj pliki z nowy_katalog
$ svn add -N <var>new_dir2</var>           # nierekursywnie dodaj nowy katalog
$ svn ci -m "Dodano <var>nowy_plik</var>, <var>nowy_katalog</var>, <var>nowy_katalog2</var>"
$ svn up                        # pobranie najnowszej wersji z repozytorium
$ svn log                       # pokazuje wszystkie wprowadzone zmiany
$ svn copy http://localhost/repos/<var>project-y</var> \
      http://localhost/repos/<var>project-y-branch</var> \
      -m "Tworzê w³asn± ga³±¼ <var>project-y</var>"  # rozga³êzienie <var>project-y</var>
$ svn copy http://localhost/repos/<var>project-y</var> \
      http://localhost/repos/<var>proj-y_release1.0</var> \
      -m "<var>project-y</var> 1.0 release"    # dodanie tagu release
 ... zauwa¿, ¿e odga³êzianie i tagowanie s± tym samym. Jedyn± ró¿nic± jest to,
 ... ¿e ga³êzie mo¿na uaktualniaæ, a tagów nie.

 ... wprowadzaj zmiany w ga³êzi ...

$ # po³±cz odga³êzienie z ga³êzi± g³ówn±
$ svn merge http://localhost/repos/<var>project-y</var> \
   http://localhost/repos/<var>project-y-branch</var>
$ svn co -r 4 http://localhost/repos/<var>project-y</var> # pobierz rewizjê 4
</example>

</sect2>

</sect1>
</sect>
</chapt>
