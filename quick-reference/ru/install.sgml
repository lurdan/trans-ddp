<!-- CVS revision of this document "$Revision: 1.6 $"  -->
<!-- CVS revision of original english document "1.80"  -->

<chapt id="install">Советы по установке системы Debian

<p>
Официальная документация по установке Debian располагается по адресу 
<url id="&stable-info;">, и
<url id="&stable-install;">.
<p>
Версии документов, находящихся в разработке, располагаются по адресу
<url id="&testing-info;" >, и
<url id="&testing-install;"> (поскольку работа еще продолжается, иногда
документ может быть не доступен).
<p> 
Хотя эта глава была изначально написана во время существования программы установки 
Potato, большая часть текста была обновлена для использования установщика
Woody (кроме этого, они очень похожи). А так как Sarge будет использовать
совершенно новую программу установки, используйте этот документ лишь
как отправную точку для установщика Sarge.

<sect>Общие советы по установке системы Linux
<p>
Если Вы ищете компактный CD-образ установщика &debian;, не забудьте изучить
содержимое страницы <url id="&debian-netinst;">.
<p>
Использование <tt>testing</tt> или  <tt>unstable</tt> дистрибутивов &debian;
увеличивает риск столкнуться с серьезными ошибками.  Этого можно избежать путем
развертывания бутового загрузчика с возможностью выбора более стабильного дистрибутива
&debian;, или использования программы <prgn>chroot</prgn> для более стабильного дистрибутива
(описано в <ref id="chroot">). Это позволит выполнить одновременно разные виды &debian;
 на разных консолях.

<sect1>Основы совместимости аппаратного обеспечения
<p>
Linux совместим с множеством аппартного обеспечения персональных компьютеров и может быть установлен 
почти на любую систему. Для меня это также легко, как установить Windows 95/98/Me.  
Список совместимого аппаратного обеспечения постоянно растет.
<p>
Если Вы имеете ноутбук, изучите информацию <url id="&linonlap;" name="Linux on Laptops">
на предмет ссылок по установке системы на определенную модель выбранного производителя.
<p>
Моя рекомендация по выбору аппартного обеспечения для персонального компьютера - "Просто будь консервативным":
<list compact>
<item>Жесткие диски - на работе SCSI, для частного использования можно IDE/ATAPI.
<item>IDE/ATAPI CD-ROM (или CD-RW).
<item>платы PCI, а не ISA, особенно для сетевых плат (NIC).
<item>Используйте дешевые сетевые карты.  Хороши Tulip для PCI, NE2000 для ISA.
<item>На ноутбуках в случае первой установки избегайте PCMCIA.
<item>Никаких USB клавиатур, мышей, ... если не хотите трудностей.
</list>
<p>
Если у Вас медленная машина, хорошей идеей будет снять жесткий диск и поключить его к другой более быстрой
машине на момент установки.
</sect1>

<sect1>Определение аппаратного обеспечения ПК и набора микросхем
<p>
В процессе установки задаются вопросы об оборудовании или наборе микросхем ПК.
Иногда данную информацию не так просто найти. 
Вот один из методов:
<enumlist compact>
  <item>Раскройте корпус Вашего ПК и загляните внутрь.
  <item>Запишите идентификационные коды продуктов на больших микросхемах видеокарты, сетевого адаптера, 
  микросхемах около последовательных и IDE портов.  
  <item>Запишите названия карт, напечатанных сзади на PCI и ISA картах.
</enumlist>
</sect1>

<sect1>Определение состава оборудования ПК при помощи &debian;
<p>
Следующие команды на Linux-системе должны дать некоторую информацию об имеющемся оборудовании и
его конфигурации.
<example>
$ lspci -v |pager
$ pager /proc/pci
$ pager /proc/interrupts
$ pager /proc/ioports
$ pager /proc/bus/usb/devices
</example>
Эти команды могут быть выполнены в процессе установки системы из экрана консоли, перейти на который
можно нажатием Alt-F2.

<p>
Типовое использование прерываний:
<list compact>
<item>IRQ0: прерывание от таймера (8254)
<item>IRQ1: прерывание от контроллера клавиатуры
<item>IRQ2: применяется для каскадирования контроллера прерываний IRQ8&ndash;IRQ15 на PC-AT
<item>IRQ3: второй последовательный порт  (io-port=0x2F8) (<file>/dev/ttyS1</file>)
<item>IRQ4: первый последовательный порт (io-port=0x3F8) (<file>/dev/ttyS0</file>)
<item>IRQ5: свободно (ранее использовалось для прерываний от жесткого диска на PC/XT)
<item>IRQ6: прерывание от контроллера гибких дисков (io-port=0x3F0) (<file>/dev/fd0</file>, <file>/dev/fd1</file>)
<item>IRQ7: паралелльный порт (io-port=0x378) (<file>/dev/lp0</file>)
<item>IRQ8: часы реального времени
<item>IRQ9: программное прерывание (int 0x0A), направленное на IRQ2
<item>IRQ10: свободно
<item>IRQ11: свободно
<item>IRQ12: мышь PS/2 
<item>IRQ13: свободно (ранее использовалось 80287 математическим сопроцессором)
<item>IRQ14: первый IDE контроллер (<file>/dev/hda</file>, <file>/dev/hdb</file>)
<item>IRQ15: второй IDE контроллер (<file>/dev/hdc</file>, <file>/dev/hdd</file>)
</list>

<p>
Для устройств USB классы устройств описаны в  
<file>/proc/bus/usb/devices</file> в виде <tt>Cls=<var>nn</var></tt>:
<list compact>
<item>Cls=00 : Не используется 
<item>Cls=01 : Аудио (динамики и пр.)
<item>Cls=02 : Устройства связи (модем, сетевая плата, ...)
<item>Cls=03 : HID (Human Interface Device: клавиатуры, мыши, джойстики)
<item>Cls=07 : Принтер
<item>Cls=08 : Устройство хранения данных (дисководы, устройства CD/DVD, жесткие диски, флеш-карты, ...)
<item>Cls=09 : Концентратор (USB концентраторы)
<item>Cls=255 : тип определяется изготовителем 
</list>
Если класс устройства не равен 255, Linux поддерживает это устройство.
</sect1>

<sect1>Определение состава оборудования ПК при помощи других операционных систем
<p>
Информация об оборудовании может быть так получена от других ОС:
<p>
Установите другой коммерческий дистрибутив Linux. Пока определение оборудования на них лучше,
чем в Debian. (Это положение должно быть улучшено при введении новой
программы-установки <prgn>debian-installer</prgn> дистрибутива Sarge.)
<p>
Установите Windows. Конфигурация оборудования может быть получена нажатием правой кнопки мыши на иконку
"Мой компьютер"с последующим входом в "Менеджер устройств".  Запишите всю информацию об используемых ресурсах
IRQ, адресах портов ввода/вывода и каналах DMA. Некоторые старые карты могут потребовать своей конфигурации 
в среде DOS и соответвствующего использования.
</sect1>

<sect1>Миф о LILO
<p>
"Lilo ограничен 1024 цилиндрами." Неверно!
<p>
Новая версия <prgn>lilo</prgn>, используемая после выхода Debian Potato имеет поддержку lba32. 
Если BIOS Вашей материнской платы поддерживает lba32, <prgn>lilo</prgn> сможет 
работать на цилиндрах выше 1024.
<p>
Для этого добавьте строку "lba32" где-нибудь в начале Вашего файла <file>lilo.conf</file>, если у Вас 
используется конфигурационный файл от старого <prgn>lilo</prgn>.
Смотрите <file>&f-lilo;</file>.
</sect1>

<sect1 id="instgrub">GRUB
<p>
Новый системный загрузчик <package>grub</package> из проекта GNU Hurd может быть установлен 
в систему &debian; Woody следующим образом:
<example>
# apt-get update
# apt-get install grub-doc
# mc &f-grub-doc;
... изучите содержимое
# apt-get install grub
# pager &f-grub;
... прочтите это:)
</example>

Для редактирования меню GRUB, правьте файл <file>&f-grub-menu;</file>. Смотрите 
<ref id="bootgrub"> чтобы узнать, как установить загрузочные параметры при загрузке системы, так как 
конфигурирование GRUB немного отличается от конфигурирования <package>lilo</package>.
</sect1>

<sect1 id="bootfloppy">Выбор набора загрузочных дискет
<p>
В Potato мне нравился набор дисков IDEPCI для нормальной установки на рабочую станцию. 
Для Woody мне нравится загрузочный набор bf2.4. Они оба используют пакет <package>boot-floppies</package>
для создания загрузочных дискет.
<p>
Если у Вас есть сетевая карта PCMCIA, Вам нужно использовать стандартный загрузочный набор дискет
(самое большое количество дисков, зато доступны все модули драйверов) и настроить сетевую карту
через настройку PCMCIA; не пытайтесь устанавливать сетевую карту через стандартный диалог настройки сети.
<p>
Для специфичных систем Вам возможно понадобится создать собственный спасательный диск.
Это может быть сделано путем замены образа ядра под именем "linux" на спасательном диске &debian;
сжатым  образом другого ядра, скомилированного где-либо для этой машины.  
Подробности описаны в файле <file>readme.txt</file> на таком диске.  
Спасательная дискета использует файловую систему MS-DOS, поэтому Вы можете использовать любую 
операционную систему, чтобы изучить и отредактировать ее содержимое.
Это делает жизнь проще людям, у которых, например, нестандартная сетевая карта.
<p>
В Sarge для создания загрузочных дискет будет использоваться программа <prgn>debian-installer</prgn> и/или 
пакет <package>pgi</package>.
</sect1>

<sect1>Установка
<p>
Следуйте официальным инструкциям, которые можно найти по адресу <url id="&stable-install;">
или <url id="&testing-install;"> (документ в разработке, иногда может быть не доступен).
<p>
Если Вы устанавливаете систему, используя программу <prgn>boot-floppies</prgn> из дистрибутива 
<tt>testing</tt>, то Вам, возможно, понадобится настроить источники системы APT. Для этого переключитесь
на вторую виртуальную консоль нажатием Alt-F2 и вручную отредактируйте строки файла <file>/etc/apt/sources.list</file>,
заменив "stable" на "testing"

<p>
Я придерживаюсь устанавливать <prgn>lilo</prgn> в места типа <file>/dev/hda3</file>,
в то время как <prgn>mbr</prgn> устанавливаю в <file>/dev/hda</file>. Это минимизирует
риск перезаписи загрузочной информации.
<p>
Вот что я выбираю в процессе установки системы:
<list compact>
<item>MD5 пароли "yes"
<item>Теневые пароли "yes"
<item>Установка "advanced" (через dselect **) и выбираю
  <list compact>
    <item>Исключаю emacs (если он выбран), nvi, tex, telnet, talk(d); 
    <item>Включаю mc, vim, один из редакторов nano-tiny или elvis-tiny.
    <p>
     Изучите <ref id="dselect">. Даже если Вы поклонник Emacs, избегайте устанавливать его сейчас 
     и довольствуйтесь nano при установке. Также избегайте устанавливать  
     другие большие пакеты, как то TeX (актуально для Potato) на этой стадии.
     Смотрите <ref id="bin-editor"> относительно причин установки nano-tiny или elvis-tiny
     в этом месте.
  </list>
<item>На все конфигурационные вопросы отвечаю "y" (замена текущего) во время диалога установки
     каждого пакета.
<item><package>exim</package>: Выбираю "2" для своей машины, так как я отправляю почту через 
     SMTP-сервер моего провайдера Интернет.
</list>
<p>
За дополнительной информацией по dselect обращайтесь к <ref id="dselect">.
</sect1>


<sect1 id="ipmap">Хосты и IP-адреса для использования в локальных сетях
<p>
Перед Вами пример конфигурации ЛВС (сеть класса C: 192.168.1.0/24):
<example>
Интернет
   |
   +--- Внешний провайдер интернет предоставляет POP-сервис (доступ по fetchmail)
   | 
  Точка доступа провайдера предоставляет сервис DHCP и SMTP-сервис (с возможностью отправки почты перез него)
   |                       :
Кабельный модем        (Dialup)
   |                       :
Внешний интерфейс шлюза: eth0 (IP, выданный провайдером по DHCP)
 на базе старенького ноутбука (IBM Thinkpad, 486 DX2 50MHz, 20MB RAM)
 работает на ядре Linux 2.4 с файловой системой ext3.
 выполняет пакет "ipmasq" (с stronger-патчами, NAT и firewall)
 выполняет пакет "dhcp-client" настроенный на интерфейс eth0 (не принимает во внимание установку DNS)
 выполняет пакет "dhcp" настроенный на интерфейс eth1
 выполняет пакет "exim" в режиме смартхоста (режим 2)
 выполняет пакет "fetchmail" с большим интервалом (fallback)
 выполняет пакет "bind" в качестве кэширующего сервера имен Интернет для запросов из ЛВС и 
                        в качестве авторитетного сервера имен домена ЛВС для запросов из ЛВС
 выполняет пакет "ssh" на порту 22 и 8080 (подключение с любого хоста)
 выполняет пакет "squid" в качестве кэширующего сервера архива Debian (для APT)
Внутренний интерфейс шлюза : eth1 (IP = 192.168.1.1, фиксированный)
                         |
         +--- Коммутатор (100base T) ---+
         |                              |
Несколько клиентов с                Несколько DHCP-клиентов в ЛВС 
фиксированными IP-адресами          (IP = 192.168.1.128-200, динамические)
(IP = 192.168.1.2-127, фиксированные)    
</example>

Смотрите <ref id="gateway"> относительно деталей по настройке сети.
Также смотрите <ref id="net-router"> относительно конфигурирования сервер-шлюза.
</sect1>


<sect1>Учетные записи пользователей
<p>
Чтобы свободно перемещаться между машинами, несколько первых учетных записей
всегда одинаковы на моих системах.
<p>
Я всегда создаю первую пользовательскую учетную запись под именем "admin" (uid=1000).
Почта root перенаправляется в почтовый ящик admin. Эта учетная запись помещается в группу
<tt>adm</tt> (смотрите <ref id="wheel">), которая получает неплохую долю привилегий root через
команду <prgn>su</prgn>, используя PAM или через команду <prgn>sudo</prgn>. Подробности смотрите в <ref id="newuser">.
</sect1>

<sect1>Создание файловых систем
<p>
<sect2>Разбиение жесткого диска
<p>
Я предпочитаю использовать различные разделы для разных деревьев каталогов с целью
уменьшения объема разрушений при системном сбое. Например:
<example>
/          == (/ + /boot + /bin + /sbin)
           == 50MB+
/tmp       == 100MB+
/var       == 100MB+
/home      == 100MB+
/usr       == 700MB+ с системой X Window
/usr/local == 100MB
</example>
<p>
Размер каталога <file>/usr</file> сильно зависит от присутствия в системе 
приложений X Window и документации к ним.
<file>/usr/</file> может быть около 300MB, если используются только терминальное ПО, или 2GB&ndash;3GB,
если установлено много приложений Gnome.  
Когда <file>/usr/</file> сильно разростается, то перенос каталога <file>/usr/share/</file> на 
другой раздел будет наиболее эффективным средством. С новыми большими ядрами Linux 2.4, поставляемыми в
виде пакетов, размер корневого каталога <file>/</file> может быть более 200MB.  

<p>
Для примера приведу текущее состояние моего Интернет-шлюза (вывод команды <tt>df -h</tt>):
<example>
Filesystem            Size  Used Avail Use&percnt; Mounted on
/dev/hda3             300M  106M  179M  38&percnt; /
/dev/hda7             100M   12M   82M  13&percnt; /home
/dev/hda8             596M   53M  513M  10&percnt; /var
/dev/hda6             100M  834k   94M   1&percnt; /var/lib/cvs
/dev/hda9             596M  222M  343M  40&percnt; /usr
/dev/hda10            596M  130M  436M  23&percnt; /var/cache/apt/archives
/dev/hda11            1.5G  204M  1.2G  14&percnt; /var/spool/squid
</example>
(Большая область зарезервирована для <file>/var/spool/squid/</file> - кэша прокси-сервера
для кэширования скачиваемых пакетов.) 

<p>
Далее идет вывод команды <tt>fdisk -l</tt>, предоставляющий структуру разделов диска:
<example>
# fdisk -l /dev/hda 

/dev/hda1             1        41    309928+   6  FAT16 # DOS
/dev/hda2            42        84    325080   83  Linux # (не используется)
/dev/hda3   *        85       126    317520   83  Linux # основной
/dev/hda4           127       629   3802680    5  расширенный раздел
/dev/hda5           127       143    128488+  82  Linux swap
/dev/hda6           144       157    105808+  83  Linux
/dev/hda7           158       171    105808+  83  Linux
/dev/hda8           172       253    619888+  83  Linux
/dev/hda9           254       335    619888+  83  Linux
/dev/hda10          336       417    619888+  83  Linux
/dev/hda11          418       629   1602688+  83  Linux
</example>
Существует несколько неиспользующихся разделов. Они предназначены для установки
второго дистрибутива Linux или для пространства расширения растущих деревьев каталогов.

<sect2>Монтирование файловых систем
<p>
Монтирование ранее созданных файловых систем выполняется согласно файла 
<file>/etc/fstab</file>:
<example>

# /etc/fstab: статическая информация о файловых системах.
#
# файловая_система точка_монтирования тип      опции_монтирования     дамп проход
/dev/hda3             /               ext2    defaults,errors=remount-ro 0 1
/dev/hda5             none            swap    sw                      0 0
proc                 /proc            proc    defaults                0 0
/dev/fd0             /floppy          auto    defaults,user,noauto    0 0
/dev/cdrom           /cdrom           iso9660 defaults,ro,user,noauto 0 0
#
# keep partitions separate
/dev/hda7       /home           ext2    defaults                0 2
/dev/hda8       /var            ext2    defaults                0 2
/dev/hda6       /var/lib/cvs    ext2    defaults                0 2
# параметр noatime повышает скорость чтения файлов 
/dev/hda9       /usr            ext2    defaults,noatime        0 2
/dev/hda10      /var/cache/apt/archives ext2    defaults        0 2

# очень большой раздел для кэша прокси-сервера
/dev/hda11      /var/spool/squid ext2   rw                      0 2

# резервный загрузочный раздел DOS
/dev/hda1       /mnt/dos        vfat    rw,noauto               0 0
# резервный загрузочный раздел с системой Linux (не готова)
/dev/hda2       /mnt/linux      ext2    rw,noauto               0 0
#
# монтирование nfs
mickey:/        /mnt/mickey     nfs     ro,noauto,intr          0 0
goofy:/         /mnt/goofy      nfs     ro,noauto,intr          0 0
# minnie:/ /mnt/minnie smbfs ro,soft,intr,credentials={filename} 0 2
</example>

Для NFS я использую опции <tt>noauto,intr</tt>, сочетаемые с опцией <tt>hard</tt>, 
которая стоит по умолчанию. Благодаря этому становится возможным восстановиться  
из повысшего процесса по причине умершего соединения посредством нажатия 
Ctrl-C.
<p>
Для соединений к Windows-машинам, подключенным через Samba (smbfs), разумно использовать
опции <tt>rw,auto,soft,intr</tt>. Смотрите <ref id="samba">.

<p>
Для флоппи-дисководов использование набора опций <tt>noauto,rw,sync,user,exec</tt> предотвратит
повреждение файлов в результате случайного извлечения дискеты до ее размонтирования, но замедлит
запись на дискету.

<sect2>Автоматическое монтирование
<p>
Ключевые моменты для автомонтирования:
<list compact>
<item>Загрузите модуль <tt>vfat</tt>, чтобы можно было в файле <file>/etc/auto.misc</file>
 указать <tt>-fstype=auto</tt>:
<example>
# modprobe vfat # выполняется перед доступом к флоппи-диску
 ...либо, чтобы это было автоматически:
# cat >>/etc/modules
vfat
^D
 ... и перезагрузите систему.
</example>
<item>Отредактируйте файл <file>/etc/auto.misc</file> следующим образом:
<example>
floppy -fstype=auto,sync,nodev,nosuid,gid=100,umask=000 :/dev/fd0
 ... где  gid=100 соответствует группе "users".
</example>
<item>Создайте ссылки <file>cdrom</file> и <file>floppy</file> в каталоге <file>/home/<var>user</var></file>,
указывающие соответственно на  
 <file>/var/autofs/misc/cdrom</file> и 
 <file>/var/autofs/misc/floppy</file>.
<item>Добавьте <var>user</var> к группе "users".
</list>

<sect2>Монтирование NFS
<p>
Внешний Linux NFS сервер (goofy) размещается за файерволом (шлюзом). У меня
достаточно слабая политика безопасности в моей ЛВС, так как я единственный пользователь. Чтобы
разрешить доступ по NFS, на стороне NFS сервера нужно добавить в файл <file>/etc/exports</file>
следующее:
<example>
# /etc/exports: список управления доступом для файловых систем, которые 
# можно экспортировать клиентам по NFS. Смотрите exports(5).
/       (rw,no_root_squash)
</example>
Это нужно для активации NFS сервера помимо установки пакетов NFS-сервера и клиентов.
<p>
Для простоты я обычно создаю один раздел 2 GB для экспериментов или для второй инсталляции
Linux. По желанию можно сделать так, что обе установки будут разделять один раздел подкачки 
и раздел <file>/tmp</file>. A multipartition scheme is too involved for
these usages. Если требуется только консольная система, 500MB будет вполне достаточно.
</sect1>

<sect1>Рекомендации по оперативной памяти
<p>
Требования системы в оперативной памяти:
<example>
  4MB:  Минимум для работы ядра Linux.
 16MB:  Минимум для приемлемой консольной системы.
 32MB:  Минимум для простой системы X Window.
 64MB:  Минимум для системы X Window с GNOME/KDE.
128MB:  Для комфортной работы с системой X Window c GNOME/KDE.
256MB (и больше): А почему бы и нет, если Вы можете себе столько позволить?  DRAM не такая дорогая.
</example>
Использование загрузочной опции <tt>mem=4m</tt> (или lilo <tt>append="mem=4m"</tt>) покажет, как система 
будет работать на 4MB оперативной памяти.  Данный загрузочный параметр необходим для  
систем с объемом оперативной памяти более 64MB со старым BIOS.
</sect1>

<sect1>Пространство для подкачки
<p>
Я придерживаюсь следующим рекомендациям по распределению пространства для подкачки:
<list compact>
<item>Каждый раздел подкачки &lt; 128MB (для старых ядер 2.0 ), &lt; 2GB
(для более свежих ядер)
<item>Общий размер пространства для подкачки = либо (1-2 величины объема установленной оперативной памяти)
         либо (128MB- 2GB) в качестве общей рекомендации
<item>Распределите этот объем по разным физическим дискам и монтируйте их все с опцией
 <tt>sw,pri=1</tt> в файле <file>/etc/fstab</file>. Это гарантирует, что ядро выполнит RAID-чередование 
     swap-разделов для максимальной производительности подкачки.
<item>По возможности используйте середину жесткого диска.
</list>
<p>
Даже если Вам не требуется подкачка, некоторый раздел подкачки все же
желателен, например, чтобы оттянуть сбой системы с работающей программой, которая грешит
утечками памяти.
</sect1>
</sect>

<sect id="bashconf">Конфигурация командного интерпретатора Bash
<p>
Я изменяю стартовые скрипты по всей системе по своему вкусу таким образом:
<example>
/etc/bash.bashrc        заменяю на свой
/etc/profile            Оставляю копию из дистрибутива ( \w -&gt; \W)
/etc/skel/.bashrc       заменяю на свой
/etc/skel/.profile      заменяю на свой
/etc/skel/.bash_profile заменяю на свой
~/.bashrc               заменяю на свой для всех учетных записей
~/.profile              заменяю на свой для всех учетных записей
~/.bash_profile         заменяю на свой для всех учетных записей
</example>
<url id="&examples/" name="Смотрите подробности в моих примерных скриптах">. 
Так как мне нравиться прозрачная система, я устанавливаю значение <prgn>umask</prgn> равное 002 или 022.
<p>
Переменная <prgn>PATH</prgn> устанавливается через следующие конфигурационные файлы в таком порядке:
<example>
/etc/login.defs  - перед тем, как оболочка устанавливает PATH
/etc/profile     (может вызывать /etc/bash.bashrc)
~/.bash_profile  (может вызывать  ~/.bashrc)
</example>
</sect>

<sect id="gpm">Настройка мыши
<p>
<sect1>Мышь PS/2 
<p>
В случае мыши на PS/2 на материнской плате ATX сделайте, чтобы сигналы от мыши
проходили такой путь:
<example>
mouse -&gt; /dev/psaux -&gt; gpm -&gt; /dev/gpmdata = /dev/mouse -&gt; X
</example>
Здесь создается символическая ссылка <file>/dev/mouse</file>, указывающая
на файл <file>/dev/gpmdata</file>, для того, чтобы нормально работали некоторые утилиты
конфигурирования и чтобы было легче выполнять перенастройку. (Например,
если Вы потом решите отказаться использовать демон <prgn>gpm</prgn>, то после этого 
просто настройте символическую ссылку <file>/dev/mouse</file> таким образом,
чтобы она указывала на файл <file>/dev/psaux</file>.)
<p>
Такой путь сигналов от мыши/клавиатуры позволяет отсоединять и инициализировать их,
повторно перезапуская <prgn>gpm</prgn> после подключения устройств. При этом система X Window 
будет нормально работать!
<p>
Протокол взаимодействия между <prgn>gpm</prgn> и X input может быть реализован одним из
двух способов: либо как "ms3" (т.е. использовать протокол трехкнопочной мыши Microsoft последовательного порта),
либо как сырой "raw"(использовать такой же протокол, как у подключенной мыши), причем данный выбор
предопределяет выбор протокола, использующийся в X Window.

<p>
Продемонстрируем пример настройки трехкнопочной PS/2 мыши фирмы Logitech 
(традиционная мышь в Unix).
<p>
Если Вам не повезло, и Ваша видеокарта не поддерживается четвертой версией XFree, и Вы вынуждены
использовать третью версию XFree (некоторые карты ATI 64), то для настройки в следующих примерах 
используйте файл <tt>/etc/X11/X86Config</tt> вместо <tt>/etc/X11/X86Config-4</tt>. 

<sect2 id="gpmms3">Подход с использованием протокола ms3 
<p>
<example>
/etc/gpm.conf            | /etc/X11/X86Config-4
=========================+======================================
device=/dev/psaux        | Section "InputDevice"
responsiveness=          |  Identifier "Configured Mouse"
repeat_type=ms3          |  Driver     "mouse"
type=autops2             |  Option     "CorePointer"
append=""                |  Option     "Device"   "/dev/mouse"
sample_rate=             |  Option     "Protocol" "IntelliMouse"
                         | EndSection
</example>
В данном случае тип мыши настраивается только в файле <file>gpm.conf</file>,
а конфигурация X Window остается неизменной.
Смотрите <url id="&examples/" name="Примерные скрипты">.

<sect2 id="gpmraw">Подход с использованием сырого "raw" протокола
<p>
<example>
/etc/gpm.conf            | /etc/X11/X86Config-4
=========================+======================================
device=/dev/psaux        | Section "InputDevice"
responsiveness=          |  Identifier "Configured Mouse"
repeat_type=raw          |  Driver     "mouse"
type=autops2             |  Option     "CorePointer"
append=""                |  Option     "Device"   "/dev/mouse"
sample_rate=             |  Option     "Protocol" "MouseManPlusPS/2"
                         | EndSection
</example>
В данном случае тип мыши устанавливается как через файл <file>gpm.conf</file>,
так и через файл конфигурации X.

<sect2>Как настроить другую мышь
<p>
У программы <prgn>gpm</prgn> тип устройства <tt>autops2</tt> предполагает 
автоопределение большинства типов мышей PS/2, существующих сейчас на рынке.
К несчастью, это не только работает не всегда, но не было доступно в релизах до Woody.  
В таких случаях попробуйте в файле <file>gpm.conf</file> установить тип <tt>ps2</tt> или <tt>imps2</tt> 
вместо <tt>autops2</tt>. Чтобы выяснить, о каких мышках знает программа <prgn>gpm</prgn>, выполните:
<tt>gpm -t help</tt>. Также смотрите <manref name="gpm" section="8">.
<p>
Если используется двухкнопочная PS/2 мышь, разрешите в X-протоколе эмуляцию третьей кнопки через
<tt>Emulate3Buttons</tt>. Разница в протоколах между двухкнопочной и трехкнопочной мышкой определяется
и настраивается автоматически программой <prgn>gpm</prgn> после однократного нажатия средней кнопки мыши.
<p>
Для X-протокола с <ref id="gpmraw"> или без использования программы <prgn>gpm</prgn> используйте:
<list compact>
<item><tt>IntelliMouse</tt>: мышь последовательного порта (<prgn>gpm</prgn>-повторитель протокола "ms3")
<item><tt>PS/2</tt>: мышь порта PS/2 (сначала всегда используйте это)
<item><tt>IMPS/2</tt>: любая мышь порта PS/2 (2, 3, мышь с прокруткой, получше)
<item><tt>MouseManPlusPS/2</tt>: Мышь Logitech для порта PS/2 
<item><tt>...</tt>
</list>
Дополнительно смотрите информацию на странице <url id="&mousexf86;" name="Поддержка мыши в XFree86">.
<p>
Типовая мышь Microsoft с прокруткой работает лучше с такой настройкой:
<example>
/etc/gpm.conf            | /etc/X11/X86Config-4
=========================+======================================
device=/dev/psaux        | Section "InputDevice"
responsiveness=          |  Identifier "Configured Mouse"
repeat_type=raw          |  Driver     "mouse"
type=autops2             |  Option     "CorePointer"
append=""                |  Option     "Device"   "/dev/mouse"
sample_rate=             |  Option     "Protocol" "IMPS/2"
                         |  Option     "Buttons" "5"
                         |  Option  "ZAxisMapping" "4 5"
                         | EndSection
</example>
<p>
На некоторых ноутбуках Toshiba активирование программы <prgn>gpm</prgn>
перед PCMCIA в скриптах начальной загрузки (System-V) помогает предотвратить
зависания системы. Странно, но факт.

<sect1>Мышь USB
<p>
Сначала убедитесь, что следующие функции ядра подключены либо в самом ядре, либо
реализованы в виде модулей:
<list compact>
<item>В секции "Input core support":
<list compact>
<item>"Input core support" (CONFIG_INPUT, <file>input.o</file>),
<item>"Mouse support" (CONFIG_INPUT_MOUSEDEV, <file>mousedev.o</file>),
</list>
<item>В секции "USB support":
<list compact>
<item>"Support for USB" (CONFIG_USB, <file>usbcore.o</file>),
<item>"Preliminary USB device filesystem" (CONFIG_USB_DEVICEFS),
<item>"UHCI" или "OHCI" (CONFIG_USB_UHCI || CONFIG_USB_UHCI_ALT ||
       CONFIG_USB_OHCI, <file>usb-uhci.o</file> || <file>uhci.o</file> ||
       <file>usb-ohci.o</file>),
<item>"USB Human Interface Device (full HID) support" (CONFIG_USB_HID,
      <file>hid.o</file>), и 
<item>"HID input layer support" (CONFIG_USB_HIDINPUT)
</list>
</list>
Здесь имена, приведенные в нижнем регистре, являются именами модулей.
<p>
Если вы не используете devfs, то следующим образом создайте файл устройства <file>/dev/input/mice</file> 
с major 13 и minor 63:
<example>
# cd /dev
# mkdir input
# mknod input/mice c 13 63
</example>
<p>
Для типовой <strong>USB</strong> мыши с прокруткой должна использоваться следующая
комбинация конфигурационных файлов:
<example>
/etc/gpm.conf            | /etc/X11/X86Config-4
=========================+======================================
device=/dev/input/mice   | Section "InputDevice"
responsiveness=          |  Identifier "Generic Mouse"
repeat_type=raw          |  Driver     "mouse"
type=autops2             |  Option     "SendCoreEvents" "true"
append=""                |  Option     "Device"   "/dev/input/mice"
sample_rate=             |  Option     "Protocol" "IMPS/2"
                         |  Option     "Buttons" "5"
                         |  Option  "ZAxisMapping" "4 5"
                         | EndSection
</example>
<p>
За дополнительной информацией смотрите страницу <url id="&linuxusb;" name="Проект Linux USB">.

<sect1>Сенсорный коврик ноутбука
<p>
Хотя сенсорный коврик на ноутбуке по умолчанию эмулирует поведение двухкнопочной
мышки PS/2, пакет <package>tpconfig</package> позволяет полностью контроллировать
устройством. Например, установка опции <tt>OPTIONS="--tapmode=0"</tt> в файле
<file>/etc/default/tpconfig</file> запретит надоедливое поведение "щелчок легким нажатием".
Измените файл <file>/etc/gpm.conf</file> следующим образом, чтобы использовать как 
сенсорный коврик, так и внешнюю мышь USB для работы в консоли:
<example>
device=/dev/psaux
responsiveness=
repeat_type=ms3
type=autops2
append="-M -m /dev/input/mice -t autops2"
sample_rate=
</example>
</sect>

<sect id="nfs">Конфигурация NFS
<p>
Настройка NFS выполняется через файл <file>/etc/exports</file>.
<example>
# apt-get install nfs-kernel-server
# echo "/ *.domainname-for-lan-hosts(rw,no_root_squash,nohide)" \
        &gt;&gt; /etc/exports
</example>
<url id="&examples/" name="Подробности смотрите в моих примерных скриптах">.
</sect>

<sect id="samba">Настройка Samba
<p>
Ссылки:
<list compact>
<item><url id="&sambahome;">
<item><package>samba-doc</package> пакет
</list>
<p>
Гораздо проще настраивать Samba для режима "share", когда создаются Windows for Workgroup-
подобные расшаренные ресурсы. Однако, установка Samba в режим "user" является предпочтительной.
<p>
Конфигурация Samba выполняется или через <prgn>debconf</prgn> или в редакторе <prgn>vi</prgn>:
<example>
# dpkg-reconfigure --priority=<var>low</var> samba # в Woody
# vi /etc/samba/smb.conf
</example>
<url id="&examples/" name="Подробности смотрите в моих примерных скриптах">.
<p>
Добавление нового пользователя в файл <file>smbpasswd</file> может быть выполнена командой <prgn>smbpasswd</prgn>:
<example>
$ su -c "smbpasswd -a username"
</example>
Убедитесь, что Вы используете шифрованные пароли для максимальной совместимости.
<p>
Установите <tt>os level</tt> согласно следующей таблице эквивалентности систем (чем больше число, тем
выше приоритет системы при выборах обозревателя сети):
<example>
0:      Samba с проигрышным атрибутом (никогда не станет главным обозревателем)
1:      WfW 3.1, Win95, Win98, Win/Me?
16:     Win NT WS 3.51
17:     Win NT WS 4.0
32:     Win NT SVR 3.51
33:     Win NT SVR 4.0
255:    Samba c максимальным приоритетом
</example>
Убедитесь, что пользователи являются членами группы, владеющей каталогом,
предназначенным для совместного доступа , и что права на каталог включают право выполнения.  
</sect>

<sect id="printer">Настройка принтера
<p>
Традиционный подход использования принтера заключается в установке программ <prgn>lpr</prgn>/<prgn>lpd</prgn>.
Существует также новая система печати - CUPS&trade; (Common UNIX Printing System). Еще существует PDQ.
За дополнительной информацией обращайтесь к <url id="&printing-howto;" name="Linux Printing HOWTO">.

<sect1 id="lprlpd"><prgn>lpr</prgn>/<prgn>lpd</prgn>
<p>
Чтобы использовать систему печати <prgn>lpr</prgn>/<prgn>lpd</prgn> (пакеты <package>lpr</package>, 
<package>lprng</package> и <package>gnulpr</package>), отредактируйте файл (базовая настройка)
 <file>/etc/printcap</file> следующим образом (в случае использования принтера PostScript или чисто текстового):
<example>
<var>lp</var>|<var>alias</var>:\
        :sd=/var/spool/lpd/<var>lp</var>:\
        :mx#0:\
        :sh:\
        :lp=/dev/lp0:
</example>
Эти строки обозначают следующее:
<list compact>
<item>Заглавная строка: <var>lp</var> &ndash; имя спула, <var>alias</var> =
 алиас
<item>mx#0 &ndash; размер файла неограничен
<item>sh &ndash; не печатать заголовки разорванных страниц
<item>lp=/dev/lp0 &ndash; устройство локального принтера, или port@host для удаленного принтера
</list>
Это хорошая конфигурация, если у Вас подключен PostScript-принтер. Это также будет 
хорошо работать в случае печати с Windows-машины через Samba, на любом принтере, поддерживающимся
Windows (правда, двунаправленная связь с принтером не поддерживается). Вам нужно только выбрать
соответствующую конфигурацию принтера на Windows-машине.
<p>
Если же у Вас принтер не поддерживает PostScript, Вам нужно установить 
фильтрующую систему на базе программы <prgn>gs</prgn>.  Существует
масса инструментов для автоматической настройки печати с установкой
файла <file>/etc/printcap</file>.

Возможна любая из этих комбинаций:
<list compact>
<item><package>gnulpr</package>, (<package>lpr-ppd</package>) и
  <package>printtool</package>&mdash; я использую эту.
<item><package>lpr</package> и <package>apsfilter</package>
<item><package>lpr</package> и <package>magicfilter</package>
<item><package>lprng</package> и <package>lprngtool</package>
<item><package>lprng</package> и <package>apsfilter</package>
<item><package>lprng</package> и <package>magicfilter</package>
<!-- I can think of more combinations but I add them if someone  
  actually report me they got it working with them.  -->
</list>
<p>
Чтобы запустить GUI-инструменты по настройке, такие как <prgn>printtool</prgn>,
смотрите <ref id="ss-xsu"> для получения привелегий root. Принтерные пулы, 
созданные программой <prgn>printtool</prgn>, используют <prgn>gs</prgn> и 
работают как PostScript-принтеры. Поэтому при доступе к ним, необходимо использовать
драйверы принтера Postscript. В Windows таким стандартным принтером является "Apple LaserWriter".
</sect1>

<sect1 id="cups">CUPS&trade;
<p>
Установите систему печати Common UNIX Printing System (сокращенно CUPS&trade;):
<example>
# apt-get install cupsys foomatic-bin foomatic-db
# apt-get install cupsys-bsd cupsys-driver-gimpprint
</example>
<!-- CUPS dependencies: Recommends are not installed automatically -->
<p>
Затем настройте систему через web-браузер:
</p>
<p>
<example>
$ <var>мой_браузер</var> http://localhost:631
</example>
</p>
<p>
Например, чтобы добавить Ваш принтер на некоторый порт в список
доступных принтеров, сделайте:
<list>
<item>нажмите "Printers" на главной странице, а там "Add Printer",
<item>Введите "root" в качестве имени пользователя и потом его пароль,
<item>перейдите к добавлению принтера, следуя подсказкам,
<item>вернитесь к странице "Printers", нажмите "Configure Printer", и 
<item>перейдите к настройке размера бумаги, разрешения и других параметров.
</list>
За дополнительной информацией обращайтесь по адресу 
<url id="http://localhost:631/documentation.html"> и
<url id="&cups-help;">.
<p>
</sect1>
</sect>

<sect>Прочие советы по инсталляции системы

<sect1 id="post-inst">Установка дополнительных пакетов после первоначальной инсталляции
<p>
После первоначальной инсталляции системы Вы получаете небольшую, но уже функционирующую
систему &debian;. И это самый подходящий момент установить большее количество пакетов.
<list>
<item>Запустите программу <prgn>tasksel</prgn>.  Изучите <ref id="tasksel">.
<p>
В случае необходимости Вы можете выбрать следующее:
<list compact>
<item>Для конечного пользователя &ndash; X Window System
<item>Для разработки &ndash; C and C++
<item>Для разработки &ndash; Python
<item>Для разработки &ndash; Tcl/Tk
<item>Прочее &ndash; TeX/LaTeX environment
<item>Для всего остального я предпочитаю использовать программу <prgn>tasksel</prgn> как руководство,
изучая состав компонентов, описанных в &lt;Task Info&gt;, для реализации некой задачи, и
устанавливаю пакеты по отдельности через <prgn>dselect</prgn>.
</list>

<item>Запуск <prgn>dselect</prgn>. 
<p>
Первое, что Вы захотите слелать, это выбрать Ваш любымый редактор и программы,
которые Вам нужны. Вы можете установить множество вариаций Emacs одновременно.
Смотрите <ref id="dselect"> и <ref id="pop-editor">.
<p>
Также Вы можете заменить некоторые пакеты по умолчанию на пакеты с большими возможностями.
<list compact>
<item>... <!-- Add list in generic way. -->
</list>
<item>...
</list>

Я обычно правлю файл <file>/etc/inittab</file> для простоты завершения работы системы следующим
образом:
<example>
...
# Выполнить при нажатии CTRL-ALT-DEL.
ca:12345:ctrlaltdel:/sbin/shutdown -t1 -a -h now
...
</example>
</sect1>

<sect1>Модули
<p>
Модули для драйверов устройств конфигурируются в процессе первоначальной
инсталляции. Программа <prgn>modconf</prgn> предоставляет меню-подобный 
инферфейс для настройки модулей после инсталляции. Эта программа полезна,
если  некоторые модули отсутствовали в ходе первоначальной инсталляции или
после установки нового ядра.
<p>
Все модули, которые необходимо загружать при старте системы, должны быть
перечислены в файле <file>/etc/modules</file>. Я также использую
программы <prgn>lsmod</prgn> и <prgn>depmod</prgn> для работы с модулями.
<p>
Также для ядер 2.4 добавьте несколько строк в файл <file>/etc/modules</file>
для работы IP-маскарадинга (FTP и прочие). Смотрите <ref id="kernel-modules">,
в частности <ref id="kernel-net">.

</sect1>

<sect1>Базовая установка CD-RW 
<p>
Отредактируйте следующие файлы:
<example>
/etc/lilo.conf  (добавьте append="hdc=ide-scsi ignore=hdc", (CDRW стоит мастером на втором канале - прим. переводчика)
                 запустите lilo для вступления в силу изменений)
/dev/cdrom      (создайте символическую ссылку следующим образом
                 # cd /dev; ln -sf scd0 cdrom
		)
/etc/modules    (добавьте "ide-scsi" и "sg". И если нужно "sr" после них.)
</example>
Подробности смотрите в <ref id="cdrw">.
</sect1>

<sect1 id="apm">Большой размер оперативной памяти и автовыключение питания 
<p>
Отредактируйте файл <file>/etc/lilo.conf</file> следующим образом для
установки загрузочных параметров большого объема ОЗУ (для ядер 2.2) и автовыключения
питания (для систем с улучшенным управлением питанием APM)
<example>
append="mem=128M apm=on apm=power-off noapic"
</example>
Выполните <prgn>lilo</prgn> для установки этих значений. Параметр <tt>apm=power-off</tt> 
необходим для SMP-ядра, а <tt>noapic</tt> - чтобы избежать проблем с аппаратурой SMP,
содержащей ошибки. Тоже самое может быть сделано путем прямого ввода опций перед загрузкой ядра.
Смотрите <ref id="bootprompt">.
<p>
Если поддержка APM скомпилировна как модуль, что в Debian является по умолчанию для ядер 2.4, 
то после загрузки запустите команду <tt>insmod apm power_off=1</tt> или 
для правки файла <file>/etc/modules</file> выполните:
<example>
# echo "apm power_off=1" &gt;&gt;/etc/modules
</example>
<p>
Кроме этого, на новых ядрах включение в ядре поддержки ACPI достигает той же цели 
и, кажется, является более дружественной к SMP (это требует более новых материнских плат).
Также ядро 2.4. на новых материнских платах должно правильно определять большие объемы ОЗУ.
<example>
CONFIG_PM=y
CONFIG_ACPI=y
...
CONFIG_ACPI_BUSMGR=m
CONFIG_ACPI_SYS=m
</example>
и добавьте следующие строки в файл <file>/etc/modules</file> в следующем порядке:
<example>
ospm_busmgr
ospm_system
</example>
Либо перекомпилируйте ядро со всеми этими опциями, установленными на значение "y". В любом
случае для ACPI никакие загрузочные параметры не нужны.
</sect1>


<sect1 id="killecn">Странные проблемы доступа на некоторые web-сайты
<p>
Недавние ядра Linux по умолчанию разрешают ECN, что может привести
к проблемам доступа к некоторым web-сайтам, находящимся за неправильными маршрузаторами.
Чтобы проверить статус ECN:
<example>
# cat /proc/sys/net/ipv4/tcp_ecn
 ... или 
# sysctl net.ipv4.tcp_ecn
</example>
Для выключения ECN используйте:
<example>
# echo "0" > /proc/sys/net/ipv4/tcp_ecn
 ... или
# sysctl -w net.ipv4.tcp_ecn=0
</example>
Чтобы запретить TCP ECN при каждой загрузке системы добавьте в файл <file>/etc/sysctl.conf</file> следующее:
<example>
net.ipv4.tcp_ecn = 0
</example>
</sect1>

<sect1>Конфигурация Dialup PPP 
<p>
Установите пакет <package>pppconfig</package>, чтобы настроить dialup PPP. 
<example>
# apt-get install pppconfig
# pppconfig
 ... следуйте инструкциям для конфигурирования dialup PPP
# adduser <var>user_name</var> dip
 ... разрешает пользователю <var>user_name</var> доступ к dialup PPP
</example>
Включение пользователем (<var>user_name</var>) dialup PPP доступа к интернету :
<example>
$ pon <var>Имя_провайдера</var>  # старт PPP-доступа к Вашему провайдеру интернет
 ... наслаждайтесь интернетом 
$ poff <var>ISP_name</var> # останавливает  PPP-доступ, <var>Имя_провайдера</var> указывать не обязательно
</example>
Подробности смотрите в <file>&f-ppp-readme;</file>.
<p>
Альтернативно можно использовать пакет <package>wvdial</package> для установки dialup PPP-доступа.
Обратите внимание на существование хорошо известной ошибки <url id="&bugs;82095">, иногда предотвращающей
работу c dialup PPP обычных пользователей.

<p>
Все программы дозвона используют демон <prgn>pppd</prgn>, который запускает
программы, найденные в <file>/etc/ppp/ip-up.d/</file> после подключения к провайдеру
и все программы, найденные в <file>/etc/ppp/ip-down.d/</file> после отключения от провайдера.
Это можно использовать для скачивания и отправки почты.
</sect1>

<sect1>Другие конфигурационные файлы для настройки из каталога <file>/etc/</file>
<p>
Вы можете захотеть добавить файл <file>/etc/cron.deny</file>, отсутствующй в стандартной 
установке Debian (можно скопировать файл <file>/etc/at.deny</file>).
</sect1>

</sect>

</chapt>



