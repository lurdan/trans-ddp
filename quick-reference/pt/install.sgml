<!-- CVS revision of this document "$Revision: 1.7 $"  -->
<!-- CVS revision of original english document "1.65"  -->

<chapt id="install"> Dicas para instalação do Sistema Debian

<p>
A documentação oficial para instalação da Debian se encontra em
<url id="&stable-info;">, e
<url id="&stable-install;">.
<p>
As versões em desenvolvimento são encontradas em 
<url id="&testing-info;" >, e
<url id="&testing-install;"> (trabalho em progresso, pode algumas vezes
não existir).
<p>
Embora "&book-title;" tenha sido escrito nos dias do lançamento da
Potato, a maior parte dos seus conteúdos foi atualizada para
&stabledebian; e &testingdebian;.

<sect> Dicas para instalação de sistemas Linux em geral
<p>
Usar os sabores <tt>testing</tt> ou <tt>unstable</tt> do &debian;
envolve um risco adicional de ter bugs sérios. O risco pode ser
gerenciado implementando um esquema de multi-inicialização com um sabor
mais estável do &debian; ou implementando o truque legal do
<prgn>chroot</prgn> com o mais estável como descrito em <ref
id="chroot">. O último permitirá que você execute diferentes sabores do
&debian; simultaneamente em consoles diferentes.
<p>

<sect1>O básico sobre a compatibilidade de hardware
<p>
Linux é compatível com o hardware de muitos PC's e pode ser instalado
frequentemente em qualquer sistema. Para mim foi tão fácil quanto
instalar Windows 95/98/Me. E a lista de hardwares compatíveis parece
continuar crescendo.
<p>
Se você tem um PC portátil (laptop), confira
<url id="&linonlap;" name="Linux on Laptops">
para instalação dos ponteiros (pointers) por marca e modelo.
<p>
Minha recomendação sobre hardware para PC de mesa (desktop) é "Apenas
seja conservador":
<list compact>
<item>SCSI ao invés de IDE para o trabalho, disco rígido IDE/ATAPI para
uso privado.
<item>IDE/ATAPI CD-ROM (ou CD-RW).
<item>PCI ao invés de ISA, especialmente para placas de rede (NIC).
<item>Use uma placa de rede barata. Tulip para PCI, NE2000 para ISA são
boas escolhas.
<item>Evite PCMCIA (portátil) em sua primeira instalação Linux.
<item>Sem teclados USB, mouse . . . a menos que você queira aventurar-se.
</list>
<p>
Se você tem uma máquina lenta, tirar fora o disco rígido e colocá-lo em
outra máquina mais rápida é uma boa idéia.
</sect1>

<sect1>Determinando hardware e chip set de um PC
<p>
Durante a instalação, lhe será pedido que identifique o hardware ou
chip set do PC. Às vezes esta informação pode não parecer fácil de
encontrar. Aqui vai um método:
<enumlist compact>
  <item>Abra o gabinete de seu PC e dê uma olhada dentro.
  <item>Anote os códigos de identificação dos chips grandes na placa de
  vídeo, placa de rede, chip próximo às portas seriais, chip próximo às
  portas IDE.
  <item>Anote o número de cartões impressos no verso das placas PCI e ISA.
</enumlist>
</sect1>

<sect1>Determinando o hardware de um PC via &debian;
<p>
Os comandos a seguir devem dar alguma idéia da configuração e hardware
presentes num sistema Linux.
<example>
$ lspci -v |pager
$ pager /proc/pci
$ pager /proc/interrupts
$ pager /proc/ioports
$ pager /proc/bus/usb/devices
</example>
Estes comandos podem ser rodados durante o processo de instalação num
terminal virtual teclando ALT-F2.
<p>
Para dispositivos USB, as classes de dispositivos são listadas em
<file>/proc/bus/usb/devices</file> como <tt>Cls=<var>nn</var></tt>:
<list compact>
<item>Cls=00 : Sem uso
<item>Cls=01 : Audio (alto-falante etc.)
<item>Cls=02 : Comunicação (MODEM, NIC, ...)
<item>Cls=03 : HID (Dispositivo de interface humana: teclado, mouse, joystick)
<item>Cls=07 : Impressora
<item>Cls=08 : Armazenamento de massa (FDD, drive CD/DVD, HDD, Flash, ...)
<item>Cls=09 : Hub (hub USB)
<item>Cls=255 : Específico de fabricante
</list>
Se a classe de um dispositivo não for 255, o Linux tem suporte ao
dispositivo.
</sect1>

<sect1>Determinando o hardware de um PC por meio de outros SO's
<p>
A informação sobre o hardware pode ser obtida a partir de outros OS's.
<p>
Instale outra distribuição comercial Linux. A detecção de hardware
tende, por ora, a ser melhor nestas do que é na Debian. Esta situação
deve equilibrar-se à medida em que o debian-installer seja introduzido
com a Sarge.
<p>
Instale Windows. A configuração do hardware pode ser obtida pressionando
o botão direito do mouse em "My Computer" para obter Propriedades /
Gerenciador de Dispositivos. Anote todas as informações sobre os
recursos tais como IRQ, endereço de porta I/O e DMA. Algumas placas ISA
antigas podem precisar ser configuradas sob o DOS e usadas em conformidade.
</sect1>

<sect1>Um mito sobre o Lilo
<p>
Lilo está limitado a 1024 cilindros. &mdash;ERRADO !
<p>
O <prgn>lilo</prgn> mais recente, usado após a Debian Potato tem suporte
a lba32. Se o BIOS de sua placa mãe é suficientemente recente para
suportar lba32, <prgn>lilo</prgn> deveria estar apto a carregar além da
limitação do cilindro 1024.
<p>
Apenas certifique-se de adicionar a linha "lba32" em algum lugar próximo
ao início de seu arquivo <prgn>lilo.conf</prgn> se você tem mantido um
<prgn>lilo.conf.</prgn> antigo. Confira <file>&f-lilo;</file>
</sect1>

<sect1 id="instgrub">GRUB
<p>
O novo carregador de inicialização <package>grub</package> do projeto
GNU HURD pode ser instalado no sistema &debian; Woody:
<example>
# apt-get update
# apt-get install grub-doc
# mc &f-grub-doc;
... leia o conteúdo
# apt-get install grub
# pager &f-grub;
... leia-o :)
</example>
Para editar o menu do GRUB, edite <file>&f-grub-menu;</file>.  Veja 
<ref id="bootgrub"> para saber como configurar os parâmetros de
inicialização durante esta, pois é ligeiramente diferente do
<package>lilo</package>.
</sect1>

<sect1 id="bootfloppy">Escolha dos disquetes de inicialização
<p>
Para Potato, gostava do conjunto de discos IDEPCI para instalação normal
em um computador de mesa (desktop). Para Woody, gosto do conjunto de
discos de inicialização bf2.4. Ambos usam uma versão de
<package>boot-floppies</package> para criar os disquetes de
inicialização.
<p>
Se você tem uma placa de rede PCMCIA, você precisa usar o conjunto
padrão de discos de inicialização (o maior número de disquetes mas todos
os módulos disponíveis) e configurar a NIC na configuração PCMCIA; não
tente configurar uma placa NIC no diálogo de configuração padrão da rede.
<p>
Para sistemas especiais, você pode precisar criar um disco de
recuperação otimizado. Isto pode ser feito substituindo a imagem do
kernel denominada "linux" no disco de recuperação &debian;
sobrescrevendo-a com outra imagem comprimida do kernel compilada para a
máquina fora do sítio (off-site).
Detalhes são documentados em <file>readme.txt</file> no disco de
recuperação.  
O disquete de recuperação usa o sistema de arquivos MS-DOS, assim você
pode usar qualquer sistema para lê-lo e editá-lo.
Isto deveria torna mais fácil a vida das pessoas com uma placa de rede
especial, etc.
<p>
Para Sarge, espera-se usar <package>debian-installer</package> e/ou
<package>pgi</package> para criar os disquetes de inicialização.
</sect1>

<sect1>Instalação
<p>
Siga as instruções oficiais encontradas em
<url id="&stable-install;">
ou
<url id="&testing-install;"> (trabalho em progresso; pode, às vezes, não
existir).
<p>
Se você está instalando um sistema usando discos de recuperação da
distribuição em teste (testing), você pode precisar abrir um terminal
durante a instalação pressionando <tt>ALT-F2</tt> e edite manualmente as
entradas de <file>/etc/apt/sources.list</file>, substituindo <tt>stable</tt>
por <tt>testing</tt> para ajusta as fontes do APT.
<p>
Costumo instalar o <prgn>lilo</prgn> em lugares como
<file>/dev/hda3</file>, e instalo <prgn>mbr</prgn> em
<file>/dev/hda</file>. Isto diminui o risco de sobrescrever a informação
de inicialização.
<p>
Aqui está o que escolho durante o processo de instalação.
<list compact>
<item>MD5 passwords "yes"
<item>shadow passwords "yes"
<item>Install "advanced" (dselect **) e selecione
  <list compact>
    <item>Exclua emacs (se selecionado), nvi, tex, telnet, talk(d); 
    <item>Inclua mc, vim e nano-tiny ou elvis-tiny.
    <p>
     Veja <ref id="dselect">. Mesmo que você seja fã do Emacs, evite-o
     por ora e se contente com nano durante a instalação. Evite também
     instalar grandes pacotes tais como TeX (Potato fazia isto) nesta
     fase. Veja <ref id="bin-editor"> para entender as razões que
     justificam instalar nano-tiny ou elvis-tiny aqui.
  </list>
<item>Para todas as perguntas de configuração durante o diálogo de
     instalação de cada pacote: "y" (substitua versão atual).
<item><package>exim</package>: seleciono 2 para a máquina pois envio
     correio eletrônico através do servidor SMTP de  meu provedor de
     internet.
</list>
<p>
Para mais informações sobre dselect, veja <ref id="dselect">.
</sect1>

<sect1>Hosts e IP a usar para LAN
<p>
Exemplo de configuração de uma LAN (C subnet: 192.168.1.0/24):
<example>
Internet
   |
   +--- ISP externo fornece serviço POP (acessado pelo fetchmail)
   | 
   ISP de ponto de acesso fornece serviço DHCP e retransmissão SMTP
   |                     :
  Cable modem         (Dial-up)
   |                     :
Porta externa da máquina gateway da LAN: eth0 (IP dado pelo DHCP do
ISP)
 use PC portátil antigo (IBM Thinkpad, 486 DX2 50 MHz, 20 MB RAM)
 rode kernel Linux 2.4 com sistema de arquivos ext3.
 rode o pacote "ipmasq" (com as correções (patch) mais fortes, NAT e
 firewall)
 rode o pacote "dhcp-client" configurado para eth0 (sobrescreve a
 configuração de DNS)
 rode o pacote "dhcp" configurado para eth1
 rode "exim" como e modo de host auxiliar (smarthost, mode 2)
 rode "fetchmail" em longos períodos (fallback)
 rode "bind" como o cache do servidor de nomes para a Internet a partir
             da LAN
             como servidor de nomes autoritativo para o domínio da LAN a
             partir da LAN
 rode "ssh" na porta 22 e 8080 (conecte de qualquer lugar)
 rode "squid" como o servido de cache para o arquivo Debian (para APT)
Porta interna da máquina gateway da LAN: eth1 (IP = 192.168.1.1, fixo)
                         |
         +--- LAN Switch (10 base T) ---+
         |                              |
Alguns clientes de IP fixos na LAN     Alguns clientes DHCP na LAN
(IP = 192.168.1.2-127, fixo)    (IP = 192.168.1.128-200, dinâmico)
</example>
Veja <ref id="gateway"> para detalhes de configuração do servidor
gateway da LAN.
</sect1>

<sect1>Contas de usuário
<p>
Para manter a consistência entre diferentes máquinas, as primeiras contas
são sempre as mesmas em meu sistema.
<p>
Sempre crio a primeira conta de usuário com um nome como "admin"
(uid=1000). Eu reenvio todo email para o root para lá. Esta conta está
associada ao grupo <tt>adm</tt>  (veja <ref id="wheel">), para o qual
pode ser dado um grande número de privilégios root através do programa
<prgn>su</prgn> usando PAM ou o comando <prgn>sudo</prgn>. Veja  <ref
id="newuser"> para detalhes.
</sect1>

<sect1>Criando sistemas de arquivo
<p>
<sect2>Partição do disco rígido
<p>
Eu prefiro usar partições diferentes em diferentes árvores de diretório
para limitar o estrago numa eventual quebra do sistema. Por exemplo,
<example>
/          == (/ + /boot + /bin + /sbin)
           == 50MB+
/tmp       == 100MB+
/var       == 100MB+
/home      == 100MB+
/usr       == 700MB+ com X
/usr/local == 100MB
</example>
<p>
O tamanho do diretório <file>/usr</file> depende muito das aplicações do
sistema X-window e da documentação.
<file>/usr</file> pode ter 300MB se rodamos apenas um terminal console,
enquanto 2GB&ndash;3GB não é um tamanho incomum se temos muitas
aplicações Gnome instaladas.

Quando <file>/usr</file> ficar muito grande, mover
<file>/usr/share/</file> para uma partição diferente é o remédio mais
efetivo. Com os novos grandes kernels Linux 2.4 pré-empacotados, pode
ser necessária mais do que 200MB.

<p>
Por exemplo, o estado atual de minha máquina gateway para Internet é o
seguinte (saída do comando <tt>df -h</tt>):
<example>
Filesystem            Size  Used Avail Use&percnt; Mounted on
/dev/hda3             300M  106M  179M  38&percnt; /
/dev/hda7             100M   12M   82M  13&percnt; /home
/dev/hda8             596M   53M  513M  10&percnt; /var
/dev/hda6             100M  834k   94M   1&percnt; /var/lib/cvs
/dev/hda9             596M  222M  343M  40&percnt; /usr
/dev/hda10            596M  130M  436M  23&percnt; /var/cache/apt/archives
/dev/hda11            1.5G  204M  1.2G  14&percnt; /var/spool/squid
</example>
(A grande área reservada para <file>/var/spool/squid</file> é para um
proxy cache dos pacotes baixados.)
<p>
Segue abaixo a saída de <tt>fdisk -l</tt> que fornece uma idéia da
estrutura de particionamento:
<example>
# fdisk -l /dev/hda # comentário

/dev/hda1             1        41    309928+   6  FAT16 # DOS
/dev/hda2            42        84    325080   83  Linux # (não usada)
/dev/hda3   *        85       126    317520   83  Linux # Principal
/dev/hda4           127       629   3802680    5  Extended
/dev/hda5           127       143    128488+  82  Linux swap
/dev/hda6           144       157    105808+  83  Linux
/dev/hda7           158       171    105808+  83  Linux
/dev/hda8           172       253    619888+  83  Linux
/dev/hda9           254       335    619888+  83  Linux
/dev/hda10          336       417    619888+  83  Linux
/dev/hda11          418       629   1602688+  83  Linux
</example>
Há poucas partições não usadas. São para instalação de uma segunda
distribuição Linux ou para expandir árvores de diretórios crescentes.

<sect2>Montar sistema de arquivos
<p>
A montagem do sistema de arquivos acima é realizada corretamente com o
seguinte <file>/etc/fstab</file>:
<example>

# /etc/fstab: informação de sistema de arquivos estático
#
# file system   mount point     type    options                dump pass
/dev/hda3       /               ext2    defaults,errors=remount-ro 0 1
/dev/hda5       none            swap    sw                      0 0
proc            /proc           proc    defaults                0 0
/dev/fd0        /floppy         auto    defaults,user,noauto    0 0
/dev/cdrom      /cdrom          iso9660 defaults,ro,user,noauto 0 0
#
# manter partições separadas
/dev/hda7       /home           ext2    defaults                0 2
/dev/hda8       /var            ext2    defaults                0 2
/dev/hda6       /var/lib/cvs    ext2    defaults                0 2
# noatime aumentará velocidade de acesso a arquivo para leitura
/dev/hda9       /usr            ext2    defaults,noatime        0 2
/dev/hda10      /var/cache/apt/archives ext2    defaults        0 2

# partição muito grande para cache do proxy
/dev/hda11      /var/spool/squid ext2   rw                      0 2

# DOS inicializável de segurança (backup)
/dev/hda1       /mnt/dos        vfat    rw,noauto               0 0
# sistema Linux inicializável de segurança (backup) (não feito)
/dev/hda2       /mnt/linux      ext2    rw,noauto               0 0
#
# montagens nfs
mickey:/        /mnt/mickey     nfs     ro,noauto,intr          0 0
goofy:/         /mnt/goofy      nfs     ro,noauto,intr          0 0
# minnie:/ /mnt/minnie smbfs ro,soft,intr,credentials={filename} 0 2
</example>

Para  NFS, uso <tt>noauto,intr</tt> combinada com a opção padrão
<tt>hard</tt>. Deste modo, é possível safar-se de um processo congelado
devido a uma conexão morta usando Control-C.
<p>
Para uma máquina Windows conectada com Samba (smbfs),
<tt>rw,auto,soft,intr</tt> pode ser uma boa idéia. Veja <ref id="samba">.
<p>
Para os disquetes, <tt>noauto,rw,sync,user,exec</tt> ao contrário
previne contra a corrupção de arquivos após a ejeção acidental do
disquete antes de desmontá-lo, mas isto retarda o processo de escrita.

<sect2>Montagem autofs
<p>
Pontos chave para a montagem automática:
<list compact>
<item>Carregue o módulo <tt>vfat</tt> para permitir que
<file>/etc/auto.misc</file> contenha <tt>-fstype=auto</tt>:
<example>
# modprobe vfat # antes da tentativa de acesso ao disquete
 ... ou, para automatizar esta configuração,
# cat >>/etc/modules
vfat
^D
 ... e reinicialize o sistema.
</example>
<item>Configure <file>/etc/auto.misc</file> como se segue:
<example>
floppy -fstype=auto,sync,nodev,nosuid,gid=100,umask=000 :/dev/fd0
 ... onde gid=100 é "users".
</example>
<item>Crie links em <file>/home/<var>user</var></file>,
<file>cdrom</file> e <file>floppy</file>, que apontem para
 <file>/var/autofs/misc/cdrom</file> e 
 <file>/var/autofs/misc/floppy</file> respectivamente.
<item>Torne <var>user</var> um membro do grupo "users".
</list>

<sect2>Montagem NFS
<p>
O servidor NFS Linux (goofy) fica atrás de um firewall (gateway). Eu
tenho uma política de segurança bastante aberta em minha LAN já que sou
eu o único usuário. Para permitir acesso NFS, o lado do servidor precisa
adicionar a <file>/etc/exports</file> o seguinte:
<example>
# /etc/exports: the access control list for file systems which may be
#               exported to NFS clients.  See exports(5).
/       (rw,no_root_squash)
</example>
Isto é necessário para ativar o servidor NFS, além de instalar e ativar
o servidor e cliente NFS.
<p>
Por simplicidade, normalmente crio uma partição única de 2GB para uma
instalação experimental ou secundária de Linux. Opcionalmente,
compartilho a partição de troca (swap) e a partição <file>/tmp</file>
para estas instalações. Um esquema multi-partição também é usado nestes
casos. Se é necessário apenas um simples sistema console, 500MB pode ser
mais do que suficiente.
</sect1>

<sect1>Guia sobre memória DRAM
<p>
O que se segue é um guia grosseiro sobre DRAM.
<example>
  4 MB:  Mínimo para o kernel Linux funcionar.
 16 MB:  Mínimo para um sistema console razoável.
 32 MB:  Mínimo para um sistema X simples.
 64 MB:  Mínimo para o sistema X com GNOME/KDE.
128 MB:  Confortável para o sistema X com GNOME/KDE.
256+MB:  Por que não se você pode se dar ao luxo disto? DRAM é barata.
</example>
Usando a opção de inicialização  <tt>mem=4m</tt> (ou lilo
<tt>append="mem=4m"</tt>) mostrará como o sistema funcionaria com 4MB de
memória instalada. É necessária o parâmetro de inicialização do lilo
para sistemas que contém mais do que 64 MB de memória e um BIOS antigo.
</sect1>

<sect1>Espaço de troca (swap)
<p>
Eu uso o seguinte guia para o espaço de troca:
<list compact>
<item> Cada partição de troca é &lt; 128 MB (antigo kernel 2.0), &lt; 2
GB (em kernels recentes)
<item> Total = ou 1 a 2 vezes a RAM instalada ou de 128 MB a 2 GB como
orientação
<item>Espalhe-as nos diferentes discos e monte-as com as opções
<tt>sw,pri=1</tt> options em <file>/etc/fstab</file>. Isto garante que o
kernel faça um striping RAID das partições de troca e ofereça o máximo
de performance na troca.
<item>Use uma porção central do disco rígido, quando possível.
</list>
<p>
Mesmo que você nunca precise disto, algum espaço de troca (128MB) é
desejável pois assim o sistema ficará lento antes de congelar com um
programa que consuma a memória.
</sect1>
</sect>

<sect>Configuração bash
<p>
Eu modifico os scripts shell de inicialização a meu gosto no sistema:
<example>
/etc/bash.bashrc        Utilize sua cópia privada
/etc/profile            Mantenha a cópia da distribuição ( \w -&gt; \W)
/etc/skel/.bashrc       Utilize sua cópia privada
/etc/skel/.profile      Utilize sua cópia privada
/etc/skel/.bash_profile Utilize sua cópia privada
~/.bashrc               Utilize sua cópia privada para todas as contas
~/.profile              Utilize sua cópia privada para todas as contas
~/.bash_profile         Utilize sua cópia privada para todas as contas
</example>
<url id="examples/" name="Veja detalhes nos meus scripts de exemplo">. 
Gosto de um sistema transparente, por isto configuro <prgn>umask</prgn>
para 002 ou 022.
<p>
<prgn>PATH</prgn> é configurado pelos seguintes arquivos de
configuração, nesta ordem:
<example>
/etc/login.defs  - antes o shell configura PATH
/etc/profile     (pode chamar /etc/bash.bashrc)
~/.bash_profile  (pode chamar ~/.bashrc)
</example>
</sect>

<sect>Configuração do mouse
<p>
<sect1>Mouses PS/2
<p>
No caso de um mouse com conector do tipo PS/2 em uma placa mãe ATX, o
fluxo do sinal deveria ser:
<example>
mouse -&gt; /dev/psaux -&gt; gpm -&gt; /dev/gpmdata = /dev/mouse -&gt; X
</example>
Aqui, um link simbólico para <file>/dev/mouse</file> é criado e aponta
para <file>/dev/gpmdata</file> para tornar alguns utilitários de
configuração felizes e mais a reconfiguração mais fácil.
(Por exemplo, se você decide não usar o daemon gpm, apenas aponte o link
simbólico <file>/dev/mouse</file> para <file>/dev/psaux</file> após
livrar-se do daemon <prgn>gpm</prgn>.)
<p>
Este fluxo de sinal permite que o teclado e o mouse sejam desplugados e
reinicializados com o <prgn>gpm</prgn> sendo rodado novamente na
reconexão. O X permanecerá vivo!
<p>
O protocolo do fluxo de sinal entre a saída do <prgn>gpm</prgn> e a
entrada do X pode ser implementado de dois modos, mutuamente exclusivos,
como "ms3" (usa o protocolo Microsoft 3-button serial mouse) ou "raw"
(usa o mesmo protocolo do mouse que está conectado), e esta escolha
determina a escolha do protocolo usado na configuração do X.
<p>
Abaixo, mostrarei os exemplos de configuração usando um mouse Logitech
3-button (mouse Unix-style tradicional) PS/2 como modelo.
<p>
Se você é um dos desafortunados cuja placa de vídeo não é suportada pelo
novo X4 e precisa usar o antigo X3 (algumas placas ATI 64 bit), configure
<tt>/etc/X11/X86Config</tt> ao invés de <tt>/etc/X11/X86Config-4</tt>
nos exemplos a seguir e instale os pacotes X3.

<sect2 id="gpmms3">A perspectiva do protocolo ms3
<p>
<example>
/etc/gpm.conf            | /etc/X11/X86Config-4
=========================+======================================
device=/dev/psaux        | Section "InputDevice"
responsiveness=          |  Identifier "Configured Mouse"
repeat_type=ms3          |  Driver     "mouse"
type=autops2             |  Option     "CorePointer"
append=""                |  Option     "Device"   "/dev/mouse"
sample_rate=             |  Option     "Protocol" "IntelliMouse"
                         | EndSection
</example>
Se esta perspectiva é usada, o ajuste do tipo de mouse é feito apenas
editando <file>gpm.conf</file> e a configuração do X permanece a mesma.
Veja <url id="examples/" name="meus scripts de exemplo">.

<sect2 id="gpmraw">A perspectiva do protocolo raw
<p>
<example>
/etc/gpm.conf            | /etc/X11/X86Config-4
=========================+======================================
device=/dev/psaux        | Section "InputDevice"
responsiveness=          |  Identifier "Configured Mouse"
repeat_type=raw          |  Driver     "mouse"
type=autops2             |  Option     "CorePointer"
append=""                |  Option     "Device"   "/dev/mouse"
sample_rate=             |  Option     "Protocol" "MouseManPlusPS/2"
                         | EndSection
</example>
Se esta perspectiva é usada, o ajuste do tipo de mouse é feito editando
<file>gpm.conf</file> assim como ajustando a configuração do X.

<sect2>Como ajustar um mice diferente
<p>

O tipo de dispositivo do <prgn>gpm</prgn> <tt>autops2</tt> supostamente
autodetecta muitos dos PS/2 mice no mercado. Infelizmente, nem sempre
funciona e não está disponível nas versões pré-Woody.
Para tais casos, tente usar <tt>ps2</tt>, ou <tt>imps2</tt> em
<file>gpm.conf</file> ao invés de <tt>autops2</tt>. Para descobrir quais
tipos de mouse o gpm reconhece: <tt>gpm -t help</tt>.
Veja <manref name="gpm" section="8">.
<p>
Se um mouse PS/2 de 2 botões é usado, configure o X para habilitar
<tt>Emulate3Buttons</tt>. A diferença de protocolo entre o mouse de 2
botões e o mouse de 3 botões é autodetectada a autoajustada para
<prgn>gpm</prgn> após apertar o botão central uma vez.
<p>
Para o protocolo X com <ref id="gpmraw"> ou com <prgn>gpm</prgn>, use:
<list compact>
<item><tt>IntelliMouse</tt>: mouse serial (repetidor gpm com "ms3")
<item><tt>PS/2</tt>: mouse PS/2 (sempre teste este primeiro)
<item><tt>IMPS/2</tt>:  mouses PS/2 (2, 3, ou mouses de rolagem, melhor)
<item><tt>MouseManPlusPS/2</tt>: mouse Logitech PS/2
<item><tt>...</tt>
</list>
Veja mais em <url id="&mousexf86;" name="Suporte a Mouse no XFree86">.
<p>
Para mouses de rolagem Microsoft típicos, sabe-se que funciona melhor
com:
<example>
/etc/gpm.conf            | /etc/X11/X86Config-4
=========================+======================================
device=/dev/psaux        | Section "InputDevice"
responsiveness=          |  Identifier "Configured Mouse"
repeat_type=raw          |  Driver     "mouse"
type=autops2             |  Option     "CorePointer"
append=""                |  Option     "Device"   "/dev/mouse"
sample_rate=             |  Option     "Protocol" "IMPS/2"
                         |  Option     "Buttons" "5"
                         |  Option  "ZAxisMapping" "4 5"
                         | EndSection
</example>
<p>
Para alguns pequenos portáteis Toshiba novos, ativar  <prgn>gpm</prgn>
antes do PCMCIA no script de inicialização System-V pode ajudar a
prevenir o travamento do sistema. Estranho mas verdadeiro.

<sect1>mouses USB
<p>
Certifique-se que você tem:
<list compact>
<item>"Input Core Support" e "Input Core Support/Mouse Support"
       habilitados no kernel ou como módulos.
<item>"Support for USB", "Preliminary USB device filesystem",
      "UHCI or OHCI", e "USB HID Support" habilitados no kernel ou como
       módulos.
<item>Instale o pacote <package>hotplug</package> e habilite
     <tt>X11_USBMICE_HACK=true</tt> no arquivo
     <file>/etc/default/hotplug.usb</file>
</list>
<p>
Se você não está usando dvfs, crie um dispositivo nó (node)
<file>/dev/input/mice</file> com major 13 e minor 63 como se segue:
<example>
# cd /dev
# mkdir input
# mknod input/mice c 13 63
</example>
<p>
Para mouses <strong>USB</strong> com roda típicos, as combinações de
configuração deveriam ser:
<example>
/etc/gpm.conf            | /etc/X11/X86Config-4
=========================+======================================
device=/dev/input/mice   | Section "InputDevice"
responsiveness=          |  Identifier "Generic Mouse"
repeat_type=raw          |  Driver     "mouse"
type=autops2             |  Option     "SendCoreEvents" "true"
append=""                |  Option     "Device"   "/dev/input/mice"
sample_rate=             |  Option     "Protocol" "IMPS/2"
                         |  Option     "Buttons" "5"
                         |  Option  "ZAxisMapping" "4 5"
                         | EndSection
</example>
<p>
Veja <url id="&linuxusb;" name="Linux USB Project"> para mais informações.

<sect1>Touch pad
<p>
Apesar de o touch pad no computador laptop emular um mouse de 2 botões
PS/2 como seu comportamento padrão, o pacote <package>tpconfig</package>
possibilita controle total do dispositivo. Por exemplo, configurando
<tt>OPTIONS="--tapmode=0"</tt> no arquivo
<file>/etc/default/tpconfig</file>, desabilita-se o incômodo
comportamento de "clique por batida leve". Configure o arquivo
<file>/etc/gpm.conf</file> como a seguir para usar tanto o touch pad
como o mouse USB externo no console:
<example>
device=/dev/psaux
responsiveness=
repeat_type=ms3
type=autops2
append="-M -m /dev/input/mice -t autops2"
sample_rate=
</example>

</sect>

<sect>Configuração NFS
<p>
Habilite NFS configurando <file>/etc/exports</file>.
<example>
# echo "/ *.domainname-for-lan-hosts(rw,no_root_squash,nohide)" \
        &gt;&gt; /etc/exports
</example>
<url id="examples/" name="Veja meus scripts de exemplo para detalhes">.
</sect>

<sect id="samba">Configuração Samba
<p>
Referências:
<list compact>
<item><url id="&sambahome;">
<item><package>samba-doc</package> package
</list>
<p>
Configurar Samba com modo "share" é muito mais fácil pois este cria
discos compartilhados tipo WfW. Mas é preferível configurá-lo com mode "ser".
<p>
Samba pode ser configurado através de <prgn>debconf</prgn> ou
<prgn>vi</prgn>:
<example>
# dpkg-reconfigure --priority=<var>low</var> samba # em Woody
# vi /etc/samba/smb.conf
</example>
<url id="examples/" name="Veja meus scripts de exemplo para detalhes">.
<p>
Adicionar um novo usuário ao arquivo smbpasswd pode ser feito via
<prgn>smbpasswd</prgn>:
<example>
$su -c "smbpasswd -a username"
</example>
Certifique-se de usar senhas criptografadas para uma compatibilidade
excelente.
<p>
Configure <tt>os level</tt> de acordo com o seguinte sistema de
equivalências (maior o número, maior a prioridade como servidor):
<example>
0:      Samba com uma atitude folgada (nunca se tornará um navegador
mestre) 
1:      Wfw 3.1, Win95, Win98, Win/me?
16:     Win NT WS 3.51
17:     Win NT WS 4.0
32:     Win NT SVR 3.51
33:     Win NT SVR 4.0
255:    Samba com enorme poder
</example>
Certifique-se de que usuários sejam membros do grupo dono do diretório
que deu acesso compartilhado e que o caminho do diretório tenha seu bit
de execução configurado para acesso.
</sect>

<sect id="printer">Configuração da Impressora
<p>
O método tradicional é <prgn>lpr</prgn>/<prgn>lpd</prgn>.  Há um novo
sistema: CUPS&trade; (Common UNIX Printing System).  PDQ é outra opção.
Veja  <url id="&printing-howto;" name="Linux Printing HOWTO"> para mais
informações.

<sect1 id="lprlpd"><prgn>lpr</prgn>/<prgn>lpd</prgn>
<p>
Para os spoolers do tipo <prgn>lpr</prgn>/<prgn>lpd</prgn>
(<package>lpr</package>, <package>lprng</package>, e
<package>gnulpr</package>), configure <file>/etc/printcap</file> como se
segue, deste que conectado a um impressora PostScript ou somento texto
(o básico):
<example>
<var>lp</var>|<var>alias</var>:\
        :sd=/var/spool/lpd/<var>lp</var>:\
        :mx#0:\
        :sh:\
        :lp=/dev/lp0:
</example>
Significado das linhas acima:
<list compact>
<item>Linha cabeçalho: <var>lp</var> &mdash; nome do spool,
<var>alias</var> = alias
<item>mx#0 &mdash; tamanho máximo do arquivo é ilimitado
<item>sh &mdash; suprime a impressão da primeira página do cabeçalho
<item>lp=/dev/lp0 &mdash; dispositivo de impressora local, ou
porta@host, se remota
</list>
Esta é uma boa configuração se você está conectado a uma impressora
PostScript.
Além disto, quando imprimir a partir de uma máquina Windows através do
Samba, esta é uma boa configuração para qualquer impressora suportada
por Windows (nenhuma comunicação bidirecional é suportada). Você tem d
e selecionar a configuração da impressora correspondente na máquina
Windows.
<p>
Se você não tem uma impressora PostScript, você precisa configurar um
sistema de filtros usando <prgn>gs</prgn>.
Há várias ferramentas para autoconfiguração com a finalidade de
configurar <file>/etc/printcap</file>.
Quaisquer destas combinações é uma opção:
<list compact>
<item><package>gnulpr</package>, (<package>lpr-ppd</package>) e
  <package>printtool</package> &mdash; Eu uso isto.
<item><package>lpr</package> e <package>apsfilter</package>
<item><package>lpr</package> e <package>magicfilter</package>
<item><package>lprng</package> e <package>lprngtool</package>
<item><package>lprng</package> e <package>apsfilter</package>
<item><package>lprng</package> e <package>magicfilter</package>
<!-- I can think of more combinations but I add them if someone  
  actually report me they got it working with them.  -->
</list>
<p>
Para rodar uma ferramenta de configuração GUI, tal como
<prgn>printtool</prgn>, veja <ref id="ss-xsu"> para obter privilégios de
root.  Impressoras spools criadas com <prgn>printtool</prgn> usam
<prgn>gs</prgn> e agem como impressoras PostScript.  Assim, quando as
acessar, use drivers de impressora PostScript. Na perspectiva do
Windows, "Apple LaserWriter" é o único padrão.
</sect1>

<sect1 id="cups">CUPS&trade;
<p>
Instale o Sistema de Impressão Comum UNIX (Common UNIX Printing System)
(ou CUPS&trade;):
<example>
# apt-get install cupsys cupsomatic-ppd 
# apt-get install cupsys-bsd cupsys-driver-gimpprint
</example>
<!-- CUPS dependencies: Recommends are not installed automatically -->
<p>
Então configure o sistema usando qualquer navegador Web:
</p>
<p>
<example>
$ <var>mybrowser</var> http://localhost:631
</example>
</p>
<p>
Por exemplo, para adicionar sua impressora em alguma porta à lista de
impressoras acessíveis:
<list>
<item>clique "Printers" na página principal e, e então "Add Printer",
<item>tecle "root" para o nome de usuário e sua senha,
<item>adicione a impressora seguindo os prompts,
<item>volte para a página "Printers" e clique "Configure Printer", e
<item>configure o tamanho do papel, resolução e outros parâmetros.
</list>
Mais informação em
<url id="http://localhost:631/documentation.html"> e
<url id="&cups-help;">.
<p>
Para kernel 2.4, veja também <ref id="parport">.
</sect1>
</sect>

<sect>Outras dicas de instalação no host

<sect1>Instale mais alguns pacotes após a instalação inicial
<p>
Desde que você já o tenha feito, já terá um pequeno mas funcional
sistema &debian;. É um bom momento para instalar pacotes maiores.
<list>
<item>Rode <prgn>tasksel</prgn>.  Veja <ref id="tasksel">.
<p>
Você pode escolher estes, se necessário:
<list compact>
<item>End-user &mdash; X window system
<item>Development &mdash; C and C++
<item>Development &mdash; Python
<item>Development &mdash; Tcl/Tk
<item>Miscellaneous &mdash; TeX/LaTeX environment
<item>
Para outros &mdash; eu prefiro usar  <prgn>tasksel</prgn> como um guia,
olhando os componentes listados sob &lt;Task Info&gt; e instalando-os
seletivamente através do dselect <prgn>dselect</prgn>.
</list>

<item>Rode <prgn>dselect</prgn>. 
<p>
Aqui, a primeira coisa que talvez você queira é selecionar seu editor
favorito e quaisquer programas que você necessitar. Você pode instalar
muitas variações do Emacs ao mesmo tempo. Veja <ref id="dselect"> e 
<ref id="pop-editor">. 
<p>
Você pode também substituir alguns dos pacotes padrão por outros com
muitos recursos.
<list compact>
<item>lynx-ssh (ao invés de lynx)
<item>... <!-- Add list in generic way. -->
</list>
<item>...
</list>

Normalmente, eu edito <file>/etc/inittab</file> para desligar facilmente.
<example>
...
# What to do when CTRL-ALT-DEL is pressed.
ca:12345:ctrlaltdel:/sbin/shutdown -t1 -a -h now
...
</example>
</sect1>

<sect1>Módulos
<p>
Módulos para os gerenciadores de dispositivo são configurados durante a
instalação inicial. Posteriormente <prgn>modconf</prgn> oferece um modo
de configuração dos módulos que é gerenciado por menus. Este programa é
muito útil quando alguns módulos foram esquecidos na instalação inicial
ou um novo kernel foi instalado após esta.
<p>
O nome dos módulos pré-carregados devem ser listados em
<file>/etc/modules</file>. Eu também uso <prgn>lsmod</prgn> e
<prgn>depmod</prgn> para controlá-los manualmente.
<p>
Certifique-se, também de adicionar algumas linhas em
<file>/etc/modules</file> para lidar com  mascaramento de ip (ftp, etc.)
em kernels 2.4.  Veja
<ref id="kernel-modules">, especificamente <ref id="kernel-net">.

</sect1>

<sect1>Configuração básica de CD-RW
<p>
Edite os seguintes arquivos:
<example>
/etc/lilo.conf  (adicione append="hdc=ide-scsi ignore=hdc", 
                 rode lilo para ativar)
/dev/cdrom      (symlink # cd /dev; ln -sf scd0 cdrom)
/etc/modules    (adicione "ide-scsi" e "sg". Se necessário, "sr" após 
                isto.) 
</example>
Veja <ref id="cdrw"> para detalhes.
</sect1>

<sect1 id="apm">Memória grande e autodesligamento
<p>
Edite o <file>/etc/lilo.conf</file> como se segue para configurar os
parâmetros de inicialização para grande memória (para kernels 2.2) e autodesligamento (para apm):
<example>
append="mem=128M apm=on apm=power-off noapic"
</example>
Rode <prgn>lilo</prgn> para instalar estas configurações.
<tt>apm=power-off</tt> é necessário para um  SMP-kernel e
<tt>noapic</tt>, para minimizar meu buggy SMP-hardware. O mesmo pode ser
feito diretamente, inserindo as opções no prompt de inicialização. Veja
<ref id="bootprompt">.
<p>
Se apm está compilado como um módulo, como nos kernels 2.4 padrão da
Debian, rode <tt># insmod apm power_off=1</tt> após a inicialização ou
configure <file>/etc/modules</file> com:
<example>
# echo "apm power_off=1" &gt;&gt;/etc/modules
</example>
<p>
Alternativamente, ao compilar suporte a ACPI obtém-se o mesmo resultado
com kernels mais novos e parece ser mais SMP-amigável (isto requer uma
placa mãe mais nova). O kernel 2.4 em placas mãe mais novas detecta
corretamente grandes memórias.
<example>
CONFIG_PM=y
CONFIG_ACPI=y
...
CONFIG_ACPI_BUSMGR=m
CONFIG_ACPI_SYS=m
</example>
e adicione as seguintes linhas em  <file>/etc/modules</file> nesta ordem:
<example>
ospm_busmgr
ospm_system
</example>
Ou recompile o kernel com todas as opções acima configuradas como
"y". De qualquer maneira, nenhum destes parâmetros de inicialização são
necessários com ACPI.
</sect1>

<sect1 id="killecn">Estranhos problemas de acesso a alguns websites
<p>
Kernels linux mais novos habilitam ECN por padrão (default), o que pode
causar problemas de acesso em alguns websites como roteadores
ruins. Para checar o status ECN:
<example>
# cat /proc/sys/net/ipv4/tcp_ecn
 ... ou
# sysctl net.ipv4.tcp_ecn
</example>
Para desabilitá-lo, use:
<example>
# echo "0" > /proc/sys/net/ipv4/tcp_ecn
 ... ou
# sysctl -w net.ipv4.tcp_ecn=0
</example>
Para desabilitar TCP ECN em toda inicialização, edite
<file>/etc/sysctl.conf</file> e adicione:
<example>
net.ipv4.tcp_ecn = 0
</example>
</sect1>

<sect1>Configuração Dial-up PPP
<p>
Instale o pacote <package>pppconfig</package> para configurar o acesso
dial-up PPP.
<example>
# apt-get install pppconfig
# pppconfig
 ... siga as instruções para configurar dial-up PPP
# adduser <var>user_name</var> dip
 ... permita que <var>user_name</var> acesse dial-up PPP
</example>
Acesso dial-up PPP pode ser iniciado pelo usuário:
(<var>user_name</var>):
<example>
$ pon <var>ISP_name</var>   # inicia o acesso PPP a seu ISP
 ... navegue na Internet
$ poff <var>ISP_name</var> # encerra o acesso PPP, <var>ISP_name</var> opcional
</example>
Veja <file>&f-ppp-readme;</file> para mais detalhes.
<p>
Alternativamente, o pacote <package>wvdial</package> pode ser usado para
configurar o acesso dial-up PPP.
</sect1>

<sect1>Outros arquivos de configuração para fuçar em <file>/etc</file>
<p>
Você pode querer adicionar um arquivo <file>/etc/cron.deny</file> que
não venha na instalação da distribuição Debian padrão (você pode copiar
<file>/etc/at.deny</file>).
</sect1>

</sect>

</chapt>



