<!-- CVS revision of this document "$Revision: 1.11 $"  -->
<!-- CVS revision of original english document "1.14"  -->
<!-- Traduction (JP Delange) au 14/02/02 de la modification de la version anglaise -->
<chapt id="woody">Mise à jour d'une distribution
<p>
Les notes de version officielles pour mettre à jour sont situées à 
<url id="&stable-release;">
et
<url id="&testing-release;"> (en développement).

<sect>Préparation de la transition (potato vers woody)
<p>
Une mise à jour via le réseau vers "testing" peut être effectuée comme suit
(lancer le script suivant <url id="&examples;" name="go-woody"> pour le faire
en une seule commande) :
<example>
# cd /etc/apt
# cp -f sources.list sources.old 
# :&gt;sources.list  
# cd /
# apt-setup noprobe 
 ... sélectionner http ou ftp
# cd /etc/apt
# grep -e "^deb " sources.list             &gt;sources.deb
# grep -e "^deb-" sources.list             &gt;sources.src
# sed -e "s/^d/#d/" /usr/share/doc/apt/examples/sources.list &gt;sources.list
# sed -e "s/stable/testing/"  sources.deb &gt;&gt;sources.list
# apt-get update
# apt-get install apt apt-utils
# cat &gt;preferences &lt;&lt;EOF
&gt; Package: *
&gt; Pin: release a=testing
&gt; Pin-Priority: 700
&gt; 
&gt; Package: *
&gt; Pin: release a=unstable
&gt; Pin-Priority: 70
&gt;
&gt; EOF
# sed -e "s/stable/unstable/" sources.deb &gt;&gt;sources.list
# sed -e "s/stable/unstable/" sources.src | \
&gt; sed -e "s/^deb-/#deb-/"                 &gt;&gt;sources.list
</example>
Conseils pour <file>/etc/apt/preferences</file> (voir <manref
name="apt_preferences" section="5">) :
<example>
passer à la version stable : changer la Pin-Priority de testing sur  80
passer à la version testing : garde en l'état (installe les paquets 
  instables avec apt-get en ajoutant "/unstable" après le nom du paquet)
passer à testing(unstable) : changer la Pin-Priority de unstable sur 600
passer à unstable(testing) : changer la Pin-Priority de unstable sur 800
</example>
Un conseil concernant le choix de Pin-Priority : aller de haut en bas de la
table précédente, commencer en haut immédiatement après une version de
distribution et descendre dans la table au fur et à mesure que le temps
approche pour le gel de la version suivante de la distribution.
<p>
Faites en sorte de configurer <prgn>apt</prgn> pour l'usage d'un proxy, si
nécessaire, en réglant la variable d'environnement <tt>http_proxy</tt> ou en
réglant la valeur de http dans <file>/etc/apt/apt.conf</file>.
<p>
La procédure décrite dans cette section ne fait que mettre à jour
<prgn>apt</prgn> et un ensemble minimum de paquets afin d'éviter des problèmes
de dépendance.
<p>
Comme cette méthode de mise à jour utilise <prgn>apt-get</prgn>, la gestion
des paquets <em>recommends</em> et <em>suggests</em> est limitée.
<!-- 
For now, I will make it compile by this simple fix. 
Please update entire chapter 
-->
<![%f-ref;[
Lisez <ref id="depends"> et utilisez <prgn>dselect</prgn> à la place pour
avoir un contrôle plus fin.
]]>
<![%q-ref;[
Utilisez <prgn>dselect</prgn> à la place pour
avoir un contrôle plus fin.
]]>
</sect>

<sect>Mise à jour vers Woody
<p>
Après la préparation ci-dessus :
<example>
# apt-get update        # commande essentielle AVANT de mettre à jour
 ... pour mettre à jour l'ensemble du système avec des "suggestions"  
# apt-get -u dist-upgrade
 ... pour mettre à jour et rester avec les réglages de dselect actuels 
    (new, better)
# apt-get -u dselect-upgrade # utiliser le résultat de configuration de 
                             # dselect
</example>
</sect>

<sect>Configuration de Woody 
<p>
(Ceci peut ne pas être à utiliser du fait de l'évolution constante de Woody.)
<p>
Pour un système Woody fraîchement installé, éditer
<file>/etc/apt/sources.list</file>, <file>/etc/apt/apt.conf</file>, et
<file>/etc/apt/preferences</file> pour réaliser la même structure que celle
décrite dans les sections ci-dessus.
</sect>

<sect id="spy">Améliorer le fichier <file>sources.list</file>
<p>
Améliorer le fichier <file>sources.list</file> en testant chaque site sur son
temps de latence et sa bande passante.
<example>
# apt-get install apt-spy
# cd /etc/apt ; mv sources.list sources.list.org
# apt-spy -d testing -l sources.apt
</example>
<prgn>netselect-apt</prgn> est similaire à <prgn>apt-spy</prgn>. Il crée un
fichier <file>sources.list</file> plus complet, mais utilise une méthode moins
bonne pour choisir le meilleur mirroir (comparaison des temps de ping).
<prgn>apt-setup</prgn> est la méthode manuelle pour sélectionner les mirroirs
de <file>sources.list</file>, mais c'est toujours le meilleur moyen de choisir
des mirroirs tant que <prgn>apt-spy</prgn> n'a pas été amélioré.
</sect>

</chapt>
