<!-- CVS revision of this document "$Revision: 1.33 $"  -->

<chapt id="tune"> Tuning a &debian; system
<p>
This chapter describes only the basics of system configuration. A prerequisite
of this chapter is reading <ref id="install">.  
<p>
For the security conscious, 
it is highly recommended to read the <url id="&securing-debian-howto;" 
name="Securing Debian Manual">, which can also be found as the
<package>&p-securing-debian-howto;</package> package.

<sect id="init-hints">System initialization hints
<p>
See <ref id="init"> for the basics of the &debian; init script.

<sect1 id="init-defaults">Customizing init scripts
<p>
&debian; uses the sys-V init script system.  Although all init scripts 
in <file>/etc/init.d/*</file> are marked as conffiles and sysadmins 
are free to modify them, customizing init scripts by
editing files in <file>/etc/defaults/*</file> is the preferred approach.
<p>
For example, <file>/etc/init.d/rcS</file> can be used to customize
boot-time defaults for <prgn>motd</prgn>, <prgn>sulogin</prgn>, etc.

<sect1 id="syslogd">Customizing system logging
<p>
System log mode can be configured using <file>/etc/syslog.conf</file>.
Check the <package>colorize</package> package for a program to 
colorize system log files.
See also <manref name="syslogd" section="8"> and 
<manref name="syslog.conf" section="5">.
</sect1>

<sect1 id="hdtune">Hardware access optimization
<p>
There are a few hardware optimization configurations that &debian; leaves 
to the sysadmin to take care of.
<list>
<item><package>hdparm</package>
 <list compact>
<item>Hard disk access optimization. Very effective.
<item>Dangerous. You must read <manref name="hdparm" section="8"> first.
<item><tt>hdparm -tT <var>/dev/hda</var></tt> to test disk access speed.
<item><tt>hdparm -c1 -d1 -u1 -m16 -A <var>/dev/hda</var></tt> to speed up a
  modern IDE system. (It may be dangerous.)
 </list>

<item><package>setserial</package>
 <list compact>
<item>Collection of tools for serial port management.
 </list>

<item><package>scsitools</package>
 <list compact>
<item>Collection of tools for SCSI hardware management.
 </list>

<item><package>memtest86</package>
 <list compact>
<item>Collection of tools for memory hardware management.
 </list>

<item><package>hwtools</package>
 <list compact>
<item>Collection of tools for low-level hardware management.
  <list compact>
   <item>irqtune: changes the IRQ priority of devices to allow devices that
   require high priority and fast service (e.g. serial ports, modems) to
   have it.
   <item>scanport: scans I/O space from 0x100 to 0x3ff looking for 
   installed ISA devices.
   <item>inb: a quick little hack that reads an I/O port and dumps the value
   in hex and binary.
  </list>

 </list>

<item><package>schedutils</package>
 <list compact>
<item>Linux scheduler utilities.
<item><prgn>taskset</prgn>, <prgn>irqset</prgn>, <prgn>lsrt</prgn>, 
 and <prgn>rt</prgn> are included.
<item>Together with <prgn>nice</prgn> and <prgn>renice</prgn> 
 (not included), they allow full control of process scheduling parameters. 
 </list>

</list>

<sect>Access control

<sect1 id="loginctrl">Access control through PAM and login
<p>
PAM (Pluggable Authentication Modules) provides login control.  
<example>
/etc/pam.d/*             # PAM control files
/etc/pam.d/login         # PAM control file for login
/etc/security/*          # PAM module parameters
/etc/securetty           # this controls root login by console (login)
/etc/login.defs          # this controls login behaviors (login)
</example>
<p>
Change the contents of <file>/etc/pam.d/login</file> as follows, if you want
insecure but passwordless console terminals at your own risk.
<example>
#auth       required   pam_unix.so nullok
auth       required   pam_permit.so
</example>
Similar tricks can be applied for <prgn>xdm</prgn>, <prgn>gdm</prgn>, ... , 
for passwordless console X.
<p>
On the other hand, install <package>cracklib2</package> and put 
<file>/etc/pam.d/passwd</file> as follows, if you want to enforce 
a good password policy.
<example>
password required       pam_cracklib.so retry=3 minlen=6 difok=3
</example>
One-time login password for account activation may also help.
For this, use passwd command with <tt>-e</tt> option 
<manref name="passwd" section="1">.
<p>
The maximum number of processes can be set with 
<tt>ulimit -u 1000</tt> in a Bash shell or with settings in 
<file>/etc/security/limits.conf</file> from PAM.  Other parameters such as
<tt>core</tt> can be set similarly. The initial value of <prgn>PATH</prgn> 
can be set by <file>/etc/login.defs</file> before the shell start up 
script.
<p>
The documentation for PAM is packaged in the
<package>libpam-doc</package> package. The Linux-PAM System
Administrator's Guide covers configuring PAM, what modules are
available etc. The documentation also includes The Linux-PAM
Application Developers' Guide and The Linux-PAM Module Writers'
Guide.
</sect1>

<sect1 id="wheel">"Why GNU <prgn>su</prgn> does not support the <tt>wheel</tt>
group"
<p>
This is the famous phrase at the bottom of the old <tt>info su</tt> page by
Richard M.  Stallman. Not to worry: the current <prgn>su</prgn> in &debian;
uses PAM, so that one can restrict the ability to use <prgn>su</prgn> to any
group using <prgn>pam_wheel.so</prgn> in <file>/etc/pam.d/su</file>.  The
following will set the <tt>adm</tt> group in a &debian; system as an
equivalent of the BSD <tt>wheel</tt> group and allow <prgn>su</prgn> without a
password for its members.
<example>
# anti-RMS configuration in /etc/pam.d/su
auth       required   pam_wheel.so group=adm

# Wheel members to be able to su without a password
auth       sufficient pam_wheel.so trust group=adm
</example>

<sect1>Meaning of various groups
<p>
A few interesting groups:
<list compact>
<item><tt>root</tt> group is the default wheel group for <prgn>su</prgn> 
 if <prgn>pam_wheel.so</prgn> is used without the <tt>group=</tt> argument. 
<item><tt>adm</tt> group can read logfiles. 
<item><tt>cdrom</tt> group can be used locally to give a set of 
        users access to a CD-ROM drive.
<item><tt>floppy</tt> group can be used locally to give a set of 
        users access to a floppy drive.
<item><tt>audio</tt> group can be used locally to give a set of 
        users access to an audio device.
<item><tt>src</tt> group owns source code, including files in 
        <file>/usr/src</file>. It can be used locally to give a user
	the ability to manage system source code.
<item><tt>staff</tt> membership is useful for helpdesk types or junior
	sysadmins, giving them the ability to do things in 
        <file>/usr/local</file> and to create directories in
        <file>/home</file>.
</list>
<p>
For a complete list, see the "FAQ" section in the
<url id="&securing-debian-howto;" name="Securing Debian Manual">,
which can also be found as the
<package>&p-securing-debian-howto;</package> package.

<sect1 id="sudo"><prgn>sudo</prgn> &ndash; a safer work environment
<p>
My usage of <prgn>sudo</prgn> is mostly a protection from my own stupidity.  I consider
using <prgn>sudo</prgn> a better alternative to always using the system as root.
YMMV. 
<p>
Install <prgn>sudo</prgn> and activate it by setting options in
/etc/<url id="&examples;" name="sudoers">.  Also check out the
<tt>sudo</tt> group feature in <file>&dochome;sudo/OPTIONS</file>.
<p>
The sample configuration provides "staff" group members access to any
commands run as root under <prgn>sudo</prgn> and also gives "src" members access to
selected commands run as root under <prgn>sudo</prgn>.
<p>
The advantage of <prgn>sudo</prgn> is that it only requires an ordinary user's password to
log in, and activity is monitored.  This is a nice way to give some authority to
a junior administrator.  For example:
<example>
$ sudo chown -R <var>myself</var>:<var>mygrp</var> .
</example>
<p>
Of course if you know the root password (as most home users do),
any command can be run under root from a user account:
<example>
$ su -c "shutdown -h now"
Password:
</example>
(I know I should tighten the admin account's <prgn>sudo</prgn> privileges.
But since this is my home server, I have not bothered yet.)
<p>
For a different program that allows ordinary users to run commands with root
privileges, see the <package>super</package> package.
</sect1>
    
<sect1 id="tcpd">Access control to daemon programs
<p>
The Internet <em>super-server</em>, <prgn>inetd</prgn>, is started at boot 
time by <file>/etc/rc2.d/S20inetd</file> (for RUNLEVEL=2), which is a
symlink to <file>/etc/init.d/inetd</file>.
Essentially, <prgn>inetd</prgn> allows running one daemon to invoke 
several others, reducing load on the system.
<p>
Whenever a request for service arrives, its protocol and service are
identified by looking them up in the databases in <file>/etc/protocols</file> and 
<file>/etc/services</file>.  <prgn>inetd</prgn> then looks up a normal
Internet service in the <file>/etc/inetd.conf</file> database,  or a Sun-RPC
based service in <file>/etc/rpc.conf</file>.
<p>
For system security, make sure to disable unused services in 
<file>/etc/inetd.conf</file>.
Sun-RPC services need to be active for NFS and other RPC-based programs.
<p>
Sometimes, <prgn>inetd</prgn> does not start the intended server 
directly but starts the <prgn>tcpd</prgn> TCP/IP daemon wrapper program
with the intended server name as its argument in <file>/etc/inetd.conf</file>.  
In this case, <prgn>tcpd</prgn> runs the appropriate server program 
after logging the request and doing some additional checks
using <file>/etc/hosts.deny</file> and <file>/etc/hosts.allow</file>.
<p>
If you have problem with remote access in a recent &debian; system, 
comment out "ALL: PARANOID" in <file>/etc/hosts.deny</file> if it exists.
<p>
For details, see
<manref name="inetd" section="8">,  
<manref name="inetd.conf" section="5">, 
<manref name="protocols" section="5">,  
<manref name="services" section="5">,  
<manref name="tcpd" section="8">,  
<manref name="hosts_access" section="5">, and
<manref name="hosts_options" section="5">. 
<p>
For more information on Sun-RPC, see
<manref name="rpcinfo" section="8"> , 
<manref name="portmap" section="8">, and
<file>&f-portmap;</file>.

<sect1 id="ldap">Lightweight Directory Access Protocol
<p>
References:
<list compact>
<item><url id="&openldaphome;" name="OpenLDAP">
<item>OpenLDAP Admin Guide in the <package>openldap-guide</package> package
<item>LDP: <url id="&ldap-linux-howto;" name="LDAP Linux HOWTO">
<item>LDP: <url id="&ldap-implementation-howto;" name="LDAP Implementation HOWTO">
<item><url id="&ldap-use1;" name="OpenLDAP, extensive use reports">
<item><url id="&ldap-use2;" name="Open LDAP with Courier IMAP and Postfix">
</list>
</sect>


<sect id="cdrw">CD-writer
<p>
CD-writers with ATAPI/IDE interfaces have recently become a very popular
option.  It is a nice medium for system backup and archiving for the home user
needing &lt; 640 MB capacity.  For the most authoritative information, see the
LDP <url id="&cd-writing-howto;" name="CD-Writing-HOWTO">.

<sect1>Introduction
<p>
First, any disruption of data sent to the CD-writer will cause irrecoverable
damage to the CD. Get a CD-writer with as large a buffer as possible. If money
is no object, do not bother with ATAPI/IDE, just get a SCSI version.  If you
have a choice of IDE interface to be connected, use the one on the PCI-bus
(i.e., on the motherboard) rather than one on the ISA-bus (an SB16 card,
etc.).
<p>
When a CD-writer is connected to IDE, it has to be driven by the IDE-SCSI
driver instead of an ordinary IDE CD driver. Also, the SCSI generic driver
needs to be activated. There are two possible approaches to doing this,
assuming a kernel distributed with modern distributions (as of March 2001).
</sect1>

<sect1>Approach 1: modules + <prgn>lilo</prgn>
<p>
Add the following line to <file>/etc/lilo.conf</file> if you are using a stock Debian
kernel. If multiple options are used, list them separated by spaces:
<example>
append="hdx=ide-scsi ignore=hdx"
</example>
Here the location of the CD-writer, which is accessed through the ide-scsi driver,
is indicated by <tt>hdx</tt>, where <em>x</em> represents one of the following:
<example>
hdb          for a slave on the first IDE port
hdc          for a master on the second IDE port
hdd          for a slave on the second IDE port
hde ... hdh  for a drive on an external IDE port
</example>
Type the following commands as root to activate after finishing all the
configuration:
<example>
# lilo
# shutdown -h now
</example>
</sect1>


<sect1>Approach 2: recompile the kernel
<p>
Debian uses <prgn>make-kpkg</prgn> to create a kernel.  Use the new
<tt>--append_to_version</tt> with make-kpkg to build multiple kernel images.
See <ref id="kernel">.
<p>
Use the following setup through <tt>make menuconfig</tt>:
<list>
<item>bzImage
<item>Exclude the IDE CD driver (not a must, but simpler to do this)
<item>Compile in ide-scsi and sg, or make them modules
</list>
</sect1>

<sect1>Post-configuration steps
<p>
Kernel support for the CD-writer can be activated during booting by
the following:
<example>
# echo ide-scsi &gt;&gt;/etc/modules
# echo sg       &gt;&gt;/etc/modules
# cd /dev; ln -sf scd0 cdrom
</example>
Manual activation can be done by:
<example>
# modprobe ide-scsi
# modprobe sg
</example>
After reboot, you can check installation by:
<example>
$ dmesg|less
# apt-get install cdrecord
# cdrecord -scanbus
</example>
<p>
[Per Warren Dodge] Sometimes there may be conflicts between
<tt>ide-scsi</tt> and <tt>ide-cd</tt> if there are both CD-ROM and
CD-R/RW on the system.  Try adding the following line to your
<file>/etc/modutils/aliases</file>, running <prgn>update-modules</prgn>, and
rebooting.
<example>
pre-install      ide-scsi      modprobe ide-cd
</example>
This causes the IDE driver to load before <tt>ide-scsi</tt>. The IDE
driver <tt>ide-cd</tt> takes control of the ATAPI CD-ROM &mdash;
anything that it hasn't been told to <strong>ignore</strong>. That
leaves just the ignored devices for <tt>ide-scsi</tt> to control. 
</sect1>

<sect1>CD-image file (bootable)
<p>
To create a CD-ROM of files under <file>target-directory/</file> as
<file>cd-image.raw</file>
(bootable, Joliet TRANS.TBL-enabled format; if not bootable, take out
<tt>-b</tt> and <tt>-c</tt> options), insert a boot floppy in the first floppy drive and
<example>
# dd if=<var>/dev/fd0</var> <var>target-directory/boot.img</var> 
# mkisofs -r -V <var>volume_id</var> -b <var>boot.img</var> -c <var>bootcatalog</var> -J -T \
        -o <var>cd-image.raw</var> <var>target_directory/</var>
</example>
<p>
One funny hack is to make a bootable DOS CD-ROM.  If an ordinary DOS boot
floppy disk image is in the above <file><var>boot.img</var></file>, the CD-ROM will boot
as if a DOS floppy were in the first floppy drive (A:).  Doing this with
freeDOS may be more interesting.
<p>
This CD-image file can be inspected by mounting it on the loop device.
<example>
# mount -t iso9660 -o ro,loop <var>cd-image.raw</var> /cdrom
# cd /cdrom
# mc
# umount /cdrom
</example>
</sect1>

<sect1>Write to the CD-writer (R, R/W):
<p>
First test with (assuming double speed)
<example>
# nice --10 cdrecord -dummy speed=2 dev=0,0 <var>disk.img</var>
</example>
Then if OK, write to CD-R with
<example>
# nice --10 cdrecord -v -eject speed=2 dev=0,0 <var>disk.img</var>
</example>
Or write to a CD-RW disk with
<example>
# nice --10 cdrecord -v -eject blank=fast speed=2 dev=0,0 <var>disk.img</var>
</example>
Some CD-RW drives work better with
<example>
# nice --10 cdrecord -v blank=all speed=2 dev=0,0
</example>
followed by
<example>
# nice --10 cdrecord -v -eject speed=2 dev=0,0 <var>disk.img</var>
</example>
Two steps are needed to prevent SCSI timeouts during blanking from
interfering with the burning step.  The argument value to 
<prgn>nice</prgn> may require some adjustments.
</sect1>

<sect1>Make an image file of a CD
<p>
Some CD-Rs and commercial CDs have junk sectors at the end that make copying
by <prgn>dd</prgn> impossible (the Windows 98 CD is one of them).  The
<package>cdrecord</package> package comes with the <prgn>readcd</prgn> command.  Use this to copy
any CD contents to an image file.  If it is a data disk, mount it and run
<prgn>mount</prgn> to see its actual size.  Divide the number shown (in blocks, = 1024
bytes) by 2 to get the number of actual CD sectors (2048 bytes).  Run
<prgn>readcd</prgn> with options and use this disk image to burn the CD-R/RW.
<example>
# readcd <var>target</var> <var>lun</var> <var>scsibusno</var> # select function 11
</example> 
Here, set all 3 command-line parameters to 0 for most cases.  Sometimes the
number of sectors given by <prgn>readcd</prgn> is excessive!  Use the above
number from an actual mount for better results.
<example>
My CD-R       = +2 sectors
MS Windows CD = +1 sector, i.e., +2048 bytes
</example>
</sect1>

<sect1>Debian CD images
<p>
To obtain the latest information on &debian; CDs, visit the
<url id="&debian-cd;" name="Debian CD site">. 
<p>
If you have a fast Internet connection, think about installing over 
the network using:
<list compact>
<item>a few <url id="&debian-floppyinst;" name="floppy images">.
<item>a <url id="&debian-netinst;" name="minimal bootable CD image">.
</list>
<p>
If you do not have a fast Internet connection, think about purchasing 
CDs from a <url id="&debian-venders;" name="CD vendors">.
<p>
Please do not waste bandwidth by downloading standard CD images 
unless you are a CD image tester (even with the new jigdo method).
<p>
One noteworthy CD image is <url id="&knoppix;" 
name="KNOPPIX - Live Linux Filesystem On CD">.  
This CD will boot a functioning &debian; system without 
installing itself to the hard disk.

<!-- old document section
$ export CVSROOT=anonymous@cvs.debian.org:/cvs/debian-boot
$ cvs co debian-cd
</example>
Following is a summary of CD image creation. 
<example>
# apt-get install debian-cd
# cd /etc/debian-cd
# vim CONF.sh
$ . CONF.sh
$ make distclean
$ make status
$ make list COMPLETE=1 SIZELIMIT1=555000000 SRCSIZELIMIT=665000000
$ make official_images
 or if you want only binary images :
$ make bin-official_images
-->
</sect1>

<sect1>Back up the system to CD-R
<p>
To copy key configuration files and data files to CD-R,
use the example "backup" script <url id="examples/" name="backup">.
Also see <ref id="diff-backup">.
</sect1>

<sect1>Copy a music CD to CD-R
<p>
Not tested by me:
<example>
# apt-get install cdrecord cdparanoia
# cdparanoia -s -B
# cdrecord dev=0,0,0 speed=2 -v -dao -eject defpregap=1 -audio *.wav
</example>
or,
<example>
# apt-get install cdrdao #disk at once
# cdrdao read-cd --device /dev/cdrom --paranoia-mode 3 my_cd # read cd
# cdrdao write --device /dev/cdrom --speed 8 my_cd    # write a new CD
</example>
<prgn>cdrdao</prgn> does a real copy (no gaps, etc...)
</sect1>
</sect>

<sect id="x">The X program
<p>
<taglist>
<tag><ref id="xsrvr">
<item>a program on a local host that displays an X window and/or desktop 
on a user's monitor (CRT, LCD) and accepts keyboard and mouse input. 
<tag><ref id="xclnt">
<item>a program on a (local or remote) host that runs X-window-compatible 
application software.
</taglist>
This reverses the ordinary use of "server" and "client" in other
contexts.  For basics refer to <manref name="X" section="7">, the LDP
<url id="&xwindowuser-howto;" name="XWindow-User-HOWTO">, and the <url
id="&remote-xapps-howto;" name="Remote X Apps mini-HOWTO">.
<p>
There are several ways of getting the "X server" (display side) to accept 
remote connections from an "X client" (application side):  

<list>
<item><prgn>xhost</prgn>
<list compact>
<item>the host list mechanism (very insecure).
<item>non-encrypted protocol (prone to eavesdropping attack).
<item>Do not use this, if possible.
<item>See <ref id="xhost"> and <manref name="xhost" section="1x">.
</list>
<item><prgn>xauth</prgn>
<list compact>
<item>the MIT magic cookie mechanism (insecure but better than
  <prgn>xhost</prgn>).
<item>non-encrypted protocol (prone to eavesdropping attack).
<item>use this only for local connection since it is less CPU intensive
than <prgn>ssh -X</prgn>.
<item>See <ref id="ss-xsu"> and <manref name="xauth" section="1x">.
</list>
<item><prgn>xdm</prgn>, <prgn>wdm</prgn>, <prgn>gdm</prgn>, 
 <prgn>kdm</prgn>, ... 
<list compact>
<item>the MIT magic cookie mechanism (insecure as <prgn>xauth</prgn>).
<item>See <manref name="xdm" section="1x"> and 
 <manref name="Xsecurity" section="7"> for the basics of X display access 
 control.
<item>See <manref name="wdm" section="1x">, <manref name="gdm" section="8">, 
 and <manref name="kdm.options" section="5"> for more information, 
 if these are installed.
<item>See <ref id="sys-v"> for how to disable <prgn>xdm</prgn> to gain 
 a Linux console upon boot without purging the <prgn>xdm</prgn> package.
</list>
<item><strong><prgn>ssh -X</prgn></strong>
<list compact>
<item>port forwarding mechanism through secure shell (<strong>secure</strong>).
<item>encrypted protocol (a waste of resources if used locally).
<item>use this for remote connections.
<item>See <ref id="xssh">.
</list>
</list>
All remote connection methods, except <prgn>ssh</prgn>, require TCP/IP
connection enabled on the X server.  See <ref id="xtcp">.

<sect1 id="configuring-x">Configure XFree86 4.x
<!-- Is this stuff valid for v3 too? If not, add a separate section for -->
<!-- v3. -->
<p>
There are two meta-packages that can be used to install all of the necessary
dependencies for XFree86: <package>x-window-system</package> and
<package>x-window-system-core</package>.  For most cases,
<package>x-window-system</package> is the package to install.
<p>
To enable hardware detection in the XFree86 package configuration stage,
install the packages <package>discover</package>, <package>mdetect</package>,
and <package>read-edid</package> prior to installing XFree86.
<!-- I'm not sure what exactly these packages do since I configured X without -->
<!-- the help of these packages.  All I know is that dexconf will try to use -->
<!-- them if available.  Anyone else have anything to add? -->
<p>
With the assistance of hardware detection, XFree86's configuration script,
<prgn>dexconf</prgn>, should create a useable
<file>/etc/X11/XF86Config-4</file> file.  To add user customizations, do not
edit the file between the text:
<example>
### BEGIN DEBCONF SECTION
[snip]
### END DEBCONF SECTION
</example>
<p>
Instead, add the customizations before the text.  For example, to use a custom
video device, add something resembling the following text to the <em>top</em>
of the file:
<example>
  Section "Device"
      Identifier        "Custom Device"
      Driver            "ati"
      Option            "NoAccel"
  EndSection

  Section "Screen"
      Identifier  "Custom Screen"
      Device      "Custom Device"
      Monitor     "Generic Monitor"
      DefaultDepth 24
      Subsection "Display"
          Depth       8
          Modes       "1280x960" "1152x864" "1024x768" "800x600" "640x480"
      EndSubsection
      Subsection "Display"
          Depth       16
          Modes       "1280x960" "1152x864" "1024x768" "800x600" "640x480"
      EndSubsection
      Subsection "Display"
          Depth       24
          Modes       "1280x960" "1152x864" "1024x768" "800x600" "640x480"
      EndSubsection
  EndSection

  Section "ServerLayout"
      Identifier        "Custom"
      Screen            "Custom Screen"
      InputDevice       "Generic Keyboard" "CoreKeyboard"
      InputDevice       "Configured Mouse" "CorePointer"
  EndSection
</example>

<sect1 id="reconf-x">Reconfigure XFree86
<p>
In Woody, re-configure X by:
<list compact>
<item><tt>dpkg-reconfigure --priority=low xserver-xfree86   # X4</tt>
<item><tt>dpkg-reconfigure --priority=low xserver-common-v3 # X3</tt>
</list>

<sect1 id="custom-x">Customize X session
<p>
X session can be started by:
<list compact>
<item><prgn>startx</prgn>: wrapper script command for <prgn>initx</prgn> to
      start X server and client from Linux character console.   If
      <file>~/.xinitrc</file> does not exist, <file>/etc/X11/Xsession</file> is
      executed through <file>/etc/X11/xinit/xinitrc</file>.
<item><prgn>xdm</prgn>, <prgn>gdm</prgn>, <prgn>kdm</prgn>, or
      <prgn>wdm</prgn>: X display manager daemon to start X server and
      client, and to control login from GUI screen.  
      <file>/etc/X11/Xsession</file> is directly executed.
</list>
<p>
The default start up script <file>/etc/X11/Xsession</file> is 
effectively a combination of
<file>/etc/X11/Xsession.d/50xfree86-common_determine-startup</file> and
<file>/etc/X11/Xsession.d/99xfree86-common_start</file>.
<p>
At the end of this sequence, a program first found in the following 
order will be executed with the <prgn>exec</prgn> command:
<enumlist compact>
<item><file>~/.xsession</file> or <file>~/.Xsession</file>, if it is defined.
<item><file>/usr/bin/x-session-manager</file>, if it is defined.
<item><file>/usr/bin/x-window-manager</file>, if it is defined.
<item><file>/usr/bin/x-terminal-emulator</file>, if it is defined.
</enumlist>
Exact meaning of these commands are determined by &debian; 
alternative system described in <ref id="alternatives">.
For example:
<example>
# update-alternatives --config x-session-manager
... or
# update-alternatives --config x-window-manager
</example>
In order to make any X window manager to be a default while keeping GNOME
and KDE session manager installed, replace
<file>/etc/X11/Xsession.d/50xfree86-common_determine-startup</file>
with the one attached in the second bug report at 
<url id="&bug-xfree;"> (I hope this to be included soon.)
and edit <file>/etc/X11/Xsession.options</file> as followings to disallow 
X session manager:
<example>
# /etc/X11/Xsession.options
#
# configuration options for /etc/X11/Xsession
# See Xsession.options(5) for an explanation of the available options.
# Default enabled
allow-failsafe
allow-user-resources
allow-user-xsession
use-ssh-agent
# Default disabled (enable them by uncommenting)
do-not-use-x-session-manager
#do-not-use-x-window-manager
</example>
<p>
<package>gnome-session</package> and <package>kdebase</package> are 
the package containing these X session manager.  Removing them allows
X window manager to be a default. (Yack, any better idea?)
<p>
If <file>~/.xsession</file> or <file>~/.Xsession</file> exist, the
action of <file>/etc/X11/Xsession</file> can be customized for each 
user.  Because of this, the last command in the 
<file>~/.xsession</file> file should use form of 
<tt>exec <var>some-window/session-manager</var></tt>.  Here
you may use one of the above mentioned generic name of the X 
window/session manager or any specific name of specific X 
window/session manager programs.  
<p>
An good example of the <file>~/.xsession</file> script is given at
<file>&f-xsession;</file>.
<p>
I use this to set window manager, screen access and language support for
each user account. See <ref id="s-w-manager">, <ref id="ss-xsu">, and
<ref id="x-cjk">.
<p>
User specific additional X resources can be stored in
<file>~/.Xresources</file>, while system wide X resources are stored in
<file>/etc/X11/Xresources/*</file>.  See <manref name="xrdb"
section="1x">.
<p>
User customized keymaps and pointer button mappings in X can be specified 
in <file>~/.xmodmaprc</file>.  See <manref name="xmodmap" section="1x">.

<sect1 id="s-w-manager">Start a particular X session/window manager
<p>
Following the principle described at <ref id="custom-x">,
user specific X session/window manager can be activated by setting
the content at the end of <file>~/.xsession</file> file as follows.

<list>
<item>default X session manager (See <ref id="alternatives">.)
<example>
exec /usr/bin/x-session-manager
</example>

<item>default X window manager (See <ref id="alternatives">.)
<example>
exec /usr/bin/x-window-manager
</example>

<item>GNOME session manager
<example>
exec /usr/bin/gnome-session
</example>

<item>KDE session manager
<example>
exec /usr/bin/kde2
</example>

<item>Windowmaker window manager
<example>
exec /usr/bin/wmaker
</example>

<item>FVWM2 window manager
<example>
exec /usr/bin/fvwm2
</example>

<item>Blackbox window manager
<example>
exec /usr/bin/blackbox
</example>

<item>...
<example>
exec /usr/bin/<var>any-window-manager</var>
</example>

</list>

<sect1 id="xsrvr">X server
<p>
See <manref name="XFree86" section="1x"> for X server information.
<p>
To (re)configure X4 in Woody, run:
<example>
# dpkg-reconfigure --p=low xserver-xfree86
</example>
<p>
Invoke X server from a local console:
<example>
$ startx -- :&lt;display&gt; <var>vtXX</var>
e.g.:
$ startx -- :1 vt8 -bpp 16
... start on vt8 connected to localhost:1 with 16 bpp mode
</example>
Arguments given after <tt>--</tt> are for the X server.
<p>
Note, when using a <file>~/.xserverrc</file> script to customize X
server start up process, be sure to  <tt>exec</tt> the real X server.
Failing to do this can make the X server slow to start and exit. For
example:
<example>
#!/bin/sh
exec /usr/bin/X11/X -dpi 100 -nolisten tcp
</example>
</sect1>

<sect1 id="xclnt">X client
<p>
Most X client programs can be started with a command like this:
<example>
client $ xterm -geometry 80x24+30+200 -fn 6x10 -display <var>hostname</var>:0 &amp;
</example>
Here, the optional command-line arguments mean:
<list>
<item><tt>-geometry <var>WIDTH</var>x<var>HEIGHT</var>+<var>XOFF</var>+<var>YOFF</var></tt>: 
the initial size and location of the window.

<item><tt>-fn <var>FONTNAME</var></tt>: the font to use for displaying text.
 <tt><var>FONTNAME</var></tt> can be:
<list compact>
<item>a14: Normal size font
<item>a24: Large size font
<item>... (check available fonts with <tt>xlsfont</tt>.)
</list>
<item><tt>-display <var>displayname</var></tt>: the name of the X server to use. 
 <tt><var>displayname</var></tt> can be:
<list compact>
<item><tt><var>hostname</var>:<var>D.S</var></tt> means screen <tt><var>S</var></tt> on display
 <tt><var>D</var></tt> of host <tt><var>hostname</var></tt>; the X server for this display is
listening to TCP port 6000+D.

<item><tt><var>host</var>/unix:<var>D.S</var></tt> means screen <tt><var>S</var></tt> on display 
<var>D</var> of host <tt><var>host</var></tt>; the X server for this display is 
listening to UNIX domain socket
<file>/tmp/.X11-unix/XD</file> (so it's only reachable from <tt><var>host</var></tt>).

<item><tt><var>:D.S</var></tt> is equivalent to 
<tt><var>host</var>/unix:<var>D.S</var></tt>, where <tt><var>host</var></tt> is the local hostname.
</list>
</list>
<p>
The default <tt><var>displayname</var></tt> for the X client program (application side) 
can be set by the DISPLAY environment variable.  For example, prior to 
running an X client program, executing one of the following commands 
achieves this:
<example>
$ export DISPLAY=:0 
        # The default, local machine using the first X screen
$ export DISPLAY=<var>hostname.fulldomain.name</var>:0.2
$ export DISPLAY=localhost:0
</example>
Its start up can be customized by <file>~/.xinitrc</file>.  For example:
<example>
xrdb -load $HOME/.Xresources
xsetroot -solid gray &amp;
xclock -g 50x50-0+0 -bw 0 &amp;
xload -g 50x50-50+0 -bw 0 &amp;
xterm -g 80x24+0+0 &amp;
xterm -g 80x24+0-0 &amp;
twm
</example>
As described in <ref id="custom-x">, this overrides everything normal 
execution of Xsession does when started from <prgn>startx</prgn>.
Use this approach only as the last resort.
</sect1>

<sect1 id="xtcp">TCP/IP connection to X
<p>
Because a remote TCP/IP socket connection without encryption is prone 
to an eavesdropping attack, the default setting for X in recent 
&debian; versions disables the TCP/IP socket.  Consider using <prgn>ssh</prgn> 
for a remote X connection (see <ref id="xssh">). 
<p>
The method described here is not encouraged unless one is in a very secure 
environment behind a good firewall system with only trusted users present.
Use the following command to verify your current X server setting for the
TCP/IP socket:
<example>
# find /etc/X11 -type f -print0 | xargs -0 grep nolisten
/etc/X11/xinit/xserverrc:exec /usr/bin/X11/X -dpi 100 -nolisten tcp
</example>
Remove <tt>-nolisten</tt> to restore TCP/IP listening on the X server.
</sect1>
 
<sect1 id="xhost">Remote X connection: <prgn>xhost</prgn>
<p>
<prgn>xhost</prgn> allows access based on hostnames. This is very insecure.
The following will disable host checking and allow connections from anywhere 
if a TCP/IP socket connection is allowed (see <ref id="xtcp">):
<example>
$ xhost +
</example>
You can re-enable host checking with:
<example>
$ xhost -
</example>
<p>
<prgn>xhost</prgn> does not distinguish between different users on the 
remote host. Also, hostnames (addresses actually) can be spoofed. 
<p>
This method must be avoided even with more restrictive host criteria
if you're on an untrusted network (for instance with dialup PPP
access to the Internet).  See <manref name="xhost" section="1x">.
</sect1>

<sect1 id="xssh">Remote X connection: <prgn>ssh</prgn>
<p>
The use of <prgn>ssh</prgn> enables a secure connection from a local X server 
to a remote application server.  
<list>
<item>Set <tt>X11Forwarding</tt> and <tt>AllowTcpForwarding</tt> entries 
to <tt>yes</tt> in <file>/etc/ssh/sshd_config</file> of the remote host.
<item>Start the X server on the local host.
<item>Open an <prgn>xterm</prgn> in the local host.
<item>Run <prgn>ssh</prgn> to establish a connection with the remote site.  
<example>
localname @ localhost $ ssh -q -X -l loginname remotehost.domain
Password:
.....
</example>
<item>Run X application commands on the remote site.
<example>
loginname @ remotehost $ gimp &
</example>
</list>
This method allows the display of the remote X client output as if it 
were locally connected through a local UNIX domain socket.
</sect1>

<sect1 id="xtermfaq"><prgn>xterm</prgn>
<p>
Learn everything about <prgn>xterm</prgn> at <url id="&xtermfaq;">.
</sect1>


<sect1 id="ss-xsu">Gain root in X
<p>
If a GUI program needs to be run with root privilege, use the following
procedures to display program output on a user's X server.
<strong>Never attempt to start an X server directly from the root
account</strong> in order to prevent possible security risks.
<p>
Start the X server as a normal user and open an <prgn>xterm</prgn> console.
Then:
<example>
$ XAUTHORITY=$HOME/.Xauthority
$ export XAUTHORITY
$ su root
Password:*****
# printtool &
</example>
When using this trick to <prgn>su</prgn> to a non-root user, make
sure <file>~/.Xauthority</file> is group readable by this non-root user.
<p>

<!-- this section moved up -->

To automate this command sequence, create a file
<file>~/.xsession</file> from the user's account, containing following
lines:
<example>
# This makes X work when I su to the root account.
if [ -z "$XAUTHORITY" ]; then
        XAUTHORITY=$HOME/.Xauthority
        export XAUTHORITY
fi
# If particular window/session manager is desired, uncomment following
# and edit it to fit your needs.
#STARTUP=/usr/bin/blackbox
# This start x-window/session-manager program
if [ -z "$STARTUP" ]; then
  if [ -x /usr/bin/x-session-manager ]; then
    STARTUP=x-session-manager
  elif [ -x /usr/bin/x-window-manager ]; then
    STARTUP=x-window-manager
  elif [ -x /usr/bin/x-terminal-emulator ]; then
    STARTUP=x-terminal-emulator
  fi
fi
# execute auto selected X window/session manager
exec $STARTUP
</example>
Then run <prgn>su</prgn> (not <tt>su -</tt>) in an
<prgn>xterm</prgn> window of the user.  Now GUI programs started from this
<prgn>xterm</prgn> can display output on this user's X window while running
with root privilege.  This trick works as long as the default 
<file>/etc/X11/Xsession</file> is
executed.  If a user set up his customization using <file>~/.xinit</file>
or <file>~/.xsession</file>, the above mentioned environment
<tt>XAUTHORITY</tt> variable needs to be set similarly in those scripts.

<p>Alternatively, <package>sudo</package> can be used to automate the command sequence:
<example>
$ sudo xterm
... or
$ sudo -H -s
</example>
Here <file>/root/.bashrc</file> should contain:
<example>
if [ $SUDO_USER ]; then
    sudo -H -u $SUDO_USER xauth extract - $DISPLAY | xauth merge -
fi
</example>
This works fine even with the home directory of the user on an NFS
mount, because root does not read the <file>.Xauthority</file> file.
<p>
There are also several specialized packages for this purpose:
<package>kdesu</package>, <package>gksu</package>, <package>gksudo</package>,
<package>gnome-sudo</package>, and <package>xsu</package>.  Some
other methods can be used to achieve similar results: creating a symlink from
<file>/root/.Xauthority</file> to the user's corresponding one; use of the
script <url id="&suxhome;" name="sux">; or putting "<tt>xauth merge
~<var>USER_RUNNING_X</var>/.Xauthority</tt>" in the root initialization script.
<p>
See more on the <url id="&deb-dev-su;" name="debian-devel mailing list">.
</sect1>

<sect1 id="xfs-tt">TrueType fonts in X
<p>
The standard <prgn>xfs</prgn> in XFree86-4 works fine with TrueType
fonts.  You have to install a third-party font server such as
<prgn>xfs-xtt</prgn>, if you are using XFree86-3.
<p>
You just need to make sure that whatever apps you want to use the
TrueType fonts are linked against libXft or libfreetype (you probably
don't even have to worry about this if you're using precompiled
.debs).
<p>
Remember to install required font files and generate the 
<file>fonts.{scale,dir}</file> files so that the fonts can be indexed
and used.
<p>
Since <strong>Free</strong> fonts are sometimes limited, installing
or sharing some commercial TrueType fonts is an option for a &debian;
users. In order to make this process easy for the user, 
some convenience packages have been created:
<list compact>
<item><package>ttf-commercial</package>
<item><package>msttcorefonts (>1.1.0)</package> (Package in Woody does 
 not work as of 8/2002 due to the change in Microsoft's website.)
</list>
You'll have a really good selection of TT fonts at the expense of
contaminating your <strong>Free</strong> system with non-Free fonts.

<sect1 id="ss-browser">Web Browser (graphical)
<p>
There are a few Web browser packages with graphical display capabilities
as of the Woody release:
<list compact>
<item><package>mozilla</package> The Mozilla browser (new)
<item><package>galeon</package> Mozilla-based browser with a Gnome UI (new)
<item><package>konqueror</package> KDE browser
<item><package>dillo</package> GTK browser
<item><package>amaya-gtk</package> W3C reference browser
<item><package>amaya-lesstif</package> W3C reference browser
<item><package>netscape-...</package> (many, old)
<item><package>communicator-...</package> (many, old)
<item>...
</list>
The version of <package>mozilla</package> must match 
the version that <package>galeon</package> requires.  Although they differ in
UI, these two programs share the Gecko HTML rendering engine.
<p>
Plug-ins for browsers such as <package>mozilla</package> and
<package>galeon</package> can be enabled by installing "<tt>*.so</tt>" 
manually in the plug-in directory and restarting the browsers.
<p>
Plug-in resources:
<list compact>
<item>Java plug-in: install binary "J2SE" from <url id="&javasunhome;">.
<item>Flash plug-in: install binary "Macromedia Flash Player 5" from
 <url id="&flashhome;">.
<item><package>freewrl</package>: VRML browser and Netscape plugin
<item>...
</list>
</sect1>

<!-- CJK and X moved to bottom with different name to locale section -->

</sect>

<sect id="ssh">SSH
<p>
SSH (Secure SHell) is the secure way to connect over the Internet.  A free
version of SSH called OpenSSH is available as the <package>ssh</package>
package in &debian;.

<sect1 id="ssh-basics">Basics
<p>
First install the OpenSSH server and client.
<example>
# apt-get update && apt-get install ssh
</example>
The non-US entry in the <file>/etc/apt/source.list</file> is required.
<file>/etc/ssh/sshd_not_to_be_run</file> must not be present if one wishes to 
run the OpenSSH server.
<p>
SSH has 2 authentication protocols:
<list>
<item>SSH protocol version 1: 
 <list compact>
<item>Potato version only supports this protocol.
<item>available authentication methods:
  <list compact>
<item>RSAAuthentication: RSA identity key based user authentication
<item>RhostsAuthentication: .rhosts based host authentication 
 (insecure, disabled)
<item>RhostsRSAAuthentication: .rhosts authentication combined with 
 RSA host key (disabled)
<item>ChallengeResponseAuthentication: RSA challenge-response authentication
<item>PasswordAuthentication: password based authentication
  </list>
 </list>
<item>SSH protocol version 2: 
 <list compact>
<item>post-Woody versions use this as primary protocol.
<item>available authentication methods:
  <list compact>
<item>PubkeyAuthentication: public key based user authentication
<item>HostbasedAuthentication: <file>.rhosts</file> or
 <file>/etc/hosts.equiv</file> authentication 
 combined with public key client host authentication  (disabled)
<item>ChallengeResponseAuthentication: challenge-response authentication
<item>PasswordAuthentication: password based authentication
  </list>
 </list>
</list>

<p>
Be careful about these differences if you are migrating to Woody or using 
a non-&debian; system.  
<p>
See <file>/usr/share/doc/ssh/README.Debian.gz</file>,
<manref name="ssh" section="1">, 
<manref name="sshd" section="8">,
<manref name="ssh-agent" section="1">, and
<manref name="ssh-keygen" section="1"> for details.

<p>
Following are the key configuration files:

<list>

<item><file>/etc/ssh/ssh_config</file>: SSH client defaults.
 See <manref name="ssh" section="1">.  Notable entries are:

 <list compact>
<item><tt>Host</tt>: Restricts the following declarations 
  (up to the next Host keyword) to be only for those hosts 
   that match one of the patterns given after the keyword.
<item><tt>Protocol</tt>: Specifies the SSH protocol versions.  
 The default is "2,1".
<item><tt>PreferredAuthentications</tt>: Specifies the SSH2 client 
 authentication method.  The default is 
"hostbased,publickey,keyboard-interactive,password".
<item><tt>ForwardX11</tt>: The default is disabled.  This can be
 overridden by the command-line option "<tt>-X</tt>".
 </list>

<item><file>/etc/ssh/sshd_config</file>: SSH server defaults.
 See <manref name="sshd" section="8">.  Notable entries are:

 <list compact>
<item><tt>ListenAddress</tt>: Specifies the local addresses 
 <prgn>sshd</prgn> should listen on. Multiple options are permitted.
<item><tt>AllowTcpForwarding</tt>: The default is disabled.  
<item><tt>X11Forwarding</tt>: The default is disabled.  
 </list>

<item><file>$HOME/.ssh/authorized_keys</file>: the lists of the default 
public keys that clients used to connect to this account on this host.
See <manref name="ssh-keygen" section="1">.

<item><file>$HOME/.ssh/identity</file>: 
See <manref name="ssh-add" section="1">
and <manref name="ssh-agent" section="1">.
</list>

<p>
The following will start an <prgn>ssh</prgn> connection from a client.
<example>
$ ssh username@hostname.domain.ext
$ ssh -1 username@hostname.domain.ext # Force SSH version 1
</example>
For the user, <prgn>ssh</prgn> functions as a smarter and more secure 
<prgn>telnet</prgn> (will not bomb with ^]).

</sect1>

<sect1 id="ssh-forward">Port forwarding &ndash; for SMTP/POP3 tunneling
<p>
To establish a pipe to connect to port 25 of <var>remote-server</var> from port 4025 of
localhost, and to port 110 of <var>remote-server</var> from port 4110 of localhost
through <prgn>ssh</prgn>, execute on the local machine:
<example>
# ssh -q -L 4025:remote-server:25 4110:remote-server:110 \
           username@remote-server
</example>
This is a secure way to make connections to SMTP/POP3 servers over the Internet.
Set the <tt>AllowTcpForwarding</tt> entry to <tt>yes</tt> in 
<file>/etc/ssh/sshd_config</file> of the remote host.
</sect1>

<sect1 id="ssh-rsa">Connect with fewer passwords
<p>
One can avoid having to remember a password for each remote system by using
RSAAuthentication (SSH1 protocol) or PubkeyAuthentication (SSH2 protocol).  
<p>
On the remote system, set respective entries,
"RSAAuthentication yes" or "PubkeyAuthentication yes", in 
<file>/etc/ssh/sshd_config</file>.
<p>
Then generate authentication keys locally and install the public key
on the remote system:
<example>
$ ssh-keygen          # RSAAuthentication: RSA1 key for SSH1
$ cat .ssh/id_rsa.pub | ssh user1@remote \
        "cat - &gt;&gt;.ssh/authorized_keys"
...
$ ssh-keygen -t rsa   # PubkeyAuthentication: RSA key for SSH2
$ cat .ssh/id_rsa.pub | ssh user1@remote \
        "cat - &gt;&gt;.ssh/authorized_keys"
...
$ ssh-keygen -t dsa   # PubkeyAuthentication: DSA key for SSH2
$ cat .ssh/id_dsa.pub | ssh user1@remote \
        "cat - &gt;&gt;.ssh/authorized_keys"
</example>
One can change the passphrase later with "<tt>ssh-keygen -p</tt>".
Make sure to verify settings by testing the connection.  In case of any
problem, use "<tt>ssh -v</tt>".
<p>
You can add options to the entries in <prgn>authorized_keys</prgn> to limit
hosts and to run specific commands. See <manref name="sshd" section="8"> for details.
<p>
Note that SSH2 has <tt>HostbasedAuthentication</tt>. For this to work, 
you must adjust settings of <tt>HostbasedAuthentication</tt> to <tt>yes</tt> in 
both <file>/etc/ssh/sshd_config</file> on the server machine and 
<file>/etc/ssh/ssh_config</file> or <file>$HOME/.ssh/config</file> on 
the client machine.
</sect1>

<sect1 id="ssh-client">Foreign SSH clients
<p>
There are a few free SSH clients available for non-Unix-like platforms.
<taglist>
<tag>Windows
<item><url id="&puttyhome;" name="puTTY"> (GPL)
<tag>Windows (cygwin)
<item>SSH in <url id="&cygwinhome;" name="cygwin"> (GPL)
<tag>Macintosh Classic
<item><url id="&macsshhome;" name="macSSH"> (GPL) [Note that Mac OS X
  includes OpenSSH; use <tt>ssh</tt> in the Terminal application]
</taglist>
See also <url id="&sfdochome;" name="SourceForge.net, site documentation">, 
"6. CVS Instructions".

<sect1 id="ssh-agent">SSH agent
<p>
<!-- XXX FIXME XXX ssh-agent can be improved -->
Just put your public key into <file>~/.ssh/authorized_keys</file>, and
you're all set:
<example>
$ ssh-agent
$ # paste the output to your shell
$ ssh-add .ssh/identity
$ # or ssh-add .ssh/id_dsa or whatever your private key is named
$ scp <var>remote.host.with.public.key</var>
</example>
For more, read <manref name="ssh-agent" section="1">and
<manref name="ssh-add" section="1">.
</sect1>

<sect1 id="ssh-trouble">Troubleshooting
<p>
If you have problems, check the permissions of configuration files and run
<prgn>ssh</prgn> with the "<tt>-v</tt>" option.
<p>
Use the "<tt>-P</tt>" option if you are root and have trouble with a firewall;
this avoids the use of server ports 1&ndash;1023.
<p>
If <prgn>ssh</prgn> connections to a remote site suddenly stop working, it may be the
result of tinkering by the sysadmin, most likely a change in
<prgn>host_key</prgn> during system maintenance.  After making sure this is
the case and nobody is trying to fake the remote host by some clever hack, one
can regain connection by removing the <prgn>host_key</prgn> entry from
<file>$HOME/.ssh/known_hosts</file> on the local machine.
</sect1>

</sect>

<sect id="mail">Mail programs
<p>
Mail configuration divides into three categories:
<list>
<item>mail transfer agent (MTA): <prgn>exim</prgn>
<item>mail utilities: <prgn>procmail</prgn>, <prgn>fetchmail</prgn>,
<prgn>mail</prgn>, ...
<item>mail user agent (MUA): <prgn>mutt</prgn>
</list>

<sect1>Mail transport agent (Exim)
<p>
References:
<list compact>
<item><package>exim-doc</package> and <package>exim-doc-html</package> packages
<item><url id="&eximhome;">
</list>
<p>
Use <prgn>exim</prgn> as the mail transfer agent (MTA). Configure:
<example>
/etc/exim/exim.conf     "eximconfig" to create and edit
/etc/inetd.conf         comment out smtp to run exim as daemon
/etc/email-addresses    Add spoofed source address lists
check filters using exim -brw, -bf, -bF, -bV, ... etc.
</example>

<sect2>A catchall for nonexistent email addresses (Exim)
<p>
In <file>/etc/exim/exim.conf</file> (Woody or later),
in the DIRECTORS part, at the end (after the localuser: director)
add a catch-all director that matches all addresses that the
previous directors couldn't resolve (per Miquel van Smoorenburg):
<example>
catchall:
  driver = smartuser
    new_address = webmaster@mydomain.com
</example>
<p>
If one wants to have more a detailed recipe for each virtual domain, etc., 
add the following at the end of <file>/etc/exim/exim.conf</file> 
(per me, not well tested):
<example>
*@yourdomain.com ${lookup{$1}lsearch*{/etc/email-addresses} \
        {$value}fail} T
</example>
Then have an "*" entry in <file>/etc/email-addresses</file>.
</sect1>

<sect1>Mail utility (Fetchmail)
<p>
<prgn>fetchmail</prgn> is run in daemon mode to fetch mail from a POP3 account
with an ISP into the local mail system.  Configure:
<example>
/etc/init.d/fetchmail   
/etc/rc?.d/???fetchmail run update-rc.d fetchmail default priority 30
/etc/fetchmailrc        configuration file (chown 600, owned by fetchmail)
</example>
<p>
Information on how to start fetchmail as a daemon from the <prgn>init.d</prgn> 
script for Potato is confusing (Woody fixed this). See the sample
<file>/etc/init.d/fetchmail</file> and <file>/etc/fetchmailrc</file> files in
the <url id="&examples;" name="example scripts">.
<p>
If your email headers are contaminated by ^M due to your ISP's mailer, add
"stripcr" to your options in <file>$HOME/.fetchmailrc</file>:
<example>
options fetchall no keep stripcr
</example>
</sect1>

<sect1>Mail utility (Procmail)
<p>
<prgn>procmail</prgn> is a local mail delivery and filter program. One needs to create 
<file>$HOME/.procmailrc</file> for each account that uses it. Example:
<url id="&examples;" name="_procmailrc">
</sect1>

<sect1>Mail user agent (Mutt)
<p>
Use <prgn>mutt</prgn> as the mail user agent (MUA) in combination with
<prgn>vim</prgn>.
Customize with <file>~/.muttrc</file>; for example:

<example>
# use visual mode and "gq" to reformat quotes
set editor="vim -c 'set tw=72 et ft=mail'"
#
# header weeding taken from the manual (Sven's Draconian header weeding)
#
ignore *
unignore from: date subject to cc
unignore user-agent x-mailer
hdr_order from subject to cc date user-agent x-mailer
auto_view application/msword
....
</example>
<p>
Add the following to <file>/etc/mailcap</file> or
<file>$HOME/.mailcap</file> to display HTML mail and MS Word attachments
inline:
<example>
text/html; lynx -force_html &percnt;s; needsterminal;
application/msword; /usr/bin/antiword '&percnt;s'; copiousoutput;
description="Microsoft Word Text"; nametemplate=&percnt;s.doc
</example>

</sect1>

</sect>

<sect id="l10n">Localization and national language support
<p>
&debian; is internationalized, offering support for a growing number of
languages and local usage conventions. The next subsection lists some of the
forms of diversity that &debian; currently supports, and the following
subsections discuss <strong>localization</strong>, the process of customizing
your working environment to allow current input and output of your chosen
language(s) and conventions for dates, numeric and monetary formats, and other
aspects of a system that differ according to your region.

<sect1 id="languages">Customizing basics
<p>
There are few aspects to the customization for the localization and national 
language support.

<sect2 id="keyboard">Keyboard
<p>
&debian; is distributed with keymaps for nearly two dozen
keyboards.  In Woody, re-configure keyboard by:

<list compact>
<item><tt>dpkg-reconfigure --priority=low console-data # console</tt>
<item><tt>dpkg-reconfigure --priority=low xserver-xfree86   # X4</tt>
<item><tt>dpkg-reconfigure --priority=low xserver-common-v3 # X3</tt>
</list>
</sect2>

<sect2 id="data-stream">Data
<p>
The vast majority of Debian software packages support data 
    handling of non-US-ASCII characters through the LC_CTYPE environment 
    variable offered by the <strong>locale</strong> technology in glibc 
   
    <list compact>
    <item>8-bit clean: practically all programs
    <item>other Latin character sets (e.g. ISO-8859-1 or ISO-8859-2): the
		  majority of programs
    <item>multi-byte languages such as Chinese, Japanese or Korean:
		  many new applications
    </list>
</sect2>

<sect2 id="display">Display
<p>
X can display any coding including UTF-8 and support all fonts.
The list includes not only all the 8-bit fonts but also 16-bit fonts 
such as Chinese, Japanese or Korean.  Multi-bite character input
method is supported by XIM mechanism.   See <ref id="x-cjk">.
<p>
Japanese EUC code display is also available in (S)VGA graphics console
through <package>kon2</package> package.  There is an alternative new
Japanese display <package>jfbterm</package> which use FB console, too.
In these console environments, Japanese input method must be supplied by
the application.  Use <package>egg</package> package for Emacs and use
japanized <package>jvim</package> package for Vim environment.
</sect2>

<sect2 id="translation">Translation
<p>
Translations exist for many of the text messages and documents that
    are displayed in the &debian; system, such as error messages, standard
    program output, menus, and manual pages.
    Currently, support for manual pages in German, Spanish, Finnish, French,
    Hungarian, Italian, Japanese, Korean and Polish
    is provided through the <tt>manpages-<var>LANG</var></tt> packages (where
    <var>LANG</var> is a comma separated list of the two-letter ISO 
    country code.  Use <tt>apt-cache search manpages-|less</tt> to get a 
    list of available unix manual pages.)
    <p>
    To access an NLS manual page, the user must set the environment variable
    LC_MESSAGES to the appropriate string. For example, in the case of the 
    Italian-language manual pages,
    LC_MESSAGES needs to be set to <tt>it</tt>.  The <prgn/man/ program will
    then search for Italian manual pages under <file>/usr/share/man/it/</file>.
</sect2>
</sect1>

<sect1 id="locales">Locales
<p>
Debian supports <strong>locale</strong> technology.  Locale is a mechanism
that allows programs to provide suitable output and functionality according to
local conventions such as character set, format for date and time, currency
symbol, and so on. It uses environment variables to determine the appropriate
behavior. For example, assuming you have both the American English and French
locales installed on your system, the error messages of many programs can be
bilingual:
<example>
$ LANG="en_US" cat foo
cat: foo: No such file or directory
$ LANG="fr_FR" cat foo
cat: foo: Aucun fichier ou rpertoire de ce type
</example>
Glibc offers support for this functionality to programs as a library.  See
<manref name="locale" section="7">.

<sect1 id="activate-locales">Activate locale support capability
<p>
&debian; does <strong>not</strong> come with all available
locales pre-compiled. Check <file>/usr/lib/locale</file> to see which
locales (besides the default "C") are compiled for your system. If the one
you need is not present, you have two options:
<list compact>
 <item>Edit <file>/etc/locale.gen</file> to add the desired locale, then
   run <prgn>locale-gen</prgn> as root to compile it. See <manref
   name="locale-gen" section="8"> and the manpages listed in its "SEE ALSO"
   section.
 <item>Run <tt>dpkg-reconfigure locales</tt> to reconfigure the
   <package>locales</package> package. Or if it is not already installed,
   installing <package>locales</package> will invoke the debconf interface to
   let you choose needed locales and compile the database.
</list>

<sect1 id="env-locale">Activate a particular locale
<p>
The following environment variables are evaluated in this order to provide
particular locale values to programs:
<enumlist>
<item>LANGUAGE: This environment variable consists of a colon-separated 
      list of locale names in order of priority. Used only if the POSIX
      locale is set to a value other than "C" [in Woody; the Potato version
      always has priority over the POSIX locale]. (GNU extension)
<item>LC_ALL: If this is non-null, the value is used for all locale
      categories. (POSIX.1) Usually "" (null).
<item>LC_*: If this is non-null, the value is used
      for the corresponding category (POSIX.1).  Usually "C".
<p>
      LC_* variables are:
 <list compact>
<item>LC_CTYPE: Character classification and case conversion.
<item>LC_COLLATE: Collation order.
<item>LC_TIME: Date and time formats.
<item>LC_NUMERIC: Non-monetary numeric formats.
<item>LC_MONETARY: Monetary formats.
<item>LC_MESSAGES: Formats of informative and diagnostic messages and
            interactive responses.
<item>LC_PAPER: Paper size.
<item>LC_NAME: Name formats.
<item>LC_ADDRESS: Address formats and location information.
<item>LC_TELEPHONE: Telephone number formats.
<item>LC_MEASUREMENT: Measurement units (Metric or Other).
<item>LC_IDENTIFICATION: Metadata about the locale information.
 </list>
<item>LANG:   If this is non-null and LC_ALL is undefined, the value is used
      for all LC_* locale categories with undefined values. (POSIX.1) Usually
      "C".
</enumlist>
Note that some applications (e.g., Netscape 4) ignore LC_* settings.
<p>
The <prgn>locale</prgn> program can display active locale settings and
available locales; see <manref name="locale" section="1">. (NOTE: <tt>locale
-a</tt> lists all the locales that your system knows about; this does
<em>not</em> mean that all of them are compiled! See
<ref id="activate-locales">.)

<sect1 id="ISO-locale">ISO 8601 date format locale
<p>
The locale support for the international date standard of <tt>yyyy-mm-dd</tt>
(ISO 8601 date format) is provided by the locale called <tt>en_DK</tt>, 
&mdash; <strong>English in Denmark</strong> which is a bit of joke :-)
This seems to only work in console screen for <prgn>ls</prgn>.

<!-- beyond locale moved to below -->

<sect1 id="iso-8859-1">Example for the US (ISO-8859-1)
<p>
Add following lines into <file>~/.bash_profile</file>:
<example>
LC_CTYPE=en_US.ISO-8859-1
export LC_CTYPE
</example>

<sect1 id="france">Example for France with euro sign (ISO-8859-15)
<p>
Add following lines into <file>~/.bash_profile</file>:
<example>
LANG=fr_FR@euro
export LANG
LC_CTYPE=fr_FR@euro
export LC_CTYPE
</example>
<p>
Configure keyboard for French "AZERTY" as described in <ref id="keyboard">.
and add French manual page by installing <package>manpages-fr</package>.
<p>
Most western European languages can be configured similarly.
<p>
See <url id="&debian-euro-support;" name="Debian Euro HOWTO"> for 
adding support for the new euro currency and 
<url id="&debian-fr-howto;" name="Utiliser et configurer Debian pour le franc,ais"> 
for more details in French.

<sect1 id="x-cjk">Example for the bilingual system (Japanese EUC and ISO-8859-1)
<p>
Let us set up bilingual system: ja_JP.eucJP (Japanese EUC, traditional 
Unix Japanese environment) in X with English message and ISO type date, 
and  en_US.ISO-8859-1 (almost ASCII with accented character support) 
in Linux console.
<list>

 <item>add a locale support for Japanese ja_JP.eucJP locale 
  using method described at <ref id="l10n">.

 <item>install Kana-to-Kanji conversion system and dictionary:
  <list compact>
  <item><package>canna</package> &mdash; Local server (free bear license), or
  <item><package>freewnn-jserver</package> &mdash; Network-extensible server 
   (Public Domain)
  </list>

 <item>install Japanese input method system:
  <list compact>
  <item><package>kinput2-canna</package> &mdash; for X, or
  <item><package>kinput2-canna-wnn</package> &mdash; for X, and
  <item><package>egg</package> &mdash; directly works with Emacsen even 
    in console (optional)
  </list>

 <item>Japanese-compatible terminal:
  <list compact>
  <item><package>kterm</package> &mdash; X (classic),
  <item><package>mlterm</package> &mdash; X (very neat, variable font size), and 
  </list>

 <item>add all the Japanese font packages.
 
 <item>Set up as described in <ref id="custom-x">. This allows user 
  specific X environment independent of the starting methods of X 
  (<prgn>startx</prgn>, <prgn>xdm</prgn>, ...)
  
 <item>create <file>~/.session</file> which sets user specific X 
  environment:

<example>
#!/bin/sh
# This makes X work when I su to root.
if [ -z "$XAUTHORITY" ]; then
	XAUTHORITY=$HOME/.Xauthority
	export XAUTHORITY
fi

# Japanese locale as default, C locale as backup
LANG=ja_JP.eucJP:C     
export LANG
# make sure to over write en_US.ISO-8859-1 used in console
LC_CTYPE=ja_JP.eucJP
export LC_CTYPE
# I want menu message to be English in ASCII :-)
LC_MESSAGES=C
export LC_MESSAGES
# activate input method
kinput2 &        
XMODIFIERS=@im=kinput2
export XMODIFIERS
# How about blackbox window manager (lightweight)
exec /usr/bin/blackbox
</example>

 <item>add following lines into <file>~/.bash_profile</file>:
<example>
LC_CTYPE=en_US.ISO-8859-1
export LC_CTYPE
# For ISO yyyy-mm-dd date display, more natural for Japanese :-)
LC_TIME=en_DK.ISO-8859-1
export LC_TIME
</example>

 <item>add following lines into <file>~/.muttrc</file>:
<example>
# UTF-8 support is not popular in popular Japanese EMACS environment
# 7 bit encoding of iso-2022-jp is easier for everyone
# default encoding order = us-ascii --&gt; iso-8859-1 --&gt; utf-8
#set send_charset="us-ascii:iso-8859-1:utf-8"
#set allow_8bit=yes
set send_charset="us-ascii:iso-8859-1:iso-2022-jp"
set allow_8bit=no
</example>
 <item>activate XIM <prgn>kinput2</prgn> for X application
  <list compact>
  <item>add <tt>*inputMethod: kinput2</tt> to your X resources file
  <file>.~/Xresources</file>  (looks like Debian takes care this
  automatically somehow).
  <item>Some applications (such as <prgn>mlterm</prgn>) also allow 
  you to set up <tt>*inputMethod:</tt> and other information dynamically 
  at runtime (press <strong>Ctrl-MouseButton-3</strong> in <prgn>mlterm</prgn>).
  </list>
 <item>start X by typing <tt>startx</tt> or from one of display
  manager (xdm, gdm, kdm, wdm, ...)
 <item>start the Japanese compatible application: 
  VIM6, (x)emacs21, mc-4.5, mutt-1.4, ...
  (Emacs seems most popular platform, thought I do not use it.)
 <item>press "<strong>Shift+Space</strong>" to toggle Japanese 
  character input mode on and off.
</list>
See also <url id="&suse-cjk;" name="SuSE pages for CJK">.

<sect1 id="x-utf-8">Example for UTF-8 in X
<p>
We need this for everyone in the future.  
See <url id="&unicode-howto;" name="The Unicode HOWTO">.

<sect1 id="fb-utf-8">Example for UTF-8 in FB console
<p>
UTF-8 support on FB console is provided by <package>bterm</package>
used in the <package>debian-installer</package>.

<sect1 id="beyond-locale">Beyond locale
<p>
When you are setting system up first time for a <strong>national
language environment</strong>, please consider to use
<prgn>tasksel</prgn> or <prgn>aptitude</prgn> to find out what packages
are selected by choosing the corresponding language environment task.
The package choice made is useful even for the multi-lingual setup.  If
you encounter any package dependency conflicts during the install to
your finely configured system, avoid installing those software that
conflicts with the existing system.  You may have to use
<prgn>update-alternative</prgn> to regain the original state for some
commands since newly installed one may have higher priority over
existing ones.
<p>
Newer major programs are using glibc 2.2 and are mostly
internationalized.  So specially localized version such as
<prgn>jvim</prgn> for VIM may not be needed and its functionality is
offered by <prgn>vim</prgn> version 6.0 in X.  In reality, it is still
somewhat rough edged.  Since <prgn>jvim</prgn> have a version compiled
with the direct Japanese IM (<prgn>canna</prgn>) support even in console
and addresses many other Japanese specific issues maturely, you may
still want it :-)
<p>
Programs may need to be configured beyond <tt>locale</tt> configuration
to enable a comfortable working environment.  The
<package>language-env</package> package and its command
<prgn>set-language-env</prgn> greatly eases this process.
<p>
Also see the internationalization document, <url id="&intro-i18n;" 
name="Introduction to i18n">. It is aimed at developers but is also 
useful for system administrators.
</sect1>

</sect>
</chapt>

