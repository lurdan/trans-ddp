<!-- CVS revision of this document "$Revision: 1.74 $"  -->

<chapt id="tune"> Tuning a &debian; system
<p>
This chapter describes only the basics of system configuration through
a command-line interface.  Before reading this chapter you should read
<ref id="install">.  
<p>
If you are concerned about security then you should read the
<url id="&securing-debian-howto;" name="Securing Debian Manual">
which comes in the <package>&p-securing-debian-howto;</package> package.

<sect id="init-hints">System initialization
<p>
&debian; uses the System V init script system.
See <ref id="init"> for an introduction.

<sect1 id="init-defaults">Customizing init scripts
<p>
The easiest way to control the behavior of an init script is by changing
environment variable assignments in the file named like the init script
in the <file>/etc/default</file> directory.
<footnote>
Files in <file>/etc/default/</file> contain environment variable
assignments <strong>only</strong>.
Each file is sourced by the init script to which it corresponds
in such a way that these assignments override any default variable
settings in the init script itself.
The choice of directory name is <url id="&etc-defaults;" name="peculiar"> to &debian;. 
It is roughly the equivalent of the <file>/etc/sysconfig</file>
directory found in Red Hat and other distributions.
</footnote>
For example, <file>/etc/default/hotplug</file> can be used to control
how <file>/etc/init.d/hotplug</file> works.
The <file>/etc/default/rcS</file> file can be used to customize
boot-time defaults for <prgn>motd</prgn>, <prgn>sulogin</prgn>, etc.
<p>
If you cannot get the behavior you want by changing such variables
then you can modify the init scripts themselves: they are all
configuration files.

<sect1 id="syslogd">Customizing system logging
<p>
System log mode can be configured using <file>/etc/syslog.conf</file>.
Check the <package>colorize</package> package for a program to 
colorize system logfiles.
See also <manref name="syslogd" section="8"> and 
<manref name="syslog.conf" section="5">.
</sect1>

<sect1 id="hdtune">Optimizing hardware
<p>
There are a few hardware optimization configurations that &debian; leaves 
to the sysadmin to take care of.
<list>
<item><package>hdparm</package>
 <list compact>
<item>Hard disk access optimization. Very effective.
<item>Dangerous. You must read <manref name="hdparm" section="8"> first.
<item><tt>hdparm -tT <var>/dev/hda</var></tt> to test disk access speed.
<item><tt>hdparm -q -c3 -d1 -u1 -m16 <var>/dev/hda</var></tt> to speed up a
  modern IDE system. (It may be dangerous.)
 </list>

<item><package>setcd</package>
 <list compact>
<item>Compact disc drive access optimization.
<item><tt>setcd -x <var>2</var></tt> to slow down to <var>2</var>x speed.
<item>See <manref name="setcd" section="1">.
 </list>

<item><package>setserial</package>
 <list compact>
<item>Collection of tools for serial port management.
 </list>

<item><package>scsitools</package>
 <list compact>
<item>Collection of tools for SCSI hardware management.
 </list>

<item><package>memtest86</package>
 <list compact>
<item>Collection of tools for memory hardware management.
 </list>

<item><package>hwtools</package>
 <list compact>
<item>Collection of tools for low-level hardware management.
  <list compact>
   <item><prgn>irqtune</prgn>: changes the IRQ priority of devices to allow devices that
   require high priority and fast service (e.g. serial ports, modems) to
   have it. 3x speedup of serial/modem throughput is possible.

   <item><prgn>scanport</prgn>: scans I/O space from 0x100 to 0x3ff looking for 
   installed ISA devices.
   <item><prgn>inb</prgn>: a quick little hack that reads an I/O port and dumps the value
   in hex and binary.
  </list>

 </list>

<item><package>schedutils</package>
 <list compact>
<item>Linux scheduler utilities.
<item><prgn>taskset</prgn>, <prgn>irqset</prgn>, <prgn>lsrt</prgn>, 
 and <prgn>rt</prgn> are included.
<item>Together with <prgn>nice</prgn> and <prgn>renice</prgn> 
 (not included), they allow full control of process scheduling parameters. 
 </list>
</list>
<p>
Mounting a filesystem with the <tt>noatime</tt> option is also very effective
in speeding up read access to the file. See <manref name="fstab"
section="5"> and <manref name="mount" section="8">.
<p>
Some hardware can be tuned directly by the Linux kernel itself through the proc
filesystem.  See <ref id="proc-sys">.
<p>
There are many hardware-specific configuration utilities in Debian.  Many 
of them address needs specific to the laptop PC.  Here are some interesting
packages available in Debian: 
<list compact>
<item><package>tpconfig</package> - A program to configure touchpad devices
<item><package>apmd</package> - Utilities for Advanced Power Management (APM)
<item><package>acpi</package> - displays information on ACPI devices
<item><package>acpid</package> - Utilities for using ACPI
<item><package>lphdisk</package> - prepares hibernation partition for Phoenix NoteBIOS
<item><package>sleepd</package> - puts a laptop to sleep during inactivity
<item><package>noflushd</package> - allow idle hard disks to spin down
<item><package>big-cursor</package> - larger mouse cursors for X
<item><package>acme</package> - Enables the "multimedia buttons" found on laptops
<item><package>tpctl</package> - IBM ThinkPad hardware configuration tools
<item><package>mwavem</package> - Mwave/ACP modem support
<item><package>toshset</package> - Access much of the Toshiba laptop hardware interface
<item><package>toshutils</package> - Toshiba laptop utilities
<item><package>sjog</package> - A program to use the "Jog Dial" on Sony Vaio Laptops
<item><package>spicctrl</package> - Sony Vaio controller program to set LCD backlight brightness
</list>
Here, ACPI is a newer framework for the power management system than APM.
<p>
Some of these packages require special kernel modules.  They are already
included in the latest kernel source in many cases.  In case of trouble,
you may need to apply the latest patch to the kernel yourself.

<sect>Restricting access

<sect1 id="loginctrl">Restricting logins with PAM
<p>
PAM (Pluggable Authentication Modules) allow you to control how users log in.
<example>
/etc/pam.d/*             # PAM control files
/etc/pam.d/login         # PAM control file for login
/etc/security/*          # PAM module parameters
/etc/securetty           # this controls root login by console (login)
/etc/login.defs          # this controls login behaviors (login)
</example>
<p>
Change the contents of <file>/etc/pam.d/login</file> as follows, if you want
insecure but passwordless console terminals at your own risk.
<example>
#auth       required   pam_unix.so nullok
auth       required   pam_permit.so
</example>
Similar tricks can be applied for <prgn>xdm</prgn>, <prgn>gdm</prgn>, ..., 
for passwordless console X.
<p>
On the other hand, install <package>cracklib2</package> and set 
<file>/etc/pam.d/passwd</file> as follows, if you want to enforce 
a good password policy.
<example>
password required       pam_cracklib.so retry=3 minlen=6 difok=3
</example>
A one-time login password for account activation may also help.
For this, use the <prgn>passwd</prgn> command with the <tt>-e</tt> option.
See <manref name="passwd" section="1">.
<p>
The maximum number of processes can be set with 
<tt>ulimit -u 1000</tt> in a Bash shell or with settings in 
<file>/etc/security/limits.conf</file> from PAM.  Other parameters such as
<tt>core</tt> can be set similarly. The initial value of <prgn>PATH</prgn> 
can be set by <file>/etc/login.defs</file> before the shell startup 
script.
<p>
The documentation for PAM is packaged in the
<package>libpam-doc</package> package. The <em>Linux-PAM System
Administrator's Guide</em> covers configuring PAM, what modules are
available, etc. The documentation also includes <em>The Linux-PAM
Application Developers' Guide</em> and <em>The Linux-PAM Module Writers'
Guide</em>.
</sect1>

<sect1 id="wheel">"Why GNU <prgn>su</prgn> does not support the <tt>wheel</tt>
group"
<p>
This is the famous phrase at the bottom of the old <tt>info su</tt> page by
Richard M. Stallman. Not to worry: the current <prgn>su</prgn> in &debian;
uses PAM, so that one can restrict the ability to use <prgn>su</prgn> to any
group using <prgn>pam_wheel.so</prgn> in <file>/etc/pam.d/su</file>.  The
following will set the <tt>adm</tt> group in a &debian; system as an
equivalent of the BSD <tt>wheel</tt> group and allow <prgn>su</prgn> without a
password for its members.
<example>
# anti-RMS configuration in /etc/pam.d/su
auth       required   pam_wheel.so group=adm

# Wheel members to be able to su without a password
auth       sufficient pam_wheel.so trust group=adm
</example>

<sect1>Purposes of standard groups
<p>
A few interesting groups:
<list compact>
<item><tt>root</tt> group is the default wheel group for <prgn>su</prgn> 
 if <prgn>pam_wheel.so</prgn> is used without the <tt>group=</tt> argument. 
<item><tt>adm</tt> group can read logfiles. 
<item><tt>cdrom</tt> group can be used locally to give a set of 
        users access to a CD-ROM drive.
<item><tt>floppy</tt> group can be used locally to give a set of 
        users access to a floppy drive.
<item><tt>audio</tt> group can be used locally to give a set of 
        users access to an audio device.
<item><tt>src</tt> group owns source code, including files in 
        <file>/usr/src</file>. It can be used locally to give a user
        the ability to manage system source code.
<item><tt>staff</tt> membership is useful for helpdesk types or junior
        sysadmins, giving them the ability to do things in 
        <file>/usr/local</file> and to create directories in
        <file>/home</file>.
</list>
<p>
For a complete list, see the "FAQ" section in the
<url id="&securing-debian-howto;" name="Securing Debian Manual">,
which can also be found as the
<package>&p-securing-debian-howto;</package> package in Woody.
Also the new <package>&p-base-passwd;</package> (>3.4.6) contains
an authoritative list: <file>&f-users-and-groups;</file>.

<sect1 id="sudo">Working more safely &ndash; <prgn>sudo</prgn>
<p>
My usage of <prgn>sudo</prgn> is mostly a protection from my own stupidity.
Personally, I consider using <prgn>sudo</prgn> a better alternative to always
using the system as root.
<p>
Install <prgn>sudo</prgn> and activate it by setting options in
<file><url id="&examples;" name="/etc/sudoers"></file>.  Also check out the
<tt>sudo</tt> group feature in <file>&dochome;sudo/OPTIONS</file>.
<p>
The sample configuration provides "staff" group members access to any
commands run as root under <prgn>sudo</prgn> and also gives "src" members access to
selected commands run as root under <prgn>sudo</prgn>.
<p>
The advantage of <prgn>sudo</prgn> is that it only requires an ordinary user's password to
log in, and activity is monitored.  This is a nice way to give some authority to
a junior administrator.  For example:
<example>
$ sudo chown -R <var>myself</var>:<var>mygrp</var> .
</example>
<p>
Of course if you know the root password (as most home users do),
any command can be run under root from a user account:
<example>
$ su -c "shutdown -h now"
Password:
</example>
(I know I should tighten the admin account's <prgn>sudo</prgn> privileges.
But since this is my home server, I have not bothered yet.)
<p>
For a different program that allows ordinary users to run commands with root
privileges, see the <package>super</package> package.
</sect1>
    
<sect1 id="tcpd">Restricting access to services
<p>
The Internet <em>super-server</em>, <prgn>inetd</prgn>, is started at boot 
time by <file>/etc/rc2.d/S20inetd</file> (for RUNLEVEL=2), which is a
symlink to <file>/etc/init.d/inetd</file>.
Essentially, <prgn>inetd</prgn> allows one running daemon to invoke 
several others, reducing load on the system.
<p>
Whenever a request for service arrives, its protocol and service are
identified by looking them up in the databases in <file>/etc/protocols</file> and 
<file>/etc/services</file>.  <prgn>inetd</prgn> then looks up a normal
Internet service in the <file>/etc/inetd.conf</file> database,  or a Sun-RPC
based service in <file>/etc/rpc.conf</file>.
<p>
For system security, make sure to disable unused services in 
<file>/etc/inetd.conf</file>.
Sun-RPC services need to be active for NFS and other RPC-based programs.
<p>
Sometimes, <prgn>inetd</prgn> does not start the intended server 
directly but starts the <prgn>tcpd</prgn> TCP/IP daemon wrapper program
with the intended server name as its argument in <file>/etc/inetd.conf</file>.  
In this case, <prgn>tcpd</prgn> runs the appropriate server program 
after logging the request and doing some additional checks
using <file>/etc/hosts.deny</file> and <file>/etc/hosts.allow</file>.
<p>
If you have problems with remote access in a recent &debian; system, 
comment out "ALL: PARANOID" in <file>/etc/hosts.deny</file> if it exists.
<p>
For details, see
<manref name="inetd" section="8">,  
<manref name="inetd.conf" section="5">, 
<manref name="protocols" section="5">,  
<manref name="services" section="5">,  
<manref name="tcpd" section="8">,  
<manref name="hosts_access" section="5">, and
<manref name="hosts_options" section="5">. 
<p>
For more information on Sun-RPC, see
<manref name="rpcinfo" section="8">, 
<manref name="portmap" section="8">, and
<file>&f-portmap;</file>.

<sect1 id="ldap">Centralizing authentication &ndash; LDAP
<p>
Use Lightweight Directory Access Protocol (LDAP).
References:
<list compact>
<item><url id="&openldaphome;" name="OpenLDAP">
<item>OpenLDAP Admin Guide in the <package>openldap-guide</package> package
<item>LDP: <url id="&ldap-linux-howto;" name="LDAP Linux HOWTO">
<item>LDP: <url id="&ldap-implementation-howto;" name="LDAP Implementation HOWTO">
<item><url id="&ldap-use1;" name="OpenLDAP, extensive use reports">
<item><url id="&ldap-use2;" name="Open LDAP with Courier IMAP and Postfix">
</list>
</sect>

<sect id="cdrw">CD writers
<p>
CD-writers with ATAPI/IDE interfaces have recently become a very popular
option.  It is a nice medium for system backup and archiving for the home user
needing &lt; 640MB capacity.  For the most authoritative information, see the
LDP <url id="&cd-writing-howto;" name="CD-Writing-HOWTO">.

<sect1>Introduction
<p>
First, any disruption of data sent to the CD-writer will cause irrecoverable
damage to the CD. Get a CD-writer with as large a buffer as possible. If money
is no object, do not bother with ATAPI/IDE, just get a SCSI version.  If you
have a choice of IDE interface to be connected, use the one on the PCI-bus
(i.e., on the motherboard) rather than one on the ISA-bus (an SB16 card,
etc.).
<p>
When a CD-writer is connected to IDE, it has to be driven by the IDE-SCSI
driver instead of an ordinary IDE CD driver for Linux 2.2 and 2.4 kernels. 
Also, the SCSI generic driver
needs to be activated. There are two possible approaches to doing this,
assuming a kernel distributed with modern distributions (as of March 2001).
<p>
For Linux 2.6 kernel, you should use ordinary IDE driver and access CD-RW 
device directly with device name such as <file>/dev/hd<var>x</var></file> 
instead.  You can use DMA this way.
</sect1>

<sect1>Approach 1: modules + <prgn>lilo</prgn>
<p>
Add the following line to <file>/etc/lilo.conf</file> if you are using a stock Debian
kernel. If multiple options are used, list them separated by spaces:
<example>
append="hd<var>x</var>=ide-scsi ignore=hd<var>x</var>"
</example>
Here the location of the CD-writer, which is accessed through the ide-scsi driver,
is indicated by <tt>hd<var>x</var></tt>, where <var>x</var> represents one of the following:
<example>
hda          for a master on the first IDE port
hdb          for a slave on the first IDE port
hdc          for a master on the second IDE port
hdd          for a slave on the second IDE port
hde ... hdh  for a drive on an external IDE port or ATA66/100 IDE port
</example>
Type the following commands as root to activate after finishing all the
configuration:
<example>
# lilo
# shutdown -h now
</example>
</sect1>


<sect1>Approach 2: recompile the kernel
<p>
Debian uses <prgn>make-kpkg</prgn> to create a kernel.  Use the new
<tt>--append_to_version</tt> with <prgn>make-kpkg</prgn> to build multiple kernel images.
See <ref id="kernel">.
<p>
Use the following setup through <tt>make menuconfig</tt>:
<list>
<item>bzImage
<item>Exclude the IDE CD driver (not a must, but simpler to do this)
<item>Compile in ide-scsi and sg, or make them modules
</list>
</sect1>

<sect1>Post-configuration steps
<p>
Kernel support for the CD-writer can be activated during booting by
the following:
<example>
# echo ide-scsi &gt;&gt;/etc/modules
# echo sg       &gt;&gt;/etc/modules
# cd /dev; ln -sf scd0 cdrom
</example>
Manual activation can be done by:
<example>
# modprobe ide-scsi
# modprobe sg
</example>
After reboot, you can check installation by:
<example>
$ dmesg|less
# apt-get install cdrecord
# cdrecord -scanbus
</example>
<p>
[Per Warren Dodge] Sometimes there may be conflicts between
<tt>ide-scsi</tt> and <tt>ide-cd</tt> if there are both CD-ROM and
CD-R/RW on the system.  Try adding the following line to your
<file>/etc/modutils/aliases</file>, running <prgn>update-modules</prgn>, and
rebooting.
<example>
pre-install      ide-scsi      modprobe ide-cd
</example>
This causes the IDE driver to load before <tt>ide-scsi</tt>. The IDE
driver <tt>ide-cd</tt> takes control of the ATAPI CD-ROM&mdash;anything
that it hasn't been told to <strong>ignore</strong>.
That leaves just the ignored devices for <tt>ide-scsi</tt> to control. 
</sect1>

<sect1>CD-image file (bootable)
<p>
To create a CD-image of files under <file>target-directory/</file> as
<file>cd-image.raw</file>
(bootable, Joliet TRANS.TBL-enabled format; if not bootable, take out
<tt>-b</tt> and <tt>-c</tt> options), insert a boot floppy in the first floppy drive and
<example>
# dd if=<var>/dev/fd0</var> <var>target-directory/boot.img</var> 
# mkisofs -r -V <var>volume_id</var> -b <var>boot.img</var> -c <var>bootcatalog</var> -J -T \
        -o <var>cd-image.raw</var> <var>target_directory/</var>
</example>
<p>
One funny hack is to make a bootable DOS CD-ROM.  If an ordinary DOS boot
floppy disk image is in the above <file><var>boot.img</var></file>, the CD-ROM will boot
as if a DOS floppy were in the first floppy drive (A:).  Doing this with
freeDOS may be more interesting.
<p>
This CD-image file can be inspected by mounting it on the loop device.
<example>
# mount -t iso9660 -o ro,loop <var>cd-image.raw</var> /cdrom
# cd /cdrom
# mc
# umount /cdrom
</example>
</sect1>

<sect1>Write to the CD-writer (R, RW):
<p>
First test with (assuming double speed)
<example>
# nice --10 cdrecord -dummy speed=2 dev=0,0 <var>disk.img</var>
</example>
Then if OK, write to CD-R with
<example>
# nice --10 cdrecord -v -eject speed=2 dev=0,0 <var>disk.img</var>
</example>
Or write to a CD-RW disk with
<example>
# nice --10 cdrecord -v -eject blank=fast speed=2 dev=0,0 <var>disk.img</var>
</example>
Some CD-RW drives work better with
<example>
# nice --10 cdrecord -v blank=all speed=2 dev=0,0 <var>disk.img</var>
</example>
followed by
<example>
# nice --10 cdrecord -v -eject speed=2 dev=0,0 <var>disk.img</var>
</example>
Two steps are needed to prevent SCSI timeouts during blanking from
interfering with the burning step.  The argument value to 
<prgn>nice</prgn> may require some adjustments.
</sect1>

<sect1>Make an image file of a CD
<p>
Some CD-Rs and commercial CDs have junk sectors at the end that make
copying by <prgn>dd</prgn> impossible (the Windows 98 CD is one of
them).  The <package>cdrecord</package> package comes with the
<prgn>readcd</prgn> command.  Use this to copy any CD contents to an
image file.  If it is a data disk, mount it and run <prgn>df</prgn> to
see its actual size.  Divide the number shown in blocks (1 block = 1024
bytes) by 2 to get the number of actual CD sectors (1 sector = 2048
bytes).  Run <prgn>readcd</prgn> with options and use this disk image to
burn the CD-R/RW.
<example>
# readcd dev=<var>target</var>,<var>lun</var>,<var>scsibusno</var> # select function 11
</example> 
Here, set all three parameters to 0 for most cases.  Usually the
number of sectors given by <prgn>readcd</prgn> is excessive!  Use the above
number from an actual mount for better results.
<p>
It should be noted that the use of <prgn>dd</prgn> has a few problems if
used on CD-ROM.  The first run of the <prgn>dd</prgn> command may cause
an error message and may yield a shorter disk image with a lost tail-end.
The second run of <prgn>dd</prgn> command may yield a larger disk image
with garbage data attached at the end on some systems if the data size
is not specified.  Only the second run of the <prgn>dd</prgn> command with the
correct data size specified, and without ejecting the CD after an error
message, seems to avoid these problems.  If for example the image size
displayed by <prgn>df</prgn> is <tt>46301184</tt> blocks, use the following
command twice to get the right image (this is my empirical information):
<example>
# dd if=/dev/cdrom of=cd.img bs=2048 count=$((46301184/2))
</example>
</sect1>

<sect1>Debian CD images
<p>
To obtain the latest information on &debian; CDs, visit the
<url id="&debian-cd;" name="Debian CD site">. 
<p>
If you have a fast Internet connection, think about installing over 
the network using:
<list compact>
<item>a few <url id="&debian-floppyinst;" name="floppy images">.
<item>a <url id="&debian-netinst;" name="minimal bootable CD image">.
</list>
<p>
If you do not have a fast Internet connection, think about purchasing 
CDs from a <url id="&debian-venders;" name="CD vendor">.
<p>
Please do not waste bandwidth by downloading standard CD images 
unless you are a CD image tester (even with the new jigdo method).
<p>
One noteworthy CD image is <url id="&knoppix;" 
name="KNOPPIX - Live Linux Filesystem On CD">.  
This CD will boot a functioning &debian; system without 
installing itself to the hard disk.

<!-- old document section
$ export CVSROOT=anonymous@cvs.debian.org:/cvs/debian-boot
$ cvs co debian-cd
</example>
Following is a summary of CD image creation. 
<example>
# apt-get install debian-cd
# cd /etc/debian-cd
# vim CONF.sh
$ . CONF.sh
$ make distclean
$ make status
$ make list COMPLETE=1 SIZELIMIT1=555000000 SRCSIZELIMIT=665000000
$ make official_images
 or if you want only binary images :
$ make bin-official_images
-->
</sect1>

<sect1>Back up the system to CD-R
<p>
To copy key configuration files and data files to CD-R,
use the example backup script <file><url id="&examples;" name="backup"></file>.
Also see <ref id="archiving"> and <ref id="diff-backup">.
</sect1>

<sect1>Copy a music CD to CD-R
<p>
Not tested by me:
<example>
# apt-get install cdrecord cdparanoia
# cdparanoia -s -B
# cdrecord dev=0,0,0 speed=2 -v -dao -eject defpregap=1 -audio *.wav
</example>
or,
<example>
# apt-get install cdrdao #disk at once
# cdrdao read-cd --device /dev/cdrom --paranoia-mode 3 my_cd # read cd
# cdrdao write --device /dev/cdrom --speed 8 my_cd    # write a new CD
</example>
<prgn>cdrdao</prgn> does a real copy (no gaps, etc...).
</sect1>

<sect1 id="dvd">Writing DVD-R, DVD-RW, and DVD+RW
<p>
For DVD writing, you have 2 approaches:
<list compact>
<item>Use <package>growisofs</package> with <package>mkisofs</package>.
<item>Recompile <package>cdrecord</package> with dvd option to create 
local package following <file>&f-readmedvd;</file>.
</list>
</sect1>
</sect>

<sect id="x">X
<p>
The X Window System is provided by <url id="&xfree86home;" name="XFree86">.
There are two major versions of X server available on the &debian; system:
XFree86 Version 3.3 (XF3) and XFree86 Version 4.x series (XF4) both
based on X11R6 specifications by <url id="&xorghome;" name="X.Org">.
<p>
For the basics of X, refer to <manref name="X" section="7">, the LDP
<url id="&xwindowuser-howto;" name="XWindow-User-HOWTO">, and the <url
id="&remote-xapps-howto;" name="Remote X Apps mini-HOWTO">.  
For a &debian;-specific user guide, read <file>&f-x-deb-faq;</file> 
provided in the <package>xfree86-common</package> package.  This
contains an interesting and authoritative review of the key binding
issues by Branden Robinson.
<p>
<taglist>
<tag><ref id="xsrvr">
<item>a program on a local host that displays an X window and/or desktop 
on a user's monitor (CRT, LCD) and accepts keyboard and mouse input. 
<tag><ref id="xclnt">
<item>a program on a (local or remote) host that runs X-compatible 
application software.
</taglist>
This reverses the ordinary use of "server" and "client" in other
contexts.  
<p>
There are several ways of getting the "X server" (display side) to accept 
remote connections from an "X client" (application side):  

<list>
<item><prgn>xhost</prgn> method
<list compact>
<item>the host list mechanism (very insecure).
<item>non-encrypted protocol (prone to eavesdropping attack).
<item>Do not use this, if possible.
<item>See <ref id="xhost"> and <manref name="xhost" section="1x">.
</list>
<item><strong><prgn>xauth</prgn></strong> method
<list compact>
<item>the MIT magic cookie mechanism (insecure but better than
  <prgn>xhost</prgn>).
<item>non-encrypted protocol (prone to eavesdropping attack).
<item>use this only for local connection since it is less CPU-intensive
than <prgn>ssh -X</prgn>.
<item>See <ref id="ss-xsu"> and <manref name="xauth" section="1x">.
</list>
<item><prgn>xdm</prgn>, <prgn>wdm</prgn>, <prgn>gdm</prgn>, 
 <prgn>kdm</prgn>, ... methods
<list compact>
<item>the MIT magic cookie mechanism (insecure as <prgn>xauth</prgn>).
<item>See <manref name="xdm" section="1x"> and 
 <manref name="Xsecurity" section="7"> for the basics of X display access 
 control.
<item>See <manref name="wdm" section="1x">, <manref name="gdm" section="8">, 
 and <manref name="kdm.options" section="5"> for more information, 
 if these are installed.
<item>See <ref id="custombootscripts"> for how to disable <prgn>xdm</prgn> to gain 
 a Linux console upon boot without purging the <prgn>xdm</prgn> package.
</list>
<item><strong><prgn>ssh -X</prgn></strong> method
<list compact>
<item>port forwarding mechanism through secure shell (<strong>secure</strong>).
<item>encrypted protocol (a waste of resources if used locally).
<item>use this for remote connections.
<item>See <ref id="xssh">.
</list>
</list>
All remote connection methods, except <prgn>ssh</prgn>, require TCP/IP
connection enabled on the X server.  See <ref id="xtcp">.

<sect1 id="x-system">X packages
<p>
There are a few (meta)packages provided to ease installation of the X
system in Woody.
<taglist>
<tag><package>x-window-system-core</package>
<item>
This metapackage provides the essential components for a stand-alone
workstation running the X Window System.  It provides the X libraries, an X
server (<package>xserver-xfree86</package>), a set of fonts, and a group of 
basic X clients and utilities.

<tag><package>x-window-system</package> 
<item>
This metapackage provides substantially all the components of the X Window
System as developed by the XFree86 Project, as well as a set of historically
popular accessory programs. (Notably, it depends on
<package>x-window-system-core</package>, <package>twm</package>, and 
<package>xdm</package>, i.e., no need to install 
<package>x-window-system-core</package> if you install this.)

<tag><package>xserver-common-v3</package> 
<item>
Files and utilities common to XFree86 3.x X servers (XF3)

<tag><package>xserver-*</package> 
<item>
Supplemental XF3 server packages to support hardware not supported by
the new XF4 server (<package>xserver-xfree86</package>) for whatever 
reason.  Some old ATI mach64 cards are not 
supported in XF4, other cards hang badly in the Woody version of XF4, etc.
(For available packages, use <tt>apt-cache search xserver-|less</tt>.
All of these XF3 servers depend on <package>xserver-common-v3</package>.)
</taglist>
<p>
For most cases, <package>x-window-system</package> is the package to install.
(If you want console login, be sure to disable <package>xdm</package>
as described in <ref id="no-x-start">.)

<sect1 id="hdetect-x">Hardware detection for X
<p>
To enable hardware detection during the X configuration stage,
install the following packages prior to installing the X system:
<list>
<item><package>discover</package> &ndash; hardware identification system.
<item><package>mdetect</package> &ndash; mouse device autodetection tool.
<item><package>read-edid</package> &ndash; hardware information-gathering 
 tool for VESA PnP monitors.
</list>

<sect1 id="xsrvr">The X server
<p>
See <manref name="XFree86" section="1x"> for X server information.
<p>
Invoke X server from a local console:
<example>
$ startx -- :&lt;display&gt; <var>vtXX</var>
e.g.:
$ startx -- :1 vt8 -bpp 16
... start on vt8 connected to localhost:1 with 16 bpp mode
</example>
Arguments given after <tt>--</tt> are for the X server.
<p>
Note, when using a <file>~/.xserverrc</file> script to customize the X
server startup process, be sure to  <tt>exec</tt> the real X server.
Failing to do this can make the X server slow to start and exit. For
example:
<example>
#!/bin/sh
exec /usr/bin/X11/X -dpi 100 -nolisten tcp
</example>

<sect2 id="config-x4">Configuring the X server (version 4)
<p>
To (re-)configure an XF4 server,
<example>
# dpkg-reconfigure --priority=low xserver-common
# dpkg-reconfigure --priority=low xserver-xfree86
</example>
will generate <file>/etc/X11/XF86Config-4</file> file 
and configure X using the script <prgn>dexconf</prgn>.

<sect2 id="config-x3">Configuring the X server (version 3)
<p>
To (re-)configure an XF3 server, for example, for ATI mach64,
<example>
# dpkg-reconfigure --priority=low xserver-common-v3
# dpkg-reconfigure --priority=low xserver-mach64
</example>
will generate <file>/etc/X11/XF86Config</file> file 
and configure X using the script <prgn>xf86config-v3</prgn>.

<sect2 id="manual-config-x">Configuring the X server manually
<p>
For Woody, to add user customizations to
<file>/etc/X11/XF86Config-4</file> file, <strong>do not edit the
configuration file between the text</strong>:
<!-- FIXME for XF3 -->
<example>
### BEGIN DEBCONF SECTION
[snip]
### END DEBCONF SECTION
</example>
<p>
Instead, <strong>add the customizations before the text</strong>.  For example, to use a custom
video device, add something resembling the following text to the <em>top</em>
of the file:
<example>
Section "Device"
  Identifier        "Custom Device"
  Driver            "ati"
  Option            "NoAccel"
EndSection

Section "Screen"
  Identifier  "Custom Screen"
  Device      "Custom Device"
  Monitor     "Generic Monitor"
  DefaultDepth 24
  Subsection "Display"
    Depth       8
    Modes       "1280x960" "1152x864" "1024x768" "800x600" "640x480"
  EndSubsection
  Subsection "Display"
    Depth       16
    Modes       "1280x960" "1152x864" "1024x768" "800x600" "640x480"
  EndSubsection
  Subsection "Display"
    Depth       24
    Modes       "1280x960" "1152x864" "1024x768" "800x600" "640x480"
  EndSubsection
EndSection

Section "ServerLayout"
    Identifier        "Custom"
    Screen            "Custom Screen"
    InputDevice       "Generic Keyboard" "CoreKeyboard"
    InputDevice       "Configured Mouse" "CorePointer"
EndSection
</example>
<p>
For Sarge (<tt>testing</tt> at the time of writing), if you wish to
retain user customizations to <file>/etc/X11/XF86Config</file> file
through upgrade, run the following commands as root:
<example>
# cp /etc/X11/XF86Config-4 /etc/X11/XF86Config-4.custom
# md5sum /etc/X11/XF86Config-4 &gt; /var/lib/xfree86/XF86Config-4.md5sum
# dpkg-reconfigure xserver-xfree86
</example> 
In order to achieve <strong>font de-uglification</strong>, you need to
edit <file>/etc/X11/XF86Config-4</file> as described in <ref
id="xfs-tt">.
<!--
<p>
For XF3, in order to achieve <strong>font de-uglification</strong>, 
you need to edit the order of <tt>FontPath</tt> in
<file>/etc/X11/XF86Config</file> 
while adding <tt>:unscaled</tt> as follows.
<example>
FontPath        "/usr/X11R6/lib/X11/fonts/misc:unscaled"
FontPath        "/usr/X11R6/lib/X11/fonts/100dpi:unscaled"
FontPath        "/usr/X11R6/lib/X11/fonts/75dpi:unscaled"
FontPath        "/usr/X11R6/lib/X11/fonts/Type1"
FontPath        "/usr/X11R6/lib/X11/fonts/Speedo"
FontPath        "/usr/X11R6/lib/X11/fonts/misc"
FontPath        "/usr/X11R6/lib/X11/fonts/100dpi"
FontPath        "/usr/X11R6/lib/X11/fonts/75dpi"
</example>
<p>
If you use xfs serves fonts via a Unix Domain Socket, you may also edit
<tt>catalogue</tt> entry of <file>/etc/X11/fs/config</file> as:
<example>
catalogue = /usr/X11R6/lib/X11/fonts/misc:unscaled,
            /usr/X11R6/lib/X11/fonts/100dpi:unscaled,
            /usr/X11R6/lib/X11/fonts/75dpi:unscaled,
            /usr/X11R6/lib/X11/fonts/Type1,
            /usr/X11R6/lib/X11/fonts/Speedo,
            /usr/X11R6/lib/X11/fonts/misc,
            /usr/X11R6/lib/X11/fonts/100dpi,
            /usr/X11R6/lib/X11/fonts/75dpi,
</example>
<p>
These <tt>:unscaled</tt> tricks are deprecated in new XF4 and no longer
needed.
-->
<!-- per /usr/share/doc/xfree86-common/README.fonts.gz in 4.2.1 -->
<p>
Please also check the other parts of your X configuration. Bad monitor
settings can be even more of a headache than bad fonts, so make sure
your refresh rate is as high as your monitor can handle (85 Hz is great,
75 Hz is OK, 60 Hz is painful).

<sect1 id="xclnt">X clients
<p>
Most X client programs can be started with a command like this:
<example>
client $ xterm -geometry 80x24+30+200 -fn 6x10 -display <var>hostname</var>:0 &amp;
</example>
Here, the optional command-line arguments mean:
<list>
<item><tt>-geometry <var>WIDTH</var>x<var>HEIGHT</var>+<var>XOFF</var>+<var>YOFF</var></tt>: 
the initial size and location of the window.

<item><tt>-fn <var>FONTNAME</var></tt>: the font to use for displaying text.
 <tt><var>FONTNAME</var></tt> can be:
<list compact>
<item>a14: Normal size font
<item>a24: Large size font
<item>... (check available fonts with <tt>xlsfont</tt>.)
</list>
<item><tt>-display <var>displayname</var></tt>: the name of the X server to use. 
 <tt><var>displayname</var></tt> can be:
<list compact>
<item><tt><var>hostname</var>:<var>D.S</var></tt> means screen <tt><var>S</var></tt> on display
 <tt><var>D</var></tt> of host <tt><var>hostname</var></tt>; the X server for this display is
listening to TCP port 6000+D.

<item><tt><var>host</var>/unix:<var>D.S</var></tt> means screen <tt><var>S</var></tt> on display 
<var>D</var> of host <tt><var>host</var></tt>; the X server for this display is 
listening to UNIX domain socket
<file>/tmp/.X11-unix/XD</file> (so it's only reachable from <tt><var>host</var></tt>).

<item><tt><var>:D.S</var></tt> is equivalent to 
<tt><var>host</var>/unix:<var>D.S</var></tt>, where <tt><var>host</var></tt> is the local hostname.
</list>
</list>
<p>
The default <tt><var>displayname</var></tt> for the X client program (application side) 
can be set by the DISPLAY environment variable.  For example, prior to 
running an X client program, executing one of the following commands 
achieves this:
<example>
$ export DISPLAY=:0 
        # The default, local machine using the first X screen
$ export DISPLAY=<var>hostname.fulldomain.name</var>:0.2
$ export DISPLAY=localhost:0
</example>
Its startup can be customized by <file>~/.xinitrc</file>.  For example:
<example>
xrdb -load $HOME/.Xresources
xsetroot -solid gray &amp;
xclock -g 50x50-0+0 -bw 0 &amp;
xload -g 50x50-50+0 -bw 0 &amp;
xterm -g 80x24+0+0 &amp;
xterm -g 80x24+0-0 &amp;
twm
</example>
As described in <ref id="custom-x">, this overrides everything normal 
execution of <prgn>Xsession</prgn> does when started from <prgn>startx</prgn>.
Use <file>~/.xsession</file> instead and use this approach only as the 
last resort. 
See <manref name="xsetroot" section="1x">, 
<manref name="xset" section="1x">, and <ref id="xresources">.
</sect1>

<sect1 id="x-session">X sessions
<p>
An X session (X server + X client) can be started by:
<list compact>
<item><prgn>startx</prgn>: wrapper script command for <prgn>xinit</prgn> to
      start an X server and client from a Linux character console.   If
      <file>~/.xinitrc</file> does not exist, <file>/etc/X11/Xsession</file> is
      executed through <file>/etc/X11/xinit/xinitrc</file>.
<item><prgn>xdm</prgn>, <prgn>gdm</prgn>, <prgn>kdm</prgn>, or
      <prgn>wdm</prgn>: X display manager daemons to start the X server and
      client, and to control login via a GUI screen.  
      <file>/etc/X11/Xsession</file> is directly executed.
</list>
The console can be made available as in <ref id="no-x-start">.

<sect2 id="custom-x">Custom X sessions
<p>
The default startup script <file>/etc/X11/Xsession</file> is 
effectively a combination of
<file>/etc/X11/Xsession.d/50xfree86-common_determine-startup</file> and
<file>/etc/X11/Xsession.d/99xfree86-common_start</file>.
<p>
Execution of <file>/etc/X11/Xsession</file> is somewhat affected by 
<file>/etc/X11/Xsession.options</file> and is essentially an execution
of a program which was first found in the following order with the 
<prgn>exec</prgn> command:
<enumlist compact>
<item><file>~/.xsession</file> or <file>~/.Xsession</file>, if it is defined.
<item><file>/usr/bin/x-session-manager</file>, if it is defined.
<item><file>/usr/bin/x-window-manager</file>, if it is defined.
<item><file>/usr/bin/x-terminal-emulator</file>, if it is defined.
</enumlist>
<p>
The exact meaning of these commands is determined by the &debian; 
alternative system described in <ref id="alternatives">.
For example:
<example>
# update-alternatives --config x-session-manager
... or
# update-alternatives --config x-window-manager
</example>
In order to make any X window manager a default while keeping GNOME
and KDE session managers installed, replace
<file>/etc/X11/Xsession.d/50xfree86-common_determine-startup</file>
with the one attached in the second bug report at 
<url id="&bug-xfree;"> (I hope this will be included soon)
and edit <file>/etc/X11/Xsession.options</file> as follows to disallow 
the X session manager:
<example>
# /etc/X11/Xsession.options
#
# configuration options for /etc/X11/Xsession
# See Xsession.options(5) for an explanation of the available options.
# Default enabled
allow-failsafe
allow-user-resources
allow-user-xsession
use-ssh-agent
# Default disabled (enable them by uncommenting)
do-not-use-x-session-manager
#do-not-use-x-window-manager
</example>
<p>
Without the above mentioned modification to the system,
<package>gnome-session</package> and <package>kdebase</package> are 
the packages containing these X session managers.  Removing them allows
X window manager to be a default. (Yack, any better idea?)
<p>
On a system where <file>/etc/X11/Xsession.options</file> contains
a line <tt>allow-user-xsession</tt> without preceding characters,
any user who defines <file>~/.xsession</file> or <file>~/.Xsession</file>
will be able to customize the action of <file>/etc/X11/Xsession</file>.
<p>
The last command in the <file>~/.xsession</file> file should use form of 
<tt>exec <var>some-window/session-manager</var></tt> to start
your favorite X window/session manager.
<p>
A good example of an <file>~/.xsession</file> script is given at
<file>&f-xsession;</file>.
<p>
I use this to set the window manager, screen access, and language support for
each user account. See <ref id="s-w-manager">, <ref id="ss-xsu">, and
<ref id="x-cjk">.
<p>
If you wish to have several X client programs started automatically, see
<ref id="xclnt"> examples and invoke them from <file>~/.xsession</file>
instead of <file>~/.xinitrc</file>.
<p>
User-specific additional X resources can be stored in
<file>~/.Xresources</file>.  See <ref id="xresources">.
<p>
User-customized keymaps and pointer button mappings in X can also be
specified in the user's start up script. See <ref id="xmodmap">.

<sect2 id="s-w-manager">Starting an X session for a user
<p>
Following the principle described at <ref id="custom-x">,
a user-specific X session/window manager can be activated by installing
the package indicated and setting the contents at the end of 
<file>~/.xsession</file> file as follows.
(I like <package>blackbox</package>/<package>fluxbox</package> for its 
simple style and fast speed.):

<list>
<item>default X session manager 
<list compact>
<item>See <ref id="alternatives">
<item><tt>exec /usr/bin/x-session-manager</tt>
</list>
<item>default X window manager 
<list compact>
<item>See <ref id="alternatives">
<item><tt>exec /usr/bin/x-window-manager</tt>
</list>

<item>GNOME session manager (loaded)
<list compact>
<item>Install package: <package>gnome-session</package>
<item><tt>exec /usr/bin/gnome-session</tt>
</list>

<item>KDE session manager (loaded)
<list compact>
<item>Install package: <package>kdebase</package> (or 
<package>kdebase3</package> for KDE3)
<item><tt>exec /usr/bin/kde2</tt>
</list>

<item>Blackbox window manager (lightweight, slick)
<list compact>
<item>Install package: <package>blackbox</package>
<item><tt>exec /usr/bin/blackbox</tt>
</list>

<item>Fluxbox window manager (lightweight, new blackbox)
<list compact>
<item>Install package: <package>fluxbox</package>
<item><tt>exec /usr/bin/fluxbox</tt>
</list>

<item>Xfce window manager (Mac OS-X, SUN CDE&ndash;like)
<list compact>
<item>Install package: <package>xfce</package>
<item><tt>exec /usr/bin/xfwm</tt>
</list>

<item>IceWM window manager (lightweight, GNOME alternative)
<list compact>
<item>Install package: <package>icewm</package>
<item><tt>exec /usr/bin/X11/icewm</tt>
</list>

<item>FVWM2 virtual window manager (lightweight, Win95-like)
<list compact>
<item>Install package: <package>fvwm</package>
<item><tt>exec /usr/bin/fvwm2</tt>
</list>

<item>Windowmaker window manager (somewhat NexT-like)
<list compact>
<item>Install package: <package>wmaker</package>
<item><tt>exec /usr/bin/wmaker</tt>
</list>

<item>Enlightenment window manager (loaded)
<list compact>
<item>Install package: <package>enlightenment</package>
<item><tt>exec /usr/bin/enlightenment</tt>
</list>

</list>
See <url id="&windomanagerhome;" name="Window Managers for X">.


<sect2 id="kde-gnome">Setting up KDE and GNOME
<p>
In order to setup full KDE or GNOME environment, the following 
metapackages are  useful:
<list compact>
<item>KDE: install the <package>kde</package> package
<item>GNOME: install the <package>gnome</package> package
</list>
Installing these packages with tools which handle <tt>Recommends</tt>,
such as <prgn>dselect</prgn> and <prgn>aptitude</prgn>, provides you 
with richer choices of software than just installing these with 
<prgn>apt-get</prgn>.
<p>
If you want console login, be sure to disable X display managers,
such as <package>kdm</package>, <package>gdm</package>, and 
<package>wdm</package>, which may be pulled in by the dependencies, 
as described in <ref id="no-x-start">.
<p>
If you want to have GNOME as the system default over KDE, make sure to
configure <prgn>x-session-manager</prgn> as in <ref id="alternatives">.

<sect1 id="xtcp">Using X over TCP/IP
<p>
Because a remote TCP/IP socket connection without encryption is prone 
to an eavesdropping attack, the default setting for X in recent 
&debian; versions disables the TCP/IP socket.  Consider using <prgn>ssh</prgn> 
for a remote X connection (see <ref id="xssh">). 
<p>
The method described here is not encouraged unless one is in a very secure 
environment behind a good firewall system with only trusted users present.
Use the following command to verify your current X server setting for the
TCP/IP socket:
<example>
# find /etc/X11 -type f -print0 | xargs -0 grep nolisten
/etc/X11/xinit/xserverrc:exec /usr/bin/X11/X -dpi 100 -nolisten tcp
</example>
Remove <tt>-nolisten</tt> to restore TCP/IP listening on the X server.
</sect1>
 
<sect1 id="xhost">Connecting to a remote X server &ndash; <prgn>xhost</prgn>
<p>
<prgn>xhost</prgn> allows access based on hostnames. This is very insecure.
The following will disable host checking and allow connections from anywhere 
if a TCP/IP socket connection is allowed (see <ref id="xtcp">):
<example>
$ xhost +
</example>
You can re-enable host checking with:
<example>
$ xhost -
</example>
<p>
<prgn>xhost</prgn> does not distinguish between different users on the 
remote host. Also, hostnames (addresses actually) can be spoofed. 
<p>
This method must be avoided even with more restrictive host criteria
if you're on an untrusted network (for instance with dial-up PPP
access to the Internet).  See <manref name="xhost" section="1x">.
</sect1>

<sect1 id="xssh">Connecting to a remote X server &ndash; <prgn>ssh</prgn>
<p>
The use of <prgn>ssh</prgn> enables a secure connection from a local X server 
to a remote application server.  
<list>
<item>Set <tt>X11Forwarding</tt> and <tt>AllowTcpForwarding</tt> entries 
to <tt>yes</tt> in <file>/etc/ssh/sshd_config</file> of the remote host,
if you want to avoid corresponding command-line options.
<item>Start the X server on the local host.
<item>Open an <prgn>xterm</prgn> in the local host.
<item>Run <prgn>ssh</prgn> to establish a connection with the remote site.  
<example>
localname @ localhost $ ssh -q -X -l loginname remotehost.domain
Password:
.....
</example>
<item>Run X application commands on the remote site.
<example>
loginname @ remotehost $ gimp &
</example>
</list>
This method allows the display of the remote X client output as if it 
were locally connected through a local UNIX domain socket.
</sect1>

<sect1 id="xtermfaq">The X terminal emulator &ndash; <prgn>xterm</prgn>
<p>
Learn everything about <prgn>xterm</prgn> at <url id="&xtermfaq;">.
</sect1>

<sect1 id="xresources">X resources
<p>
Many older X programs, such as <prgn>xterm</prgn>, use the X resource database
to configure their appearance.  The file <file>~/.Xresources</file> is used
to store user resource specifications.  This file is automatically
merged into the default X resources upon login. The system-wide defaults of 
X resources are stored in <file>/etc/X11/Xresources/*</file> and application 
defaults of them are stored in <file>/etc/X11/app-defaults/*</file>.  Use
these settings as the starting points.
<p>
Here are some helpful settings to add to your
<file>~/.Xresources</file> file:
<example>
! Set the font to a more readable 9x15
XTerm*font: 9x15

! Display a scrollbar
XTerm*scrollBar: true

! Set the size of the buffer to 1000 lines
XTerm*saveLines: 1000

! Large kterm screen
KTerm*VT100*fontList: -*-fixed-medium-r-normal--24-*,\
 -*-gothic-medium-r-normal--24-*,\
 -*-mincho-medium-r-normal--24-*
</example>
To make these settings take effect immediately, merge them into the
database using the command:
<example>
xrdb -merge ~/.Xresources
</example>
See <manref name="xrdb" section="1x">.

<sect1 id="xmodmap">Keymaps and pointer button mappings in X
<p>
The <prgn>xmodmap</prgn> program is used to edit and display the
keyboard  modifier map  and  keymap  table that are used by client
applications to convert event keycodes into keysyms in X.
<example>
$ xmodmap -pm 
 ... display the current modifier map
$ xmodmap -pk | pager
 ... display the current keymap table
$ xmodmap -e "pointer = 3 2 1" # set mouse for the left hand.
$ xmodmap ~/.xmodmaprc # set keyboard as in ~/.xmodmaprc
</example>
It is usually run from the user's session startup script,
<file>~/.xsession</file>. 
<!--
User-customized keymaps and pointer button mappings in X can be
specified in <file>~/.xmodmaprc</file>.
-->
<p>
To get the <tt>keycode</tt>, run <prgn>xev</prgn> in X and press keys.
To get the meaning of <tt>keysym</tt>, look into the MACRO definition in
<file>/usr/include/X11/keysymdef.h</file> file.  All the
<tt>#define</tt> statements in this file are named as <tt>XK_</tt>
prepended to the <tt>keysym</tt> names.
<p>
See <manref name="xmodmap" section="1x">.

<sect1 id="ss-xsu">Getting root in X
<p>
If a GUI program needs to be run with root privilege, use the following
procedures to display program output on a user's X server.
<strong>Never attempt to start an X server directly from the root
account</strong> in order to avoid possible security risks.
<p>
Start the X server as a normal user and open an <prgn>xterm</prgn> console.
Then:
<example>
$ XAUTHORITY=$HOME/.Xauthority
$ export XAUTHORITY
$ su root
Password:*****
# printtool &
</example>
When using this trick to <prgn>su</prgn> to a non-root user, make
sure <file>~/.Xauthority</file> is group readable by this non-root user.
<p>

<!-- this section moved up -->

To automate this command sequence, create a file
<file>~/.xsession</file> from the user's account, containing the following
lines:
<example>
# This makes X work when I su to the root account.
if [ -z "$XAUTHORITY" ]; then
        XAUTHORITY=$HOME/.Xauthority
        export XAUTHORITY
fi
unset XSTARTUP
# If a particular window/session manager is desired, uncomment
# the following and edit it to fit your needs.
#XSTARTUP=/usr/bin/blackbox
# This starts x-window/session-manager program
if [ -z "$XSTARTUP" ]; then
  if [ -x /usr/bin/x-session-manager ]; then
    XSTARTUP=x-session-manager
  elif [ -x /usr/bin/x-window-manager ]; then
    XSTARTUP=x-window-manager
  elif [ -x /usr/bin/x-terminal-emulator ]; then
    XSTARTUP=x-terminal-emulator
  fi
fi
# execute auto selected X window/session manager
exec $XSTARTUP
</example>
Then run <prgn>su</prgn> (not <tt>su -</tt>) in an
<prgn>xterm</prgn> window of the user.  Now GUI programs started from this
<prgn>xterm</prgn> can display output on this user's X window while running
with root privilege.  This trick works as long as the default 
<file>/etc/X11/Xsession</file> is
executed.  If a user set up his customization using <file>~/.xinitrc</file>
or <file>~/.xsession</file>, the above mentioned environment
variable <tt>XAUTHORITY</tt> needs to be set similarly in those scripts.

<p>Alternatively, <package>sudo</package> can be used to automate the command sequence:
<example>
$ sudo xterm
... or
$ sudo -H -s
</example>
Here <file>/root/.bashrc</file> should contain:
<example>
if [ $SUDO_USER ]; then
    sudo -H -u $SUDO_USER xauth extract - $DISPLAY | xauth merge -
fi
</example>
This works fine even with the home directory of the user on an NFS
mount, because root does not read the <file>.Xauthority</file> file.
<p>
There are also several specialized packages for this purpose:
<package>kdesu</package>, <package>gksu</package>, <package>gksudo</package>,
<package>gnome-sudo</package>, and <package>xsu</package>.  Some
other methods can be used to achieve similar results: creating a symlink from
<file>/root/.Xauthority</file> to the user's corresponding one; use of the
script <url id="&suxhome;" name="sux">; or putting "<tt>xauth merge
~<var>USER_RUNNING_X</var>/.Xauthority</tt>" in the root initialization script.
<p>
See more on the <url id="&deb-dev-su;" name="debian-devel mailing list">.
</sect1>

<sect1 id="xfs-tt">TrueType fonts in X
<p>
The standard <prgn>xfs</prgn> in XFree86-4 works fine with TrueType
fonts.  You have to install a third-party font server such as
<prgn>xfs-xtt</prgn>, if you are using XFree86-3.
<p>
You just need to make sure that whatever applications you want to use the
TrueType fonts are linked against libXft or libfreetype (you probably
don't even have to worry about this if you're using pre-compiled
.debs).
<p>
First set up font support infrastructure:
<list compact>
<item>Install <package>x-ttcidfont-conf</package> and
<package>defoma</package> packages. This automates generation of the
<file>fonts.scale</file> and <file>fonts.dir</file> files.
<example>
# apt-get install x-ttcidfont-conf
</example>
<item>Edit <file>/etc/X11/XF86Config-4</file> in the <tt>Section "Files"</tt>
as:
<example>
Section "Files"
    FontPath  "/var/lib/defoma/x-ttcidfont-conf.d/dirs/TrueType"
    FontPath  "/usr/share/fonts/truetype"
    FontPath  "/usr/lib/X11/fonts/CID"
    FontPath  "/usr/lib/X11/fonts/Speedo"
    FontPath  "/usr/lib/X11/fonts/misc"
    FontPath  "/usr/lib/X11/fonts/cyrillic"
    FontPath  "/usr/lib/X11/fonts/100dpi:unscaled"
    FontPath  "/usr/lib/X11/fonts/75dpi:unscaled"
    FontPath  "/usr/lib/X11/fonts/Type1"
EndSection
</example>
The first line will setup XFree86 to use any TrueType fonts you install
from &debian; packages.  
Type1 font entry is moved down since XFree86 does a rather poor job of
rendering Type1 fonts.
The <tt>:unscaled</tt> trick for bitmap fonts should not be needed for
new XF4 anymore but I included it here just be sure.
<!-- per /usr/share/doc/xfree86-common/README.fonts.gz in 4.2.1 -->
<p>
In order to preserve manual changes of <file>/etc/X11/XF86Config-4</file>
follow instructions in <ref id="manual-config-x">.
</list>
<p>
Then install DFSG font packages:
<list compact>
<item>Western TrueType fonts:
<list compact>
<item><package>ttf-bitstream-vera</package>: A set of high-quality
TrueType fonts created by Bitstream, Inc.
<footnote>
Though this is not available in Woody, you can install this from Sarge.
</footnote>
<item><package>ttf-freefont</package>: A set of free high-quality
TrueType fonts covering the UCS character set.
<item><package>ttf-thryomanes</package>: A TrueType Unicode font
covering Latin, Greek, Cyrillic, and IPA.
</list>
<item>Asian fonts:
<list compact>
<item><package>tfm-arphic-bsmi00lp</package>: Chinese Arphic "AR PL
Mingti2L Big5" TrueType font TeX font metric data
<item><package>tfm-arphic-bkai00mp</package>: Chinese Arphic "AR PL
KaitiM Big5" TrueType font TeX font metric data
<item><package>tfm-arphic-gbsn00lp</package>: Chinese Arphic "AR PL
SungtiL GB" TrueType font TeX font metric data
<item><package>tfm-arphic-gkai00mp</package>: Chinese Arphic "AR PL
KaitiM GB" TrueType font TeX font metric data
<item><package>ttf-baekmuk</package>: Korean Baekmuk series TrueType fonts
<item><package>hbf-jfs56</package>: Chinese Jianti Fangsong 56x56 bitmap
font (GB2312) for CJK
<item><package>hbf-cns40-b5</package>: Chinese Fanti Song 40x40 bitmap
font (Big5) for CJK
<item><package>hbf-kanji48</package>: Japanese Kanji 48x48 bitmap font
(JIS X-0208) for CJK
</list>
</list>
<!-- Need to watch Japanese font issue -->
<p>
Since <strong>Free</strong> fonts are sometimes limited, installing
or sharing some commercial TrueType fonts is an option for a &debian;
users. In order to make this process easy for the user, 
some convenience packages have been created:
<list compact>
<item><package>ttf-commercial</package>
<item><package>msttcorefonts (>1.1.0)</package>
<footnote>
The package in Woody does not work as of 8/2002 due to a change in
Microsoft's website.  Use Sarge version even in Woody instead.
</footnote>
</list>
You'll have a really good selection of TrueType fonts at the expense of
contaminating your <strong>Free</strong> system with non-Free fonts.
<p>
All these font packages in &debian; should work without any efforts
and appear available to all X programs that use the
regular "core" font system.  This includes things like Xterm, Emacs, and
most other non-KDE and non-GNOME applications.
<p>
Now, run <prgn>xfontsel</prgn> and select any TrueType fonts in the
fndry menu, you should be able to see many ungrayed out
entries in the "fmly" menu.
<p>
For KDE2.2 and GNOME1.4 (with libgdkxft0, which is a hack to get GTK 1.2
to do anti-aliased font rendering), you need to setup Xft1, as well.
Xft1 is highly deprecated, and is basically only used by GNOME1.4 and
KDE2.2.  Edit <file>/etc/X11/XftConfig</file> and add a line like
<example>
    dir "/var/lib/defoma/x-ttcidfont-conf.d/dirs/TrueType"
</example>
<p>
before the other dir lines.  
<footnote>
I don't have any xft1 stuff on my machine
anymore, so I'm not sure if you need to restart X or not before this
change will take effect.  I seem to remember that "xftcache" would
update the Xft1 cache, but it'd be good if someone could confirm that
for me.
</footnote>
<p>
For GNOME2 and KDE3 (post Sarge release), you need to setup
<package>fontconfig</package> which Xft2 uses to find fonts. 
<footnote>
<package>Fontconfig</package> does not exist in Woody.  
</footnote>
You shouldn't need to install anything extra for this
because every package using <package>fontconfig</package> Depends
on it (indirectly) already.
<p>
First, look in <file>/etc/fonts/fonts.conf</file>.  There should be a
line like the one below.  If not, open up
<file>/etc/fonts/local.conf</file> and add this
<example>
    &lt;dir&gt;/var/lib/defoma/x-ttcidfont-conf.d/dirs/TrueType&lt;/dir&gt;
</example>
just after the &lt;fontconfig&gt; line.
<p>
<package>Fontconfig</package> should pick these up immediately, and
"fc-list" should list your new fonts.  Another neat feature of
<package>fontconfig</package> is that you can just drop fonts in
<file>~/.fonts/</file> and all your fontconfigified programs will have
access to them immediately.
<p>
If you manually install a new set of TrueType fonts while in X without
using &debian; package, run
<example>
# xset fp rehash
</example>
to get XFree86 to look at the contents of that directory again and to
pickup new ones.

<sect1 id="ss-browser">Web browsers in X
<p>
There are many web browser packages with graphical display capabilities
as of the Sarge release:
<list compact>
<item><package>mozilla</package> The Mozilla browser
<item><package>mozilla-firefox</package> Mozilla browser variant (stand-alone)
<item><package>epiphany-browser</package> Mozilla browser variant (Gnome)
<item><package>konqueror</package> KDE browser
<item><package>amaya</package> W3C reference browser
<item>...
</list>
In <tt>testing</tt> or <tt>unstable</tt>, you may face version mismatch 
problems among <package>mozilla</package> variant browsers since
they may require matched versions of shared libraries.
<p>
Plug-ins for browsers such as <package>mozilla</package> 
can be enabled by installing "<tt>*.so</tt>" 
manually in the plug-in directory and restarting the browsers.
<p>
Plug-in resources:
<list compact>
<item>Java plug-in: install binary "J2SE" from <url id="&javasunhome;">.
<item>Flash plug-in: install binary "Macromedia Flash Player 5" from
 <url id="&flashhome;">.
<item><package>freewrl</package>: VRML browser and Netscape plug-in
<item>...
</list>
</sect1>

<sect1 id="ss-mail"> Mail Clients (MUAs) in X
<p>
There are sevral client packages with graphical display capabilities
as of the Sarge release:
<list compact>
<item><package>mozilla-thunderbird</package> stand-alone mail client
<item><package>kmail</package> KDE mail client
<item><package>evolution</package> groupware suite from Novell
<item>...
</list>

<!-- CJK and X moved to bottom with different name to locale section -->

</sect>

<sect id="ssh">SSH
<p>
SSH (Secure SHell) is the secure way to connect over the Internet.  A free
version of SSH called OpenSSH is available as the <package>ssh</package>
package in &debian;.

<sect1 id="ssh-basics">Basics of SSH
<p>
First install the OpenSSH server and client.
<example>
# apt-get update && apt-get install ssh
</example>
<file>/etc/ssh/sshd_not_to_be_run</file> must not be present if one wishes to 
run the OpenSSH server.
<p>
SSH has two authentication protocols:
<list>
<item>SSH protocol version 1: 
 <list compact>
<item>Potato version only supports this protocol.
<item>available authentication methods:
  <list compact>
<item>RSAAuthentication: RSA identity key based user authentication
<item>RhostsAuthentication: .rhosts based host authentication 
 (insecure, disabled)
<item>RhostsRSAAuthentication: .rhosts authentication combined with 
 RSA host key (disabled)
<item>ChallengeResponseAuthentication: RSA challenge-response authentication
<item>PasswordAuthentication: password based authentication
  </list>
 </list>
<item>SSH protocol version 2: 
 <list compact>
<item>post-Woody versions use this as the primary protocol.
<item>available authentication methods:
  <list compact>
<item>PubkeyAuthentication: public key based user authentication
<item>HostbasedAuthentication: <file>.rhosts</file> or
 <file>/etc/hosts.equiv</file> authentication 
 combined with public key client host authentication  (disabled)
<item>ChallengeResponseAuthentication: challenge-response authentication
<item>PasswordAuthentication: password based authentication
  </list>
 </list>
</list>

<p>
Be careful about these differences if you are migrating to Woody or using 
a non-&debian; system.  
<p>
See <file>/usr/share/doc/ssh/README.Debian.gz</file>,
<manref name="ssh" section="1">, 
<manref name="sshd" section="8">,
<manref name="ssh-agent" section="1">, and
<manref name="ssh-keygen" section="1"> for details.

<p>
Following are the key configuration files:

<list>

<item><file>/etc/ssh/ssh_config</file>: SSH client defaults.
 See <manref name="ssh" section="1">.  Notable entries are:

 <list compact>
<item><tt>Host</tt>: Restricts the following declarations 
  (up to the next Host keyword) to be only for those hosts 
   that match one of the patterns given after the keyword.
<item><tt>Protocol</tt>: Specifies the SSH protocol versions.  
 The default is "2,1".
<item><tt>PreferredAuthentications</tt>: Specifies the SSH2 client 
 authentication method.  The default is 
"hostbased,publickey,keyboard-interactive,password".
<item><tt>PasswordAuthentication</tt>: If you want to log in with 
 a password, you have to make sure this is not set <tt>no</tt>.
<item><tt>ForwardX11</tt>: The default is disabled.  This can be
 overridden by the command-line option "<tt>-X</tt>".
 </list>

<item><file>/etc/ssh/sshd_config</file>: SSH server defaults.
 See <manref name="sshd" section="8">.  Notable entries are:

 <list compact>
<item><tt>ListenAddress</tt>: Specifies the local addresses 
 <prgn>sshd</prgn> should listen on. Multiple options are permitted.
<item><tt>AllowTcpForwarding</tt>: The default is disabled.  
<item><tt>X11Forwarding</tt>: The default is disabled.  
 </list>

<item><file>$HOME/.ssh/authorized_keys</file>: the lists of the default 
public keys that clients use to connect to this account on this host.
See <manref name="ssh-keygen" section="1">.

<item><file>$HOME/.ssh/identity</file>: 
See <manref name="ssh-add" section="1">
and <manref name="ssh-agent" section="1">.
</list>

<p>
The following will start an <prgn>ssh</prgn> connection from a client.
<example>
$ ssh username@hostname.domain.ext
$ ssh -1 username@hostname.domain.ext # Force SSH version 1
$ ssh -1 -o RSAAuthentication=no -l username foo.host
    # force password on SSH1
$ ssh -o PreferredAuthentications=password -l username foo.host
    # force password on SSH2
</example>
For the user, <prgn>ssh</prgn> functions as a smarter and more secure 
<prgn>telnet</prgn> (will not bomb with ^]).

</sect1>

<sect1 id="ssh-forward">Port forwarding for SMTP/POP3 tunneling
<p>
To establish a pipe to connect to port 25 of <var>remote-server</var> from port 4025 of
localhost, and to port 110 of <var>remote-server</var> from port 4110 of localhost
through <prgn>ssh</prgn>, execute on the local machine:
<example>
# ssh -q -L 4025:remote-server:25 4110:remote-server:110 \
           username@remote-server
</example>
This is a secure way to make connections to SMTP/POP3 servers over the Internet.
Set the <tt>AllowTcpForwarding</tt> entry to <tt>yes</tt> in 
<file>/etc/ssh/sshd_config</file> of the remote host.
</sect1>

<sect1 id="ssh-rsa">Connecting with fewer passwords &ndash; RSA
<p>
One can avoid having to remember a password for each remote system by using
RSAAuthentication (SSH1 protocol) or PubkeyAuthentication (SSH2 protocol).  
<p>
On the remote system, set the respective entries,
"RSAAuthentication yes" or "PubkeyAuthentication yes", in 
<file>/etc/ssh/sshd_config</file>.
<p>
Then generate authentication keys locally and install the public key
on the remote system:
<example>
$ ssh-keygen          # RSAAuthentication: RSA1 key for SSH1
$ cat .ssh/identity.pub | ssh user1@remote \
        "cat - &gt;&gt;.ssh/authorized_keys"
...
$ ssh-keygen -t rsa   # PubkeyAuthentication: RSA key for SSH2
$ cat .ssh/id_rsa.pub | ssh user1@remote \
        "cat - &gt;&gt;.ssh/authorized_keys"
...
$ ssh-keygen -t dsa   # PubkeyAuthentication: DSA key for SSH2
$ cat .ssh/id_dsa.pub | ssh user1@remote \
        "cat - &gt;&gt;.ssh/authorized_keys"
</example>
One can change the passphrase later with "<tt>ssh-keygen -p</tt>".
Make sure to verify settings by testing the connection.  In case of any
problem, use "<tt>ssh -v</tt>".
<p>
You can add options to the entries in <prgn>authorized_keys</prgn> to limit
hosts and to run specific commands. See <manref name="sshd" section="8"> for details.
<p>
Note that SSH2 has <tt>HostbasedAuthentication</tt>. For this to work, 
you must adjust the settings of <tt>HostbasedAuthentication</tt> to <tt>yes</tt> in 
both <file>/etc/ssh/sshd_config</file> on the server machine and 
<file>/etc/ssh/ssh_config</file> or <file>$HOME/.ssh/config</file> on 
the client machine.
</sect1>

<sect1 id="ssh-client">Dealing with alien SSH clients
<p>
There are a few free SSH clients available for non-Unix-like platforms.
<taglist>
<tag>Windows
<item><url id="&puttyhome;" name="puTTY"> (GPL)
<tag>Windows (cygwin)
<item>SSH in <url id="&cygwinhome;" name="cygwin"> (GPL)
<tag>Macintosh Classic
<item><url id="&macsshhome;" name="macSSH"> (GPL) [Note that Mac OS X
  includes OpenSSH; use <tt>ssh</tt> in the Terminal application]
</taglist>
See also <url id="&sfdochome;" name="SourceForge.net, site documentation">, 
"6. CVS Instructions".

<sect1 id="ssh-agent">Setting up <prgn>ssh-agent</prgn>
<p>
It is safer to protect your SSH authentication key with a passphrase.
If it was not set, use <tt>ssh-keygen -p</tt> to set it.
<p>
Place your public key (e.g. <file>~/.ssh/id_rsa.pub</file>) 
into <file>~/.ssh/authorized_keys</file> on a remote host using
a password-based connection to the remote host as described in
<ref id="ssh-rsa">.
<example>
$ ssh-agent bash # or run zsh/tcsh/pdksh program instead.
$ ssh-add ~/.ssh/id_rsa
Enter passphrase for /home/osamu/.ssh/id_rsa:
Identity added: /home/osamu/.ssh/id_rsa (/home/osamu/.ssh/id_rsa)
$ scp <var>foo</var> <var>user@remote.host:foo</var>
 ... no passphrase needed from here on :-)
$^D
 ... terminating ssh-agent session
</example>
For the X server, normal &debian; startup scripts execute 
<prgn>ssh-agent</prgn> as parent process.  So you only need to execute 
<prgn>ssh-add</prgn> once.
<p>
For more, read <manref name="ssh-agent" section="1">and
<manref name="ssh-add" section="1">.
</sect1>

<sect1 id="ssh-trouble">Troubleshooting SSH
<p>
If you have problems, check the permissions of configuration files and run
<prgn>ssh</prgn> with the "<tt>-v</tt>" option.
<p>
Use the "<tt>-P</tt>" option if you are root and have trouble with a firewall;
this avoids the use of server ports 1&ndash;1023.
<p>
If <prgn>ssh</prgn> connections to a remote site suddenly stop working, it may be the
result of tinkering by the sysadmin, most likely a change in
<prgn>host_key</prgn> during system maintenance.  After making sure this is
the case and nobody is trying to fake the remote host by some clever hack, one
can regain a connection by removing the <prgn>host_key</prgn> entry from
<file>$HOME/.ssh/known_hosts</file> on the local machine.
</sect1>

</sect>

<sect id="mail">Mail
<p>
Mail configuration divides into three categories:
<list>
<item>mail transfer agent (MTA): <prgn>exim4</prgn>, <prgn>exim</prgn>, 
 <prgn>postfix</prgn>, 
 <prgn>sendmail</prgn>, <prgn>qmail</prgn>, <prgn>ssmtp</prgn>,
 <prgn>nullmailer</prgn>, ...
<item>mail utilities: <prgn>procmail</prgn>, <prgn>fetchmail</prgn>, 
<prgn>mailx</prgn>, <prgn>crm114</prgn>, ...
<item>mail user agent (MUA): <prgn>mutt</prgn>,
<prgn>emacs</prgn>+<prgn>gnus</prgn>, ...
</list>

<sect1 id="mta">Mail transport agents (MTAs)
<p>
For a full-featured MTA, use <package>exim</package> in Woody and
use <package>exim4</package> in Sarge.
<footnote>
Following sections use <prgn>exim</prgn> in examples.  For Sarge
replace this with <prgn>exim4</prgn> as needed.
</footnote>
References:
<list compact>
<item><package>exim-doc</package> and <package>exim-doc-html</package> 
 packages for <package>exim</package>
<item><package>exim4-doc-info</package> and 
 <package>exim4-doc-html</package> packages for <package>exim4</package>
<item><url id="&eximhome;">
</list>
The only reasonable alternative MTA is <package>postfix</package> if you
care about security. <package>sendmail</package> and
<package>qmail</package> are available as &debian; packages but are not
recommended. 
<p>
If you do not need the relay capability of an MTA as in the case of a
satellite system such as a laptop PC, you may consider using one of these 
lightweight packages:
<list compact>
<item><prgn>ssmtp</prgn>: needs an SMTP connection and is alias-capable, or
<item><prgn>nullmailer</prgn>: can spool but is not alias-capable.
</list>
At this moment, I find <prgn>exim</prgn> to be more suitable even for
my personal workstation machine, which is a laptop PC.
<p>
You may need to remove <prgn>exim</prgn> for the installation of 
these conflicting packages:
<example>
# dpkg -P --force-depends exim
# apt-get install nullmailer         # or ssmtp
</example> 

<sect2 id="exim-smart">Smarthost
<p>
If you are running <prgn>exim4</prgn> or <prgn>exim</prgn> on a host 
which is connected
through the consumer grade services, please make sure to send outgoing
mail through a smarthost offered by your ISP or some others.
<footnote>
You must follow this rule for any hosts on dial-up, DSL, cable services
or LAN through some broadband router.  Even if your home host has a
fixed IP from your ISP, it is still a good idea to follow this rule.
Most workstations and home servers fall into this category.
</footnote>
There are few good reasons:
<list compact>
<item>to ensure SMTP retries since your ISP's smarthost usually have
more reliably connection.
<item>to avoid sending mail directly from a <strong>dynamic IP
address</strong> which will likely be blocked by dial-up spam lists. 
<item>to save your local bandwidth to send mails with multiple
recipients. 
</list>
<p>
The only conceivable exceptions are:
<list compact>
<item>the emergency cure for your ISP's SMTP service trouble.
<item>an experiment for the educational purpose.
<item>your host being a professionally hosted server.
</list>

<sect2 id="exim-base">Basic configuration of Exim
<p>
In order to use <prgn>exim4</prgn> or <prgn>exim</prgn> as your MTA, configure the following:
<example>
/etc/exim/exim.conf     "eximconfig" to create and edit (exim)
/etc/exim4/*            "dpkg-reconfigure exim4-config" to create and edit (exim4)
/etc/inetd.conf         comment out smtp to run exim as daemon
/etc/email-addresses    Add spoofed source address lists
</example>
check filters using <prgn>exim4</prgn> or <prgn>exim</prgn> with 
<tt>-brw, -bf, -bF, -bV, ...</tt> etc.

<sect2 id="addr-catchall">Setting up a catchall for nonexistent email addresses under Exim
<p>
In <file>/etc/exim/exim.conf</file> (Woody or later),
in the DIRECTORS part, at the end (after the localuser: director)
add a catch-all director that matches all addresses that the
previous directors couldn't resolve (per Miquel van Smoorenburg):
<example>
catchall:
  driver = smartuser
    new_address = <var>webmaster@mydomain.com</var>
</example>
<p>
If one wants to have more a detailed recipe for each virtual domain, etc., 
add the following at the end of <file>/etc/exim/exim.conf</file> 
(per me, not well tested):
<example>
*@yourdomain.com ${lookup{$1}lsearch*{/etc/email-addresses} \
        {$value}fail} T
</example>
Then have an "*" entry in <file>/etc/email-addresses</file>.
</sect2>

<sect2 id="addr-rewrite">Configuring selective address rewriting for outgoing mail under Exim
<p>
<!-- Derrick 'dman' Hudson dman@dman.ddts.net -->
Selective address rewrite for outgoing mail to produce
proper "From:" headers can be done using <prgn>exim</prgn>
by configuring near the end of <file>/etc/exim/exim.conf</file>:
<example>
*@host1.something.dyndns.org \
  "${if eq {${lookup{$1}lsearch{/etc/passwd}{1}{0}}} {1}  \
   {$0}{$1@something.dyndns.org}}"  frFs
</example>
This rewrites all addresses matching <tt>*@host1.something.dyndns.org</tt>.
<enumlist>
<item>It searches through <file>/etc/password</file> to see if the local part ($1)
   is a local user or not.
<item>If it is a local user, it rewrites the address to the same thing it was in
   the first place ($0).
<item>If it is not a local user, it rewrites the domain part.
</enumlist>

<sect2 id="smtp-aauth">Configuring SMTP authentication under Exim
<p>
Some SMTP services such as yahoo.com require SMTP auth.
Configure <file>/etc/exim/exim.conf</file> as follows:
<example>
remote_smtp:
  driver = smtp
  authenticate_hosts = smtp.mail.yahoo.com
...

smarthost:
  driver = domainlist
  transport = remote_smtp
  route_list = "* smtp.mail.yahoo.com bydns_a"
...

plain:
  driver = plaintext
  public_name = PLAIN
  client_send = "^cmatheson3^this_is_my_password"
</example>
Do not forget double quotes in the last line.

<sect1 id="fetchmail">Fetching mail &ndash; Fetchmail
<p>
<prgn>fetchmail</prgn> is run in daemon mode to fetch mail from a POP3 account
with an ISP into the local mail system.  Configure:
<example>
/etc/init.d/fetchmail   
/etc/rc?.d/???fetchmail run update-rc.d fetchmail default priority 30
/etc/fetchmailrc        configuration file (chown 600, owned by fetchmail)
</example>
<p>
Information on how to start <prgn>fetchmail</prgn> as a daemon from the
<prgn>init.d</prgn> script for Potato is confusing (Woody fixed this). See the
sample <file>/etc/init.d/fetchmail</file> and <file>/etc/fetchmailrc</file>
files in the <url id="&examples;" name="example scripts">.
<p>
If your email headers are contaminated by ^M due to your ISP's mailer, add
"stripcr" to your options in <file>$HOME/.fetchmailrc</file>:
<example>
options fetchall no keep stripcr
</example>
</sect1>

<sect1 id="procmail">Processing mail &ndash; Procmail
<p>
<prgn>procmail</prgn> is a local mail delivery and filter program. One needs to create 
<file>$HOME/.procmailrc</file> for each account that uses it. Example:
<url id="&examples;" name="_procmailrc">
</sect1>

<sect1 id="crm114">Processing spam with <package>crm114</package>
<p>
<package>crm114</package> package provides
<prgn>/usr/share/crm114/mailfilter.crm</prgn> script which is written in
CRM114.  This script provides a very effective spam filter which can be
trained by feeding the spam and the ham.
<p>
CRM114 is a small language designed to write filters in; consider it to 
be a version of grep with super powers. See <manref name="crm" section="1">.
</sect1>

<sect1 id="mutt">Reading mail &ndash; Mutt
<p>
Use <prgn>mutt</prgn> as the mail user agent (MUA) in combination with
<prgn>vim</prgn>.
Customize with <file>~/.muttrc</file>; for example:

<example>
# use visual mode and "gq" to reformat quotes
set editor="vim -c 'set tw=72 et ft=mail'"
#
# header weeding taken from the manual (Sven's Draconian header weeding)
#
ignore *
unignore from: date subject to cc
unignore user-agent x-mailer
hdr_order from subject to cc date user-agent x-mailer
auto_view application/msword
....
</example>
<p>
Add the following to <file>/etc/mailcap</file> or
<file>$HOME/.mailcap</file> to display HTML mail and MS Word attachments
inline:
<example>
text/html; lynx -force_html &percnt;s; needsterminal;
application/msword; /usr/bin/antiword '&percnt;s'; copiousoutput;
description="Microsoft Word Text"; nametemplate=&percnt;s.doc
</example>

</sect1>

</sect>

<sect id="l10n">Localization (l10n)
<p>
&debian; is internationalized, offering support for a growing number of
languages and local usage conventions. The next subsection lists some of the
forms of diversity that &debian; currently supports, and the following
subsections discuss <strong>localization</strong>, the process of customizing
your working environment to allow current input and output of your chosen
language(s) and conventions for dates, numeric and monetary formats, and other
aspects of a system that differ according to your region.

<sect1 id="languages">Basics of localization
<p>
There are several aspects to customizing for localization and national 
language support.

<sect2 id="keyboard">Localizing the keyboard
<p>
&debian; is distributed with keymaps for nearly two dozen
keyboards.  In Woody, reconfigure the keyboard by:

<list compact>
<item><tt>dpkg-reconfigure --priority=low console-data # console</tt>
<item><tt>dpkg-reconfigure --priority=low xserver-xfree86   # XF4</tt>
<item><tt>dpkg-reconfigure --priority=low xserver-common-v3 # XF3</tt>
</list>
</sect2>

<sect2 id="data-stream">Localizing data files
<p>
The vast majority of Debian software packages support data 
    handling of non-US-ASCII characters through the LC_CTYPE environment 
    variable offered by the <strong>locale</strong> technology in glibc.
   
    <list compact>
    <item>8-bit clean: practically all programs
    <item>other Latin character sets (e.g. ISO-8859-1 or ISO-8859-2): the
                  majority of programs
    <item>multibyte languages such as Chinese, Japanese, or Korean:
                  many new applications
    </list>
</sect2>

<sect2 id="display">Localizing the display
<p>
X can display any coding, including UTF-8, and supports all fonts.
The list includes not only all the 8-bit fonts but also 16-bit fonts 
such as Chinese, Japanese, or Korean.  Multibyte character input
method is supported by the <ref id="x-input"> mechanism.   
See <ref id="x-cjk"> and <ref id="x-utf-8">.
<p>
Japanese EUC code display is also available in a (S)VGA graphics console
through the <package>kon2</package> package.  There is an alternative new
Japanese display, <package>jfbterm</package>, which uses a frame-buffer
console, too.  In these console environments, the Japanese input method must
be supplied by the application.  Use <package>egg</package> package for Emacs
and use japanized <package>jvim</package> package for a Vim environment.
<p>
Installation of non Unicode fonts to X will help in displaying documents
with any encoding in X.  So do not worry too much about encoding of fonts.
</sect2>

<sect2 id="translation">Localizing messages and documentation
<p>
Translations exist for many of the text messages and documents that
    are displayed in the &debian; system, such as error messages, standard
    program output, menus, and manual pages.
    Currently, support for manual pages in German, Spanish, Finnish, French,
    Hungarian, Italian, Japanese, Korean, Polish, Portuguese, Chinese,
    and Russian is provided through the <tt>manpages-<var>LANG</var></tt>
    packages (where <var>LANG</var> is a comma-separated list of two-letter
    ISO country codes.  Use <tt>apt-cache search manpages-|less</tt> to get a 
    list of available Unix manual pages.)
    <p>
    To access an NLS manual page, the user must set the environment variable
    LC_MESSAGES to the appropriate string. For example, in the case of the 
    Italian-language manual pages,
    LC_MESSAGES needs to be set to <tt>it</tt>.  The <prgn>man</prgn> program will
    then search for Italian manual pages under <file>/usr/share/man/it/</file>.
</sect2>
</sect1>

<sect1 id="locales">Locales
<p>
Debian supports <strong>locale</strong> technology.  Locale is a mechanism
that allows programs to provide suitable output and functionality according to
local conventions such as character set, format for date and time, currency
symbol, and so on. It uses environment variables to determine the appropriate
behavior. For example, assuming you have both the American English and German
locales installed on your system, the error messages of many programs can be
multilingual:
<example>
$ LANG="en_US" cat foo
cat: foo: No such file or directory
$ LANG="de_DE" cat foo
cat: foo: Datei oder Verzeichnis nicht gefunden
</example>
Glibc offers support for this functionality to programs as a library.  See
<manref name="locale" section="7">.

<sect1 id="base-locale">Introduction to locales
<p>
Full locale description consists of 3 parts: <tt>xx_YY.ZZZZ</tt>.
<list compact>
<item><strong><tt>xx</tt></strong>: ISO 639 language codes (lower case)
<item><strong><tt>YY</tt></strong>: ISO 3166 country codes (upper case)
<item><strong><tt>ZZZZ</tt></strong>: codeset, i.e., character set or encoding
identifier.
</list>
<p>
For language codes and country codes, see pertinent description in the
<tt>info gettext</tt>.
<p>
Please note this codeset part may be normalized internally to achieve
cross platform compatibility by removing all <tt>-</tt> and by
converting all characters into lower case.  Typical codesets are:
<list compact>
  <item><strong>UTF-8</strong>: Unicode for all regions, mostly in 1-3 Octets (new
       de facto standard)
  <item><strong>ISO-8859-1</strong>: western Europe (de facto old standard)
  <item><strong>ISO-8859-2</strong>: eastern Europe (Bosnian, Croatian, Czech,
       Hungarian, Polish, Romanian, Serbian, Slovak,  Slovenian)
  <item><strong>ISO-8859-3</strong>: Maltese
  <item><strong>ISO-8859-5</strong>: Macedonian, Serbian
  <item><strong>ISO-8859-6</strong>: Arabic
  <item><strong>ISO-8859-7</strong>: Greek
  <item><strong>ISO-8859-8</strong>: Hebrew
  <item><strong>ISO-8859-9</strong>: Turkish
  <item><strong>ISO-8859-11</strong>: Thai (=TIS-620)
  <item><strong>ISO-8859-13</strong>: Latvian, Lithuanian, Maori
  <item><strong>ISO-8859-14</strong>: Welsh
  <item><strong>ISO-8859-15</strong>: western Europe with euro
  <item><strong>KOI8-R</strong>: Russian
  <item><strong>KOI8-U</strong>: Ukrainian
  <item><strong>CP1250</strong>: Czech, Hungarian, Polish (MS Windows origin)
  <item><strong>CP1251</strong>: Bulgarian, Byelorussian (MS Windows origin)
  <item><strong>eucJP</strong>: Unix style Japanese (=ujis)
  <item><strong>eucKR</strong>: Unix style Korean 
  <item><strong>GB2312</strong>: Unix style Simplified Chinese (=GB, =eucCN) for zh_CN
  <item><strong>Big5</strong>: Traditional Chinese for zh_TW
  <item><strong>sjis</strong>: Microsoft style Japanese (Shift-JIS) 
</list>
As for the meaning of basic encoding system jargons:
<list compact>
<item><strong>ASCII</strong>: 7 bits (0-0x7f)
<item><strong>ISO-8859-?</strong>: 8 bits (0-0xff)
<item><strong>ISO-10646-1</strong>: Universal Character Set (UCS) (31 bits, 0-0x7fffffff)
<item><strong>UCS-2</strong>: First 16 bit of UCS as straight 2 Octets (Unicode: 0-0xffff)
<item><strong>UCS-4</strong>: UCS as straight 4 Octets (UCS: 0-0x7fffffff)
<item><strong>UTF-8</strong>: UCS encoded in 1-6 Octets (mostly in 3 Octets)
<item><strong>ISO-2022</strong>: 7 bits (0-0xff) with the escape sequence.
ISO-2022-JP is the most popular encoding for the Japanese e-mail.
<item><strong>EUC</strong>: 8 bits + 16 bits combination (0-0xff), Unix style
<item><strong>Shift-JIS</strong>: 8 bits + 16 bits combination (0-0xff), Microsoft
style.
</list>
ISO-8859-?, EUC, ISO-10646-1, UCS-2, UCS-4, and UTF-8 share the same
code with ASCII for the 7 bit characters.  EUC or Shift-JIS uses
high-bit characters (0x80-0xff) to indicate that part of encoding is 16
bit.  UTF-8 also uses high-bit characters (0x80-0xff) to indicate non 7
bit character sequence bytes and this is the most sane encoding system 
to handle non-ASCII characters.
<p>
Please note the byte order difference of Unicode implementation:
<list compact>
<item><strong>Standard  UCS-2, UCS-4</strong>: big endian
<item><strong>Microsoft UCS-2, UCS-4</strong>: little endian for ix86 (machine-dependent)
</list>
See <ref id="recode"> for conversion between various character sets.
For more see <url id="&intro-i18n;" name="Introduction to i18n">.

<sect1 id="activate-locales">Activating locale support
<p>
&debian; does <strong>not</strong> come with all available
locales pre-compiled. Check <file>/usr/lib/locale</file> to see which
locales (besides the default "C") are compiled for your system. If the one
you need is not present, you have two options:
<list compact>
 <item>Edit <file>/etc/locale.gen</file> to add the desired locale, then
   run <prgn>locale-gen</prgn> as root to compile it. See <manref
   name="locale-gen" section="8"> and the manpages listed in its "SEE ALSO"
   section.
 <item>Run <tt>dpkg-reconfigure locales</tt> to reconfigure the
   <package>locales</package> package. Or if it is not already installed,
   installing <package>locales</package> will invoke the debconf interface to
   let you choose needed locales and compile the database.
 <!--  XXX FIXME XXX 
 <item>Run <prgn>localedef</prgn> manually from user account to compile 
   the locale database and use it by setting 
   <tt>LOC_PATH</tt> 
   environment variable.  For example for <tt>en_GB.UTF-8</tt>:
   <example>
$ localedef -v -c -i en_GB -f UTF-8 <var>somewhere/</var>en_GB.UTF-8
$ export LOC_PATH=<var>somewhere/</var>
   </example>
 -->
</list>

<sect1 id="env-locale">Activating a particular locale
<p>
The following environment variables are evaluated in this order to provide
particular locale values to programs:
<enumlist>
<item>LANGUAGE: This environment variable consists of a colon-separated 
      list of locale names in order of priority. Used only if the POSIX
      locale is set to a value other than "C" [in Woody; the Potato version
      always has priority over the POSIX locale]. (GNU extension)
<item>LC_ALL: If this is non-null, the value is used for all locale
      categories. (POSIX.1) Usually "" (null).
<item>LC_*: If this is non-null, the value is used
      for the corresponding category (POSIX.1).  Usually "C".
<p>
      LC_* variables are:
 <list compact>
<item>LC_CTYPE: Character classification and case conversion.
<item>LC_COLLATE: Collation order.
<item>LC_TIME: Date and time formats.
<item>LC_NUMERIC: Non-monetary numeric formats.
<item>LC_MONETARY: Monetary formats.
<item>LC_MESSAGES: Formats of informative and diagnostic messages and
            interactive responses.
<item>LC_PAPER: Paper size.
<item>LC_NAME: Name formats.
<item>LC_ADDRESS: Address formats and location information.
<item>LC_TELEPHONE: Telephone number formats.
<item>LC_MEASUREMENT: Measurement units (Metric or Other).
<item>LC_IDENTIFICATION: Metadata about the locale information.
 </list>
<item>LANG:   If this is non-null and LC_ALL is undefined, the value is used
      for all LC_* locale categories with undefined values. (POSIX.1) Usually
      "C".
</enumlist>
Note that some applications (e.g., Netscape 4) ignore LC_* settings.
<p>
The <prgn>locale</prgn> program can display active locale settings and
available locales; see <manref name="locale" section="1">. (NOTE: <tt>locale
-a</tt> lists all the locales that your system knows about; this does
<em>not</em> mean that all of them are compiled! See
<ref id="activate-locales">.)


<sect1 id="ISO-locale">ISO 8601 date format locale
<p>
The locale support for the international date standard of <tt>yyyy-mm-dd</tt>
(ISO 8601 date format) is provided by the locale called <tt>en_DK</tt>, 
"English in Denmark", which is a bit of joke :-)
This seems to work only in a console screen for <prgn>ls</prgn>.

<!-- beyond locale moved to below -->

<sect1 id="iso-8859-1">Example for the US (ISO-8859-1)
<p>
Add the following lines to <file>~/.bash_profile</file>:
<example>
LC_CTYPE=en_US.ISO-8859-1
export LC_CTYPE
</example>

<sect1 id="france">Example for France with Euro sign (ISO-8859-15)
<p>
Add the following lines to <file>~/.bash_profile</file>:
<example>
LANG=fr_FR@euro
export LANG
LC_CTYPE=fr_FR@euro
export LC_CTYPE
</example>
<p>
Configure the keyboard for French "AZERTY" as described in <ref id="keyboard">;
add French manual pages by installing <package>manpages-fr</package>.  The
Right-Alt key in the US is called Alt-Gr in Europe.  Pressing this together
with other keys creates numerous accented and special characters.  For example,
Alt-Gr+E creates a Euro sign.
<p>
Most western European languages can be configured similarly.
<p>
See <url id="&debian-euro-support;" name="Debian Euro HOWTO"> for 
adding support for the new Euro currency and 
<url id="&debian-fr-howto;" name="Utiliser et configurer Debian pour le franais"> 
for more details in French.

<sect1 id="x-cjk">Example for a multilingual X window system
<p>
Let us set up a multilingual X window system which simultaneously
supports Japanese, English, German, and French with EUC, UTF-8, and
ISO-8859-1 encodings in different consoles.
<p>
I will show you a customization using the &debian; menu system.  See the
details of &debian; menu system in <url id="&f-menu;">.  I also create a
shortcut to the <prgn>mozilla</prgn> web browser in this example.
 <footnote>
In this example, 2 bug workarounds are deployed for the version of
<prgn>blackbox</prgn> in 2003. I use <tt>sh -c</tt> in command. Also
<file>~/.menu/*</file> entry is not used but root requiring
<file>/etc/menu/*</file> was used instead.
 </footnote>
<list>

 <item>add locale support for the Japanese ja_JP.eucJP locale and other
 required locales using the method described at <ref id="l10n">. (for
 all)

 <item>install Kana-to-Kanji conversion system and dictionary (for
 Japanese):
  <list compact>
  <item><package>canna</package> &ndash; Local server ("free-beer" license), or
  <item><package>freewnn-jserver</package> &ndash; Network-extensible server 
   (Public Domain)
  </list>

 <item>install Japanese input method system (for Japanese):
  <list compact>
  <item><package>kinput2-canna</package> &ndash; for X, or
  <item><package>kinput2-canna-wnn</package> &ndash; for X, and
  <item><package>egg</package> &ndash; directly works with Emacsen even 
    in console (optional)
  </list>

 <item>Install compatible terminals (for all):
  <list compact>
  <item><package>xterm</package> &ndash; X (for ISO-8859-1 and UTF-8),
  <item><package>kterm</package> &ndash; X (for Japanese EUC), and
  <item><package>mlterm</package> &ndash; X (multilingual).
  </list>

 <item>add all the required font packages. (for all)
 
 <item>create the <file>~/.xsession</file> that sets the user-specific X 
  environment as described in <ref id="custom-x"> (for all):

<example>
#!/bin/sh
# This makes X work when I su to root.
if [ -z "$XAUTHORITY" ]; then
        XAUTHORITY=$HOME/.Xauthority
        export XAUTHORITY
fi

# Set specific environment through debian menu system.
# Reset locale
unset LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES 
unset LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT 
unset LC_IDENTIFICATION LC_ALL LANG LANGUAGE PAGER
# set locale default in X
LANG=C
# export locale
export LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES 
export LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT 
export LC_IDENTIFICATION LC_ALL LANG LANGUAGE PAGER
###
# activate input method for Japanese with kinput2
kinput2 &
XMODIFIERS="@im=kinput2"
export XMODIFIERS
# How about blackbox window manager (lightweight)
exec blackbox
#exec xfwm
#exec wmaker
</example>

 <item>set locale in <file>~/.bash_profile</file> for Linux consoles
 (for all).
 
 <item>remove locale settings from <file>~/.bashrc</file>, if existed
 (for all).

 <item>create few files in <file>/etc/menu/</file> (for all).
 <list compact>
 <item><file>/etc/menu/xterm-local</file>: (add new entries to menu)
 <footnote>
Use a file name which does not overwrap with any package names.
 </footnote>
<example>
?package(xterm):\
 needs=x11\
 section=XShells\
 longtitle="XTerm: terminal emulator (en_US.ISO-8859-1)"\
 title="XTerm (en_US.ISO-8859-1)"\
 command="sh -c 'LC_ALL=en_US.ISO-8859-1 xterm'"
?package(xterm):\
 needs=x11\
 section=XShells\
 longtitle="XTerm: terminal emulator (de_DE.ISO-8859-1)"\
 title="XTerm (de_DE.ISO-8859-1)"\
 command="sh -c 'LC_ALL=de_DE.ISO-8859-1 xterm -T xterm-de'"
?package(xterm):\
 needs=x11\
 section=XShells\
 longtitle="XTerm: terminal emulator for X with Unicode support (Japanese)"\
 title="UXTerm (ja_JP.UTF-8)"\
 command="sh -c 'LC_ALL=ja_JP.UTF-8 uxterm'"
</example>
 <item><file>/etc/menu/kterm</file>: (override the system default)
 <footnote>
Use a file name which overwraps with the package name.
 </footnote>
<example>
?package(kterm):\
 needs="x11"\
 section="XShells"\
 command="sh -c 'LC_ALL=ja_JP.eucJP PAGER=w3m /usr/X11R6/bin/kterm -xim'" \
 title="Kanji Terminal"
?package(kterm):\
 needs="x11"\
 section="XShells"\
 command="sh -c 'LANG=ja_JP.eucJP \
          LC_MESSAGES=en_US.ISO-8859-1 PAGER=w3m /usr/X11R6/bin/kterm -xim'" \
 title="Kanji Terminal (bilingal)"
</example>
 <item><file>/etc/menu/mozilla-local</file>: (add a new shortcut)
 <footnote>
 The slash in <tt>section="/"</tt> enables entry to the initial menu,
 and the leading space in <tt>title=" Mozilla Navigator"</tt> enables
 entry to the top of the list.
 </footnote>
<example>
?package(mozilla-browser):needs="x11" section="/" \
        title=" Mozilla Navigator" command="mozilla-1.5" hints="Web browsers" \
        icon=/usr/share/pixmaps/mozilla.xpm
</example>
 <item>run <prgn>update-menus</prgn> from the root account.
 </list>
 <item>add the following lines to <file>~/.muttrc</file> (for Japanese):
<example>
# UTF-8 support is not popular in popular Japanese EMACS environment
# 7-bit encoding of iso-2022-jp is easier for everyone.
# default encoding order = us-ascii --&gt; iso-8859-1 --&gt; iso-2022-jp
set send_charset="us-ascii:iso-8859-1:iso-2022-jp"
set allow_8bit=no
</example>
 <item>activate XIM <prgn>kinput2</prgn> for X applications (for
 Japanese):
  <list compact>
  <item>add <tt>*inputMethod: kinput2</tt> and <tt>KTerm*VT100*OpenIm:
  true</tt> to your X resources file,
  <file>~/.Xresources</file>  (it looks like Debian takes care of this
  automatically somehow).
  <item>Some applications (such as <prgn>mlterm</prgn>) also allow 
  you to set up <tt>*inputMethod:</tt> and other information dynamically 
  at runtime (press <strong>Ctrl-MouseButton-3</strong> in <prgn>mlterm</prgn>).
  </list>
 <item>start X by typing <tt>startx</tt> or from one of the display
  managers (<prgn>xdm</prgn>, <prgn>gdm</prgn>, <prgn>kdm</prgn>,
  <prgn>wdm</prgn>, ...)  (for all).
 <item>start a Japanese-compatible application such as
  Vim 6, (x)emacs21, mc-4.5, mutt-1.4, ... in <prgn>kterm</prgn>  (for
  Japanese).
  (Emacs seems to be the most popular platform, though I do not use it.)
 <item>press <strong>Shift+Space</strong> to toggle Japanese 
  character input mode on and off (for Japanese).
 <item>read the localized manual page by starting command in localized
 console (for all).
</list>
For other CJK language supports, see the following sections and <url
id="&suse-cjk;" name="SuSE pages for CJK">.

<sect1 id="x-input">Alternative X input methods
<!-- I need feed back from Chinese and Korean people for here -->
<p>
There are many alternative X input methods support packages available:
<example>
Language   LC_CTYPE     XIM server XMODIFIERS              Start key
Japanese   ja_JP*       kinput2    "@im=kinput2"           Shift-Space
Korean     ko_KR*       ami        "@im=Ami"               Shift-Space
Chinese(T) zh_TW.Big5   xcin       "@im=xcin-zh_TW.big5"   Ctrl-Space
Chinese(S) zh_CN.GB2312 xcin       "@im=xcin-zh_CN.GB2312" Ctrl-Space
</example>
<p>
Japanese input method <prgn>kinput2</prgn> is offered by the packages
such as <package>kinput2-canna-wnn</package>,
<package>kinput2-canna</package>, and <package>kinput2-wnn</package>.
Japanese needs dictionary server such as <package>canna</package> and
<package>freewnn-jserver</package> to be practical.

<!--
<p>
Korean and Chinese may also use dictionary server such as 
<package>freewnn-kserver</package> and
<package>freewnn-cserver</package> too.
-->

<sect1 id="x-term">X terminal emulators
<p>
There are many X consoles which support simple 8 bit encodings
when pertinent font packages are installed:
<list compact>
  <item><package>xterm</package> &ndash; The X terminal emulator
  <item><package>gnome-terminal</package> &ndash; <package>xterm</package> 
   for Gnome
  <item><package>konsole</package> &ndash; <package>xterm</package> 
   for KDE
  <item><package>rxvt</package> &ndash; VT102 terminal (lighter)
  <item><package>aterm</package> &ndash; VT102 for Afterstep WM
  <item><package>eterm</package> &ndash; VT102 for Enlightment WM
  <item><package>wterm</package> &ndash; VT102 for WindowMaker WM
</list>
<p>
Multi-byte encoding supports of X console are provided by
<package>xterm</package> through UTF-8 encoding (<ref id="x-utf-8">).
Other traditional encoding supports are in progress (as of 2003).
Following packages offer traditional encoding supports:
<list compact>
  <item><package>aterm-ml</package> &ndash; Multi-lingual
  <item><package>kterm</package> &ndash; Multi-lingual (Japanese, ...)
  <item><package>rxvt-ml</package> &ndash; Multi-lingual
  <item><package>wterm-ml</package> &ndash; Multi-lingual 
  <item><package>cxterm-big5</package> &ndash; Chinese (Trad., Big5)
  <item><package>cxterm-gb</package> &ndash; Chinese (Simp., GB)
  <item><package>cxterm-ks</package> &ndash; Chinese (KS)
  <item><package>cxterm-jis</package> &ndash; Japanese
  <item><package>hanterm-classic</package> &ndash; Korean (Hangul)
  <item><package>hanterm-xf</package> &ndash; Korean (Hangul)
  <item><package>hztty</package> &ndash; Chinese (GB, Big5, zW/HZ)
</list>
For <prgn>kterm</prgn> (and possibly others), you may want to 
activate XIM through menu after Ctrl-middle-click mouse action.

<sect1 id="x-utf-8">UTF-8 support for the X terminal emulator
<p>
UTF-8 support for X terminal emulator is provided by the
<prgn>uxterm</prgn> program in the <package>xterm</package> package for
XFree86 4.x.  It enables support for all languages.  It is a wrapper
around the <manref name="xterm" section="1"> program that invokes the
latter program with the "UXTerm" X resource class set.
<p>
For example, to enable nice large display of English, Russian, Japanese,
Chinese, and Korean characters, add following to your
<file>~/.Xresources</file> after installing all the pertinent fonts:
<example>
! set large font
UXTerm*font: -misc-fixed-medium-r-normal-*-18-120-100-100-c-90-iso10646-1
! Use XIM for Japanese
*inputMethod: kinput2
</example> 
Then run <tt>xrdb -merge ~/.Xresources</tt> to update X resources as
described in <ref id="xresources">.
<p>
Although most of the popular console program packages such as
<package>vim</package>, <package>mutt</package>, and
<package>emacs</package> have been made compatible with UTF-8 recently
(Woody-Sarge).  Program such as <package>mc</package> still is not UTF-8
compatible but simply 8-bit clean. If you are editing 7 bit ASCII part
of unknown or mixed encoding file, it is safer to use the locale unaware
8-bit clean editor.
<p>
See <url id="&unicode-howto;" name="The Unicode HOWTO">.

<sect1 id="fb-utf-8">Example for UTF-8 in a framebuffer console
<p>
UTF-8 support on a FB console is provided by <package>bterm</package>
used in the <prgn>debian-installer</prgn>.

<sect1 id="beyond-locale">Beyond locales
<p>
When you are first setting the system up for a <strong>national
language environment</strong>, please consider using
<prgn>tasksel</prgn> or <prgn>aptitude</prgn> to find out what packages
are selected by choosing the corresponding language environment task.
The package choice made is useful even for a multilingual setup.  If
you encounter any package dependency conflicts during the install to
your carefully configured system, avoid installing any software that
conflicts with the existing system.  You may have to use
<prgn>update-alternative</prgn> to regain the original state for some
commands since a newly installed one may have higher priority than
existing ones.
<p>
Newer major programs are using glibc 2.2 and are mostly internationalized.  So
a specially localized version such as <prgn>jvim</prgn> for Vim may not be
needed as its functionality is offered by <prgn>vim</prgn> version 6.0 in X.
In reality, it is still somewhat rough-edged.  Since <prgn>jvim</prgn> has a
version compiled with direct Japanese input method (<prgn>canna</prgn>)
support even in the console and addresses many other Japanese-specific issues
maturely, you may still want it :-)
<p>
Programs may need to be configured beyond <tt>locale</tt> configuration
to enable a comfortable working environment.  The
<package>language-env</package> package and its command
<prgn>set-language-env</prgn> greatly eases this process.
<p>
Also see the internationalization document, <url id="&intro-i18n;" 
name="Introduction to i18n">. It is aimed at developers but is also 
useful for system administrators.
</sect1>

</sect>

<sect id="m17n">Multilingualization (m17n)
<p>
<ref id="l10n"> enabled by <package>language-env</package> package and
alike are aimed to achieve monolingual localization.  These packages
also use traditional encodings as the choice for the text encoding.  You
cannot mix French and Japanese text in such environment since they use
incompatible ISO-8859-1 and EUC-JP encodings respectively.
<p>
You can obtain multilingualized UTF-8 Desktop using Gnome and KDE
programs started under one of the available UTF-8 locales. (Sarge) In
such environment, you can mix English, Chinese, Russian, and Japanese
characters under UTF-8 compliant softwares.
<p>
Under such environment, new multilingualized input method (IM) using
<package>scim</package> is preferred.  IM offered by the
<package>scim</package> is turned on and off by typing Ctrl-Space
together.  The input conversion engine can be switched by clicking small
SCIM panel.
<p>
<package>vim</package> offers the multilingualized environment and can
handle both UTF-8 and conventionally encoded files (EUC-JP, ISO-8859-1,
...) when it is run under the UTF-8 console such as
<prgn>gnome-teminal</prgn>.  See vim help message with pressing [Esc]
and typing <tt>:help mbyte.txt</tt>.
</sect>

</chapt>

