<!-- CVS revision of this document "$Revision: 1.6 $"  -->
<chapt id="woody">Upgrading distribution

<![%FIXME[<p>===Proof reading by bignachos once but : NO ===]]>
<![%FIXME[<p>===Osamu rewote whole thing with apt-setup ===]]>
<!-- with proper dhelp, this can be simplified, someone? -->
<p>
Official release notes for upgrading are located at
<url id="&stable-release;">
and
<url id="&testing-release;"> (work in progress).

<p>
<sect>Transition preparation (woody)
<p>
Network upgrade to "testing" can be done as follows (run a script 
<url id="&examples;" 
name="go-woody"> to do this in one command):
<example>
# cd /etc/apt
# cp -f sources.list sources.old 
# :&gt;sources.list  
# cd /
# apt-setup noprobe 
 ... select http or ftp
# cd /etc/apt
# grep -e "^deb " sources.list             &gt;sources.deb
# grep -e "^deb-" sources.list             &gt;sources.src
# sed -e "s/^d/#d/" \
&gt;  /usr/share/doc/apt/examples/sources.list 
&gt;  &gt;sources.list
# sed -e "s/stable/testing/"  \
&gt;  sources.deb &gt;&gt;sources.list
# apt-get update
# apt-get install apt apt-utils
# cat &gt;preferences &lt;&lt;EOF
&gt; Package: *
&gt; Pin: release a=testing
&gt; Pin-Priority: 700
&gt; 
&gt; Package: *
&gt; Pin: release a=unstable
&gt; Pin-Priority: 70
&gt;
&gt; EOF
# sed -e "s/stable/unstable/" sources.deb \
&gt;  &gt;&gt;sources.list
# sed -e "s/stable/unstable/" sources.src | \
&gt; sed -e "s/^deb-/#deb-/"  &gt;&gt;sources.list
</example>
A guideline for <file>/etc/apt/preferences</file> (see <manref
name="apt_preferences" section="5">):
<example>
track stable:            change  Pin-Priority of testing  to  80
track testing:           keep as is (install unstable by /unstable)
track testing(unstable): change  Pin-Priority of unstable to 600
track unstable(testing): change  Pin-Priority of unstable to 800
</example>
A guideline for the choice of Pin-Priority moves from the top to bottom 
in the above table as the time moves from a time immediately after a 
distribution release to a time of freeze for the next release.
<p>
Make sure to set up <prgn>apt</prgn> to use a proxy, if necessary, by
setting the <tt>http_proxy</tt> environment 
variable or set the http value in <file>/etc/apt/apt.conf</file>.
<p>
The procedure described in this section only upgrades <prgn>apt</prgn> 
and a minimum set of packages to avoid dependency-related problems.
<p>
Since this upgrade method uses <prgn>apt-get</prgn>, it's handling for 
<em>recommends</em> and <em>suggests</em> are limitted. 
Read <ref id="depends"> and use <prgn>dselect</prgn> instead to achieve 
fine grained control.
</sect>

<sect>Upgrade to Woody
<p>
After above preparation:
<example>
# apt-get update # always do this before upgrade
 ... to upgrade whole system with "suggests" selections
# apt-get update                     # always do this before upgrade
 ... to upgrade whole system with "suggests" selection 
# apt-get -u dist-upgrade
 ... to upgrade and stay with current dselect setting (new, better)
# dselect update
# dselect select # or any method to select packages
# apt-get -u dselect-upgrade         # use dselect setup result
</example>
</sect>

<sect>Woody configuration
<p>
This may not be needed as woody improves.
<p>
For freshly installed woody system, edit <file>/etc/apt/sources.list</file>,
<file>/etc/apt/apt.conf</file>, and <file>/etc/apt/preferences</file> 
to achieve the same structure as described in the above section.
</sect>

<sect id="spy">Optimized <file>sources.list</file>
<p>
Create <file>sources.list</file> automatically, based on latency
and bandwidth.
<example>
# apt-get install apt-spy
# cd /etc/apt ; mv sources.list sources.list.org
# apt-spy -d testing -l sources.apt
</example>
<prgn>netselect-apt</prgn> is very similar to <prgn>apt-spy</prgn>.
It creates a more complete <file>sources.list</file>, but uses an 
inferior method of choosing the best mirror (ping time comparison).
<prgn>apt-setup</prgn> is the manual method for selecting the 
mirrors in <file>sources.list</file>, but is still the best way
for choosing mirrors until apt-spy improves.

</sect>

</chapt>

