<!-- CVS revision of this document "$Revision: 1.5 $"  -->
<!--Line width ruler (ruler uses 78 characters)     34567890123456789012345-->

<chapt id="cvs">CVS

<![%FIXME[<p>===Proof reading by danielwebb: DONE ===]]>

<p>
Check <file>/usr/share/doc/cvs/html-cvsclient</file>, 
<file>/usr/share/doc/cvs/html-info</file>,
<file>/usr/share/doc/cvsbook</file> with lynx or run <tt>info cvs</tt> and
<tt>man cvs</tt> for detailed information.

<sect id="cvs-inst">Install CVS server
<p>
The following setup will allow commits to the CVS repository only by a
member of the "src" group, and administration of CVS only by a member of
the "staff" group, thus reducing the chance of shooting oneself.
<example>
# cd /var/lib; umask 002 ; sudo mkdir cvs # [WOODY] FSH
# apt-get install cvs cvs-doc cvsbook
# export CVSROOT=/var/lib/cvs
# cd $CVSROOT
# chown root:src .  # "staff" to restrict more for starting project.
# chmod 3775 .             # If above uses "staff", use 2775
# cvs -d /var/lib/cvs init # safer to specify -d here explicitly!
# cd CVSROOT
# chown -R root:staff .
# chmod 2775 .
# touch val-tags 
# chmod 664 history val-tags
# chown root:src history val-tags
</example>
<p>
</sect>

<sect id="cvs-examples">CVS session examples

<sect1>Anonymous CVS (download only)
<p>
<example>
$ export CVSROOT=:pserver:anonymous@cvs.qref.sf.net:/cvsroot/qref
$ cvs login
$ cvs -z3 co qref
</example>
</sect1>

<sect1>Use local CVS server
<p>
<example>
$ export CVSROOT=/var/lib/cvs
</example>
</sect1>

<sect1>Use remote CVS pserver
<p>
This is insecure but good for anonymous CVS:
<example>
$ export CVSROOT=:pserver:account@cvs.foobar.com:/var/lib/cvs
$ cvs login
</example>
</sect1>

<sect1>Use remote CVS through <prgn>ssh</prgn>
<p>
You can also use RSA authentication (<ref id="ssh-rsa">) which
eliminates the password prompt.
<example>
$ export CVSROOT=:ext:account@cvs.foobar.com:/var/lib/cvs
</example>
or for Sourceforge:
<example>
$ export CVSROOT=:ext:account@cvs.qref.sf.net:/cvsroot/qref
</example>
</sect1>

<sect1>Create a new CVS archive
<p>
For,
<example>
ITEM              VALUE                    MEANING
source tree:      ~/project-x              All source codes
Project name:     project-x                Name for this project
Vendor Tag:       Main-branch              Tag for the entire branch
Release Tag:      Release-original         Tag for a specific release
</example>
Then,
<example>
$ cd ~/project-x                 # dive into source directory
 ... create a source tree ...
$ cvs import -m "Start project-x" project-x Main-branch Release-initial
$ cd ..; rm -R ~/project-x
</example>
</sect1>

<sect1>Work with CVS
<p>
To recall and work in local sources of project-x with CVS archive:
<example>
$ cd                            # move to the work area.
$ cvs co project-x              # get sources from CVS to local
$ cd project-x
 ... make changes to the content ...
$ cvs diff -u                   # similar to diff -u repository/ local/
$ cvs ci -m "Describe change"   # save local sources to CVS
$ vi newfile_added
$ cvs add newfile_added
$ cvs ci -m "Added newfile_added"
$ cvs up                        # merge latest version from CVS
$ cvs tag Release-1             # add release tag
... edit further ...
$ cvs tag -d Release-1          # remove release tag
$ cvs ci -m "more comments"
$ cvs tag Release-1             # re-add release tag
$ cd                            # move back to the work area.
$ cvs co -r Release-initial -d old project-x 
... get original version to old directory
$ cd old
$ cvs tag -b Release-initial-bugfixes # create branch (-b) tag
 ... Now you can work on the old version
$ cvs update -r Release-initial-bugfixes 
 ... Source tree now has sticky tag Release-initial-bugfixes
 ... Work on this branch
$ cvs up # sync with others on branch
$ cvs ci -m "check into branch"
$ cvs update -r HEAD # change branch to the main trank's HEAD
$ cvs update -kk -j Release-initial-bugfixes
 ... Merge branch into the main trunk without keyword expansion
 ... fix conflicts with editor
$ cvs ci -m "merge Release-initial-bugfixes into the main trank"
$ cd
$ tar -cvzf old-project-x.tar.gz old     # make archive, -j for bz2
$ cvs release -d old               # remove local source (optional)
</example>
Nice options to remember (use right after <prgn>cvs</prgn>):
<example>
-n      dry run, no effect
-t      display messages showing steps of cvs activity
</example>
</sect1>

<sect1>Export files from CVS
<p>
To get the latest version from CVS, use "tomorrow":
<example>
$ cvs ex -D tomorrow <var>module_name</var>
</example>
</sect1>

<sect1>Administer CVS
<p>
Add alias to a project (local server):
<example>
$ su - admin           # a member of staff
$ export CVSROOT=/var/lib/cvs ; cvs co CVSROOT/modules
$ cd CVSROOT
$ echo "px -a project-x" &gt;&gt;modules
$ cvs ci -m "Now px is an alias for project-x"
$ cvs release -d .
$ exit                 # control-D to get back from su
$ cvs co -d project px 
 ... check out project-x (alias:px) from CVS to directory project
$ cd project
 ... make changes to the content ...
</example>
</sect1>
</sect>

<sect id="cvs-trouble">Troubleshooting CVS

<sect1>File permissions in repository
<p>
CVS will not overwrite the current repository file but replaces it with
another one.  Thus, <em>write permission to the repository directory</em>
is critical. For every new repository creation run the following to
ensure this condition if needed.
<example>
# cd /var/lib/cvs
# chown -R root:src repository
# chmod -R ug+rwX   repository
# chmod    2775     repository  # if needed, this and subdirectory
</example>
</sect1>

<sect1>Execution bit
<p>
A file's execution bit is retained when checked out.  Whenever you
see execution permission problems in checked-out files, change
permissions of the file in the CVS repository with the following command.
<example>
# chmod ugo-x filename
</example>
</sect1>

</sect>

<sect id="cvs-short">CVS commands
<p>
Here are CVS commands with their shortcuts.
<example>
{add|ad|new} [-k kflag] [-m 'message'] files...
{admin|adm|rcs} [rcs-options] files...
{annotate|ann} [options] [files...]
{checkout|co|get} [options] modules...
{commit|ci|com}   [-lnR]  [-m  'log_message'  |  -f  file] \
        [-r revision] [files...]
{diff|di|dif} [-kl] [rcsdiff_options] [[-r rev1 | -D date1] \
        [-r rev2 |  -D date2]] [files...]
{export|ex|exp} [-flNn] -r rev|-D date [-d dir] [-k kflag] module...
{history|hi|his} [-report] [-flags] [-options args] [files...]
{import|im|imp} [-options] repository vendortag releasetag...
{login|logon|lgn}
{log|lo|rlog} [-l] rlog-options [files...]
{rdiff|patch|pa} [-flags] [-V vn] [-r t|-D d [-r t2|-D d2]] modules...
{release|re|rel} [-d] directories...
{remove|rm|delete} [-lR] [files...]
{rtag|rt|rfreeze} [-falnR]  [-b]  [-d]  [-r  tag  |  -D  date] \
         sym_bolic_tag modules...
{status|st|stat} [-lR] [-v] [files...]
{tag|ta|freeze} [-lR] [-F] [-b] [-d] [-r tag | -D date]  [-f] \
         sym_bolic_tag [files...]
{update|up|upd} [-AdflPpR] [-d] [-r tag|-D date] files...
</example>
</sect>

</chapt>
