<!--
  english version: 1.3
  russian version: $Id: uptodate.ru.sgml,v 1.2 2001-04-13 09:16:53 nidd Exp $
  -->

<chapt id="uptodate">Поддержание вашей системы Debian на уровне современных
требований

<p>Одной из целей Debian является предоставление процесса согласованных и
безопасных обновлений, и мы всегда стараемся как можно более сгладить переход
со старых версий на более новые. Если появляются какие-то важные замечания во
время процесса обновления, то пакет уведомляет пользователя, и часто
предлагает решение возможных проблем.

<p>Вы также должны прочитать Замечания по Выпуску, документ, описывающий
специфичные подробности обновления, имеющийся на всех CD Debian и доступный на
WWW по адресу
<url id="http://www.debian.org/releases/stable/i386/release-notes/">.

<sect id="libc5to6upgrade">Как мне обновить мой дистрибутив Debian 1.3.1 (или
более ранний), основанный на libc5, до 2.0 (или более позднего), основанного на
libc6?

<p>Для обновления существует несколько путей:
<list>
  <item>Используя простой сценарий shell <tt>autoup.sh</tt>, который
    обновляет наиболее важные пакеты. После того как <tt>autoup.sh</tt>
    выполнит свою работу, вы можете воспользоваться dselect, чтобы
    <em>сразу</em> установить остальные пакеты.
    Это, вероятно, самый рекомендуемый метод, но он не единственный.
    <p>Сейчас, последний выпуск <tt>autoup.sh</tt> можно найти:
    <list>
      <item><url id="http://www.debian.org/releases/2.0/autoup/">
      <item><url id="http://www.taz.net.au/autoup/">
      <item><url id="http://csanders.vicnet.net.au/autoup/">
    </list>
  <item>Точно следуя <url name="libc5-libc6-Mini-HOWTO"
    id="ftp://ftp.debian.org/pub/debian/doc/libc5-libc6-Mini-HOWTO.txt">, и
    обновление наиболее важных пакетов сделать вручную. <tt>autoup.sh</tt> 
    основан на этом Mini-HOWTO, поэтому этот метод должен работать более менее
    также как и <tt>autoup.sh</tt>.
  <item>Используя, основанный на libc5, <tt>apt</tt>. APT относится к пакетным
    утилитам, и возможно когда-нибудь заменит dselect. Сейчас, она работает
    только из командной строки или в качестве метода доступа из dselect. Вы
    можете найти libc5 версию в каталоге
    <tt>dists/slink/main/upgrade-older-i386</tt> архивов Debian.
  <item>Используя только dselect, без первоначального обновления пакетов
    вручную. Настоятельно НЕ рекомендуется пользоваться эти методом, если
    возможно этого избежать, так как простой dselect сейчас не может
    устанавливать пакеты в оптимальном порядке. APT работает намного лучше и
    безопаснее.
    <!-- Он, наверно, работает, если внутренняя переменная dpkg
    max-error-before-stop увеличивается. Вопрос: Она вообще когда-нибудь 
    увеличивается? -->
</list>

<!--
Этот параграф устарел, но я оставил его оставил его здесь как напоминание, что
dpkg, основанный на libc6 несколько лучше, чем из Debian 1.3.1: Замечу, что
версия <tt>dpkg</tt> в этом каталоге имеет двоичный формат a.out.
<tt>dpkg</tt> сейчас дорабатывается и стабильная ветка имеет ELF формат.
-->

<sect id="howtocurrent">Как мне сохранять мою систему Debian в современном
состоянии?

<p>Нужно просто сделать запрос на анонимный ftp с архивом Debian, затем
внимательно просмотреть каталоги, пока не будет найден желаемый файл, а затем
скачать его и наконец установить с помощью <tt>dpkg</tt>. Заметим, что
<tt>dpkg</tt> установит обновлённые файлы даже при работающей системе. Иногда,
обновляемый пакет может потребовать установки новой версии другого пакета, в
этом случае установка прерывается, пока не будет установлен нужный пакет.

<p>Многие люди сочтут предлагаемый способ отнимающим много времени, т.к.
Debian развивается слишком быстро -- обычно, где-то дюжина и более пакетов
обновляется каждую неделю. Это число увеличивается по мере приближения в новому
основному выпуску. Чтобы справится с такой лавиной, многие люди предпочитают
использовать программы автоматизации процесса. Для этих целей существует
несколько различных пакетов:

<sect1 id="apt">APT

<p>APT -- это система управления пакетами программного обеспечения, а именно
двоичными пакетами Debian и пакетами с исходным текстом. apt-get -- это
утилита командной строки для манипулирования пакетами, а метод APT к dselect
-- это интерфейс к APT для <prgn/dselect/, оба из которых предоставляют
простой, безопасный путь установки и обновления пакетов.

<p>APT обеспечивает целостную упорядоченную установку из нескольких источников
и имеет несколько других уникальных свойств, смотрите Руководство Пользователя
в <tt>/usr/share/doc/apt/guide.html/index.html</tt>.

<!-- куча подробностей отсутствует... -->

<sect1 id="dpkg-ftp">dpkg-ftp

<p>Этот метод доступа используется в <prgn/dselect/. Он может быть вызван из
<prgn/dselect/, таким образом давая возможность пользователю скачать файлы и
установить их прямо за один шаг. Чтобы попробовать, запустите программу
<prgn/dselect/, выберите пункт "0" ("Choose the access method to use"),
выделите пункт "ftp", затем задайте имя удалённой машины и каталог.
<prgn/dpkg-ftp/ автоматически скачает выбранные файлы (или при работе с
<prgn/dselect/ или выбранные ранее).

<p>Заметим, что в отличие от программы <prgn/mirror/, <prgn/dpkg-ftp/ не
перекачивает всё с зеркалирующего сайта. Она скачивает только те файлы, 
которые вы выбрали (перед запуском <prgn/dpkg-ftp/), и которые нужно обновить.

<sect1 id="mirror">mirror

<p>Это сценарий Perl, а его (необязательная) программа управления называется
<prgn/mirror-master/, можно использовать для получения заданной пользователем
части дерева каталогов с указанного хоста <em>через</em> анонимный FTP.

<p><prgn/mirror/ определённо полезна для скачивания больших объёмов
программного обеспечения. После первого скачивания файлов с сайта, на локальной
машине создаётся файл <tt>.mirrorinfo</tt>. <prgn/mirror/> автоматически
отслеживает изменения удалённой файловой системы, путём сравнения данного
файла с подобным файлом на удалённой системе и скачивает только изменившиеся
файлы.

<p>Программа <prgn/mirror/, как правило, полезна для обновления локальных
копий удалённого дерева каталогов. Получаемые файлы необязательно должны быть
файлами Debian. (Т.к. <prgn/mirror/ является сценарием Perl, он также может
работать на не-Unix системах.)
Не смотря на то, что программа <prgn/mirror/ предоставляет механизм исключения
имён файлов, которые совпадают со строками, заданными пользователем, эта
программа наиболее полезна, когда требуется скачивать целые деревья каталогов,
а не отдельные пакеты.

<!-- Здесь также нужно порекомендовать GNU wget? -->

<sect1 id="dftp">dftp

<p>Этот сценарий Perl можно использовать для получения заданных пользователем
пакетов Debian с заданного хоста. Сначала скачиваются файлы Packages.gz для
каталогов, заданных пользователем (например, stable, contrib, non-free), а
затем ему предоставляется список пакетов. Пакеты делятся на несколько разделов:
новые обновления, откаты на старые версии, новые пакеты, игнорируемые
обновления и игнорируемые пакеты. Затем пользователь выбирает пакеты, которые
он хочет, а dftp скачивает и устанавливает их. Это очень лёгкий способ
содержать вашу систему Debian на 100% актуальной всё время без скачивания
пакетов, которые вы не хотите устанавливать.

<p><prgn/dftp/ можно вызывать из <prgn/dselect/ (смотрите <ref id="dselect">),
таким образом предоставляется встроенная возможность получать и обновлять
пакеты Debian в данной системе. Когда установка завершится, можно
воспользоваться другой командой <prgn/dftp/, которая удаляет архивные файлы
пакета (".deb"). <prgn/dftp/ автоматически отслеживает изменения удалённой
файловой системы, сравнивая локальный файл Packages.gz с файлом удалённой
системы.

<sect1 id="dpkg-mountable">dpkg-mountable

<p>dpkg-mountable добавляет метод доступа, называемый `mountable' в список
dselect, который позволяет вам установку с любой файловой системы, указанной
в /etc/fstab (например, обычный раздел жёсткого диска или NFS сервер), и
при необходимости, самостоятельно монтирует и размонтирует файловые системы.

<p>Он, также, имеет некоторые дополнительные свойства, не отражённые в
стандартных методах dselect, например обеспечение локального дерева файлов
(или параллельно с главным дистрибутивом или полностью отдельно), и получение
только требуемых пакетов, вместо требуемого времени рекурсивного сканирования
каталогов, также как и протоколирования всех действий dpkg во время метода
install.

<sect id="upgradesingle">Должен ли я переходить в однопользовательский режим,
чтобы обновить пакет?

<p>Нет. Пакеты можно обновлять сразу, даже при работающей системе. Если
во время обновления пакета требуется остановка процесса, то на этот случай
в Debian есть программа <tt>start-stop-daemon</tt>, которая останавливает, а
затем перезапускает работавший ранее процесс.

<sect id="savedebs">Нужно ли мне сохранять на диске все архивные файлы .deb?

<p>Нет. Если вы скачали файлы на диск (что необязательно, смотрите описание
по dpkg-ftp или dftp выше), то после установки пакетов, вы можете удалить их
из своей системы.

<sect id="keepingalog">Как мне сохранить журнал пакетов, которые я добавил в
систему?

<p><prgn/dpkg/ хранит записи о пакетах, которые были распакованы, настроены,
убраны, и/или стёрты, но (на сегодняшний день) не сохраняет то, что выводится
на терминал при работе с пакетом. Некоторые пользователи преодолевают это
просто используя <prgn/tee/, например так:
<example>
dpkg -iGOEB -R main/binary non-free/binary contrib/binary | \
    tee -a /root/dpkg.log
</example>

Эта же команда, но записанная с длинными параметрами:
<example>
dpkg --install --refuse-downgrade --selected-only \
  --skip-same-version --auto-deconfigure \
  --recursive main/binary non-free/binary contrib/binary | \
    tee -a /root/dpkg.log
</example>

