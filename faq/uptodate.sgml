<chapt id="uptodate">Keeping Your Debian System Up To Date

<p>One of Debian goals is to provide a consistant upgrade path and a secure
upgrade process, and we always do our best to make the new release smoothly
upgradable from the previous ones. In case there's some important note to
add to the upgrade process, the packages will alert the user, and often
provide a solution to a possible problem.

<p>You should also read the Release Notes, document that describes the
details of specific upgrades, shipped on all Debian CDs, and available on
the WWW at <url id="http://www.debian.org/releases/stable/i386/release-notes/">.

<sect id="libc5to6upgrade">How can I upgrade my Debian 1.3.1 (or earlier)
  distribution, based on libc5, to 2.0 (or later), based on libc6?

<p>There are several ways to upgrade:
<list>
  <item>Using a simple shell script called <tt>autoup.sh</tt> which upgrades
    the most important packages. After <tt>autoup.sh</tt> has done his job,
    you may use dselect to install the remaining packages <em>en masse</em>.
    This is probably the recommended method, but not the only one.
    <p>Currently, the latest release of <tt>autoup.sh</tt> may be found on the
    following locations:
    <list>
      <item><url id="http://www.debian.org/releases/2.0/autoup/">
      <item><url id="http://www.taz.net.au/autoup/">
      <item><url id="http://csanders.vicnet.net.au/autoup/">
    </list>
  <item>Following closely the <url name="libc5-libc6-Mini-HOWTO"
    id="ftp://ftp.debian.org/pub/debian/doc/libc5-libc6-Mini-HOWTO.txt"> and
    upgrade the most important packages by hand. <tt>autoup.sh</tt> is based
    on this Mini-HOWTO, so this method should work more or less like using
    <tt>autoup.sh</tt>.
  <item>Using a libc5-based <tt>apt</tt>. APT stands for A Package Tool, and
    it might replace dselect some day. Currently, it works just as a
    command-line interface, or as a dselect access method. You will find a
    libc5 version in the <tt>dists/slink/main/upgrade-older-i386</tt>
    directory at the Debian archives.
  <item>Using just dselect, without upgrading any package by hand
    first. It is highly recommended that you do NOT use this method
    if you can avoid it, because dselect alone currently does not install
    packages in the optimal order. APT works much better and it is safer.
    <!-- This should probably work if dpkg's max-error-before-stop internal
    variable is increased. Question: Will it be increased some day? -->
</list>

<!--
This paragraph is obsolete, but I will keep it here as a reminder in
case libc6-based dpkg happen to be some better than the one in Debian
1.3.1: Note that the version of <tt>dpkg</tt> in this directory has the
a.out binary format.  The versions of <tt>dpkg</tt> in the development and
stable trees have the ELF format.
-->

<sect id="howtocurrent">How can I keep my Debian system current?

<p>One could simply execute an anonymous ftp call to a Debian archive, then
peruse the directories until he finds the desired file, and then fetch it,
and finally install it using <tt>dpkg</tt>.  Note that <tt>dpkg</tt>
will install upgrade files in place, even on a running system.
Sometimes, a revised package will require the installation of a newly revised
version of another package, in which case the installation will fail
until/unless the other package is installed.

<p>Many people find this approach much too time-consuming, since Debian
evolves so quickly -- typically, a dozen or more new packages are uploaded
every week.  This number is larger just before a new major release.
To deal with this avalanche, many people prefer to use an automated
programs.  Several different packages are available for this purpose:

<sect1 id="apt">APT

<p>APT is a management system for software packages, namely Debian binary
and source packages. apt-get is the command-line tool for handling packages,
and APT dselect method is an interface to APT through <prgn/dselect/, both
of which provide a simpler, safer way to install and upgrade packages.

<p>APT features complete installation ordering, multiple source capability
and several other unique features, see the User's Guide in
<tt>/usr/share/doc/apt/guide.html/index.html</tt>.

<!-- more details are missing... -->

<sect1 id="dpkg-ftp">dpkg-ftp

<p>This is an access method for <prgn/dselect/. It can be invoked from
within <prgn/dselect/, thereby allowing a user the ability to download
files and install them directly in one step.  To do this, bring up the
<prgn/dselect/ program, choose option "0" ("Choose the access method
to use"), highlight the option "ftp" then specify the remote hostname and
directory. <prgn/dpkg-ftp/ will then automatically download the files
that are selected (either in this session of <prgn/dselect/ or earlier
ones).

<p>Note that, unlike the <prgn/mirror/ program, <prgn/dpkg-ftp/ does
not grab everything at a mirror site. Rather, it downloads only those
files which you have selected (when first starting up <prgn/dpkg-ftp/),
and which need to be updated.

<sect1 id="mirror">mirror

<p>This Perl script, and its (optional) manager program called
<prgn/mirror-master/, can be used to fetch user-specified parts of
a directory tree from a specified host <em>via</em> anonymous FTP.

<p><prgn/mirror/ is particularly useful for downloading large volumes of
software.  After the first time files have been downloaded from a site, a
file called <tt>.mirrorinfo</tt> is stored on the local host.  Changes to
the remote filesystem are tracked automatically by <prgn/mirror/, which
compares this file to a similar file on the remote system and downloads only
changed files.

<p>The <prgn/mirror/ program is generally useful for updating local copies
of remote directory trees.  The files fetched need not be Debian files.
(Since <prgn/mirror/ is a Perl script, it can also run on non-Unix systems.)
Though the <prgn/mirror/ program provides mechanisms for excluding files
names of which match user-specified strings, this program is most useful
when the objective is to download whole directory trees, rather than
selected packages.

<!-- Should we recommend GNU wget here, too? -->

<sect1 id="dftp">dftp

<p>This Perl script can be used to fetch user-specified Debian packages from
a specified host.  It begins by downloading the Packages.gz files for the
directories specified by the user (e.g. stable, contrib, non-free) and
presents him with a list of packages.  These are placed in various
sections: new upgrades, downgrades, new packages, ignored upgrades, and
ignored packages.  The user then selects the packages he wants and dftp
downloads and installs them.  This makes it very easy to have your Debian
system 100% current all the time without downloading packages that you are
not going to install.

<p><prgn/dftp/ can be used to call <prgn/dselect/ (see <ref id="dselect">),
thereby providing an integrated way to fetch and update the Debian packages
on one's system.  When the installation is finished, another <prgn/dftp/
command can be used to remove the package archive (".deb") files.
Changes to the remote filesystem are tracked automatically by <prgn/dftp/,
which compares the local Packages.gz file to the files on the remote system.

<sect1 id="dpkg-mountable">dpkg-mountable

<p>dpkg-mountable adds an access method called `mountable' to dselect's
list, which allows you to install of any filesystem specified in /etc/fstab
(e.g. a normal hard disk partition, or an NFS server), which it will
automatically mount and umount for you if necessary.

<p>It also has some extra features not found in the standard dselect
methods, such as provision for a local file tree (either parallel to the
main distribution or totally separate), and only getting packages which are
required, rather than the time-consuming recursive directory scan, as well
as logging of all dpkg actions in the install method.

<sect id="upgradesingle">Must I go into single user mode in order to
  upgrade a package?

<p>No.  Packages can be upgraded in place, even in running systems.
Debian has a <tt>start-stop-daemon</tt> program that is invoked to stop,
then restart running process if necessary during a package upgrade.

<sect id="savedebs">Do I have to keep all those .deb archive files on
  my disk?

<p>No.  If you have downloaded the files to your disk (which is not
absolutely necessary, see above for dpkg-ftp or dftp descriptions),
then after you have installed the packages, you can remove them from
your system.

<sect id="keepingalog">How can I keep a log of the packages I added to
  the system?

<p><prgn/dpkg/ keeps a record of the packages that have been unpacked,
configured, removed, and/or purged, but does not (currently) keep a log
of terminal activity that occured while a package was being so manipulated.
Some users overcome this simply by using <prgn/tee/, like this:
<example>
dpkg -iGOEB -R main/binary non-free/binary contrib/binary | \
    tee -a /root/dpkg.log
</example>

The same command written using long options:
<example>
dpkg --install --refuse-downgrade --selected-only \
  --skip-same-version --auto-deconfigure \
  --recursive main/binary non-free/binary contrib/binary | \
    tee -a /root/dpkg.log
</example>
