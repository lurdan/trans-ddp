<chapt id="uptodate">Keeping your Debian system up-to-date

<p>A Debian goal is to provide a consistent upgrade path and a secure
upgrade process. We always do our best to make upgrading to new releases
a smooth procedure. In case there's some important note to
add to the upgrade process, the packages will alert the user, and often
provide a solution to a possible problem.

<p>You should also read the Release Notes, document that describes the
details of specific upgrades, shipped on all Debian CDs, and available on
the WWW at <url id="http://www.debian.org/releases/stable/releasenotes">.

<sect id="libc5to6upgrade">How can I upgrade my Debian 1.3.1 (or earlier)
  distribution, based on libc5, to 2.0 (or later), based on libc6?

<p>There are several ways to upgrade:
<list>
  <item>Using a simple shell script called <tt>autoup.sh</tt> which upgrades
    the most important packages. After <tt>autoup.sh</tt> has done his job,
    you may use dselect to install the remaining packages <em>en masse</em>.
    This is probably the recommended method, but not the only one.
    <p>Currently, the latest release of <tt>autoup.sh</tt> may be found on the
    following locations:
    <list>
      <item><url id="http://www.debian.org/releases/2.0/autoup/">
      <item><url id="http://www.taz.net.au/autoup/">
      <item><url id="http://debian.vicnet.net.au/autoup/">
    </list>
  <item>Following closely the <url name="Debian libc5 to libc6 Mini-HOWTO"
    id="http://debian.vicnet.net.au/autoup/HOWTO/libc5-libc6-Mini-HOWTO.html"> and
    upgrade the most important packages by hand. <tt>autoup.sh</tt> is based
    on this Mini-HOWTO, so this method should work more or less like using
    <tt>autoup.sh</tt>.
  <item>Using a libc5-based <tt>apt</tt>. APT stands for Advanced Package Tool, and
    it might replace dselect some day. Currently, it works just as a
    command-line interface, or as a dselect access method. You will find a
    libc5 version in the <tt>dists/slink/main/upgrade-older-i386</tt>
    directory at the Debian archives.
  <item>Using just dselect, without upgrading any package by hand
    first. It is highly recommended that you do NOT use this method
    if you can avoid it, because dselect alone currently does not install
    packages in the optimal order. APT works much better and it is safer.
    <!-- This should probably work if dpkg's max-error-before-stop internal
    variable is increased. Question: Will it be increased some day? -->
</list>

<!--
This paragraph is obsolete, but I will keep it here as a reminder in
case libc6-based dpkg happen to be some better than the one in Debian
1.3.1: Note that the version of <tt>dpkg</tt> in this directory has the
a.out binary format.  The versions of <tt>dpkg</tt> in the development and
stable trees have the ELF format.
-->

<sect id="howtocurrent">How can I keep my Debian system current?

<p>One could simply execute an anonymous ftp call to a Debian archive, then
peruse the directories until he finds the desired file, and then fetch it,
and finally install it using <tt>dpkg</tt>.  Note that <tt>dpkg</tt>
will install upgrade files in place, even on a running system.
Sometimes, a revised package will require the installation of a newly revised
version of another package, in which case the installation will fail
until/unless the other package is installed.

<p>Many people find this approach much too time-consuming, since Debian
evolves so quickly -- typically, a dozen or more new packages are uploaded
every week.  This number is larger just before a new major release.
To deal with this avalanche, many people prefer to use a more automated
method.  Several different packages are available for this purpose:

<sect1 id="apt">APT

<p>APT is an advanced interface to the Debian packaging system. apt-get is
the command-line tool for handling packages, and APT dselect method is an
interface to APT through <prgn/dselect/. Both of these provide a simpler,
safer way to install and upgrade packages.

<p>APT features complete installation ordering, multiple source capability
and several other unique features, see the User's Guide in
<tt>/usr/share/doc/apt-doc/guide.html/index.html</tt> (you will have
to install the <tt>apt-doc</tt> package).

<p>Install the <package/apt/ package, and edit the
<tt>/etc/apt/sources.list</tt> file to set it up. If you wish to upgrade to
the latest stable version of Debian, you'll probably want to use a source
like this one:

<example>http://http.us.debian.org/debian stable main contrib non-free</example>

<p>You can replace http.us.debian.org with the name of a faster Debian mirror
near you. See the mirror list at
<url id="http://www.debian.org/misc/README.mirrors"> for more information.

<p>Details on this can be found in <manref name="apt-get" section="8">
and <manref name="sources.list" section="8"> manual pages, as well as in
the aforementioned APT User's Guide, in
<tt>/usr/share/doc/apt-doc/guide.html/index.html</tt>.

<p>Then run
      <example>apt-get update</example>
followed by
      <example>apt-get dist-upgrade</example>
Answer any questions that might come up, and your system will be upgraded.

<p>To use APT with <prgn/dselect/, choose the APT access method in dselect's
method selection screen (option 0) and then specify the sources that should
be use. The configuration file is <file>/etc/apt/sources.list</file>, and
its format is described in the <manref name="sources.list" section="5">
manual page.

<p>If you want to use CDs to install packages, you can use <prgn/apt-cdrom/.
For details, please see the Release Notes, section "Setting up for an
upgrade from a local mirror".

<p>Please note that when you get and install the packages, you'll still have
them kept in your /var directory hierarchy. To keep your partition from
overflowing, remember to delete extra files using <tt>apt-get clean</tt> and
<tt>apt-get autoclean</tt>, or to move them someplace else (hint: use
<package/apt-move/).

<sect1 id="dpkg-ftp">dpkg-ftp

<p>This is an older access method for <prgn/dselect/. It can be invoked from
within <prgn/dselect/, thereby allowing a user the ability to download
files and install them directly in one step.  To do this, select the
<tt>ftp</tt> access method in <prgn/dselect/ (option 0) and specify
the remote host name and directory. <prgn/dpkg-ftp/ will then automatically
download the files that are selected (either in this session of
<prgn/dselect/ or earlier ones).

<p>Note that, unlike the <prgn/mirror/ program, <prgn/dpkg-ftp/ does
not grab everything at a mirror site. Rather, it downloads only those
files which you have selected (when first starting up <prgn/dpkg-ftp/),
and which need to be updated.

<p><prgn/dpkg-ftp/ is somewhat obsolete. You should use the APT access
method with ftp:// URLs in <file>sources.list</file> instead.

<sect1 id="mirror">mirror

<p>This Perl script, and its (optional) manager program called
<prgn/mirror-master/, can be used to fetch user-specified parts of
a directory tree from a specified host <em>via</em> anonymous FTP.

<p><prgn/mirror/ is particularly useful for downloading large volumes of
software.  After the first time files have been downloaded from a site, a
file called <tt>.mirrorinfo</tt> is stored on the local host.  Changes to
the remote file system are tracked automatically by <prgn/mirror/, which
compares this file to a similar file on the remote system and downloads only
changed files.

<p>The <prgn/mirror/ program is generally useful for updating local copies
of remote directory trees.  The files fetched need not be Debian files.
(Since <prgn/mirror/ is a Perl script, it can also run on non-Unix systems.)
Though the <prgn/mirror/ program provides mechanisms for excluding files
names of which match user-specified strings, this program is most useful
when the objective is to download whole directory trees, rather than
selected packages.

<!-- Should we recommend GNU wget here, too? -->

<sect1 id="dpkg-mountable">dpkg-mountable

<p>dpkg-mountable adds an access method called `mountable' to dselect's
list, which allows you to install from any file system specified in /etc/fstab.
For example, the archive could be a normal hard disk partition or an NFS 
server, which it will automatically mount and umount for you if necessary.

<p>It also has some extra features not found in the standard dselect
methods, such as provision for a local file tree (either parallel to the
main distribution or totally separate), and only getting packages which are
required, rather than the time-consuming recursive directory scan, as well
as logging of all dpkg actions in the install method.

<sect id="upgradesingle">Must I go into single user mode in order to
  upgrade a package?

<p>No.  Packages can be upgraded in place, even in running systems.
Debian has a <tt>start-stop-daemon</tt> program that is invoked to stop,
then restart running process if necessary during a package upgrade.

<sect id="savedebs">Do I have to keep all those .deb archive files on
  my disk?

<p>No.  If you have downloaded the files to your disk (which is not
absolutely necessary, see above for the description of dpkg-ftp),
then after you have installed the packages, you can remove them from
your system.

<sect id="keepingalog">How can I keep a log of the packages I added to
  the system?

<p><prgn/dpkg/ keeps a record of the packages that have been unpacked,
configured, removed, and/or purged, but does not (currently) keep a log
of terminal activity that occurred while a package was being so manipulated.

<p>The simplest way to work around this is to run your
<prgn>dpkg</prgn>/<prgn>dselect</prgn>/<prgn>apt-get</prgn>/whatever
sessions within the <manref name="script" section="1"> program.
