<!--
  english version: 1.7
  russian version: $Id: pkgtools.sgml,v 1.1 2002-04-21 15:42:26 joy Exp $
  -->

<chapt id="pkgtools">Средства управления пакетами Debian

<sect id="pkgprogs">Какие программы для управления пакетами имеются в
Debian?

<sect1 id="dpkg">dpkg

<p>Это основная программа управления пакетами. <prgn/dpkg/ может
использоваться с многими параметрами. Некоторые из них:
<list>
  <item>Вывести список всех параметров:  <tt>dpkg --help</tt>.
  <item>Вывести информацию для заданного пакета:
    <tt>dpkg --info foo_VVV-RRR.deb</tt>
  <item>Установить пакет (т.е. распаковать и настроить) на жесткий диск:
    <tt>dpkg --install foo_VVV-RRR.deb</tt>.
  <item>Распаковать (но не настраивать) файлы из архива Debian на
    жесткий диск: <tt>dpkg --unpack foo_VVV-RRR.deb</tt>.  Заметим, что
    данная операция <em>не</em> обязательно приводит пакет в рабочее
    состояние; некоторые файлы могут требовать внесения изменений для
    правильной работы. Данная команда удаляет любую ранее установленную
    версию программы и запускает сценарий preinst 
    (см. <ref id="maintscripts">), связаный с пакетом.
  <item>Настроить пакет который ранее был распакован:
    <tt>dpkg --configure foo</tt>.  Кроме всего прочего, эта команда
    запускает сценарий postinst (см. <ref id="maintscripts">) связанный
    с пакетом. Она также обновляет файлы перечисленные в <tt>conffiles</tt> 
    для этого пакета. Заметим, что данной команде передается в качестве
    аргумента имя пакета (т.е., foo), а <em/не/ имя файла архива Debian 
    (т.е., foo_VVV-RRR.deb).
  <item>Извлечь единственный файл с именем "blurf" (или группу файлов с
    именами "blurf*") из архива Debian:
    <tt>dpkg --fsys-tarfile foo_VVV-RRR.deb | tar -xf - blurf*</tt>
  <item>Удалить пакет (но не его файлы конфигурации):
    <tt>dpkg --remove foo</tt>.
  <item>Удалить пакет (в том числе и файлы конфигурации):
    <tt>dpkg --purge foo</tt>.
  <item>Перечислить статус (установлен или нет) пакетов содержащих
    в имени строку (или регулярное выражение) "foo*": 
    <tt>dpkg --list 'foo*'</tt>.
</list>

<sect1 id="dselect">dselect

<p>Данная программа является меню-ориентированным интерфейсом к системе
управления пакетами Debian. Она, в частности, используется при
первоначальной инсталляции и широкомасштабных обновлениях.

<p>Основные возможности <prgn/dselect/:
<list>
  <item>позволяет пользователю выбирать пакеты для установки и удаления,
    гарантирует, что устанавливаемые пакеты не конфликтуют друг с
    другом, и что все пакеты требуемые для правильной работы каждого
    пакета установлены;
  <item>предупреждает пользователя о противоречиях и несовместимостях,
    возникающих в процессе выбора;
  <item>определяет порядок в котором должны быть установлены пакеты;
  <item>автоматически выполняет установку и удаление; и
  <item>проводит пользователя через процесс конфигурации каждого пакета.
</list>

<p>При запуске <prgn/dselect/ предоставляет пользователю меню из семи
пунктов, каждый из которых выполняет определенное действие. Пользователь
может выбрать один из пунктов наведя на него подсвеченный прямоугольник при
помощи клавиш со стрелками, и нажав затем клавишу <em>&lt;enter&gt;</em>.

<p>То, что пользователь увидит дальше, зависит от выбранного действия.
Если выбран любой пункт кроме <tt>Access (Метод)</tt> и 
<tt>Select (Выбрать)</tt>, то <prgn/dselect/ просто выполнит указанное
действие: например, если пользователь выбрал пункт <tt>Remove (Удалить)</tt>,
то dselect произведет удаление всех файлов помеченных для удаления когда
пользователь выбирал пункт <tt>Select (Выбрать)</tt>.

<p>Пункты <tt>Access (Метод)</tt> и <tt>Select (Выбрать)</tt>, оба
предлагают дополнительные меню. В обоих случаях, эти меню делят экран по
вертикали; в верхней части представлен прокручиваемый список
возможностей для выбора, в то время, как в нижней части экрана дается
краткое описание каждого варианта.

<p>Доступна краткая справка о работе с программой, для ее вызова
используйте клавишу '?'.

<p>Порядок, в котором действия представлены в первом меню
<prgn/dselect/, отражает порядок в котором эти действия обычно
выбираются пользователем при установке пакетов. Однако, пользователь
может пользоваться каждым пунктом меню так часто, как это ему нужно.

<list>
  <item>Начните с выбора <strong/метода доступа (Access Method)/. Это
    способ которым пользователь получает доступ к пакетам Debian; напр.
    некоторые имеют компакт-диски с пакетами Debian, другие же скачивают
    эти пакеты по ftp. Выбранный метод доступа сохраняется после выхода
    из <prgn/dselect/, поэтому, если он не изменился, то нет
    необходимости вызывать этот пункт меню каждый раз.

  <item>Затем <strong/обновите (Update)/ список доступных пакетов. Для
    этого <prgn/dselect/ читает файл "Packages.gz", который находится в
    верхнем уровне дерева каталогов содержащего пакеты Debian. (Если его
    там нет, <prgn/dselect/ попытается сделать его для Вас.)

  <item><strong/Выберите (Select)/ нужные пакеты для установки на Вашей
    системе. После выбора данного пункта меню, пользователю показывается
    экран помощи (если не указан параметр `--expert' в командной
    строке). После выхода из экрана помощи, Вы увидите меню для выбора
    устанавливаемых или удаляемых пакетов.

    <p>Верхняя часть экрана содержит список всех &all-pkgs; пакетов
    Debian; нижняя часть экрана содержит описание пакета или группы
    пакетов, которые выделены выше. 

    <p>Для указания пакета, над которым будет совершаться операция,
    следует навести подсветку на его название. После этого можно выбрать
    требуемую операцию:
    <taglist>
      <tag>установить:
        <item>Это достигается нажатием клавиши `+'.
      <tag>удалить:
        <item>Пакеты могут удаляться двумя путями:
        <list>
          <item>remove: эта команда удаляет большинство файлов
	  принадлежащих пакету, но оставляет файлы помеченные как
	  конфигурационные (см. <ref id="conffile">) и информацию о
	  конфигурации пакета. Выполняется нажатием клавиши `-'.
          <item>purge: команда удаляет <em/каждый/ файл, являющийся
	  частью пакета. Выполняется нажатием клавиши `_'.
        </list>
        Заметим, что не возможно удалить "All Packages". Если Вы
	попытаетесь это сделать, то Ваша система будет сокращена до
	первоначально установленных базовых пакетов.
      <tag>заблокировать (hold):
        <item>Выполняется нажатием `=', и указывает <prgn/dselect/ не
	выполнять обновление пакета, даже если установленная версия
	устарела по сравнению с той, что имеется в используемом Вами
	хранилище пакетов Debian (оно указывается когда Вы определяете
	<strong/метод доступа (Access Method)/, и инициализируется при 
	выполнении <strong/обновления (Update)/).
        <p>Если пакет заблокирован, то разблокировать его можно нажатием
	`:'. Этим сообщается <prgn/dselect/, что пакет(ы) может быть
	обновлен если доступна более новая версия. Это установлено
	по-умолчанию.
    </taglist>

    <p>Вы можете выбирать различный порядок представления пакетов
    используя клавишу `o' для переключения между режимами сортировки.
    Изначально пакеты отсортированы по приоритету; а в пределах одного
    приоритета по разделу, к которому они относятся. 

    <p>Вы можете получить расширенное описание пакетов в верхней части
    экрана нажав клавишу `v'. Данное действие увеличивает объем
    выводимого текста, и он выходит за правую границу экрана. Для
    прокрутки текста можно пользоваться клавишами со стрелками вправо и
    влево.

    <p>Если Вы выбрали пакет для установки или удаления, напр.,
    <package/foo.deb/, и этот пакет зависит от (или рекомендует) других
    пакетов, напр. <package/blurf.deb/, то <prgn/dselect/ выведет
    дополнительный экран, подобный основному экрану выбора. Там Вы
    сможете выбрать среди пакетов относящихся к данному те, которые
    следует установить. Вы можете принять предлагаемый вариант или 
    отказаться от него. В последнем случае следует нажать Shift-D; для
    возврата к предлагаемому варианту, нажмите Shift-U. В любом случае
    Вы можете сохранить свой выбор нажатием Shift-Q. Для того, чтобы
    отказаться от установки пакета нажмите Shift-X.

  <item>После выбора пакетов Вы возвращаетесь в главное меню. Там Вы
  можете выбрать "Установить" (Install) для установки и конфигурирования
  выбраных пакетов. Если Вы отметили пакеты для удаления, то можете
  выбрать пункт "Удалить" (Remove). В любой момент времени можно выбрать
  пункт "Выход" (Quit) для выхода из программы; при этом пакеты
  отмеченные для установки и удаления сохраняются <prgn/dselect/.
</list>

<sect1 id="dpkg-deb">dpkg-deb

<p>Данная программа позволяет манипулировать файлами архивов
Debian (<tt>.deb</tt> файлами).
Общие случаи применения:
<list>
  <item>Вывести список допустимых параметров:  <tt>dpkg-deb --help</tt>.
  <item>Определить файлы содержащиеся в архиве Debian:
    <tt>dpkg-deb --contents foo_VVV-RRR.deb</tt>)
  <item>Извлечь файлы, содержащиеся в архиве Debian в указанный
  пользователем каталог: <tt>dpkg-deb --extract foo_VVV-RRR.deb tmp</tt>
    извлечет все файлы из <tt>foo_VVV-RRR.deb</tt> в каталог 
    <tt>tmp/</tt>. Это удобно для просмотра содержимого пакета в
    изолированном каталоге без его установки в основное дерево
    каталогов.
</list>

<p>Заметим, что любые пакеты просто распакованные командой <tt/dpkg-deb
--extract/ будут установлены некорректно, для установки следует
использоват <tt/dpkg --install/.

<p>Больше информации дано в странице руководства <manref name="dpkg-deb"
section="1">.

<sect1 id="apt-get">apt-get

<p><prgn/apt-get/ обеспечивает простой метод для установки пакетов из
командной строки. В отличие от <prgn/dpkg/, <prgn/apt-get/ не работает с
.deb файлами, она работает с правильными именами пакетов и может
устанавливать пакеты только из источников указанных в файле
<file>/etc/apt/sources.list</file>.

<p>Для получения более подробной информации, установите пакет <package/apt/
и ознакомьтесь с
<manref name="apt-get" section="8">, <manref name="sources.list" section="5">
и <file>/usr/share/doc/apt/guide.html/index.html</file>.

<sect1 id="dpkg-split">dpkg-split

<p>Эта программа делит большие пакеты на файлы меньшего размера (напр.,
для записи на дискеты), и, также, может использоваться для объединения
набора разделенных файлов обратно в один файл. Она может использоваться
только в системах Debian (т.е. в системах содержащих пакет <package/dpkg/),
т.к. вызывает программу <tt>dpkg-deb</tt> для разделения файла пакета на
отдельные компоненты.

<p>Например, для того, чтобы разделить большой .deb файл на части,
<list>
  <item>Выполните команду <tt>dpkg-split --split foo.deb</tt>.
    В результате получится несколько файлов, приблизительно по 460 Кбайт
    каждый, в текущем каталоге.
  <item>Скопируйте эти файлы на дискеты.
  <item>Скопируйте содержимое дисет на жесткий диск другой машины.
  <item>Объедините эти файлы вместе командой 
    <tt>dpkg-split --join "foo*"</tt>.
</list>

<sect id="updaterunning">Debian утверждает, что способен обновить
работающую программу; каким образом это достигается?

<p>Ядро в системах &debian; позволяет замену файлов даже если они
используются.

<p>Мы, также, предоставляем программу <prgn/start-stop-daemon/, которая
используется для запуска демонов при загрузке или их останова при смене
уровня выполнения (напр., из многопользовательского в
однопользовательский или на завершение работы). Эта же программа
используется сценариями установки при инсталяции нового пакета
содержащего демон, для остановки работающего демона и его перезапуска по
мере необходимости.

<sect id="whatpackages">Как я могу узнать какие пакеты установлены в
  системе?

<p>Чтобы получить список всех установленных пакетов, выполните команду
  <example>dpkg --list</example>

Эта команда выведет для каждого пакета строчку, содержащую
двухсимвольный статус (обозначения раскрыты в заголовке), имя пакета,
версию, которая <em>установлена</em>, и краткое описание.

<p>Чтобы узнать статус пакетов, имена которых начинаются с "foo",
выполните команду:
  <example>dpkg --list 'foo*'</example>

<p>Чтобы получить более подробный отчет о состоянии отдельного пакета,
выполните команду:
  <example>dpkg --status packagename</example>

<sect id="filesearch">Как найти пакет содержащий конкретный файл?

<p>Чтобы определить в каком пакете содержится файл с именем <tt>foo</tt>
вполните одну из следующих команд:

<list>
  <item><tt>dpkg --search filename</tt>
    <p>Команда ищет <tt>filename</tt> в установленых пакетах.
    (Это (в настоящий момент) эквивалентно поиску всех файлов с
    расширением <tt>.list</tt> в каталоге <tt>/var/lib/dpkg/info/</tt>,
    и выводу имен тех из них, которые содержат заданный filename, вместе
    со строкой, содержащей этот параметр). 

  <item><tt>zgrep foo Contents-ARCH.gz</tt>
    <p>Команда выполняет поиск файлов содержащих подстроку <tt>foo</tt>
    в своем полном имени. Файлы <tt>Contents-ARCH.gz</tt> (где ARCH
    определяет архитектуру) расположены в основных каталогах пакетов
    (main, non-free, contrib) на FTP сайте Debian. Файлы <tt>Contents</tt>
    содержат ссылки на пакеты находящиеся только в подкаталогах
    соответствующего каталога. Следовательно, может потребоваться поиск
    более чем в одном файле <tt>Contents</tt> для нахождения пакета
    содержащего файл <tt>foo</tt>.

    <p>Данный метод имеет преимущество над <tt>dpkg --search</tt> в том, 
    что он находит файлы в пакетах не установленных в системе.
</list>
