<chapt id="kernel">Debian i j±dro systemu

<sect id="non-debian-kernel">Czy mogê skompilowaæ i zainstalowaæ j±dro systemu
bez dostosowywania go do specyfiki Debiana?

<p>Tak.

<p>Z jednym tylko zastrze¿eniem: biblioteki jêzyka C w systemie Debian
s± budowane z wykorzystaniem najnowszych <em>stabilnych</em> wersji plików
nag³ówkowych <strong>j±dra systemu</strong>. Je¶li chcesz skompilowaæ program
z wykorzystaniem nowszych plików nag³ówkowych j±dra ni¿ te ze stabilnej
wersji, stoisz przed wyborem pomiêdzy uaktualnieniem pakietu zawieraj±cego
pliki nag³ówkowe (<package/libc6-dev/), a u¿yciem nowych plików nag³ówkowych,
które znajduj± siê w katalogu z rozpakowanymi plikami ¼ród³owymi j±dra.
Je¿eli pliki ¼ród³owe j±dra znajduj± siê w katalogu 
<file>/usr/src/linux/</file>, wtedy przy kompilowaniu do polecenia musisz 
dodaæ opcjê <tt>-I/usr/src/linux/include/</tt>.

<sect id="customkernel">Jakich narzêdzi dostarcza system Debian w celu 
budowania w³asnych wersji j±dra systemu?

<p>U¿ytkownicy którzy pragn± zbudowaæ w³asn± wersjê j±dra systemu mog± pobraæ
i zainstalowaæ pakiet <package/kernel-package/. Zawiera on skrypt wykonuj±cy
kompilacjê i umo¿liwia stworzenie pakietu Debiana z gotowym j±drem przy pomocy
polecenia  <example>make-kpkg kernel_image</example>, które nale¿y wpisaæ
znajduj±c siê w katalogu z plikami ¼ród³owymi j±dra. Wiêcej informacji mo¿na
uzyskaæ przy pomocy polecenia <example>make-kpkg --help</example>
lub podrêcznika systemowego <manref name="make-kpkg" section="1">.

<p>Poniewa¿ opisany pakiet nie zawiera plików ¼ród³owych j±dra, u¿ytkownicy
musz± pobraæ je oddzielnie z wybranego przez siebie serwera lub w postaci
pakietu Debiana je¶li pakiet kernel-source-wersja jest dostêpny
(gdzie wersja to numer po¿±danej wersji j±dra).

<p>Szczegó³owe instrukcje dotycz±ce korzystania z pakietu 
<package/kernel-package/ mo¿na znale¼æ w pliku
<file>/usr/share/doc/kernel-package/README.gz</file>. W skrócie powinno siê:

<list>
  <item>Rozpakowaæ pliki ¼ród³owe j±dra i przenie¶æ siê do nowo powsta³ego
    katalogu przy pomocy polecenia <tt>cd</tt>.
  <item>Dostosowaæ konfiguracjê j±dra do w³asnych potrzeb przy pomocy jednego
  	z poni¿szych poleceñ:
    <list>
      <item><tt>make config</tt>
        (interfejs tekstowy zadaj±cy kolejno pytania).
      <item><tt>make menuconfig</tt> (interfejs tekstowy wykorzystuj±cy 
      	bibliotekê ncurses z opcjami pogrupowanymi w menu).
        Aby móc korzystaæ z tego polecenia musisz mieæ
	    zainstalowany pakiet <package/libncurses5-dev/.
      <item><tt>make xconfig</tt>  (interfejs graficzny X11).
        Korzystanie z tej opcji wymaga zainstalowania istotnych pakietów
	    zwi±zanych z X11 i Tcl/Tk.
    </list>
    Wykorzystanie któregokolwiek z powy¿szych poleceñ spowoduje utworzenie
    nowego pliku <tt>.config</tt> w katalogu z plikami ¼ród³owymi.

  <item>Wprowadziæ polecenie: <tt>make-kpkg -rev TwojaNazwa.N kernel_image
    </tt>, przy czym N oznacza nadany przez Ciebie numer. Stworzony w wyniku
    tak przeprowadzonej kompilacji pakiet z j±drem bêdzie posiada³ unikatowy
    stworzony przez Ciebie symbol wersji TwojaNazwa.1, np.:
    <tt>kernel-image-2.2.14_TwojaNazwa.1_i386.deb</tt> dla j±dra w wersji
    2.2.14.

  <item>Zainstalowaæ stworzony w ten sposób pakiet.
    <list>
      <item>Uruchom <tt>dpkg --install /usr/src/kernel-image-VVV_Custom.N.deb
        </tt> aby zainstalowaæ j±dro. Skrypt instalacyjny:
        <list>
          <item>uruchomi program ³aduj±cy system, LILO (je¶li ten jest
	    zainstalowany),
          <item>zainstaluje skompilowane przez Ciebie j±dro w katalogu /boot 
	    pod nazw± vmlinuz_VVV-TwojaNazwa.N i stworzy odpowiednie
	    dowi±zania symboliczne.
          <item>zapyta u¿ytkownika czy wykonaæ dyskietkê startow±. Dyskietka 
	    taka zawiera jedynie plik z j±drem. Aby dowiedzieæ siê wiêcej
	    zobacz <ref id="custombootdisk">.
        </list>
          <item>Aby wykorzystaæ jeden z pozosta³ych programów ³aduj±cych
	    system takich jak <package/grub/ czy <tt/loadlin/, skopiuj ten plik
	    w inne miejsce (np. do katalogu /boot/grub lub na partycjê
	    z systemem plików <tt>MS-DOS</tt>).
    </list>
  </list>

<!-- TODO: check out a new source of details, this README isn't too useful,
I'm told (joy) -->
<sect id="custombootdisk">W jaki sposób mogê wykonaæ w³asn± wersjê dyskietki 
  startowej?

<p>Do tego celu mo¿esz z powodzeniem pos³u¿yæ siê pakietem 
<package/boot-floppies/, który znajduje siê w sekcji <tt>admin</tt> zasobów
FTP Debiana. Skrypt pow³oki znajduj±cy siê w tym pakiecie tworzy
dyskietki startowe w formacie <tt>SYSLINUX</tt>. S± to dyskietki z systemem
plików <tt>MS-DOS</tt>, których g³ówny rekord startowy zosta³ zmodyfikowany
tak aby bezpo¶rednio ³adowa³ j±dro Linuksa (lub innego systemu w zale¿no¶ci
od definicji zawartej w pliku syslinux.cfg znajduj±cym siê na dyskietce).
Pozosta³e skrypty w tym pakiecie s³u¿± do tworzenia dyskietek awaryjnych lub instalacyjnych.

<p>Wiêcej informacji znajdziesz w pliku <tt>/usr/doc/boot-floppies/README</tt>
po zainstalowaniu pakietu <package/boot-floppies/.

<sect id="modules">Jakie narzêdzia udostêpnia Debian do obs³ugi modu³ów?

<p>Pakiet Debiana <package/modconf/ udostêpnia skrypt pow³oki
(<tt>/usr/sbin/modconf</tt>), który mo¿e byæ wykorzystywany do dostosowywania 
konfiguracji modu³ów dla w³asnych potrzeb. Skrypt ten oferuje interfejs oparty
o menu, który pyta u¿ytkownika o szczegó³y dotycz±ce modu³ów sterowników
urz±dzeñ w systemie. Uzyskane odpowiedzi s³u¿± do stworzenia odpowiednich
wpisów w pliku <tt>/etc/modules.conf</tt> (który zawiera listê aliasów/skrótów
i parametry które zostan± u¿yte przy ³adowaniu modu³ów). S± równie¿ konieczne
do stworzenia plików znajduj±cych siê w katalogu <tt>/etc/modutils/</tt>
oraz zawarto¶ci pliku <tt>/etc/modules</tt> (który zawiera listê modu³ów
³adowanych w czasie startu systemu).

<p>Podobnie jak (nowe) pliki Configure.help, które teraz pomagaj± przy
tworzeniu w³asnych wersji j±dra, pakiet modconf zawiera pliki pomocy 
(znajduj±ce siê w katalogu <tt>/usr/lib/modules_help/</tt>), które dostarczaj±
szczegó³owych informacji na temat parametrów w³a¶ciwych dla poszczególnych
modu³ów.

<sect id="removeoldkernel">Czy mogê bezpiecznie odinstalowaæ pakiet ze starym
   j±drem?

<p>Tak. Skrypt <tt>kernel-image-NNN.prerm</tt> sprawdza, czy j±dro które chcesz usun±æ nie jest tym, którego w³a¶nie u¿ywasz. W ka¿dym przypadku
mo¿esz usun±æ pakiety z niechcianym j±drem u¿ywaj±c polecenia

<example>dpkg --purge --force-remove-essential kernel-image-VVV</example>

(zastêpuj±c oczywi¶cie "VVV" numerem wersji j±dra)
