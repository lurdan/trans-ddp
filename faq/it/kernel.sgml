<chapt id="kernel">Debian e il kernel

<sect id="non-debian-kernel">Posso installare e compilare un kernel senza alcun adattamento
  specifico per Debian?

<p>Sì.

<p>C'è solo una trappola: le librerie C di Debian sono compilate con la più recente
release <em>stabile</em> degli header del <strong>kernel</strong>.
Se capita di aver bisogno di compilare un programma con gli header del kernel
più nuovi rispetto a quelli nella serie stabile allora si dovrebbe aggiornare
il pacchetto contenente gli header (<package/libc6-dev/) oppure usare i nuovi
header da un albero di directory del kernel più recente. Così, se i sorgenti
del kernel sono in <file>/usr/src/linux</file>, si dovrebbe aggiungere
<tt>-I/usr/src/linux/include/</tt> alla propria riga di comando quando si compila.

<sect id="customkernel">Quali strumenti fornisce Debian per costruire kernel personalizzati?

<p>Gli utenti che desiderano (o devono) costruirsi un kernel personalizzato sono
incoraggiati a scaricare il pacchetto <package/kernel-package/. Questo pacchetto
contiene lo script per costruire il pacchetto kernel e fornisce la
possibilità di creare un pacchetto Debian kernel-image solo eseguendo il comando
  <example>make-kpkg kernel_image</example>
nel livello più alto della directory dei sorgenti del kernel.
L'aiuto è disponibile eseguendo il comando
  <example>make-kpkg --help</example>
e attraverso la pagina di manuale <manref name="make-kpkg" section="8">.

<p>Gli utenti devono scaricare separatamente il codice sorgente per il
kernel più recente (o il kernel di propria scelta) dall'archivio del
proprio sito Linux preferito, a meno che un pacchetto kernel-source-version
sia disponibile (dove "version" rappresenta la versione del kernel).

<p>Istruzioni dettagliate sull'uso del pacchetto <package/kernel-package/
sono fornite nel file <tt>/usr/doc/kernel-package/README</tt>. In breve, si dovrebbe:

<list>
  <item>Spacchettare i sorgenti del kernel e <tt>cd</tt> alla nuova directory creata.
  <item>Modificare la configurazione del kernel usando uno di questi comandi:
    <list>
      <item><tt>make config</tt> (per un'interfaccia tty una-riga-alla-volta).
      <item><tt>make menuconfig</tt> (per un'interfaccia a menu basata su ncurses).
        Si noti che se si usa questa opzione, il pacchetto <package/libncurses5-dev/
        deve essere installato.
      <item><tt>make xconfig</tt> (per un'interfaccia X11).
        Usare questa opzione richiede che pacchetti rilevanti di X e Tcl/Tk siano installati.
    </list>
    Ognuno dei passi sopra genera un nuovo <tt>.config</tt> nel livello più alto
    della directory dei sorgenti del kernel.
  <item>Eseguire il comando: <tt>make-kpkg -rev Custom.N kernel_image</tt>,
    dove N è un numero di revisione assegnato dall'utente.
    Il nuovo archivio Debian così formato dovrebbe avere revisione Custom.1, p.e.,
    <tt>kernel-image-2.2.14_Custom.1_i386.deb</tt>
    per il kernel Linux 2.2.14.
  <item>Installare il pacchetto creato.
    <list>
    <item><tt>Si esegua dpkg --install /usr/src/kernel-image-VVV_Custom.N.deb</tt>
      per installare il kernel. Lo script di installazione:
      <list>
        <item>eseguirà il boot loader, LILO (se è installato),
        <item>installerà il kernel personalizzato in /boot/vmlinuz_VVV-Custom.N e
          imposterà gli appropriati link simbolici alla versione del kernel
          più recente.
        <item>chiederà all'utente di fare un floppy di avvio. Questo
          floppy conterrà solo il kernel. Si veda <ref id="custombootdisk">.
      </list>
    <item>Per servirsi di boot loader secondari come <package/grub/ o
      <tt/loadlin/, si copi questa immagine in altri posti (p.e., in /boot/grub
      o su una partizione <tt>MS-DOS</tt>).
  </list>
</list>

<!-- TODO: check out a new source of details, this README isn't too useful,
I'm told (joy) -->
<sect id="custombootdisk">Come posso creare un floppy di avvio personalizzato?

<p>Questo compito è molto semplificato dal pacchetto Debian <package/boot-floppies/,
che si trova normalmente nella sezione <tt>admin</tt> dell'archivio FTP Debian.
Gli script di shell in questo pacchetto producono floppy di boot nel formato <tt>SYSLINUX</tt>.
Questi sono floppy formattati <tt>MS-DOS</tt> i cui master boot record sono stati alterati
così che possano avviare direttamente Linux (o qualsiasi altro sistema operativo
sia stato definito nel file syslinux.cfg sul floppy). Altri script in questo pacchetto
producono dischi di root di emergenza e possono anche riprodurre i dischi base.

<p>Si troveranno maggiori informazioni su questo nel file
<tt>/usr/doc/boot-floppies/README</tt> dopo aver installato il pacchetto
<package/boot-floppies/.

<sect id="modules">Quali strumenti speciali fornisce Debian per lavorare con i moduli?

<p>Il pacchetto <package/modconf/ di Debian fornisce uno script di shell
(<tt>/usr/sbin/modconf</tt>) che può essere usato per personalizzare
la configurazione dei moduli. Questo script presenta un'interfaccia basata su menu
che chiede all'utente particolari sui dispositivi driver caricabili nel suo sistema.
Le risposte sono usate per personalizzare il file <tt>/etc/modules.conf</tt> (che elenca
gli alias ed altri argomenti che devono essere usati in congiunzione con i vari moduli)
attraverso i file in <tt>/etc/modutils/</tt> e <tt>/etc/modules</tt> (che elenca i
moduli che devono essere caricati all'avvio).

<p>Come i (nuovi) file Configure.help sono ora disponibili per supportare
la costruzione di kernel personalizzati, il pacchetto modconf nasce con una serie
di file di aiuto (in <tt>/usr/lib/modules_help/</tt>) che forniscono
informazioni dettagliate sugli argomenti appropriati per ognuno dei moduli.

<sect id="removeoldkernel">Posso disinstallare con sicurezza un vecchio pacchetto kernel e,
  se sì, come?

<p>Sì. Lo script <tt>kernel-image-NNN.prerm</tt> verifica se il kernel
che si sta correntemente usando è lo stesso kernel che si sta tentando di
disinstallare. Quindi si può rimuovere il pacchetto dell'immagine del
kernel che non si vuole usando questo comando:

<example>dpkg --purge --force-remove-essential kernel-image-NNN</example>

(si sostituisca "NNN" con la propria versione e numero di revisione del kernel, ovviamente)